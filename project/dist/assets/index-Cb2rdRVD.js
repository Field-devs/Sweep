function CL(t,r){for(var o=0;o<r.length;o++){const u=r[o];if(typeof u!="string"&&!Array.isArray(u)){for(const f in u)if(f!=="default"&&!(f in t)){const _=Object.getOwnPropertyDescriptor(u,f);_&&Object.defineProperty(t,f,_.get?_:{enumerable:!0,get:()=>u[f]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))u(f);new MutationObserver(f=>{for(const _ of f)if(_.type==="childList")for(const b of _.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&u(b)}).observe(document,{childList:!0,subtree:!0});function o(f){const _={};return f.integrity&&(_.integrity=f.integrity),f.referrerPolicy&&(_.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?_.credentials="include":f.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function u(f){if(f.ep)return;f.ep=!0;const _=o(f);fetch(f.href,_)}})();var ps=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Dh(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function l1(t){if(t.__esModule)return t;var r=t.default;if(typeof r=="function"){var o=function u(){return this instanceof u?Reflect.construct(r,arguments,this.constructor):r.apply(this,arguments)};o.prototype=r.prototype}else o={};return Object.defineProperty(o,"__esModule",{value:!0}),Object.keys(t).forEach(function(u){var f=Object.getOwnPropertyDescriptor(t,u);Object.defineProperty(o,u,f.get?f:{enumerable:!0,get:function(){return t[u]}})}),o}var YC={exports:{}},v_={},JC={exports:{}},or={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fp=Symbol.for("react.element"),kL=Symbol.for("react.portal"),IL=Symbol.for("react.fragment"),AL=Symbol.for("react.strict_mode"),ML=Symbol.for("react.profiler"),PL=Symbol.for("react.provider"),RL=Symbol.for("react.context"),LL=Symbol.for("react.forward_ref"),zL=Symbol.for("react.suspense"),DL=Symbol.for("react.memo"),OL=Symbol.for("react.lazy"),cT=Symbol.iterator;function BL(t){return t===null||typeof t!="object"?null:(t=cT&&t[cT]||t["@@iterator"],typeof t=="function"?t:null)}var QC={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ek=Object.assign,tk={};function Oh(t,r,o){this.props=t,this.context=r,this.refs=tk,this.updater=o||QC}Oh.prototype.isReactComponent={};Oh.prototype.setState=function(t,r){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,r,"setState")};Oh.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function rk(){}rk.prototype=Oh.prototype;function u1(t,r,o){this.props=t,this.context=r,this.refs=tk,this.updater=o||QC}var c1=u1.prototype=new rk;c1.constructor=u1;ek(c1,Oh.prototype);c1.isPureReactComponent=!0;var hT=Array.isArray,nk=Object.prototype.hasOwnProperty,h1={current:null},ik={key:!0,ref:!0,__self:!0,__source:!0};function sk(t,r,o){var u,f={},_=null,b=null;if(r!=null)for(u in r.ref!==void 0&&(b=r.ref),r.key!==void 0&&(_=""+r.key),r)nk.call(r,u)&&!ik.hasOwnProperty(u)&&(f[u]=r[u]);var T=arguments.length-2;if(T===1)f.children=o;else if(1<T){for(var a=Array(T),I=0;I<T;I++)a[I]=arguments[I+2];f.children=a}if(t&&t.defaultProps)for(u in T=t.defaultProps,T)f[u]===void 0&&(f[u]=T[u]);return{$$typeof:fp,type:t,key:_,ref:b,props:f,_owner:h1.current}}function FL(t,r){return{$$typeof:fp,type:t.type,key:r,ref:t.ref,props:t.props,_owner:t._owner}}function d1(t){return typeof t=="object"&&t!==null&&t.$$typeof===fp}function jL(t){var r={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(o){return r[o]})}var dT=/\/+/g;function Rv(t,r){return typeof t=="object"&&t!==null&&t.key!=null?jL(""+t.key):r.toString(36)}function vg(t,r,o,u,f){var _=typeof t;(_==="undefined"||_==="boolean")&&(t=null);var b=!1;if(t===null)b=!0;else switch(_){case"string":case"number":b=!0;break;case"object":switch(t.$$typeof){case fp:case kL:b=!0}}if(b)return b=t,f=f(b),t=u===""?"."+Rv(b,0):u,hT(f)?(o="",t!=null&&(o=t.replace(dT,"$&/")+"/"),vg(f,r,o,"",function(I){return I})):f!=null&&(d1(f)&&(f=FL(f,o+(!f.key||b&&b.key===f.key?"":(""+f.key).replace(dT,"$&/")+"/")+t)),r.push(f)),1;if(b=0,u=u===""?".":u+":",hT(t))for(var T=0;T<t.length;T++){_=t[T];var a=u+Rv(_,T);b+=vg(_,r,o,a,f)}else if(a=BL(t),typeof a=="function")for(t=a.call(t),T=0;!(_=t.next()).done;)_=_.value,a=u+Rv(_,T++),b+=vg(_,r,o,a,f);else if(_==="object")throw r=String(t),Error("Objects are not valid as a React child (found: "+(r==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":r)+"). If you meant to render a collection of children, use an array instead.");return b}function Wm(t,r,o){if(t==null)return t;var u=[],f=0;return vg(t,u,"","",function(_){return r.call(o,_,f++)}),u}function NL(t){if(t._status===-1){var r=t._result;r=r(),r.then(function(o){(t._status===0||t._status===-1)&&(t._status=1,t._result=o)},function(o){(t._status===0||t._status===-1)&&(t._status=2,t._result=o)}),t._status===-1&&(t._status=0,t._result=r)}if(t._status===1)return t._result.default;throw t._result}var ki={current:null},xg={transition:null},UL={ReactCurrentDispatcher:ki,ReactCurrentBatchConfig:xg,ReactCurrentOwner:h1};function ok(){throw Error("act(...) is not supported in production builds of React.")}or.Children={map:Wm,forEach:function(t,r,o){Wm(t,function(){r.apply(this,arguments)},o)},count:function(t){var r=0;return Wm(t,function(){r++}),r},toArray:function(t){return Wm(t,function(r){return r})||[]},only:function(t){if(!d1(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};or.Component=Oh;or.Fragment=IL;or.Profiler=ML;or.PureComponent=u1;or.StrictMode=AL;or.Suspense=zL;or.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=UL;or.act=ok;or.cloneElement=function(t,r,o){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var u=ek({},t.props),f=t.key,_=t.ref,b=t._owner;if(r!=null){if(r.ref!==void 0&&(_=r.ref,b=h1.current),r.key!==void 0&&(f=""+r.key),t.type&&t.type.defaultProps)var T=t.type.defaultProps;for(a in r)nk.call(r,a)&&!ik.hasOwnProperty(a)&&(u[a]=r[a]===void 0&&T!==void 0?T[a]:r[a])}var a=arguments.length-2;if(a===1)u.children=o;else if(1<a){T=Array(a);for(var I=0;I<a;I++)T[I]=arguments[I+2];u.children=T}return{$$typeof:fp,type:t.type,key:f,ref:_,props:u,_owner:b}};or.createContext=function(t){return t={$$typeof:RL,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:PL,_context:t},t.Consumer=t};or.createElement=sk;or.createFactory=function(t){var r=sk.bind(null,t);return r.type=t,r};or.createRef=function(){return{current:null}};or.forwardRef=function(t){return{$$typeof:LL,render:t}};or.isValidElement=d1;or.lazy=function(t){return{$$typeof:OL,_payload:{_status:-1,_result:t},_init:NL}};or.memo=function(t,r){return{$$typeof:DL,type:t,compare:r===void 0?null:r}};or.startTransition=function(t){var r=xg.transition;xg.transition={};try{t()}finally{xg.transition=r}};or.unstable_act=ok;or.useCallback=function(t,r){return ki.current.useCallback(t,r)};or.useContext=function(t){return ki.current.useContext(t)};or.useDebugValue=function(){};or.useDeferredValue=function(t){return ki.current.useDeferredValue(t)};or.useEffect=function(t,r){return ki.current.useEffect(t,r)};or.useId=function(){return ki.current.useId()};or.useImperativeHandle=function(t,r,o){return ki.current.useImperativeHandle(t,r,o)};or.useInsertionEffect=function(t,r){return ki.current.useInsertionEffect(t,r)};or.useLayoutEffect=function(t,r){return ki.current.useLayoutEffect(t,r)};or.useMemo=function(t,r){return ki.current.useMemo(t,r)};or.useReducer=function(t,r,o){return ki.current.useReducer(t,r,o)};or.useRef=function(t){return ki.current.useRef(t)};or.useState=function(t){return ki.current.useState(t)};or.useSyncExternalStore=function(t,r,o){return ki.current.useSyncExternalStore(t,r,o)};or.useTransition=function(){return ki.current.useTransition()};or.version="18.3.1";JC.exports=or;var ve=JC.exports;const Sn=Dh(ve),VL=CL({__proto__:null,default:Sn},[ve]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $L=ve,GL=Symbol.for("react.element"),WL=Symbol.for("react.fragment"),qL=Object.prototype.hasOwnProperty,HL=$L.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ZL={key:!0,ref:!0,__self:!0,__source:!0};function ak(t,r,o){var u,f={},_=null,b=null;o!==void 0&&(_=""+o),r.key!==void 0&&(_=""+r.key),r.ref!==void 0&&(b=r.ref);for(u in r)qL.call(r,u)&&!ZL.hasOwnProperty(u)&&(f[u]=r[u]);if(t&&t.defaultProps)for(u in r=t.defaultProps,r)f[u]===void 0&&(f[u]=r[u]);return{$$typeof:GL,type:t,key:_,ref:b,props:f,_owner:HL.current}}v_.Fragment=WL;v_.jsx=ak;v_.jsxs=ak;YC.exports=v_;var nt=YC.exports,lk={exports:{}},gs={},uk={exports:{}},ck={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function r(lt,st){var kt=lt.length;lt.push(st);e:for(;0<kt;){var It=kt-1>>>1,Bt=lt[It];if(0<f(Bt,st))lt[It]=st,lt[kt]=Bt,kt=It;else break e}}function o(lt){return lt.length===0?null:lt[0]}function u(lt){if(lt.length===0)return null;var st=lt[0],kt=lt.pop();if(kt!==st){lt[0]=kt;e:for(var It=0,Bt=lt.length,tn=Bt>>>1;It<tn;){var Yt=2*(It+1)-1,Kr=lt[Yt],jr=Yt+1,dr=lt[jr];if(0>f(Kr,kt))jr<Bt&&0>f(dr,Kr)?(lt[It]=dr,lt[jr]=kt,It=jr):(lt[It]=Kr,lt[Yt]=kt,It=Yt);else if(jr<Bt&&0>f(dr,kt))lt[It]=dr,lt[jr]=kt,It=jr;else break e}}return st}function f(lt,st){var kt=lt.sortIndex-st.sortIndex;return kt!==0?kt:lt.id-st.id}if(typeof performance=="object"&&typeof performance.now=="function"){var _=performance;t.unstable_now=function(){return _.now()}}else{var b=Date,T=b.now();t.unstable_now=function(){return b.now()-T}}var a=[],I=[],D=1,j=null,V=3,q=!1,se=!1,pe=!1,be=typeof setTimeout=="function"?setTimeout:null,te=typeof clearTimeout=="function"?clearTimeout:null,X=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ie(lt){for(var st=o(I);st!==null;){if(st.callback===null)u(I);else if(st.startTime<=lt)u(I),st.sortIndex=st.expirationTime,r(a,st);else break;st=o(I)}}function Se(lt){if(pe=!1,ie(lt),!se)if(o(a)!==null)se=!0,Sr(Ce);else{var st=o(I);st!==null&&xn(Se,st.startTime-lt)}}function Ce(lt,st){se=!1,pe&&(pe=!1,te(qe),qe=-1),q=!0;var kt=V;try{for(ie(st),j=o(a);j!==null&&(!(j.expirationTime>st)||lt&&!Tt());){var It=j.callback;if(typeof It=="function"){j.callback=null,V=j.priorityLevel;var Bt=It(j.expirationTime<=st);st=t.unstable_now(),typeof Bt=="function"?j.callback=Bt:j===o(a)&&u(a),ie(st)}else u(a);j=o(a)}if(j!==null)var tn=!0;else{var Yt=o(I);Yt!==null&&xn(Se,Yt.startTime-st),tn=!1}return tn}finally{j=null,V=kt,q=!1}}var Le=!1,Ne=null,qe=-1,it=5,Ae=-1;function Tt(){return!(t.unstable_now()-Ae<it)}function $t(){if(Ne!==null){var lt=t.unstable_now();Ae=lt;var st=!0;try{st=Ne(!0,lt)}finally{st?pt():(Le=!1,Ne=null)}}else Le=!1}var pt;if(typeof X=="function")pt=function(){X($t)};else if(typeof MessageChannel<"u"){var Kt=new MessageChannel,Dr=Kt.port2;Kt.port1.onmessage=$t,pt=function(){Dr.postMessage(null)}}else pt=function(){be($t,0)};function Sr(lt){Ne=lt,Le||(Le=!0,pt())}function xn(lt,st){qe=be(function(){lt(t.unstable_now())},st)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(lt){lt.callback=null},t.unstable_continueExecution=function(){se||q||(se=!0,Sr(Ce))},t.unstable_forceFrameRate=function(lt){0>lt||125<lt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):it=0<lt?Math.floor(1e3/lt):5},t.unstable_getCurrentPriorityLevel=function(){return V},t.unstable_getFirstCallbackNode=function(){return o(a)},t.unstable_next=function(lt){switch(V){case 1:case 2:case 3:var st=3;break;default:st=V}var kt=V;V=st;try{return lt()}finally{V=kt}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(lt,st){switch(lt){case 1:case 2:case 3:case 4:case 5:break;default:lt=3}var kt=V;V=lt;try{return st()}finally{V=kt}},t.unstable_scheduleCallback=function(lt,st,kt){var It=t.unstable_now();switch(typeof kt=="object"&&kt!==null?(kt=kt.delay,kt=typeof kt=="number"&&0<kt?It+kt:It):kt=It,lt){case 1:var Bt=-1;break;case 2:Bt=250;break;case 5:Bt=1073741823;break;case 4:Bt=1e4;break;default:Bt=5e3}return Bt=kt+Bt,lt={id:D++,callback:st,priorityLevel:lt,startTime:kt,expirationTime:Bt,sortIndex:-1},kt>It?(lt.sortIndex=kt,r(I,lt),o(a)===null&&lt===o(I)&&(pe?(te(qe),qe=-1):pe=!0,xn(Se,kt-It))):(lt.sortIndex=Bt,r(a,lt),se||q||(se=!0,Sr(Ce))),lt},t.unstable_shouldYield=Tt,t.unstable_wrapCallback=function(lt){var st=V;return function(){var kt=V;V=st;try{return lt.apply(this,arguments)}finally{V=kt}}}})(ck);uk.exports=ck;var XL=uk.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var KL=ve,ms=XL;function at(t){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+t,o=1;o<arguments.length;o++)r+="&args[]="+encodeURIComponent(arguments[o]);return"Minified React error #"+t+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var hk=new Set,$f={};function Qu(t,r){Eh(t,r),Eh(t+"Capture",r)}function Eh(t,r){for($f[t]=r,t=0;t<r.length;t++)hk.add(r[t])}var Ca=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Lx=Object.prototype.hasOwnProperty,YL=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,fT={},pT={};function JL(t){return Lx.call(pT,t)?!0:Lx.call(fT,t)?!1:YL.test(t)?pT[t]=!0:(fT[t]=!0,!1)}function QL(t,r,o,u){if(o!==null&&o.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return u?!1:o!==null?!o.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function ez(t,r,o,u){if(r===null||typeof r>"u"||QL(t,r,o,u))return!0;if(u)return!1;if(o!==null)switch(o.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function Ii(t,r,o,u,f,_,b){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=u,this.attributeNamespace=f,this.mustUseProperty=o,this.propertyName=t,this.type=r,this.sanitizeURL=_,this.removeEmptyString=b}var ni={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){ni[t]=new Ii(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var r=t[0];ni[r]=new Ii(r,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){ni[t]=new Ii(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){ni[t]=new Ii(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){ni[t]=new Ii(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){ni[t]=new Ii(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){ni[t]=new Ii(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){ni[t]=new Ii(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){ni[t]=new Ii(t,5,!1,t.toLowerCase(),null,!1,!1)});var f1=/[\-:]([a-z])/g;function p1(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var r=t.replace(f1,p1);ni[r]=new Ii(r,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var r=t.replace(f1,p1);ni[r]=new Ii(r,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var r=t.replace(f1,p1);ni[r]=new Ii(r,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){ni[t]=new Ii(t,1,!1,t.toLowerCase(),null,!1,!1)});ni.xlinkHref=new Ii("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){ni[t]=new Ii(t,1,!1,t.toLowerCase(),null,!0,!0)});function m1(t,r,o,u){var f=ni.hasOwnProperty(r)?ni[r]:null;(f!==null?f.type!==0:u||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(ez(r,o,f,u)&&(o=null),u||f===null?JL(r)&&(o===null?t.removeAttribute(r):t.setAttribute(r,""+o)):f.mustUseProperty?t[f.propertyName]=o===null?f.type===3?!1:"":o:(r=f.attributeName,u=f.attributeNamespace,o===null?t.removeAttribute(r):(f=f.type,o=f===3||f===4&&o===!0?"":""+o,u?t.setAttributeNS(u,r,o):t.setAttribute(r,o))))}var Ma=KL.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,qm=Symbol.for("react.element"),sh=Symbol.for("react.portal"),oh=Symbol.for("react.fragment"),g1=Symbol.for("react.strict_mode"),zx=Symbol.for("react.profiler"),dk=Symbol.for("react.provider"),fk=Symbol.for("react.context"),_1=Symbol.for("react.forward_ref"),Dx=Symbol.for("react.suspense"),Ox=Symbol.for("react.suspense_list"),y1=Symbol.for("react.memo"),xl=Symbol.for("react.lazy"),pk=Symbol.for("react.offscreen"),mT=Symbol.iterator;function df(t){return t===null||typeof t!="object"?null:(t=mT&&t[mT]||t["@@iterator"],typeof t=="function"?t:null)}var mn=Object.assign,Lv;function Sf(t){if(Lv===void 0)try{throw Error()}catch(o){var r=o.stack.trim().match(/\n( *(at )?)/);Lv=r&&r[1]||""}return`
`+Lv+t}var zv=!1;function Dv(t,r){if(!t||zv)return"";zv=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch(I){var u=I}Reflect.construct(t,[],r)}else{try{r.call()}catch(I){u=I}t.call(r.prototype)}else{try{throw Error()}catch(I){u=I}t()}}catch(I){if(I&&u&&typeof I.stack=="string"){for(var f=I.stack.split(`
`),_=u.stack.split(`
`),b=f.length-1,T=_.length-1;1<=b&&0<=T&&f[b]!==_[T];)T--;for(;1<=b&&0<=T;b--,T--)if(f[b]!==_[T]){if(b!==1||T!==1)do if(b--,T--,0>T||f[b]!==_[T]){var a=`
`+f[b].replace(" at new "," at ");return t.displayName&&a.includes("<anonymous>")&&(a=a.replace("<anonymous>",t.displayName)),a}while(1<=b&&0<=T);break}}}finally{zv=!1,Error.prepareStackTrace=o}return(t=t?t.displayName||t.name:"")?Sf(t):""}function tz(t){switch(t.tag){case 5:return Sf(t.type);case 16:return Sf("Lazy");case 13:return Sf("Suspense");case 19:return Sf("SuspenseList");case 0:case 2:case 15:return t=Dv(t.type,!1),t;case 11:return t=Dv(t.type.render,!1),t;case 1:return t=Dv(t.type,!0),t;default:return""}}function Bx(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case oh:return"Fragment";case sh:return"Portal";case zx:return"Profiler";case g1:return"StrictMode";case Dx:return"Suspense";case Ox:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case fk:return(t.displayName||"Context")+".Consumer";case dk:return(t._context.displayName||"Context")+".Provider";case _1:var r=t.render;return t=t.displayName,t||(t=r.displayName||r.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case y1:return r=t.displayName||null,r!==null?r:Bx(t.type)||"Memo";case xl:r=t._payload,t=t._init;try{return Bx(t(r))}catch{}}return null}function rz(t){var r=t.type;switch(t.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=r.render,t=t.displayName||t.name||"",r.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Bx(r);case 8:return r===g1?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function Nl(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function mk(t){var r=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function nz(t){var r=mk(t)?"checked":"value",o=Object.getOwnPropertyDescriptor(t.constructor.prototype,r),u=""+t[r];if(!t.hasOwnProperty(r)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var f=o.get,_=o.set;return Object.defineProperty(t,r,{configurable:!0,get:function(){return f.call(this)},set:function(b){u=""+b,_.call(this,b)}}),Object.defineProperty(t,r,{enumerable:o.enumerable}),{getValue:function(){return u},setValue:function(b){u=""+b},stopTracking:function(){t._valueTracker=null,delete t[r]}}}}function Hm(t){t._valueTracker||(t._valueTracker=nz(t))}function gk(t){if(!t)return!1;var r=t._valueTracker;if(!r)return!0;var o=r.getValue(),u="";return t&&(u=mk(t)?t.checked?"true":"false":t.value),t=u,t!==o?(r.setValue(t),!0):!1}function Bg(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Fx(t,r){var o=r.checked;return mn({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:o??t._wrapperState.initialChecked})}function gT(t,r){var o=r.defaultValue==null?"":r.defaultValue,u=r.checked!=null?r.checked:r.defaultChecked;o=Nl(r.value!=null?r.value:o),t._wrapperState={initialChecked:u,initialValue:o,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function _k(t,r){r=r.checked,r!=null&&m1(t,"checked",r,!1)}function jx(t,r){_k(t,r);var o=Nl(r.value),u=r.type;if(o!=null)u==="number"?(o===0&&t.value===""||t.value!=o)&&(t.value=""+o):t.value!==""+o&&(t.value=""+o);else if(u==="submit"||u==="reset"){t.removeAttribute("value");return}r.hasOwnProperty("value")?Nx(t,r.type,o):r.hasOwnProperty("defaultValue")&&Nx(t,r.type,Nl(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(t.defaultChecked=!!r.defaultChecked)}function _T(t,r,o){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var u=r.type;if(!(u!=="submit"&&u!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+t._wrapperState.initialValue,o||r===t.value||(t.value=r),t.defaultValue=r}o=t.name,o!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,o!==""&&(t.name=o)}function Nx(t,r,o){(r!=="number"||Bg(t.ownerDocument)!==t)&&(o==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+o&&(t.defaultValue=""+o))}var Tf=Array.isArray;function _h(t,r,o,u){if(t=t.options,r){r={};for(var f=0;f<o.length;f++)r["$"+o[f]]=!0;for(o=0;o<t.length;o++)f=r.hasOwnProperty("$"+t[o].value),t[o].selected!==f&&(t[o].selected=f),f&&u&&(t[o].defaultSelected=!0)}else{for(o=""+Nl(o),r=null,f=0;f<t.length;f++){if(t[f].value===o){t[f].selected=!0,u&&(t[f].defaultSelected=!0);return}r!==null||t[f].disabled||(r=t[f])}r!==null&&(r.selected=!0)}}function Ux(t,r){if(r.dangerouslySetInnerHTML!=null)throw Error(at(91));return mn({},r,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function yT(t,r){var o=r.value;if(o==null){if(o=r.children,r=r.defaultValue,o!=null){if(r!=null)throw Error(at(92));if(Tf(o)){if(1<o.length)throw Error(at(93));o=o[0]}r=o}r==null&&(r=""),o=r}t._wrapperState={initialValue:Nl(o)}}function yk(t,r){var o=Nl(r.value),u=Nl(r.defaultValue);o!=null&&(o=""+o,o!==t.value&&(t.value=o),r.defaultValue==null&&t.defaultValue!==o&&(t.defaultValue=o)),u!=null&&(t.defaultValue=""+u)}function vT(t){var r=t.textContent;r===t._wrapperState.initialValue&&r!==""&&r!==null&&(t.value=r)}function vk(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Vx(t,r){return t==null||t==="http://www.w3.org/1999/xhtml"?vk(r):t==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Zm,xk=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,o,u,f){MSApp.execUnsafeLocalFunction(function(){return t(r,o,u,f)})}:t}(function(t,r){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=r;else{for(Zm=Zm||document.createElement("div"),Zm.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=Zm.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;r.firstChild;)t.appendChild(r.firstChild)}});function Gf(t,r){if(r){var o=t.firstChild;if(o&&o===t.lastChild&&o.nodeType===3){o.nodeValue=r;return}}t.textContent=r}var If={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},iz=["Webkit","ms","Moz","O"];Object.keys(If).forEach(function(t){iz.forEach(function(r){r=r+t.charAt(0).toUpperCase()+t.substring(1),If[r]=If[t]})});function bk(t,r,o){return r==null||typeof r=="boolean"||r===""?"":o||typeof r!="number"||r===0||If.hasOwnProperty(t)&&If[t]?(""+r).trim():r+"px"}function wk(t,r){t=t.style;for(var o in r)if(r.hasOwnProperty(o)){var u=o.indexOf("--")===0,f=bk(o,r[o],u);o==="float"&&(o="cssFloat"),u?t.setProperty(o,f):t[o]=f}}var sz=mn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function $x(t,r){if(r){if(sz[t]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error(at(137,t));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error(at(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error(at(61))}if(r.style!=null&&typeof r.style!="object")throw Error(at(62))}}function Gx(t,r){if(t.indexOf("-")===-1)return typeof r.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Wx=null;function v1(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var qx=null,yh=null,vh=null;function xT(t){if(t=gp(t)){if(typeof qx!="function")throw Error(at(280));var r=t.stateNode;r&&(r=T_(r),qx(t.stateNode,t.type,r))}}function Sk(t){yh?vh?vh.push(t):vh=[t]:yh=t}function Tk(){if(yh){var t=yh,r=vh;if(vh=yh=null,xT(t),r)for(t=0;t<r.length;t++)xT(r[t])}}function Ek(t,r){return t(r)}function Ck(){}var Ov=!1;function kk(t,r,o){if(Ov)return t(r,o);Ov=!0;try{return Ek(t,r,o)}finally{Ov=!1,(yh!==null||vh!==null)&&(Ck(),Tk())}}function Wf(t,r){var o=t.stateNode;if(o===null)return null;var u=T_(o);if(u===null)return null;o=u[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(t=t.type,u=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!u;break e;default:t=!1}if(t)return null;if(o&&typeof o!="function")throw Error(at(231,r,typeof o));return o}var Hx=!1;if(Ca)try{var ff={};Object.defineProperty(ff,"passive",{get:function(){Hx=!0}}),window.addEventListener("test",ff,ff),window.removeEventListener("test",ff,ff)}catch{Hx=!1}function oz(t,r,o,u,f,_,b,T,a){var I=Array.prototype.slice.call(arguments,3);try{r.apply(o,I)}catch(D){this.onError(D)}}var Af=!1,Fg=null,jg=!1,Zx=null,az={onError:function(t){Af=!0,Fg=t}};function lz(t,r,o,u,f,_,b,T,a){Af=!1,Fg=null,oz.apply(az,arguments)}function uz(t,r,o,u,f,_,b,T,a){if(lz.apply(this,arguments),Af){if(Af){var I=Fg;Af=!1,Fg=null}else throw Error(at(198));jg||(jg=!0,Zx=I)}}function ec(t){var r=t,o=t;if(t.alternate)for(;r.return;)r=r.return;else{t=r;do r=t,r.flags&4098&&(o=r.return),t=r.return;while(t)}return r.tag===3?o:null}function Ik(t){if(t.tag===13){var r=t.memoizedState;if(r===null&&(t=t.alternate,t!==null&&(r=t.memoizedState)),r!==null)return r.dehydrated}return null}function bT(t){if(ec(t)!==t)throw Error(at(188))}function cz(t){var r=t.alternate;if(!r){if(r=ec(t),r===null)throw Error(at(188));return r!==t?null:t}for(var o=t,u=r;;){var f=o.return;if(f===null)break;var _=f.alternate;if(_===null){if(u=f.return,u!==null){o=u;continue}break}if(f.child===_.child){for(_=f.child;_;){if(_===o)return bT(f),t;if(_===u)return bT(f),r;_=_.sibling}throw Error(at(188))}if(o.return!==u.return)o=f,u=_;else{for(var b=!1,T=f.child;T;){if(T===o){b=!0,o=f,u=_;break}if(T===u){b=!0,u=f,o=_;break}T=T.sibling}if(!b){for(T=_.child;T;){if(T===o){b=!0,o=_,u=f;break}if(T===u){b=!0,u=_,o=f;break}T=T.sibling}if(!b)throw Error(at(189))}}if(o.alternate!==u)throw Error(at(190))}if(o.tag!==3)throw Error(at(188));return o.stateNode.current===o?t:r}function Ak(t){return t=cz(t),t!==null?Mk(t):null}function Mk(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var r=Mk(t);if(r!==null)return r;t=t.sibling}return null}var Pk=ms.unstable_scheduleCallback,wT=ms.unstable_cancelCallback,hz=ms.unstable_shouldYield,dz=ms.unstable_requestPaint,Tn=ms.unstable_now,fz=ms.unstable_getCurrentPriorityLevel,x1=ms.unstable_ImmediatePriority,Rk=ms.unstable_UserBlockingPriority,Ng=ms.unstable_NormalPriority,pz=ms.unstable_LowPriority,Lk=ms.unstable_IdlePriority,x_=null,Ko=null;function mz(t){if(Ko&&typeof Ko.onCommitFiberRoot=="function")try{Ko.onCommitFiberRoot(x_,t,void 0,(t.current.flags&128)===128)}catch{}}var _o=Math.clz32?Math.clz32:yz,gz=Math.log,_z=Math.LN2;function yz(t){return t>>>=0,t===0?32:31-(gz(t)/_z|0)|0}var Xm=64,Km=4194304;function Ef(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Ug(t,r){var o=t.pendingLanes;if(o===0)return 0;var u=0,f=t.suspendedLanes,_=t.pingedLanes,b=o&268435455;if(b!==0){var T=b&~f;T!==0?u=Ef(T):(_&=b,_!==0&&(u=Ef(_)))}else b=o&~f,b!==0?u=Ef(b):_!==0&&(u=Ef(_));if(u===0)return 0;if(r!==0&&r!==u&&!(r&f)&&(f=u&-u,_=r&-r,f>=_||f===16&&(_&4194240)!==0))return r;if(u&4&&(u|=o&16),r=t.entangledLanes,r!==0)for(t=t.entanglements,r&=u;0<r;)o=31-_o(r),f=1<<o,u|=t[o],r&=~f;return u}function vz(t,r){switch(t){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function xz(t,r){for(var o=t.suspendedLanes,u=t.pingedLanes,f=t.expirationTimes,_=t.pendingLanes;0<_;){var b=31-_o(_),T=1<<b,a=f[b];a===-1?(!(T&o)||T&u)&&(f[b]=vz(T,r)):a<=r&&(t.expiredLanes|=T),_&=~T}}function Xx(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function zk(){var t=Xm;return Xm<<=1,!(Xm&4194240)&&(Xm=64),t}function Bv(t){for(var r=[],o=0;31>o;o++)r.push(t);return r}function pp(t,r,o){t.pendingLanes|=r,r!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,r=31-_o(r),t[r]=o}function bz(t,r){var o=t.pendingLanes&~r;t.pendingLanes=r,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=r,t.mutableReadLanes&=r,t.entangledLanes&=r,r=t.entanglements;var u=t.eventTimes;for(t=t.expirationTimes;0<o;){var f=31-_o(o),_=1<<f;r[f]=0,u[f]=-1,t[f]=-1,o&=~_}}function b1(t,r){var o=t.entangledLanes|=r;for(t=t.entanglements;o;){var u=31-_o(o),f=1<<u;f&r|t[u]&r&&(t[u]|=r),o&=~f}}var Pr=0;function Dk(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Ok,w1,Bk,Fk,jk,Kx=!1,Ym=[],Pl=null,Rl=null,Ll=null,qf=new Map,Hf=new Map,Tl=[],wz="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ST(t,r){switch(t){case"focusin":case"focusout":Pl=null;break;case"dragenter":case"dragleave":Rl=null;break;case"mouseover":case"mouseout":Ll=null;break;case"pointerover":case"pointerout":qf.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":Hf.delete(r.pointerId)}}function pf(t,r,o,u,f,_){return t===null||t.nativeEvent!==_?(t={blockedOn:r,domEventName:o,eventSystemFlags:u,nativeEvent:_,targetContainers:[f]},r!==null&&(r=gp(r),r!==null&&w1(r)),t):(t.eventSystemFlags|=u,r=t.targetContainers,f!==null&&r.indexOf(f)===-1&&r.push(f),t)}function Sz(t,r,o,u,f){switch(r){case"focusin":return Pl=pf(Pl,t,r,o,u,f),!0;case"dragenter":return Rl=pf(Rl,t,r,o,u,f),!0;case"mouseover":return Ll=pf(Ll,t,r,o,u,f),!0;case"pointerover":var _=f.pointerId;return qf.set(_,pf(qf.get(_)||null,t,r,o,u,f)),!0;case"gotpointercapture":return _=f.pointerId,Hf.set(_,pf(Hf.get(_)||null,t,r,o,u,f)),!0}return!1}function Nk(t){var r=Bu(t.target);if(r!==null){var o=ec(r);if(o!==null){if(r=o.tag,r===13){if(r=Ik(o),r!==null){t.blockedOn=r,jk(t.priority,function(){Bk(o)});return}}else if(r===3&&o.stateNode.current.memoizedState.isDehydrated){t.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}t.blockedOn=null}function bg(t){if(t.blockedOn!==null)return!1;for(var r=t.targetContainers;0<r.length;){var o=Yx(t.domEventName,t.eventSystemFlags,r[0],t.nativeEvent);if(o===null){o=t.nativeEvent;var u=new o.constructor(o.type,o);Wx=u,o.target.dispatchEvent(u),Wx=null}else return r=gp(o),r!==null&&w1(r),t.blockedOn=o,!1;r.shift()}return!0}function TT(t,r,o){bg(t)&&o.delete(r)}function Tz(){Kx=!1,Pl!==null&&bg(Pl)&&(Pl=null),Rl!==null&&bg(Rl)&&(Rl=null),Ll!==null&&bg(Ll)&&(Ll=null),qf.forEach(TT),Hf.forEach(TT)}function mf(t,r){t.blockedOn===r&&(t.blockedOn=null,Kx||(Kx=!0,ms.unstable_scheduleCallback(ms.unstable_NormalPriority,Tz)))}function Zf(t){function r(f){return mf(f,t)}if(0<Ym.length){mf(Ym[0],t);for(var o=1;o<Ym.length;o++){var u=Ym[o];u.blockedOn===t&&(u.blockedOn=null)}}for(Pl!==null&&mf(Pl,t),Rl!==null&&mf(Rl,t),Ll!==null&&mf(Ll,t),qf.forEach(r),Hf.forEach(r),o=0;o<Tl.length;o++)u=Tl[o],u.blockedOn===t&&(u.blockedOn=null);for(;0<Tl.length&&(o=Tl[0],o.blockedOn===null);)Nk(o),o.blockedOn===null&&Tl.shift()}var xh=Ma.ReactCurrentBatchConfig,Vg=!0;function Ez(t,r,o,u){var f=Pr,_=xh.transition;xh.transition=null;try{Pr=1,S1(t,r,o,u)}finally{Pr=f,xh.transition=_}}function Cz(t,r,o,u){var f=Pr,_=xh.transition;xh.transition=null;try{Pr=4,S1(t,r,o,u)}finally{Pr=f,xh.transition=_}}function S1(t,r,o,u){if(Vg){var f=Yx(t,r,o,u);if(f===null)Hv(t,r,u,$g,o),ST(t,u);else if(Sz(f,t,r,o,u))u.stopPropagation();else if(ST(t,u),r&4&&-1<wz.indexOf(t)){for(;f!==null;){var _=gp(f);if(_!==null&&Ok(_),_=Yx(t,r,o,u),_===null&&Hv(t,r,u,$g,o),_===f)break;f=_}f!==null&&u.stopPropagation()}else Hv(t,r,u,null,o)}}var $g=null;function Yx(t,r,o,u){if($g=null,t=v1(u),t=Bu(t),t!==null)if(r=ec(t),r===null)t=null;else if(o=r.tag,o===13){if(t=Ik(r),t!==null)return t;t=null}else if(o===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;t=null}else r!==t&&(t=null);return $g=t,null}function Uk(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(fz()){case x1:return 1;case Rk:return 4;case Ng:case pz:return 16;case Lk:return 536870912;default:return 16}default:return 16}}var kl=null,T1=null,wg=null;function Vk(){if(wg)return wg;var t,r=T1,o=r.length,u,f="value"in kl?kl.value:kl.textContent,_=f.length;for(t=0;t<o&&r[t]===f[t];t++);var b=o-t;for(u=1;u<=b&&r[o-u]===f[_-u];u++);return wg=f.slice(t,1<u?1-u:void 0)}function Sg(t){var r=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&r===13&&(t=13)):t=r,t===10&&(t=13),32<=t||t===13?t:0}function Jm(){return!0}function ET(){return!1}function _s(t){function r(o,u,f,_,b){this._reactName=o,this._targetInst=f,this.type=u,this.nativeEvent=_,this.target=b,this.currentTarget=null;for(var T in t)t.hasOwnProperty(T)&&(o=t[T],this[T]=o?o(_):_[T]);return this.isDefaultPrevented=(_.defaultPrevented!=null?_.defaultPrevented:_.returnValue===!1)?Jm:ET,this.isPropagationStopped=ET,this}return mn(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=Jm)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=Jm)},persist:function(){},isPersistent:Jm}),r}var Bh={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},E1=_s(Bh),mp=mn({},Bh,{view:0,detail:0}),kz=_s(mp),Fv,jv,gf,b_=mn({},mp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:C1,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==gf&&(gf&&t.type==="mousemove"?(Fv=t.screenX-gf.screenX,jv=t.screenY-gf.screenY):jv=Fv=0,gf=t),Fv)},movementY:function(t){return"movementY"in t?t.movementY:jv}}),CT=_s(b_),Iz=mn({},b_,{dataTransfer:0}),Az=_s(Iz),Mz=mn({},mp,{relatedTarget:0}),Nv=_s(Mz),Pz=mn({},Bh,{animationName:0,elapsedTime:0,pseudoElement:0}),Rz=_s(Pz),Lz=mn({},Bh,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),zz=_s(Lz),Dz=mn({},Bh,{data:0}),kT=_s(Dz),Oz={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Bz={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Fz={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function jz(t){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(t):(t=Fz[t])?!!r[t]:!1}function C1(){return jz}var Nz=mn({},mp,{key:function(t){if(t.key){var r=Oz[t.key]||t.key;if(r!=="Unidentified")return r}return t.type==="keypress"?(t=Sg(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Bz[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:C1,charCode:function(t){return t.type==="keypress"?Sg(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Sg(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Uz=_s(Nz),Vz=mn({},b_,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),IT=_s(Vz),$z=mn({},mp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:C1}),Gz=_s($z),Wz=mn({},Bh,{propertyName:0,elapsedTime:0,pseudoElement:0}),qz=_s(Wz),Hz=mn({},b_,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Zz=_s(Hz),Xz=[9,13,27,32],k1=Ca&&"CompositionEvent"in window,Mf=null;Ca&&"documentMode"in document&&(Mf=document.documentMode);var Kz=Ca&&"TextEvent"in window&&!Mf,$k=Ca&&(!k1||Mf&&8<Mf&&11>=Mf),AT=" ",MT=!1;function Gk(t,r){switch(t){case"keyup":return Xz.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Wk(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ah=!1;function Yz(t,r){switch(t){case"compositionend":return Wk(r);case"keypress":return r.which!==32?null:(MT=!0,AT);case"textInput":return t=r.data,t===AT&&MT?null:t;default:return null}}function Jz(t,r){if(ah)return t==="compositionend"||!k1&&Gk(t,r)?(t=Vk(),wg=T1=kl=null,ah=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return $k&&r.locale!=="ko"?null:r.data;default:return null}}var Qz={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function PT(t){var r=t&&t.nodeName&&t.nodeName.toLowerCase();return r==="input"?!!Qz[t.type]:r==="textarea"}function qk(t,r,o,u){Sk(u),r=Gg(r,"onChange"),0<r.length&&(o=new E1("onChange","change",null,o,u),t.push({event:o,listeners:r}))}var Pf=null,Xf=null;function eD(t){nI(t,0)}function w_(t){var r=ch(t);if(gk(r))return t}function tD(t,r){if(t==="change")return r}var Hk=!1;if(Ca){var Uv;if(Ca){var Vv="oninput"in document;if(!Vv){var RT=document.createElement("div");RT.setAttribute("oninput","return;"),Vv=typeof RT.oninput=="function"}Uv=Vv}else Uv=!1;Hk=Uv&&(!document.documentMode||9<document.documentMode)}function LT(){Pf&&(Pf.detachEvent("onpropertychange",Zk),Xf=Pf=null)}function Zk(t){if(t.propertyName==="value"&&w_(Xf)){var r=[];qk(r,Xf,t,v1(t)),kk(eD,r)}}function rD(t,r,o){t==="focusin"?(LT(),Pf=r,Xf=o,Pf.attachEvent("onpropertychange",Zk)):t==="focusout"&&LT()}function nD(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return w_(Xf)}function iD(t,r){if(t==="click")return w_(r)}function sD(t,r){if(t==="input"||t==="change")return w_(r)}function oD(t,r){return t===r&&(t!==0||1/t===1/r)||t!==t&&r!==r}var vo=typeof Object.is=="function"?Object.is:oD;function Kf(t,r){if(vo(t,r))return!0;if(typeof t!="object"||t===null||typeof r!="object"||r===null)return!1;var o=Object.keys(t),u=Object.keys(r);if(o.length!==u.length)return!1;for(u=0;u<o.length;u++){var f=o[u];if(!Lx.call(r,f)||!vo(t[f],r[f]))return!1}return!0}function zT(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function DT(t,r){var o=zT(t);t=0;for(var u;o;){if(o.nodeType===3){if(u=t+o.textContent.length,t<=r&&u>=r)return{node:o,offset:r-t};t=u}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=zT(o)}}function Xk(t,r){return t&&r?t===r?!0:t&&t.nodeType===3?!1:r&&r.nodeType===3?Xk(t,r.parentNode):"contains"in t?t.contains(r):t.compareDocumentPosition?!!(t.compareDocumentPosition(r)&16):!1:!1}function Kk(){for(var t=window,r=Bg();r instanceof t.HTMLIFrameElement;){try{var o=typeof r.contentWindow.location.href=="string"}catch{o=!1}if(o)t=r.contentWindow;else break;r=Bg(t.document)}return r}function I1(t){var r=t&&t.nodeName&&t.nodeName.toLowerCase();return r&&(r==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||r==="textarea"||t.contentEditable==="true")}function aD(t){var r=Kk(),o=t.focusedElem,u=t.selectionRange;if(r!==o&&o&&o.ownerDocument&&Xk(o.ownerDocument.documentElement,o)){if(u!==null&&I1(o)){if(r=u.start,t=u.end,t===void 0&&(t=r),"selectionStart"in o)o.selectionStart=r,o.selectionEnd=Math.min(t,o.value.length);else if(t=(r=o.ownerDocument||document)&&r.defaultView||window,t.getSelection){t=t.getSelection();var f=o.textContent.length,_=Math.min(u.start,f);u=u.end===void 0?_:Math.min(u.end,f),!t.extend&&_>u&&(f=u,u=_,_=f),f=DT(o,_);var b=DT(o,u);f&&b&&(t.rangeCount!==1||t.anchorNode!==f.node||t.anchorOffset!==f.offset||t.focusNode!==b.node||t.focusOffset!==b.offset)&&(r=r.createRange(),r.setStart(f.node,f.offset),t.removeAllRanges(),_>u?(t.addRange(r),t.extend(b.node,b.offset)):(r.setEnd(b.node,b.offset),t.addRange(r)))}}for(r=[],t=o;t=t.parentNode;)t.nodeType===1&&r.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<r.length;o++)t=r[o],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var lD=Ca&&"documentMode"in document&&11>=document.documentMode,lh=null,Jx=null,Rf=null,Qx=!1;function OT(t,r,o){var u=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Qx||lh==null||lh!==Bg(u)||(u=lh,"selectionStart"in u&&I1(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),Rf&&Kf(Rf,u)||(Rf=u,u=Gg(Jx,"onSelect"),0<u.length&&(r=new E1("onSelect","select",null,r,o),t.push({event:r,listeners:u}),r.target=lh)))}function Qm(t,r){var o={};return o[t.toLowerCase()]=r.toLowerCase(),o["Webkit"+t]="webkit"+r,o["Moz"+t]="moz"+r,o}var uh={animationend:Qm("Animation","AnimationEnd"),animationiteration:Qm("Animation","AnimationIteration"),animationstart:Qm("Animation","AnimationStart"),transitionend:Qm("Transition","TransitionEnd")},$v={},Yk={};Ca&&(Yk=document.createElement("div").style,"AnimationEvent"in window||(delete uh.animationend.animation,delete uh.animationiteration.animation,delete uh.animationstart.animation),"TransitionEvent"in window||delete uh.transitionend.transition);function S_(t){if($v[t])return $v[t];if(!uh[t])return t;var r=uh[t],o;for(o in r)if(r.hasOwnProperty(o)&&o in Yk)return $v[t]=r[o];return t}var Jk=S_("animationend"),Qk=S_("animationiteration"),eI=S_("animationstart"),tI=S_("transitionend"),rI=new Map,BT="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Vl(t,r){rI.set(t,r),Qu(r,[t])}for(var Gv=0;Gv<BT.length;Gv++){var Wv=BT[Gv],uD=Wv.toLowerCase(),cD=Wv[0].toUpperCase()+Wv.slice(1);Vl(uD,"on"+cD)}Vl(Jk,"onAnimationEnd");Vl(Qk,"onAnimationIteration");Vl(eI,"onAnimationStart");Vl("dblclick","onDoubleClick");Vl("focusin","onFocus");Vl("focusout","onBlur");Vl(tI,"onTransitionEnd");Eh("onMouseEnter",["mouseout","mouseover"]);Eh("onMouseLeave",["mouseout","mouseover"]);Eh("onPointerEnter",["pointerout","pointerover"]);Eh("onPointerLeave",["pointerout","pointerover"]);Qu("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Qu("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Qu("onBeforeInput",["compositionend","keypress","textInput","paste"]);Qu("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Qu("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Qu("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Cf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),hD=new Set("cancel close invalid load scroll toggle".split(" ").concat(Cf));function FT(t,r,o){var u=t.type||"unknown-event";t.currentTarget=o,uz(u,r,void 0,t),t.currentTarget=null}function nI(t,r){r=(r&4)!==0;for(var o=0;o<t.length;o++){var u=t[o],f=u.event;u=u.listeners;e:{var _=void 0;if(r)for(var b=u.length-1;0<=b;b--){var T=u[b],a=T.instance,I=T.currentTarget;if(T=T.listener,a!==_&&f.isPropagationStopped())break e;FT(f,T,I),_=a}else for(b=0;b<u.length;b++){if(T=u[b],a=T.instance,I=T.currentTarget,T=T.listener,a!==_&&f.isPropagationStopped())break e;FT(f,T,I),_=a}}}if(jg)throw t=Zx,jg=!1,Zx=null,t}function Zr(t,r){var o=r[i0];o===void 0&&(o=r[i0]=new Set);var u=t+"__bubble";o.has(u)||(iI(r,t,2,!1),o.add(u))}function qv(t,r,o){var u=0;r&&(u|=4),iI(o,t,u,r)}var eg="_reactListening"+Math.random().toString(36).slice(2);function Yf(t){if(!t[eg]){t[eg]=!0,hk.forEach(function(o){o!=="selectionchange"&&(hD.has(o)||qv(o,!1,t),qv(o,!0,t))});var r=t.nodeType===9?t:t.ownerDocument;r===null||r[eg]||(r[eg]=!0,qv("selectionchange",!1,r))}}function iI(t,r,o,u){switch(Uk(r)){case 1:var f=Ez;break;case 4:f=Cz;break;default:f=S1}o=f.bind(null,r,o,t),f=void 0,!Hx||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(f=!0),u?f!==void 0?t.addEventListener(r,o,{capture:!0,passive:f}):t.addEventListener(r,o,!0):f!==void 0?t.addEventListener(r,o,{passive:f}):t.addEventListener(r,o,!1)}function Hv(t,r,o,u,f){var _=u;if(!(r&1)&&!(r&2)&&u!==null)e:for(;;){if(u===null)return;var b=u.tag;if(b===3||b===4){var T=u.stateNode.containerInfo;if(T===f||T.nodeType===8&&T.parentNode===f)break;if(b===4)for(b=u.return;b!==null;){var a=b.tag;if((a===3||a===4)&&(a=b.stateNode.containerInfo,a===f||a.nodeType===8&&a.parentNode===f))return;b=b.return}for(;T!==null;){if(b=Bu(T),b===null)return;if(a=b.tag,a===5||a===6){u=_=b;continue e}T=T.parentNode}}u=u.return}kk(function(){var I=_,D=v1(o),j=[];e:{var V=rI.get(t);if(V!==void 0){var q=E1,se=t;switch(t){case"keypress":if(Sg(o)===0)break e;case"keydown":case"keyup":q=Uz;break;case"focusin":se="focus",q=Nv;break;case"focusout":se="blur",q=Nv;break;case"beforeblur":case"afterblur":q=Nv;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":q=CT;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":q=Az;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":q=Gz;break;case Jk:case Qk:case eI:q=Rz;break;case tI:q=qz;break;case"scroll":q=kz;break;case"wheel":q=Zz;break;case"copy":case"cut":case"paste":q=zz;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":q=IT}var pe=(r&4)!==0,be=!pe&&t==="scroll",te=pe?V!==null?V+"Capture":null:V;pe=[];for(var X=I,ie;X!==null;){ie=X;var Se=ie.stateNode;if(ie.tag===5&&Se!==null&&(ie=Se,te!==null&&(Se=Wf(X,te),Se!=null&&pe.push(Jf(X,Se,ie)))),be)break;X=X.return}0<pe.length&&(V=new q(V,se,null,o,D),j.push({event:V,listeners:pe}))}}if(!(r&7)){e:{if(V=t==="mouseover"||t==="pointerover",q=t==="mouseout"||t==="pointerout",V&&o!==Wx&&(se=o.relatedTarget||o.fromElement)&&(Bu(se)||se[ka]))break e;if((q||V)&&(V=D.window===D?D:(V=D.ownerDocument)?V.defaultView||V.parentWindow:window,q?(se=o.relatedTarget||o.toElement,q=I,se=se?Bu(se):null,se!==null&&(be=ec(se),se!==be||se.tag!==5&&se.tag!==6)&&(se=null)):(q=null,se=I),q!==se)){if(pe=CT,Se="onMouseLeave",te="onMouseEnter",X="mouse",(t==="pointerout"||t==="pointerover")&&(pe=IT,Se="onPointerLeave",te="onPointerEnter",X="pointer"),be=q==null?V:ch(q),ie=se==null?V:ch(se),V=new pe(Se,X+"leave",q,o,D),V.target=be,V.relatedTarget=ie,Se=null,Bu(D)===I&&(pe=new pe(te,X+"enter",se,o,D),pe.target=ie,pe.relatedTarget=be,Se=pe),be=Se,q&&se)t:{for(pe=q,te=se,X=0,ie=pe;ie;ie=Qc(ie))X++;for(ie=0,Se=te;Se;Se=Qc(Se))ie++;for(;0<X-ie;)pe=Qc(pe),X--;for(;0<ie-X;)te=Qc(te),ie--;for(;X--;){if(pe===te||te!==null&&pe===te.alternate)break t;pe=Qc(pe),te=Qc(te)}pe=null}else pe=null;q!==null&&jT(j,V,q,pe,!1),se!==null&&be!==null&&jT(j,be,se,pe,!0)}}e:{if(V=I?ch(I):window,q=V.nodeName&&V.nodeName.toLowerCase(),q==="select"||q==="input"&&V.type==="file")var Ce=tD;else if(PT(V))if(Hk)Ce=sD;else{Ce=nD;var Le=rD}else(q=V.nodeName)&&q.toLowerCase()==="input"&&(V.type==="checkbox"||V.type==="radio")&&(Ce=iD);if(Ce&&(Ce=Ce(t,I))){qk(j,Ce,o,D);break e}Le&&Le(t,V,I),t==="focusout"&&(Le=V._wrapperState)&&Le.controlled&&V.type==="number"&&Nx(V,"number",V.value)}switch(Le=I?ch(I):window,t){case"focusin":(PT(Le)||Le.contentEditable==="true")&&(lh=Le,Jx=I,Rf=null);break;case"focusout":Rf=Jx=lh=null;break;case"mousedown":Qx=!0;break;case"contextmenu":case"mouseup":case"dragend":Qx=!1,OT(j,o,D);break;case"selectionchange":if(lD)break;case"keydown":case"keyup":OT(j,o,D)}var Ne;if(k1)e:{switch(t){case"compositionstart":var qe="onCompositionStart";break e;case"compositionend":qe="onCompositionEnd";break e;case"compositionupdate":qe="onCompositionUpdate";break e}qe=void 0}else ah?Gk(t,o)&&(qe="onCompositionEnd"):t==="keydown"&&o.keyCode===229&&(qe="onCompositionStart");qe&&($k&&o.locale!=="ko"&&(ah||qe!=="onCompositionStart"?qe==="onCompositionEnd"&&ah&&(Ne=Vk()):(kl=D,T1="value"in kl?kl.value:kl.textContent,ah=!0)),Le=Gg(I,qe),0<Le.length&&(qe=new kT(qe,t,null,o,D),j.push({event:qe,listeners:Le}),Ne?qe.data=Ne:(Ne=Wk(o),Ne!==null&&(qe.data=Ne)))),(Ne=Kz?Yz(t,o):Jz(t,o))&&(I=Gg(I,"onBeforeInput"),0<I.length&&(D=new kT("onBeforeInput","beforeinput",null,o,D),j.push({event:D,listeners:I}),D.data=Ne))}nI(j,r)})}function Jf(t,r,o){return{instance:t,listener:r,currentTarget:o}}function Gg(t,r){for(var o=r+"Capture",u=[];t!==null;){var f=t,_=f.stateNode;f.tag===5&&_!==null&&(f=_,_=Wf(t,o),_!=null&&u.unshift(Jf(t,_,f)),_=Wf(t,r),_!=null&&u.push(Jf(t,_,f))),t=t.return}return u}function Qc(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function jT(t,r,o,u,f){for(var _=r._reactName,b=[];o!==null&&o!==u;){var T=o,a=T.alternate,I=T.stateNode;if(a!==null&&a===u)break;T.tag===5&&I!==null&&(T=I,f?(a=Wf(o,_),a!=null&&b.unshift(Jf(o,a,T))):f||(a=Wf(o,_),a!=null&&b.push(Jf(o,a,T)))),o=o.return}b.length!==0&&t.push({event:r,listeners:b})}var dD=/\r\n?/g,fD=/\u0000|\uFFFD/g;function NT(t){return(typeof t=="string"?t:""+t).replace(dD,`
`).replace(fD,"")}function tg(t,r,o){if(r=NT(r),NT(t)!==r&&o)throw Error(at(425))}function Wg(){}var e0=null,t0=null;function r0(t,r){return t==="textarea"||t==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var n0=typeof setTimeout=="function"?setTimeout:void 0,pD=typeof clearTimeout=="function"?clearTimeout:void 0,UT=typeof Promise=="function"?Promise:void 0,mD=typeof queueMicrotask=="function"?queueMicrotask:typeof UT<"u"?function(t){return UT.resolve(null).then(t).catch(gD)}:n0;function gD(t){setTimeout(function(){throw t})}function Zv(t,r){var o=r,u=0;do{var f=o.nextSibling;if(t.removeChild(o),f&&f.nodeType===8)if(o=f.data,o==="/$"){if(u===0){t.removeChild(f),Zf(r);return}u--}else o!=="$"&&o!=="$?"&&o!=="$!"||u++;o=f}while(o);Zf(r)}function zl(t){for(;t!=null;t=t.nextSibling){var r=t.nodeType;if(r===1||r===3)break;if(r===8){if(r=t.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return t}function VT(t){t=t.previousSibling;for(var r=0;t;){if(t.nodeType===8){var o=t.data;if(o==="$"||o==="$!"||o==="$?"){if(r===0)return t;r--}else o==="/$"&&r++}t=t.previousSibling}return null}var Fh=Math.random().toString(36).slice(2),qo="__reactFiber$"+Fh,Qf="__reactProps$"+Fh,ka="__reactContainer$"+Fh,i0="__reactEvents$"+Fh,_D="__reactListeners$"+Fh,yD="__reactHandles$"+Fh;function Bu(t){var r=t[qo];if(r)return r;for(var o=t.parentNode;o;){if(r=o[ka]||o[qo]){if(o=r.alternate,r.child!==null||o!==null&&o.child!==null)for(t=VT(t);t!==null;){if(o=t[qo])return o;t=VT(t)}return r}t=o,o=t.parentNode}return null}function gp(t){return t=t[qo]||t[ka],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function ch(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(at(33))}function T_(t){return t[Qf]||null}var s0=[],hh=-1;function $l(t){return{current:t}}function Xr(t){0>hh||(t.current=s0[hh],s0[hh]=null,hh--)}function Wr(t,r){hh++,s0[hh]=t.current,t.current=r}var Ul={},gi=$l(Ul),Xi=$l(!1),Zu=Ul;function Ch(t,r){var o=t.type.contextTypes;if(!o)return Ul;var u=t.stateNode;if(u&&u.__reactInternalMemoizedUnmaskedChildContext===r)return u.__reactInternalMemoizedMaskedChildContext;var f={},_;for(_ in o)f[_]=r[_];return u&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=f),f}function Ki(t){return t=t.childContextTypes,t!=null}function qg(){Xr(Xi),Xr(gi)}function $T(t,r,o){if(gi.current!==Ul)throw Error(at(168));Wr(gi,r),Wr(Xi,o)}function sI(t,r,o){var u=t.stateNode;if(r=r.childContextTypes,typeof u.getChildContext!="function")return o;u=u.getChildContext();for(var f in u)if(!(f in r))throw Error(at(108,rz(t)||"Unknown",f));return mn({},o,u)}function Hg(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Ul,Zu=gi.current,Wr(gi,t),Wr(Xi,Xi.current),!0}function GT(t,r,o){var u=t.stateNode;if(!u)throw Error(at(169));o?(t=sI(t,r,Zu),u.__reactInternalMemoizedMergedChildContext=t,Xr(Xi),Xr(gi),Wr(gi,t)):Xr(Xi),Wr(Xi,o)}var ba=null,E_=!1,Xv=!1;function oI(t){ba===null?ba=[t]:ba.push(t)}function vD(t){E_=!0,oI(t)}function Gl(){if(!Xv&&ba!==null){Xv=!0;var t=0,r=Pr;try{var o=ba;for(Pr=1;t<o.length;t++){var u=o[t];do u=u(!0);while(u!==null)}ba=null,E_=!1}catch(f){throw ba!==null&&(ba=ba.slice(t+1)),Pk(x1,Gl),f}finally{Pr=r,Xv=!1}}return null}var dh=[],fh=0,Zg=null,Xg=0,Rs=[],Ls=0,Xu=null,wa=1,Sa="";function Lu(t,r){dh[fh++]=Xg,dh[fh++]=Zg,Zg=t,Xg=r}function aI(t,r,o){Rs[Ls++]=wa,Rs[Ls++]=Sa,Rs[Ls++]=Xu,Xu=t;var u=wa;t=Sa;var f=32-_o(u)-1;u&=~(1<<f),o+=1;var _=32-_o(r)+f;if(30<_){var b=f-f%5;_=(u&(1<<b)-1).toString(32),u>>=b,f-=b,wa=1<<32-_o(r)+f|o<<f|u,Sa=_+t}else wa=1<<_|o<<f|u,Sa=t}function A1(t){t.return!==null&&(Lu(t,1),aI(t,1,0))}function M1(t){for(;t===Zg;)Zg=dh[--fh],dh[fh]=null,Xg=dh[--fh],dh[fh]=null;for(;t===Xu;)Xu=Rs[--Ls],Rs[Ls]=null,Sa=Rs[--Ls],Rs[Ls]=null,wa=Rs[--Ls],Rs[Ls]=null}var fs=null,ds=null,Qr=!1,go=null;function lI(t,r){var o=zs(5,null,null,0);o.elementType="DELETED",o.stateNode=r,o.return=t,r=t.deletions,r===null?(t.deletions=[o],t.flags|=16):r.push(o)}function WT(t,r){switch(t.tag){case 5:var o=t.type;return r=r.nodeType!==1||o.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(t.stateNode=r,fs=t,ds=zl(r.firstChild),!0):!1;case 6:return r=t.pendingProps===""||r.nodeType!==3?null:r,r!==null?(t.stateNode=r,fs=t,ds=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(o=Xu!==null?{id:wa,overflow:Sa}:null,t.memoizedState={dehydrated:r,treeContext:o,retryLane:1073741824},o=zs(18,null,null,0),o.stateNode=r,o.return=t,t.child=o,fs=t,ds=null,!0):!1;default:return!1}}function o0(t){return(t.mode&1)!==0&&(t.flags&128)===0}function a0(t){if(Qr){var r=ds;if(r){var o=r;if(!WT(t,r)){if(o0(t))throw Error(at(418));r=zl(o.nextSibling);var u=fs;r&&WT(t,r)?lI(u,o):(t.flags=t.flags&-4097|2,Qr=!1,fs=t)}}else{if(o0(t))throw Error(at(418));t.flags=t.flags&-4097|2,Qr=!1,fs=t}}}function qT(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;fs=t}function rg(t){if(t!==fs)return!1;if(!Qr)return qT(t),Qr=!0,!1;var r;if((r=t.tag!==3)&&!(r=t.tag!==5)&&(r=t.type,r=r!=="head"&&r!=="body"&&!r0(t.type,t.memoizedProps)),r&&(r=ds)){if(o0(t))throw uI(),Error(at(418));for(;r;)lI(t,r),r=zl(r.nextSibling)}if(qT(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(at(317));e:{for(t=t.nextSibling,r=0;t;){if(t.nodeType===8){var o=t.data;if(o==="/$"){if(r===0){ds=zl(t.nextSibling);break e}r--}else o!=="$"&&o!=="$!"&&o!=="$?"||r++}t=t.nextSibling}ds=null}}else ds=fs?zl(t.stateNode.nextSibling):null;return!0}function uI(){for(var t=ds;t;)t=zl(t.nextSibling)}function kh(){ds=fs=null,Qr=!1}function P1(t){go===null?go=[t]:go.push(t)}var xD=Ma.ReactCurrentBatchConfig;function _f(t,r,o){if(t=o.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(o._owner){if(o=o._owner,o){if(o.tag!==1)throw Error(at(309));var u=o.stateNode}if(!u)throw Error(at(147,t));var f=u,_=""+t;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===_?r.ref:(r=function(b){var T=f.refs;b===null?delete T[_]:T[_]=b},r._stringRef=_,r)}if(typeof t!="string")throw Error(at(284));if(!o._owner)throw Error(at(290,t))}return t}function ng(t,r){throw t=Object.prototype.toString.call(r),Error(at(31,t==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":t))}function HT(t){var r=t._init;return r(t._payload)}function cI(t){function r(te,X){if(t){var ie=te.deletions;ie===null?(te.deletions=[X],te.flags|=16):ie.push(X)}}function o(te,X){if(!t)return null;for(;X!==null;)r(te,X),X=X.sibling;return null}function u(te,X){for(te=new Map;X!==null;)X.key!==null?te.set(X.key,X):te.set(X.index,X),X=X.sibling;return te}function f(te,X){return te=Fl(te,X),te.index=0,te.sibling=null,te}function _(te,X,ie){return te.index=ie,t?(ie=te.alternate,ie!==null?(ie=ie.index,ie<X?(te.flags|=2,X):ie):(te.flags|=2,X)):(te.flags|=1048576,X)}function b(te){return t&&te.alternate===null&&(te.flags|=2),te}function T(te,X,ie,Se){return X===null||X.tag!==6?(X=rx(ie,te.mode,Se),X.return=te,X):(X=f(X,ie),X.return=te,X)}function a(te,X,ie,Se){var Ce=ie.type;return Ce===oh?D(te,X,ie.props.children,Se,ie.key):X!==null&&(X.elementType===Ce||typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===xl&&HT(Ce)===X.type)?(Se=f(X,ie.props),Se.ref=_f(te,X,ie),Se.return=te,Se):(Se=Mg(ie.type,ie.key,ie.props,null,te.mode,Se),Se.ref=_f(te,X,ie),Se.return=te,Se)}function I(te,X,ie,Se){return X===null||X.tag!==4||X.stateNode.containerInfo!==ie.containerInfo||X.stateNode.implementation!==ie.implementation?(X=nx(ie,te.mode,Se),X.return=te,X):(X=f(X,ie.children||[]),X.return=te,X)}function D(te,X,ie,Se,Ce){return X===null||X.tag!==7?(X=Gu(ie,te.mode,Se,Ce),X.return=te,X):(X=f(X,ie),X.return=te,X)}function j(te,X,ie){if(typeof X=="string"&&X!==""||typeof X=="number")return X=rx(""+X,te.mode,ie),X.return=te,X;if(typeof X=="object"&&X!==null){switch(X.$$typeof){case qm:return ie=Mg(X.type,X.key,X.props,null,te.mode,ie),ie.ref=_f(te,null,X),ie.return=te,ie;case sh:return X=nx(X,te.mode,ie),X.return=te,X;case xl:var Se=X._init;return j(te,Se(X._payload),ie)}if(Tf(X)||df(X))return X=Gu(X,te.mode,ie,null),X.return=te,X;ng(te,X)}return null}function V(te,X,ie,Se){var Ce=X!==null?X.key:null;if(typeof ie=="string"&&ie!==""||typeof ie=="number")return Ce!==null?null:T(te,X,""+ie,Se);if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case qm:return ie.key===Ce?a(te,X,ie,Se):null;case sh:return ie.key===Ce?I(te,X,ie,Se):null;case xl:return Ce=ie._init,V(te,X,Ce(ie._payload),Se)}if(Tf(ie)||df(ie))return Ce!==null?null:D(te,X,ie,Se,null);ng(te,ie)}return null}function q(te,X,ie,Se,Ce){if(typeof Se=="string"&&Se!==""||typeof Se=="number")return te=te.get(ie)||null,T(X,te,""+Se,Ce);if(typeof Se=="object"&&Se!==null){switch(Se.$$typeof){case qm:return te=te.get(Se.key===null?ie:Se.key)||null,a(X,te,Se,Ce);case sh:return te=te.get(Se.key===null?ie:Se.key)||null,I(X,te,Se,Ce);case xl:var Le=Se._init;return q(te,X,ie,Le(Se._payload),Ce)}if(Tf(Se)||df(Se))return te=te.get(ie)||null,D(X,te,Se,Ce,null);ng(X,Se)}return null}function se(te,X,ie,Se){for(var Ce=null,Le=null,Ne=X,qe=X=0,it=null;Ne!==null&&qe<ie.length;qe++){Ne.index>qe?(it=Ne,Ne=null):it=Ne.sibling;var Ae=V(te,Ne,ie[qe],Se);if(Ae===null){Ne===null&&(Ne=it);break}t&&Ne&&Ae.alternate===null&&r(te,Ne),X=_(Ae,X,qe),Le===null?Ce=Ae:Le.sibling=Ae,Le=Ae,Ne=it}if(qe===ie.length)return o(te,Ne),Qr&&Lu(te,qe),Ce;if(Ne===null){for(;qe<ie.length;qe++)Ne=j(te,ie[qe],Se),Ne!==null&&(X=_(Ne,X,qe),Le===null?Ce=Ne:Le.sibling=Ne,Le=Ne);return Qr&&Lu(te,qe),Ce}for(Ne=u(te,Ne);qe<ie.length;qe++)it=q(Ne,te,qe,ie[qe],Se),it!==null&&(t&&it.alternate!==null&&Ne.delete(it.key===null?qe:it.key),X=_(it,X,qe),Le===null?Ce=it:Le.sibling=it,Le=it);return t&&Ne.forEach(function(Tt){return r(te,Tt)}),Qr&&Lu(te,qe),Ce}function pe(te,X,ie,Se){var Ce=df(ie);if(typeof Ce!="function")throw Error(at(150));if(ie=Ce.call(ie),ie==null)throw Error(at(151));for(var Le=Ce=null,Ne=X,qe=X=0,it=null,Ae=ie.next();Ne!==null&&!Ae.done;qe++,Ae=ie.next()){Ne.index>qe?(it=Ne,Ne=null):it=Ne.sibling;var Tt=V(te,Ne,Ae.value,Se);if(Tt===null){Ne===null&&(Ne=it);break}t&&Ne&&Tt.alternate===null&&r(te,Ne),X=_(Tt,X,qe),Le===null?Ce=Tt:Le.sibling=Tt,Le=Tt,Ne=it}if(Ae.done)return o(te,Ne),Qr&&Lu(te,qe),Ce;if(Ne===null){for(;!Ae.done;qe++,Ae=ie.next())Ae=j(te,Ae.value,Se),Ae!==null&&(X=_(Ae,X,qe),Le===null?Ce=Ae:Le.sibling=Ae,Le=Ae);return Qr&&Lu(te,qe),Ce}for(Ne=u(te,Ne);!Ae.done;qe++,Ae=ie.next())Ae=q(Ne,te,qe,Ae.value,Se),Ae!==null&&(t&&Ae.alternate!==null&&Ne.delete(Ae.key===null?qe:Ae.key),X=_(Ae,X,qe),Le===null?Ce=Ae:Le.sibling=Ae,Le=Ae);return t&&Ne.forEach(function($t){return r(te,$t)}),Qr&&Lu(te,qe),Ce}function be(te,X,ie,Se){if(typeof ie=="object"&&ie!==null&&ie.type===oh&&ie.key===null&&(ie=ie.props.children),typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case qm:e:{for(var Ce=ie.key,Le=X;Le!==null;){if(Le.key===Ce){if(Ce=ie.type,Ce===oh){if(Le.tag===7){o(te,Le.sibling),X=f(Le,ie.props.children),X.return=te,te=X;break e}}else if(Le.elementType===Ce||typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===xl&&HT(Ce)===Le.type){o(te,Le.sibling),X=f(Le,ie.props),X.ref=_f(te,Le,ie),X.return=te,te=X;break e}o(te,Le);break}else r(te,Le);Le=Le.sibling}ie.type===oh?(X=Gu(ie.props.children,te.mode,Se,ie.key),X.return=te,te=X):(Se=Mg(ie.type,ie.key,ie.props,null,te.mode,Se),Se.ref=_f(te,X,ie),Se.return=te,te=Se)}return b(te);case sh:e:{for(Le=ie.key;X!==null;){if(X.key===Le)if(X.tag===4&&X.stateNode.containerInfo===ie.containerInfo&&X.stateNode.implementation===ie.implementation){o(te,X.sibling),X=f(X,ie.children||[]),X.return=te,te=X;break e}else{o(te,X);break}else r(te,X);X=X.sibling}X=nx(ie,te.mode,Se),X.return=te,te=X}return b(te);case xl:return Le=ie._init,be(te,X,Le(ie._payload),Se)}if(Tf(ie))return se(te,X,ie,Se);if(df(ie))return pe(te,X,ie,Se);ng(te,ie)}return typeof ie=="string"&&ie!==""||typeof ie=="number"?(ie=""+ie,X!==null&&X.tag===6?(o(te,X.sibling),X=f(X,ie),X.return=te,te=X):(o(te,X),X=rx(ie,te.mode,Se),X.return=te,te=X),b(te)):o(te,X)}return be}var Ih=cI(!0),hI=cI(!1),Kg=$l(null),Yg=null,ph=null,R1=null;function L1(){R1=ph=Yg=null}function z1(t){var r=Kg.current;Xr(Kg),t._currentValue=r}function l0(t,r,o){for(;t!==null;){var u=t.alternate;if((t.childLanes&r)!==r?(t.childLanes|=r,u!==null&&(u.childLanes|=r)):u!==null&&(u.childLanes&r)!==r&&(u.childLanes|=r),t===o)break;t=t.return}}function bh(t,r){Yg=t,R1=ph=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&r&&(Hi=!0),t.firstContext=null)}function Bs(t){var r=t._currentValue;if(R1!==t)if(t={context:t,memoizedValue:r,next:null},ph===null){if(Yg===null)throw Error(at(308));ph=t,Yg.dependencies={lanes:0,firstContext:t}}else ph=ph.next=t;return r}var Fu=null;function D1(t){Fu===null?Fu=[t]:Fu.push(t)}function dI(t,r,o,u){var f=r.interleaved;return f===null?(o.next=o,D1(r)):(o.next=f.next,f.next=o),r.interleaved=o,Ia(t,u)}function Ia(t,r){t.lanes|=r;var o=t.alternate;for(o!==null&&(o.lanes|=r),o=t,t=t.return;t!==null;)t.childLanes|=r,o=t.alternate,o!==null&&(o.childLanes|=r),o=t,t=t.return;return o.tag===3?o.stateNode:null}var bl=!1;function O1(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function fI(t,r){t=t.updateQueue,r.updateQueue===t&&(r.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Ea(t,r){return{eventTime:t,lane:r,tag:0,payload:null,callback:null,next:null}}function Dl(t,r,o){var u=t.updateQueue;if(u===null)return null;if(u=u.shared,hr&2){var f=u.pending;return f===null?r.next=r:(r.next=f.next,f.next=r),u.pending=r,Ia(t,o)}return f=u.interleaved,f===null?(r.next=r,D1(u)):(r.next=f.next,f.next=r),u.interleaved=r,Ia(t,o)}function Tg(t,r,o){if(r=r.updateQueue,r!==null&&(r=r.shared,(o&4194240)!==0)){var u=r.lanes;u&=t.pendingLanes,o|=u,r.lanes=o,b1(t,o)}}function ZT(t,r){var o=t.updateQueue,u=t.alternate;if(u!==null&&(u=u.updateQueue,o===u)){var f=null,_=null;if(o=o.firstBaseUpdate,o!==null){do{var b={eventTime:o.eventTime,lane:o.lane,tag:o.tag,payload:o.payload,callback:o.callback,next:null};_===null?f=_=b:_=_.next=b,o=o.next}while(o!==null);_===null?f=_=r:_=_.next=r}else f=_=r;o={baseState:u.baseState,firstBaseUpdate:f,lastBaseUpdate:_,shared:u.shared,effects:u.effects},t.updateQueue=o;return}t=o.lastBaseUpdate,t===null?o.firstBaseUpdate=r:t.next=r,o.lastBaseUpdate=r}function Jg(t,r,o,u){var f=t.updateQueue;bl=!1;var _=f.firstBaseUpdate,b=f.lastBaseUpdate,T=f.shared.pending;if(T!==null){f.shared.pending=null;var a=T,I=a.next;a.next=null,b===null?_=I:b.next=I,b=a;var D=t.alternate;D!==null&&(D=D.updateQueue,T=D.lastBaseUpdate,T!==b&&(T===null?D.firstBaseUpdate=I:T.next=I,D.lastBaseUpdate=a))}if(_!==null){var j=f.baseState;b=0,D=I=a=null,T=_;do{var V=T.lane,q=T.eventTime;if((u&V)===V){D!==null&&(D=D.next={eventTime:q,lane:0,tag:T.tag,payload:T.payload,callback:T.callback,next:null});e:{var se=t,pe=T;switch(V=r,q=o,pe.tag){case 1:if(se=pe.payload,typeof se=="function"){j=se.call(q,j,V);break e}j=se;break e;case 3:se.flags=se.flags&-65537|128;case 0:if(se=pe.payload,V=typeof se=="function"?se.call(q,j,V):se,V==null)break e;j=mn({},j,V);break e;case 2:bl=!0}}T.callback!==null&&T.lane!==0&&(t.flags|=64,V=f.effects,V===null?f.effects=[T]:V.push(T))}else q={eventTime:q,lane:V,tag:T.tag,payload:T.payload,callback:T.callback,next:null},D===null?(I=D=q,a=j):D=D.next=q,b|=V;if(T=T.next,T===null){if(T=f.shared.pending,T===null)break;V=T,T=V.next,V.next=null,f.lastBaseUpdate=V,f.shared.pending=null}}while(!0);if(D===null&&(a=j),f.baseState=a,f.firstBaseUpdate=I,f.lastBaseUpdate=D,r=f.shared.interleaved,r!==null){f=r;do b|=f.lane,f=f.next;while(f!==r)}else _===null&&(f.shared.lanes=0);Yu|=b,t.lanes=b,t.memoizedState=j}}function XT(t,r,o){if(t=r.effects,r.effects=null,t!==null)for(r=0;r<t.length;r++){var u=t[r],f=u.callback;if(f!==null){if(u.callback=null,u=o,typeof f!="function")throw Error(at(191,f));f.call(u)}}}var _p={},Yo=$l(_p),ep=$l(_p),tp=$l(_p);function ju(t){if(t===_p)throw Error(at(174));return t}function B1(t,r){switch(Wr(tp,r),Wr(ep,t),Wr(Yo,_p),t=r.nodeType,t){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:Vx(null,"");break;default:t=t===8?r.parentNode:r,r=t.namespaceURI||null,t=t.tagName,r=Vx(r,t)}Xr(Yo),Wr(Yo,r)}function Ah(){Xr(Yo),Xr(ep),Xr(tp)}function pI(t){ju(tp.current);var r=ju(Yo.current),o=Vx(r,t.type);r!==o&&(Wr(ep,t),Wr(Yo,o))}function F1(t){ep.current===t&&(Xr(Yo),Xr(ep))}var fn=$l(0);function Qg(t){for(var r=t;r!==null;){if(r.tag===13){var o=r.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||o.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if(r.flags&128)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var Kv=[];function j1(){for(var t=0;t<Kv.length;t++)Kv[t]._workInProgressVersionPrimary=null;Kv.length=0}var Eg=Ma.ReactCurrentDispatcher,Yv=Ma.ReactCurrentBatchConfig,Ku=0,pn=null,Bn=null,Zn=null,e_=!1,Lf=!1,rp=0,bD=0;function fi(){throw Error(at(321))}function N1(t,r){if(r===null)return!1;for(var o=0;o<r.length&&o<t.length;o++)if(!vo(t[o],r[o]))return!1;return!0}function U1(t,r,o,u,f,_){if(Ku=_,pn=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,Eg.current=t===null||t.memoizedState===null?ED:CD,t=o(u,f),Lf){_=0;do{if(Lf=!1,rp=0,25<=_)throw Error(at(301));_+=1,Zn=Bn=null,r.updateQueue=null,Eg.current=kD,t=o(u,f)}while(Lf)}if(Eg.current=t_,r=Bn!==null&&Bn.next!==null,Ku=0,Zn=Bn=pn=null,e_=!1,r)throw Error(at(300));return t}function V1(){var t=rp!==0;return rp=0,t}function Wo(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Zn===null?pn.memoizedState=Zn=t:Zn=Zn.next=t,Zn}function Fs(){if(Bn===null){var t=pn.alternate;t=t!==null?t.memoizedState:null}else t=Bn.next;var r=Zn===null?pn.memoizedState:Zn.next;if(r!==null)Zn=r,Bn=t;else{if(t===null)throw Error(at(310));Bn=t,t={memoizedState:Bn.memoizedState,baseState:Bn.baseState,baseQueue:Bn.baseQueue,queue:Bn.queue,next:null},Zn===null?pn.memoizedState=Zn=t:Zn=Zn.next=t}return Zn}function np(t,r){return typeof r=="function"?r(t):r}function Jv(t){var r=Fs(),o=r.queue;if(o===null)throw Error(at(311));o.lastRenderedReducer=t;var u=Bn,f=u.baseQueue,_=o.pending;if(_!==null){if(f!==null){var b=f.next;f.next=_.next,_.next=b}u.baseQueue=f=_,o.pending=null}if(f!==null){_=f.next,u=u.baseState;var T=b=null,a=null,I=_;do{var D=I.lane;if((Ku&D)===D)a!==null&&(a=a.next={lane:0,action:I.action,hasEagerState:I.hasEagerState,eagerState:I.eagerState,next:null}),u=I.hasEagerState?I.eagerState:t(u,I.action);else{var j={lane:D,action:I.action,hasEagerState:I.hasEagerState,eagerState:I.eagerState,next:null};a===null?(T=a=j,b=u):a=a.next=j,pn.lanes|=D,Yu|=D}I=I.next}while(I!==null&&I!==_);a===null?b=u:a.next=T,vo(u,r.memoizedState)||(Hi=!0),r.memoizedState=u,r.baseState=b,r.baseQueue=a,o.lastRenderedState=u}if(t=o.interleaved,t!==null){f=t;do _=f.lane,pn.lanes|=_,Yu|=_,f=f.next;while(f!==t)}else f===null&&(o.lanes=0);return[r.memoizedState,o.dispatch]}function Qv(t){var r=Fs(),o=r.queue;if(o===null)throw Error(at(311));o.lastRenderedReducer=t;var u=o.dispatch,f=o.pending,_=r.memoizedState;if(f!==null){o.pending=null;var b=f=f.next;do _=t(_,b.action),b=b.next;while(b!==f);vo(_,r.memoizedState)||(Hi=!0),r.memoizedState=_,r.baseQueue===null&&(r.baseState=_),o.lastRenderedState=_}return[_,u]}function mI(){}function gI(t,r){var o=pn,u=Fs(),f=r(),_=!vo(u.memoizedState,f);if(_&&(u.memoizedState=f,Hi=!0),u=u.queue,$1(vI.bind(null,o,u,t),[t]),u.getSnapshot!==r||_||Zn!==null&&Zn.memoizedState.tag&1){if(o.flags|=2048,ip(9,yI.bind(null,o,u,f,r),void 0,null),Xn===null)throw Error(at(349));Ku&30||_I(o,r,f)}return f}function _I(t,r,o){t.flags|=16384,t={getSnapshot:r,value:o},r=pn.updateQueue,r===null?(r={lastEffect:null,stores:null},pn.updateQueue=r,r.stores=[t]):(o=r.stores,o===null?r.stores=[t]:o.push(t))}function yI(t,r,o,u){r.value=o,r.getSnapshot=u,xI(r)&&bI(t)}function vI(t,r,o){return o(function(){xI(r)&&bI(t)})}function xI(t){var r=t.getSnapshot;t=t.value;try{var o=r();return!vo(t,o)}catch{return!0}}function bI(t){var r=Ia(t,1);r!==null&&yo(r,t,1,-1)}function KT(t){var r=Wo();return typeof t=="function"&&(t=t()),r.memoizedState=r.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:np,lastRenderedState:t},r.queue=t,t=t.dispatch=TD.bind(null,pn,t),[r.memoizedState,t]}function ip(t,r,o,u){return t={tag:t,create:r,destroy:o,deps:u,next:null},r=pn.updateQueue,r===null?(r={lastEffect:null,stores:null},pn.updateQueue=r,r.lastEffect=t.next=t):(o=r.lastEffect,o===null?r.lastEffect=t.next=t:(u=o.next,o.next=t,t.next=u,r.lastEffect=t)),t}function wI(){return Fs().memoizedState}function Cg(t,r,o,u){var f=Wo();pn.flags|=t,f.memoizedState=ip(1|r,o,void 0,u===void 0?null:u)}function C_(t,r,o,u){var f=Fs();u=u===void 0?null:u;var _=void 0;if(Bn!==null){var b=Bn.memoizedState;if(_=b.destroy,u!==null&&N1(u,b.deps)){f.memoizedState=ip(r,o,_,u);return}}pn.flags|=t,f.memoizedState=ip(1|r,o,_,u)}function YT(t,r){return Cg(8390656,8,t,r)}function $1(t,r){return C_(2048,8,t,r)}function SI(t,r){return C_(4,2,t,r)}function TI(t,r){return C_(4,4,t,r)}function EI(t,r){if(typeof r=="function")return t=t(),r(t),function(){r(null)};if(r!=null)return t=t(),r.current=t,function(){r.current=null}}function CI(t,r,o){return o=o!=null?o.concat([t]):null,C_(4,4,EI.bind(null,r,t),o)}function G1(){}function kI(t,r){var o=Fs();r=r===void 0?null:r;var u=o.memoizedState;return u!==null&&r!==null&&N1(r,u[1])?u[0]:(o.memoizedState=[t,r],t)}function II(t,r){var o=Fs();r=r===void 0?null:r;var u=o.memoizedState;return u!==null&&r!==null&&N1(r,u[1])?u[0]:(t=t(),o.memoizedState=[t,r],t)}function AI(t,r,o){return Ku&21?(vo(o,r)||(o=zk(),pn.lanes|=o,Yu|=o,t.baseState=!0),r):(t.baseState&&(t.baseState=!1,Hi=!0),t.memoizedState=o)}function wD(t,r){var o=Pr;Pr=o!==0&&4>o?o:4,t(!0);var u=Yv.transition;Yv.transition={};try{t(!1),r()}finally{Pr=o,Yv.transition=u}}function MI(){return Fs().memoizedState}function SD(t,r,o){var u=Bl(t);if(o={lane:u,action:o,hasEagerState:!1,eagerState:null,next:null},PI(t))RI(r,o);else if(o=dI(t,r,o,u),o!==null){var f=Ei();yo(o,t,u,f),LI(o,r,u)}}function TD(t,r,o){var u=Bl(t),f={lane:u,action:o,hasEagerState:!1,eagerState:null,next:null};if(PI(t))RI(r,f);else{var _=t.alternate;if(t.lanes===0&&(_===null||_.lanes===0)&&(_=r.lastRenderedReducer,_!==null))try{var b=r.lastRenderedState,T=_(b,o);if(f.hasEagerState=!0,f.eagerState=T,vo(T,b)){var a=r.interleaved;a===null?(f.next=f,D1(r)):(f.next=a.next,a.next=f),r.interleaved=f;return}}catch{}finally{}o=dI(t,r,f,u),o!==null&&(f=Ei(),yo(o,t,u,f),LI(o,r,u))}}function PI(t){var r=t.alternate;return t===pn||r!==null&&r===pn}function RI(t,r){Lf=e_=!0;var o=t.pending;o===null?r.next=r:(r.next=o.next,o.next=r),t.pending=r}function LI(t,r,o){if(o&4194240){var u=r.lanes;u&=t.pendingLanes,o|=u,r.lanes=o,b1(t,o)}}var t_={readContext:Bs,useCallback:fi,useContext:fi,useEffect:fi,useImperativeHandle:fi,useInsertionEffect:fi,useLayoutEffect:fi,useMemo:fi,useReducer:fi,useRef:fi,useState:fi,useDebugValue:fi,useDeferredValue:fi,useTransition:fi,useMutableSource:fi,useSyncExternalStore:fi,useId:fi,unstable_isNewReconciler:!1},ED={readContext:Bs,useCallback:function(t,r){return Wo().memoizedState=[t,r===void 0?null:r],t},useContext:Bs,useEffect:YT,useImperativeHandle:function(t,r,o){return o=o!=null?o.concat([t]):null,Cg(4194308,4,EI.bind(null,r,t),o)},useLayoutEffect:function(t,r){return Cg(4194308,4,t,r)},useInsertionEffect:function(t,r){return Cg(4,2,t,r)},useMemo:function(t,r){var o=Wo();return r=r===void 0?null:r,t=t(),o.memoizedState=[t,r],t},useReducer:function(t,r,o){var u=Wo();return r=o!==void 0?o(r):r,u.memoizedState=u.baseState=r,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:r},u.queue=t,t=t.dispatch=SD.bind(null,pn,t),[u.memoizedState,t]},useRef:function(t){var r=Wo();return t={current:t},r.memoizedState=t},useState:KT,useDebugValue:G1,useDeferredValue:function(t){return Wo().memoizedState=t},useTransition:function(){var t=KT(!1),r=t[0];return t=wD.bind(null,t[1]),Wo().memoizedState=t,[r,t]},useMutableSource:function(){},useSyncExternalStore:function(t,r,o){var u=pn,f=Wo();if(Qr){if(o===void 0)throw Error(at(407));o=o()}else{if(o=r(),Xn===null)throw Error(at(349));Ku&30||_I(u,r,o)}f.memoizedState=o;var _={value:o,getSnapshot:r};return f.queue=_,YT(vI.bind(null,u,_,t),[t]),u.flags|=2048,ip(9,yI.bind(null,u,_,o,r),void 0,null),o},useId:function(){var t=Wo(),r=Xn.identifierPrefix;if(Qr){var o=Sa,u=wa;o=(u&~(1<<32-_o(u)-1)).toString(32)+o,r=":"+r+"R"+o,o=rp++,0<o&&(r+="H"+o.toString(32)),r+=":"}else o=bD++,r=":"+r+"r"+o.toString(32)+":";return t.memoizedState=r},unstable_isNewReconciler:!1},CD={readContext:Bs,useCallback:kI,useContext:Bs,useEffect:$1,useImperativeHandle:CI,useInsertionEffect:SI,useLayoutEffect:TI,useMemo:II,useReducer:Jv,useRef:wI,useState:function(){return Jv(np)},useDebugValue:G1,useDeferredValue:function(t){var r=Fs();return AI(r,Bn.memoizedState,t)},useTransition:function(){var t=Jv(np)[0],r=Fs().memoizedState;return[t,r]},useMutableSource:mI,useSyncExternalStore:gI,useId:MI,unstable_isNewReconciler:!1},kD={readContext:Bs,useCallback:kI,useContext:Bs,useEffect:$1,useImperativeHandle:CI,useInsertionEffect:SI,useLayoutEffect:TI,useMemo:II,useReducer:Qv,useRef:wI,useState:function(){return Qv(np)},useDebugValue:G1,useDeferredValue:function(t){var r=Fs();return Bn===null?r.memoizedState=t:AI(r,Bn.memoizedState,t)},useTransition:function(){var t=Qv(np)[0],r=Fs().memoizedState;return[t,r]},useMutableSource:mI,useSyncExternalStore:gI,useId:MI,unstable_isNewReconciler:!1};function fo(t,r){if(t&&t.defaultProps){r=mn({},r),t=t.defaultProps;for(var o in t)r[o]===void 0&&(r[o]=t[o]);return r}return r}function u0(t,r,o,u){r=t.memoizedState,o=o(u,r),o=o==null?r:mn({},r,o),t.memoizedState=o,t.lanes===0&&(t.updateQueue.baseState=o)}var k_={isMounted:function(t){return(t=t._reactInternals)?ec(t)===t:!1},enqueueSetState:function(t,r,o){t=t._reactInternals;var u=Ei(),f=Bl(t),_=Ea(u,f);_.payload=r,o!=null&&(_.callback=o),r=Dl(t,_,f),r!==null&&(yo(r,t,f,u),Tg(r,t,f))},enqueueReplaceState:function(t,r,o){t=t._reactInternals;var u=Ei(),f=Bl(t),_=Ea(u,f);_.tag=1,_.payload=r,o!=null&&(_.callback=o),r=Dl(t,_,f),r!==null&&(yo(r,t,f,u),Tg(r,t,f))},enqueueForceUpdate:function(t,r){t=t._reactInternals;var o=Ei(),u=Bl(t),f=Ea(o,u);f.tag=2,r!=null&&(f.callback=r),r=Dl(t,f,u),r!==null&&(yo(r,t,u,o),Tg(r,t,u))}};function JT(t,r,o,u,f,_,b){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(u,_,b):r.prototype&&r.prototype.isPureReactComponent?!Kf(o,u)||!Kf(f,_):!0}function zI(t,r,o){var u=!1,f=Ul,_=r.contextType;return typeof _=="object"&&_!==null?_=Bs(_):(f=Ki(r)?Zu:gi.current,u=r.contextTypes,_=(u=u!=null)?Ch(t,f):Ul),r=new r(o,_),t.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=k_,t.stateNode=r,r._reactInternals=t,u&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=f,t.__reactInternalMemoizedMaskedChildContext=_),r}function QT(t,r,o,u){t=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(o,u),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(o,u),r.state!==t&&k_.enqueueReplaceState(r,r.state,null)}function c0(t,r,o,u){var f=t.stateNode;f.props=o,f.state=t.memoizedState,f.refs={},O1(t);var _=r.contextType;typeof _=="object"&&_!==null?f.context=Bs(_):(_=Ki(r)?Zu:gi.current,f.context=Ch(t,_)),f.state=t.memoizedState,_=r.getDerivedStateFromProps,typeof _=="function"&&(u0(t,r,_,o),f.state=t.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof f.getSnapshotBeforeUpdate=="function"||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(r=f.state,typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount(),r!==f.state&&k_.enqueueReplaceState(f,f.state,null),Jg(t,o,f,u),f.state=t.memoizedState),typeof f.componentDidMount=="function"&&(t.flags|=4194308)}function Mh(t,r){try{var o="",u=r;do o+=tz(u),u=u.return;while(u);var f=o}catch(_){f=`
Error generating stack: `+_.message+`
`+_.stack}return{value:t,source:r,stack:f,digest:null}}function ex(t,r,o){return{value:t,source:null,stack:o??null,digest:r??null}}function h0(t,r){try{console.error(r.value)}catch(o){setTimeout(function(){throw o})}}var ID=typeof WeakMap=="function"?WeakMap:Map;function DI(t,r,o){o=Ea(-1,o),o.tag=3,o.payload={element:null};var u=r.value;return o.callback=function(){n_||(n_=!0,b0=u),h0(t,r)},o}function OI(t,r,o){o=Ea(-1,o),o.tag=3;var u=t.type.getDerivedStateFromError;if(typeof u=="function"){var f=r.value;o.payload=function(){return u(f)},o.callback=function(){h0(t,r)}}var _=t.stateNode;return _!==null&&typeof _.componentDidCatch=="function"&&(o.callback=function(){h0(t,r),typeof u!="function"&&(Ol===null?Ol=new Set([this]):Ol.add(this));var b=r.stack;this.componentDidCatch(r.value,{componentStack:b!==null?b:""})}),o}function eE(t,r,o){var u=t.pingCache;if(u===null){u=t.pingCache=new ID;var f=new Set;u.set(r,f)}else f=u.get(r),f===void 0&&(f=new Set,u.set(r,f));f.has(o)||(f.add(o),t=VD.bind(null,t,r,o),r.then(t,t))}function tE(t){do{var r;if((r=t.tag===13)&&(r=t.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return t;t=t.return}while(t!==null);return null}function rE(t,r,o,u,f){return t.mode&1?(t.flags|=65536,t.lanes=f,t):(t===r?t.flags|=65536:(t.flags|=128,o.flags|=131072,o.flags&=-52805,o.tag===1&&(o.alternate===null?o.tag=17:(r=Ea(-1,1),r.tag=2,Dl(o,r,1))),o.lanes|=1),t)}var AD=Ma.ReactCurrentOwner,Hi=!1;function Ti(t,r,o,u){r.child=t===null?hI(r,null,o,u):Ih(r,t.child,o,u)}function nE(t,r,o,u,f){o=o.render;var _=r.ref;return bh(r,f),u=U1(t,r,o,u,_,f),o=V1(),t!==null&&!Hi?(r.updateQueue=t.updateQueue,r.flags&=-2053,t.lanes&=~f,Aa(t,r,f)):(Qr&&o&&A1(r),r.flags|=1,Ti(t,r,u,f),r.child)}function iE(t,r,o,u,f){if(t===null){var _=o.type;return typeof _=="function"&&!J1(_)&&_.defaultProps===void 0&&o.compare===null&&o.defaultProps===void 0?(r.tag=15,r.type=_,BI(t,r,_,u,f)):(t=Mg(o.type,null,u,r,r.mode,f),t.ref=r.ref,t.return=r,r.child=t)}if(_=t.child,!(t.lanes&f)){var b=_.memoizedProps;if(o=o.compare,o=o!==null?o:Kf,o(b,u)&&t.ref===r.ref)return Aa(t,r,f)}return r.flags|=1,t=Fl(_,u),t.ref=r.ref,t.return=r,r.child=t}function BI(t,r,o,u,f){if(t!==null){var _=t.memoizedProps;if(Kf(_,u)&&t.ref===r.ref)if(Hi=!1,r.pendingProps=u=_,(t.lanes&f)!==0)t.flags&131072&&(Hi=!0);else return r.lanes=t.lanes,Aa(t,r,f)}return d0(t,r,o,u,f)}function FI(t,r,o){var u=r.pendingProps,f=u.children,_=t!==null?t.memoizedState:null;if(u.mode==="hidden")if(!(r.mode&1))r.memoizedState={baseLanes:0,cachePool:null,transitions:null},Wr(gh,cs),cs|=o;else{if(!(o&1073741824))return t=_!==null?_.baseLanes|o:o,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:t,cachePool:null,transitions:null},r.updateQueue=null,Wr(gh,cs),cs|=t,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},u=_!==null?_.baseLanes:o,Wr(gh,cs),cs|=u}else _!==null?(u=_.baseLanes|o,r.memoizedState=null):u=o,Wr(gh,cs),cs|=u;return Ti(t,r,f,o),r.child}function jI(t,r){var o=r.ref;(t===null&&o!==null||t!==null&&t.ref!==o)&&(r.flags|=512,r.flags|=2097152)}function d0(t,r,o,u,f){var _=Ki(o)?Zu:gi.current;return _=Ch(r,_),bh(r,f),o=U1(t,r,o,u,_,f),u=V1(),t!==null&&!Hi?(r.updateQueue=t.updateQueue,r.flags&=-2053,t.lanes&=~f,Aa(t,r,f)):(Qr&&u&&A1(r),r.flags|=1,Ti(t,r,o,f),r.child)}function sE(t,r,o,u,f){if(Ki(o)){var _=!0;Hg(r)}else _=!1;if(bh(r,f),r.stateNode===null)kg(t,r),zI(r,o,u),c0(r,o,u,f),u=!0;else if(t===null){var b=r.stateNode,T=r.memoizedProps;b.props=T;var a=b.context,I=o.contextType;typeof I=="object"&&I!==null?I=Bs(I):(I=Ki(o)?Zu:gi.current,I=Ch(r,I));var D=o.getDerivedStateFromProps,j=typeof D=="function"||typeof b.getSnapshotBeforeUpdate=="function";j||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(T!==u||a!==I)&&QT(r,b,u,I),bl=!1;var V=r.memoizedState;b.state=V,Jg(r,u,b,f),a=r.memoizedState,T!==u||V!==a||Xi.current||bl?(typeof D=="function"&&(u0(r,o,D,u),a=r.memoizedState),(T=bl||JT(r,o,T,u,V,a,I))?(j||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(r.flags|=4194308)):(typeof b.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=u,r.memoizedState=a),b.props=u,b.state=a,b.context=I,u=T):(typeof b.componentDidMount=="function"&&(r.flags|=4194308),u=!1)}else{b=r.stateNode,fI(t,r),T=r.memoizedProps,I=r.type===r.elementType?T:fo(r.type,T),b.props=I,j=r.pendingProps,V=b.context,a=o.contextType,typeof a=="object"&&a!==null?a=Bs(a):(a=Ki(o)?Zu:gi.current,a=Ch(r,a));var q=o.getDerivedStateFromProps;(D=typeof q=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(T!==j||V!==a)&&QT(r,b,u,a),bl=!1,V=r.memoizedState,b.state=V,Jg(r,u,b,f);var se=r.memoizedState;T!==j||V!==se||Xi.current||bl?(typeof q=="function"&&(u0(r,o,q,u),se=r.memoizedState),(I=bl||JT(r,o,I,u,V,se,a)||!1)?(D||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(u,se,a),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(u,se,a)),typeof b.componentDidUpdate=="function"&&(r.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof b.componentDidUpdate!="function"||T===t.memoizedProps&&V===t.memoizedState||(r.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||T===t.memoizedProps&&V===t.memoizedState||(r.flags|=1024),r.memoizedProps=u,r.memoizedState=se),b.props=u,b.state=se,b.context=a,u=I):(typeof b.componentDidUpdate!="function"||T===t.memoizedProps&&V===t.memoizedState||(r.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||T===t.memoizedProps&&V===t.memoizedState||(r.flags|=1024),u=!1)}return f0(t,r,o,u,_,f)}function f0(t,r,o,u,f,_){jI(t,r);var b=(r.flags&128)!==0;if(!u&&!b)return f&&GT(r,o,!1),Aa(t,r,_);u=r.stateNode,AD.current=r;var T=b&&typeof o.getDerivedStateFromError!="function"?null:u.render();return r.flags|=1,t!==null&&b?(r.child=Ih(r,t.child,null,_),r.child=Ih(r,null,T,_)):Ti(t,r,T,_),r.memoizedState=u.state,f&&GT(r,o,!0),r.child}function NI(t){var r=t.stateNode;r.pendingContext?$T(t,r.pendingContext,r.pendingContext!==r.context):r.context&&$T(t,r.context,!1),B1(t,r.containerInfo)}function oE(t,r,o,u,f){return kh(),P1(f),r.flags|=256,Ti(t,r,o,u),r.child}var p0={dehydrated:null,treeContext:null,retryLane:0};function m0(t){return{baseLanes:t,cachePool:null,transitions:null}}function UI(t,r,o){var u=r.pendingProps,f=fn.current,_=!1,b=(r.flags&128)!==0,T;if((T=b)||(T=t!==null&&t.memoizedState===null?!1:(f&2)!==0),T?(_=!0,r.flags&=-129):(t===null||t.memoizedState!==null)&&(f|=1),Wr(fn,f&1),t===null)return a0(r),t=r.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(r.mode&1?t.data==="$!"?r.lanes=8:r.lanes=1073741824:r.lanes=1,null):(b=u.children,t=u.fallback,_?(u=r.mode,_=r.child,b={mode:"hidden",children:b},!(u&1)&&_!==null?(_.childLanes=0,_.pendingProps=b):_=M_(b,u,0,null),t=Gu(t,u,o,null),_.return=r,t.return=r,_.sibling=t,r.child=_,r.child.memoizedState=m0(o),r.memoizedState=p0,t):W1(r,b));if(f=t.memoizedState,f!==null&&(T=f.dehydrated,T!==null))return MD(t,r,b,u,T,f,o);if(_){_=u.fallback,b=r.mode,f=t.child,T=f.sibling;var a={mode:"hidden",children:u.children};return!(b&1)&&r.child!==f?(u=r.child,u.childLanes=0,u.pendingProps=a,r.deletions=null):(u=Fl(f,a),u.subtreeFlags=f.subtreeFlags&14680064),T!==null?_=Fl(T,_):(_=Gu(_,b,o,null),_.flags|=2),_.return=r,u.return=r,u.sibling=_,r.child=u,u=_,_=r.child,b=t.child.memoizedState,b=b===null?m0(o):{baseLanes:b.baseLanes|o,cachePool:null,transitions:b.transitions},_.memoizedState=b,_.childLanes=t.childLanes&~o,r.memoizedState=p0,u}return _=t.child,t=_.sibling,u=Fl(_,{mode:"visible",children:u.children}),!(r.mode&1)&&(u.lanes=o),u.return=r,u.sibling=null,t!==null&&(o=r.deletions,o===null?(r.deletions=[t],r.flags|=16):o.push(t)),r.child=u,r.memoizedState=null,u}function W1(t,r){return r=M_({mode:"visible",children:r},t.mode,0,null),r.return=t,t.child=r}function ig(t,r,o,u){return u!==null&&P1(u),Ih(r,t.child,null,o),t=W1(r,r.pendingProps.children),t.flags|=2,r.memoizedState=null,t}function MD(t,r,o,u,f,_,b){if(o)return r.flags&256?(r.flags&=-257,u=ex(Error(at(422))),ig(t,r,b,u)):r.memoizedState!==null?(r.child=t.child,r.flags|=128,null):(_=u.fallback,f=r.mode,u=M_({mode:"visible",children:u.children},f,0,null),_=Gu(_,f,b,null),_.flags|=2,u.return=r,_.return=r,u.sibling=_,r.child=u,r.mode&1&&Ih(r,t.child,null,b),r.child.memoizedState=m0(b),r.memoizedState=p0,_);if(!(r.mode&1))return ig(t,r,b,null);if(f.data==="$!"){if(u=f.nextSibling&&f.nextSibling.dataset,u)var T=u.dgst;return u=T,_=Error(at(419)),u=ex(_,u,void 0),ig(t,r,b,u)}if(T=(b&t.childLanes)!==0,Hi||T){if(u=Xn,u!==null){switch(b&-b){case 4:f=2;break;case 16:f=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:f=32;break;case 536870912:f=268435456;break;default:f=0}f=f&(u.suspendedLanes|b)?0:f,f!==0&&f!==_.retryLane&&(_.retryLane=f,Ia(t,f),yo(u,t,f,-1))}return Y1(),u=ex(Error(at(421))),ig(t,r,b,u)}return f.data==="$?"?(r.flags|=128,r.child=t.child,r=$D.bind(null,t),f._reactRetry=r,null):(t=_.treeContext,ds=zl(f.nextSibling),fs=r,Qr=!0,go=null,t!==null&&(Rs[Ls++]=wa,Rs[Ls++]=Sa,Rs[Ls++]=Xu,wa=t.id,Sa=t.overflow,Xu=r),r=W1(r,u.children),r.flags|=4096,r)}function aE(t,r,o){t.lanes|=r;var u=t.alternate;u!==null&&(u.lanes|=r),l0(t.return,r,o)}function tx(t,r,o,u,f){var _=t.memoizedState;_===null?t.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:u,tail:o,tailMode:f}:(_.isBackwards=r,_.rendering=null,_.renderingStartTime=0,_.last=u,_.tail=o,_.tailMode=f)}function VI(t,r,o){var u=r.pendingProps,f=u.revealOrder,_=u.tail;if(Ti(t,r,u.children,o),u=fn.current,u&2)u=u&1|2,r.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=r.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&aE(t,o,r);else if(t.tag===19)aE(t,o,r);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===r)break e;for(;t.sibling===null;){if(t.return===null||t.return===r)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}u&=1}if(Wr(fn,u),!(r.mode&1))r.memoizedState=null;else switch(f){case"forwards":for(o=r.child,f=null;o!==null;)t=o.alternate,t!==null&&Qg(t)===null&&(f=o),o=o.sibling;o=f,o===null?(f=r.child,r.child=null):(f=o.sibling,o.sibling=null),tx(r,!1,f,o,_);break;case"backwards":for(o=null,f=r.child,r.child=null;f!==null;){if(t=f.alternate,t!==null&&Qg(t)===null){r.child=f;break}t=f.sibling,f.sibling=o,o=f,f=t}tx(r,!0,o,null,_);break;case"together":tx(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function kg(t,r){!(r.mode&1)&&t!==null&&(t.alternate=null,r.alternate=null,r.flags|=2)}function Aa(t,r,o){if(t!==null&&(r.dependencies=t.dependencies),Yu|=r.lanes,!(o&r.childLanes))return null;if(t!==null&&r.child!==t.child)throw Error(at(153));if(r.child!==null){for(t=r.child,o=Fl(t,t.pendingProps),r.child=o,o.return=r;t.sibling!==null;)t=t.sibling,o=o.sibling=Fl(t,t.pendingProps),o.return=r;o.sibling=null}return r.child}function PD(t,r,o){switch(r.tag){case 3:NI(r),kh();break;case 5:pI(r);break;case 1:Ki(r.type)&&Hg(r);break;case 4:B1(r,r.stateNode.containerInfo);break;case 10:var u=r.type._context,f=r.memoizedProps.value;Wr(Kg,u._currentValue),u._currentValue=f;break;case 13:if(u=r.memoizedState,u!==null)return u.dehydrated!==null?(Wr(fn,fn.current&1),r.flags|=128,null):o&r.child.childLanes?UI(t,r,o):(Wr(fn,fn.current&1),t=Aa(t,r,o),t!==null?t.sibling:null);Wr(fn,fn.current&1);break;case 19:if(u=(o&r.childLanes)!==0,t.flags&128){if(u)return VI(t,r,o);r.flags|=128}if(f=r.memoizedState,f!==null&&(f.rendering=null,f.tail=null,f.lastEffect=null),Wr(fn,fn.current),u)break;return null;case 22:case 23:return r.lanes=0,FI(t,r,o)}return Aa(t,r,o)}var $I,g0,GI,WI;$I=function(t,r){for(var o=r.child;o!==null;){if(o.tag===5||o.tag===6)t.appendChild(o.stateNode);else if(o.tag!==4&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return;o=o.return}o.sibling.return=o.return,o=o.sibling}};g0=function(){};GI=function(t,r,o,u){var f=t.memoizedProps;if(f!==u){t=r.stateNode,ju(Yo.current);var _=null;switch(o){case"input":f=Fx(t,f),u=Fx(t,u),_=[];break;case"select":f=mn({},f,{value:void 0}),u=mn({},u,{value:void 0}),_=[];break;case"textarea":f=Ux(t,f),u=Ux(t,u),_=[];break;default:typeof f.onClick!="function"&&typeof u.onClick=="function"&&(t.onclick=Wg)}$x(o,u);var b;o=null;for(I in f)if(!u.hasOwnProperty(I)&&f.hasOwnProperty(I)&&f[I]!=null)if(I==="style"){var T=f[I];for(b in T)T.hasOwnProperty(b)&&(o||(o={}),o[b]="")}else I!=="dangerouslySetInnerHTML"&&I!=="children"&&I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&I!=="autoFocus"&&($f.hasOwnProperty(I)?_||(_=[]):(_=_||[]).push(I,null));for(I in u){var a=u[I];if(T=f!=null?f[I]:void 0,u.hasOwnProperty(I)&&a!==T&&(a!=null||T!=null))if(I==="style")if(T){for(b in T)!T.hasOwnProperty(b)||a&&a.hasOwnProperty(b)||(o||(o={}),o[b]="");for(b in a)a.hasOwnProperty(b)&&T[b]!==a[b]&&(o||(o={}),o[b]=a[b])}else o||(_||(_=[]),_.push(I,o)),o=a;else I==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,T=T?T.__html:void 0,a!=null&&T!==a&&(_=_||[]).push(I,a)):I==="children"?typeof a!="string"&&typeof a!="number"||(_=_||[]).push(I,""+a):I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&($f.hasOwnProperty(I)?(a!=null&&I==="onScroll"&&Zr("scroll",t),_||T===a||(_=[])):(_=_||[]).push(I,a))}o&&(_=_||[]).push("style",o);var I=_;(r.updateQueue=I)&&(r.flags|=4)}};WI=function(t,r,o,u){o!==u&&(r.flags|=4)};function yf(t,r){if(!Qr)switch(t.tailMode){case"hidden":r=t.tail;for(var o=null;r!==null;)r.alternate!==null&&(o=r),r=r.sibling;o===null?t.tail=null:o.sibling=null;break;case"collapsed":o=t.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?r||t.tail===null?t.tail=null:t.tail.sibling=null:u.sibling=null}}function pi(t){var r=t.alternate!==null&&t.alternate.child===t.child,o=0,u=0;if(r)for(var f=t.child;f!==null;)o|=f.lanes|f.childLanes,u|=f.subtreeFlags&14680064,u|=f.flags&14680064,f.return=t,f=f.sibling;else for(f=t.child;f!==null;)o|=f.lanes|f.childLanes,u|=f.subtreeFlags,u|=f.flags,f.return=t,f=f.sibling;return t.subtreeFlags|=u,t.childLanes=o,r}function RD(t,r,o){var u=r.pendingProps;switch(M1(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return pi(r),null;case 1:return Ki(r.type)&&qg(),pi(r),null;case 3:return u=r.stateNode,Ah(),Xr(Xi),Xr(gi),j1(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(t===null||t.child===null)&&(rg(r)?r.flags|=4:t===null||t.memoizedState.isDehydrated&&!(r.flags&256)||(r.flags|=1024,go!==null&&(T0(go),go=null))),g0(t,r),pi(r),null;case 5:F1(r);var f=ju(tp.current);if(o=r.type,t!==null&&r.stateNode!=null)GI(t,r,o,u,f),t.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!u){if(r.stateNode===null)throw Error(at(166));return pi(r),null}if(t=ju(Yo.current),rg(r)){u=r.stateNode,o=r.type;var _=r.memoizedProps;switch(u[qo]=r,u[Qf]=_,t=(r.mode&1)!==0,o){case"dialog":Zr("cancel",u),Zr("close",u);break;case"iframe":case"object":case"embed":Zr("load",u);break;case"video":case"audio":for(f=0;f<Cf.length;f++)Zr(Cf[f],u);break;case"source":Zr("error",u);break;case"img":case"image":case"link":Zr("error",u),Zr("load",u);break;case"details":Zr("toggle",u);break;case"input":gT(u,_),Zr("invalid",u);break;case"select":u._wrapperState={wasMultiple:!!_.multiple},Zr("invalid",u);break;case"textarea":yT(u,_),Zr("invalid",u)}$x(o,_),f=null;for(var b in _)if(_.hasOwnProperty(b)){var T=_[b];b==="children"?typeof T=="string"?u.textContent!==T&&(_.suppressHydrationWarning!==!0&&tg(u.textContent,T,t),f=["children",T]):typeof T=="number"&&u.textContent!==""+T&&(_.suppressHydrationWarning!==!0&&tg(u.textContent,T,t),f=["children",""+T]):$f.hasOwnProperty(b)&&T!=null&&b==="onScroll"&&Zr("scroll",u)}switch(o){case"input":Hm(u),_T(u,_,!0);break;case"textarea":Hm(u),vT(u);break;case"select":case"option":break;default:typeof _.onClick=="function"&&(u.onclick=Wg)}u=f,r.updateQueue=u,u!==null&&(r.flags|=4)}else{b=f.nodeType===9?f:f.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=vk(o)),t==="http://www.w3.org/1999/xhtml"?o==="script"?(t=b.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof u.is=="string"?t=b.createElement(o,{is:u.is}):(t=b.createElement(o),o==="select"&&(b=t,u.multiple?b.multiple=!0:u.size&&(b.size=u.size))):t=b.createElementNS(t,o),t[qo]=r,t[Qf]=u,$I(t,r,!1,!1),r.stateNode=t;e:{switch(b=Gx(o,u),o){case"dialog":Zr("cancel",t),Zr("close",t),f=u;break;case"iframe":case"object":case"embed":Zr("load",t),f=u;break;case"video":case"audio":for(f=0;f<Cf.length;f++)Zr(Cf[f],t);f=u;break;case"source":Zr("error",t),f=u;break;case"img":case"image":case"link":Zr("error",t),Zr("load",t),f=u;break;case"details":Zr("toggle",t),f=u;break;case"input":gT(t,u),f=Fx(t,u),Zr("invalid",t);break;case"option":f=u;break;case"select":t._wrapperState={wasMultiple:!!u.multiple},f=mn({},u,{value:void 0}),Zr("invalid",t);break;case"textarea":yT(t,u),f=Ux(t,u),Zr("invalid",t);break;default:f=u}$x(o,f),T=f;for(_ in T)if(T.hasOwnProperty(_)){var a=T[_];_==="style"?wk(t,a):_==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,a!=null&&xk(t,a)):_==="children"?typeof a=="string"?(o!=="textarea"||a!=="")&&Gf(t,a):typeof a=="number"&&Gf(t,""+a):_!=="suppressContentEditableWarning"&&_!=="suppressHydrationWarning"&&_!=="autoFocus"&&($f.hasOwnProperty(_)?a!=null&&_==="onScroll"&&Zr("scroll",t):a!=null&&m1(t,_,a,b))}switch(o){case"input":Hm(t),_T(t,u,!1);break;case"textarea":Hm(t),vT(t);break;case"option":u.value!=null&&t.setAttribute("value",""+Nl(u.value));break;case"select":t.multiple=!!u.multiple,_=u.value,_!=null?_h(t,!!u.multiple,_,!1):u.defaultValue!=null&&_h(t,!!u.multiple,u.defaultValue,!0);break;default:typeof f.onClick=="function"&&(t.onclick=Wg)}switch(o){case"button":case"input":case"select":case"textarea":u=!!u.autoFocus;break e;case"img":u=!0;break e;default:u=!1}}u&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return pi(r),null;case 6:if(t&&r.stateNode!=null)WI(t,r,t.memoizedProps,u);else{if(typeof u!="string"&&r.stateNode===null)throw Error(at(166));if(o=ju(tp.current),ju(Yo.current),rg(r)){if(u=r.stateNode,o=r.memoizedProps,u[qo]=r,(_=u.nodeValue!==o)&&(t=fs,t!==null))switch(t.tag){case 3:tg(u.nodeValue,o,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&tg(u.nodeValue,o,(t.mode&1)!==0)}_&&(r.flags|=4)}else u=(o.nodeType===9?o:o.ownerDocument).createTextNode(u),u[qo]=r,r.stateNode=u}return pi(r),null;case 13:if(Xr(fn),u=r.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Qr&&ds!==null&&r.mode&1&&!(r.flags&128))uI(),kh(),r.flags|=98560,_=!1;else if(_=rg(r),u!==null&&u.dehydrated!==null){if(t===null){if(!_)throw Error(at(318));if(_=r.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(at(317));_[qo]=r}else kh(),!(r.flags&128)&&(r.memoizedState=null),r.flags|=4;pi(r),_=!1}else go!==null&&(T0(go),go=null),_=!0;if(!_)return r.flags&65536?r:null}return r.flags&128?(r.lanes=o,r):(u=u!==null,u!==(t!==null&&t.memoizedState!==null)&&u&&(r.child.flags|=8192,r.mode&1&&(t===null||fn.current&1?Fn===0&&(Fn=3):Y1())),r.updateQueue!==null&&(r.flags|=4),pi(r),null);case 4:return Ah(),g0(t,r),t===null&&Yf(r.stateNode.containerInfo),pi(r),null;case 10:return z1(r.type._context),pi(r),null;case 17:return Ki(r.type)&&qg(),pi(r),null;case 19:if(Xr(fn),_=r.memoizedState,_===null)return pi(r),null;if(u=(r.flags&128)!==0,b=_.rendering,b===null)if(u)yf(_,!1);else{if(Fn!==0||t!==null&&t.flags&128)for(t=r.child;t!==null;){if(b=Qg(t),b!==null){for(r.flags|=128,yf(_,!1),u=b.updateQueue,u!==null&&(r.updateQueue=u,r.flags|=4),r.subtreeFlags=0,u=o,o=r.child;o!==null;)_=o,t=u,_.flags&=14680066,b=_.alternate,b===null?(_.childLanes=0,_.lanes=t,_.child=null,_.subtreeFlags=0,_.memoizedProps=null,_.memoizedState=null,_.updateQueue=null,_.dependencies=null,_.stateNode=null):(_.childLanes=b.childLanes,_.lanes=b.lanes,_.child=b.child,_.subtreeFlags=0,_.deletions=null,_.memoizedProps=b.memoizedProps,_.memoizedState=b.memoizedState,_.updateQueue=b.updateQueue,_.type=b.type,t=b.dependencies,_.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),o=o.sibling;return Wr(fn,fn.current&1|2),r.child}t=t.sibling}_.tail!==null&&Tn()>Ph&&(r.flags|=128,u=!0,yf(_,!1),r.lanes=4194304)}else{if(!u)if(t=Qg(b),t!==null){if(r.flags|=128,u=!0,o=t.updateQueue,o!==null&&(r.updateQueue=o,r.flags|=4),yf(_,!0),_.tail===null&&_.tailMode==="hidden"&&!b.alternate&&!Qr)return pi(r),null}else 2*Tn()-_.renderingStartTime>Ph&&o!==1073741824&&(r.flags|=128,u=!0,yf(_,!1),r.lanes=4194304);_.isBackwards?(b.sibling=r.child,r.child=b):(o=_.last,o!==null?o.sibling=b:r.child=b,_.last=b)}return _.tail!==null?(r=_.tail,_.rendering=r,_.tail=r.sibling,_.renderingStartTime=Tn(),r.sibling=null,o=fn.current,Wr(fn,u?o&1|2:o&1),r):(pi(r),null);case 22:case 23:return K1(),u=r.memoizedState!==null,t!==null&&t.memoizedState!==null!==u&&(r.flags|=8192),u&&r.mode&1?cs&1073741824&&(pi(r),r.subtreeFlags&6&&(r.flags|=8192)):pi(r),null;case 24:return null;case 25:return null}throw Error(at(156,r.tag))}function LD(t,r){switch(M1(r),r.tag){case 1:return Ki(r.type)&&qg(),t=r.flags,t&65536?(r.flags=t&-65537|128,r):null;case 3:return Ah(),Xr(Xi),Xr(gi),j1(),t=r.flags,t&65536&&!(t&128)?(r.flags=t&-65537|128,r):null;case 5:return F1(r),null;case 13:if(Xr(fn),t=r.memoizedState,t!==null&&t.dehydrated!==null){if(r.alternate===null)throw Error(at(340));kh()}return t=r.flags,t&65536?(r.flags=t&-65537|128,r):null;case 19:return Xr(fn),null;case 4:return Ah(),null;case 10:return z1(r.type._context),null;case 22:case 23:return K1(),null;case 24:return null;default:return null}}var sg=!1,mi=!1,zD=typeof WeakSet=="function"?WeakSet:Set,wt=null;function mh(t,r){var o=t.ref;if(o!==null)if(typeof o=="function")try{o(null)}catch(u){vn(t,r,u)}else o.current=null}function _0(t,r,o){try{o()}catch(u){vn(t,r,u)}}var lE=!1;function DD(t,r){if(e0=Vg,t=Kk(),I1(t)){if("selectionStart"in t)var o={start:t.selectionStart,end:t.selectionEnd};else e:{o=(o=t.ownerDocument)&&o.defaultView||window;var u=o.getSelection&&o.getSelection();if(u&&u.rangeCount!==0){o=u.anchorNode;var f=u.anchorOffset,_=u.focusNode;u=u.focusOffset;try{o.nodeType,_.nodeType}catch{o=null;break e}var b=0,T=-1,a=-1,I=0,D=0,j=t,V=null;t:for(;;){for(var q;j!==o||f!==0&&j.nodeType!==3||(T=b+f),j!==_||u!==0&&j.nodeType!==3||(a=b+u),j.nodeType===3&&(b+=j.nodeValue.length),(q=j.firstChild)!==null;)V=j,j=q;for(;;){if(j===t)break t;if(V===o&&++I===f&&(T=b),V===_&&++D===u&&(a=b),(q=j.nextSibling)!==null)break;j=V,V=j.parentNode}j=q}o=T===-1||a===-1?null:{start:T,end:a}}else o=null}o=o||{start:0,end:0}}else o=null;for(t0={focusedElem:t,selectionRange:o},Vg=!1,wt=r;wt!==null;)if(r=wt,t=r.child,(r.subtreeFlags&1028)!==0&&t!==null)t.return=r,wt=t;else for(;wt!==null;){r=wt;try{var se=r.alternate;if(r.flags&1024)switch(r.tag){case 0:case 11:case 15:break;case 1:if(se!==null){var pe=se.memoizedProps,be=se.memoizedState,te=r.stateNode,X=te.getSnapshotBeforeUpdate(r.elementType===r.type?pe:fo(r.type,pe),be);te.__reactInternalSnapshotBeforeUpdate=X}break;case 3:var ie=r.stateNode.containerInfo;ie.nodeType===1?ie.textContent="":ie.nodeType===9&&ie.documentElement&&ie.removeChild(ie.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(at(163))}}catch(Se){vn(r,r.return,Se)}if(t=r.sibling,t!==null){t.return=r.return,wt=t;break}wt=r.return}return se=lE,lE=!1,se}function zf(t,r,o){var u=r.updateQueue;if(u=u!==null?u.lastEffect:null,u!==null){var f=u=u.next;do{if((f.tag&t)===t){var _=f.destroy;f.destroy=void 0,_!==void 0&&_0(r,o,_)}f=f.next}while(f!==u)}}function I_(t,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var o=r=r.next;do{if((o.tag&t)===t){var u=o.create;o.destroy=u()}o=o.next}while(o!==r)}}function y0(t){var r=t.ref;if(r!==null){var o=t.stateNode;switch(t.tag){case 5:t=o;break;default:t=o}typeof r=="function"?r(t):r.current=t}}function qI(t){var r=t.alternate;r!==null&&(t.alternate=null,qI(r)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(r=t.stateNode,r!==null&&(delete r[qo],delete r[Qf],delete r[i0],delete r[_D],delete r[yD])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function HI(t){return t.tag===5||t.tag===3||t.tag===4}function uE(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||HI(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function v0(t,r,o){var u=t.tag;if(u===5||u===6)t=t.stateNode,r?o.nodeType===8?o.parentNode.insertBefore(t,r):o.insertBefore(t,r):(o.nodeType===8?(r=o.parentNode,r.insertBefore(t,o)):(r=o,r.appendChild(t)),o=o._reactRootContainer,o!=null||r.onclick!==null||(r.onclick=Wg));else if(u!==4&&(t=t.child,t!==null))for(v0(t,r,o),t=t.sibling;t!==null;)v0(t,r,o),t=t.sibling}function x0(t,r,o){var u=t.tag;if(u===5||u===6)t=t.stateNode,r?o.insertBefore(t,r):o.appendChild(t);else if(u!==4&&(t=t.child,t!==null))for(x0(t,r,o),t=t.sibling;t!==null;)x0(t,r,o),t=t.sibling}var ti=null,po=!1;function dl(t,r,o){for(o=o.child;o!==null;)ZI(t,r,o),o=o.sibling}function ZI(t,r,o){if(Ko&&typeof Ko.onCommitFiberUnmount=="function")try{Ko.onCommitFiberUnmount(x_,o)}catch{}switch(o.tag){case 5:mi||mh(o,r);case 6:var u=ti,f=po;ti=null,dl(t,r,o),ti=u,po=f,ti!==null&&(po?(t=ti,o=o.stateNode,t.nodeType===8?t.parentNode.removeChild(o):t.removeChild(o)):ti.removeChild(o.stateNode));break;case 18:ti!==null&&(po?(t=ti,o=o.stateNode,t.nodeType===8?Zv(t.parentNode,o):t.nodeType===1&&Zv(t,o),Zf(t)):Zv(ti,o.stateNode));break;case 4:u=ti,f=po,ti=o.stateNode.containerInfo,po=!0,dl(t,r,o),ti=u,po=f;break;case 0:case 11:case 14:case 15:if(!mi&&(u=o.updateQueue,u!==null&&(u=u.lastEffect,u!==null))){f=u=u.next;do{var _=f,b=_.destroy;_=_.tag,b!==void 0&&(_&2||_&4)&&_0(o,r,b),f=f.next}while(f!==u)}dl(t,r,o);break;case 1:if(!mi&&(mh(o,r),u=o.stateNode,typeof u.componentWillUnmount=="function"))try{u.props=o.memoizedProps,u.state=o.memoizedState,u.componentWillUnmount()}catch(T){vn(o,r,T)}dl(t,r,o);break;case 21:dl(t,r,o);break;case 22:o.mode&1?(mi=(u=mi)||o.memoizedState!==null,dl(t,r,o),mi=u):dl(t,r,o);break;default:dl(t,r,o)}}function cE(t){var r=t.updateQueue;if(r!==null){t.updateQueue=null;var o=t.stateNode;o===null&&(o=t.stateNode=new zD),r.forEach(function(u){var f=GD.bind(null,t,u);o.has(u)||(o.add(u),u.then(f,f))})}}function lo(t,r){var o=r.deletions;if(o!==null)for(var u=0;u<o.length;u++){var f=o[u];try{var _=t,b=r,T=b;e:for(;T!==null;){switch(T.tag){case 5:ti=T.stateNode,po=!1;break e;case 3:ti=T.stateNode.containerInfo,po=!0;break e;case 4:ti=T.stateNode.containerInfo,po=!0;break e}T=T.return}if(ti===null)throw Error(at(160));ZI(_,b,f),ti=null,po=!1;var a=f.alternate;a!==null&&(a.return=null),f.return=null}catch(I){vn(f,r,I)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)XI(r,t),r=r.sibling}function XI(t,r){var o=t.alternate,u=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(lo(r,t),Vo(t),u&4){try{zf(3,t,t.return),I_(3,t)}catch(pe){vn(t,t.return,pe)}try{zf(5,t,t.return)}catch(pe){vn(t,t.return,pe)}}break;case 1:lo(r,t),Vo(t),u&512&&o!==null&&mh(o,o.return);break;case 5:if(lo(r,t),Vo(t),u&512&&o!==null&&mh(o,o.return),t.flags&32){var f=t.stateNode;try{Gf(f,"")}catch(pe){vn(t,t.return,pe)}}if(u&4&&(f=t.stateNode,f!=null)){var _=t.memoizedProps,b=o!==null?o.memoizedProps:_,T=t.type,a=t.updateQueue;if(t.updateQueue=null,a!==null)try{T==="input"&&_.type==="radio"&&_.name!=null&&_k(f,_),Gx(T,b);var I=Gx(T,_);for(b=0;b<a.length;b+=2){var D=a[b],j=a[b+1];D==="style"?wk(f,j):D==="dangerouslySetInnerHTML"?xk(f,j):D==="children"?Gf(f,j):m1(f,D,j,I)}switch(T){case"input":jx(f,_);break;case"textarea":yk(f,_);break;case"select":var V=f._wrapperState.wasMultiple;f._wrapperState.wasMultiple=!!_.multiple;var q=_.value;q!=null?_h(f,!!_.multiple,q,!1):V!==!!_.multiple&&(_.defaultValue!=null?_h(f,!!_.multiple,_.defaultValue,!0):_h(f,!!_.multiple,_.multiple?[]:"",!1))}f[Qf]=_}catch(pe){vn(t,t.return,pe)}}break;case 6:if(lo(r,t),Vo(t),u&4){if(t.stateNode===null)throw Error(at(162));f=t.stateNode,_=t.memoizedProps;try{f.nodeValue=_}catch(pe){vn(t,t.return,pe)}}break;case 3:if(lo(r,t),Vo(t),u&4&&o!==null&&o.memoizedState.isDehydrated)try{Zf(r.containerInfo)}catch(pe){vn(t,t.return,pe)}break;case 4:lo(r,t),Vo(t);break;case 13:lo(r,t),Vo(t),f=t.child,f.flags&8192&&(_=f.memoizedState!==null,f.stateNode.isHidden=_,!_||f.alternate!==null&&f.alternate.memoizedState!==null||(Z1=Tn())),u&4&&cE(t);break;case 22:if(D=o!==null&&o.memoizedState!==null,t.mode&1?(mi=(I=mi)||D,lo(r,t),mi=I):lo(r,t),Vo(t),u&8192){if(I=t.memoizedState!==null,(t.stateNode.isHidden=I)&&!D&&t.mode&1)for(wt=t,D=t.child;D!==null;){for(j=wt=D;wt!==null;){switch(V=wt,q=V.child,V.tag){case 0:case 11:case 14:case 15:zf(4,V,V.return);break;case 1:mh(V,V.return);var se=V.stateNode;if(typeof se.componentWillUnmount=="function"){u=V,o=V.return;try{r=u,se.props=r.memoizedProps,se.state=r.memoizedState,se.componentWillUnmount()}catch(pe){vn(u,o,pe)}}break;case 5:mh(V,V.return);break;case 22:if(V.memoizedState!==null){dE(j);continue}}q!==null?(q.return=V,wt=q):dE(j)}D=D.sibling}e:for(D=null,j=t;;){if(j.tag===5){if(D===null){D=j;try{f=j.stateNode,I?(_=f.style,typeof _.setProperty=="function"?_.setProperty("display","none","important"):_.display="none"):(T=j.stateNode,a=j.memoizedProps.style,b=a!=null&&a.hasOwnProperty("display")?a.display:null,T.style.display=bk("display",b))}catch(pe){vn(t,t.return,pe)}}}else if(j.tag===6){if(D===null)try{j.stateNode.nodeValue=I?"":j.memoizedProps}catch(pe){vn(t,t.return,pe)}}else if((j.tag!==22&&j.tag!==23||j.memoizedState===null||j===t)&&j.child!==null){j.child.return=j,j=j.child;continue}if(j===t)break e;for(;j.sibling===null;){if(j.return===null||j.return===t)break e;D===j&&(D=null),j=j.return}D===j&&(D=null),j.sibling.return=j.return,j=j.sibling}}break;case 19:lo(r,t),Vo(t),u&4&&cE(t);break;case 21:break;default:lo(r,t),Vo(t)}}function Vo(t){var r=t.flags;if(r&2){try{e:{for(var o=t.return;o!==null;){if(HI(o)){var u=o;break e}o=o.return}throw Error(at(160))}switch(u.tag){case 5:var f=u.stateNode;u.flags&32&&(Gf(f,""),u.flags&=-33);var _=uE(t);x0(t,_,f);break;case 3:case 4:var b=u.stateNode.containerInfo,T=uE(t);v0(t,T,b);break;default:throw Error(at(161))}}catch(a){vn(t,t.return,a)}t.flags&=-3}r&4096&&(t.flags&=-4097)}function OD(t,r,o){wt=t,KI(t)}function KI(t,r,o){for(var u=(t.mode&1)!==0;wt!==null;){var f=wt,_=f.child;if(f.tag===22&&u){var b=f.memoizedState!==null||sg;if(!b){var T=f.alternate,a=T!==null&&T.memoizedState!==null||mi;T=sg;var I=mi;if(sg=b,(mi=a)&&!I)for(wt=f;wt!==null;)b=wt,a=b.child,b.tag===22&&b.memoizedState!==null?fE(f):a!==null?(a.return=b,wt=a):fE(f);for(;_!==null;)wt=_,KI(_),_=_.sibling;wt=f,sg=T,mi=I}hE(t)}else f.subtreeFlags&8772&&_!==null?(_.return=f,wt=_):hE(t)}}function hE(t){for(;wt!==null;){var r=wt;if(r.flags&8772){var o=r.alternate;try{if(r.flags&8772)switch(r.tag){case 0:case 11:case 15:mi||I_(5,r);break;case 1:var u=r.stateNode;if(r.flags&4&&!mi)if(o===null)u.componentDidMount();else{var f=r.elementType===r.type?o.memoizedProps:fo(r.type,o.memoizedProps);u.componentDidUpdate(f,o.memoizedState,u.__reactInternalSnapshotBeforeUpdate)}var _=r.updateQueue;_!==null&&XT(r,_,u);break;case 3:var b=r.updateQueue;if(b!==null){if(o=null,r.child!==null)switch(r.child.tag){case 5:o=r.child.stateNode;break;case 1:o=r.child.stateNode}XT(r,b,o)}break;case 5:var T=r.stateNode;if(o===null&&r.flags&4){o=T;var a=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":a.autoFocus&&o.focus();break;case"img":a.src&&(o.src=a.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var I=r.alternate;if(I!==null){var D=I.memoizedState;if(D!==null){var j=D.dehydrated;j!==null&&Zf(j)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(at(163))}mi||r.flags&512&&y0(r)}catch(V){vn(r,r.return,V)}}if(r===t){wt=null;break}if(o=r.sibling,o!==null){o.return=r.return,wt=o;break}wt=r.return}}function dE(t){for(;wt!==null;){var r=wt;if(r===t){wt=null;break}var o=r.sibling;if(o!==null){o.return=r.return,wt=o;break}wt=r.return}}function fE(t){for(;wt!==null;){var r=wt;try{switch(r.tag){case 0:case 11:case 15:var o=r.return;try{I_(4,r)}catch(a){vn(r,o,a)}break;case 1:var u=r.stateNode;if(typeof u.componentDidMount=="function"){var f=r.return;try{u.componentDidMount()}catch(a){vn(r,f,a)}}var _=r.return;try{y0(r)}catch(a){vn(r,_,a)}break;case 5:var b=r.return;try{y0(r)}catch(a){vn(r,b,a)}}}catch(a){vn(r,r.return,a)}if(r===t){wt=null;break}var T=r.sibling;if(T!==null){T.return=r.return,wt=T;break}wt=r.return}}var BD=Math.ceil,r_=Ma.ReactCurrentDispatcher,q1=Ma.ReactCurrentOwner,Ds=Ma.ReactCurrentBatchConfig,hr=0,Xn=null,An=null,ri=0,cs=0,gh=$l(0),Fn=0,sp=null,Yu=0,A_=0,H1=0,Df=null,Wi=null,Z1=0,Ph=1/0,ya=null,n_=!1,b0=null,Ol=null,og=!1,Il=null,i_=0,Of=0,w0=null,Ig=-1,Ag=0;function Ei(){return hr&6?Tn():Ig!==-1?Ig:Ig=Tn()}function Bl(t){return t.mode&1?hr&2&&ri!==0?ri&-ri:xD.transition!==null?(Ag===0&&(Ag=zk()),Ag):(t=Pr,t!==0||(t=window.event,t=t===void 0?16:Uk(t.type)),t):1}function yo(t,r,o,u){if(50<Of)throw Of=0,w0=null,Error(at(185));pp(t,o,u),(!(hr&2)||t!==Xn)&&(t===Xn&&(!(hr&2)&&(A_|=o),Fn===4&&El(t,ri)),Yi(t,u),o===1&&hr===0&&!(r.mode&1)&&(Ph=Tn()+500,E_&&Gl()))}function Yi(t,r){var o=t.callbackNode;xz(t,r);var u=Ug(t,t===Xn?ri:0);if(u===0)o!==null&&wT(o),t.callbackNode=null,t.callbackPriority=0;else if(r=u&-u,t.callbackPriority!==r){if(o!=null&&wT(o),r===1)t.tag===0?vD(pE.bind(null,t)):oI(pE.bind(null,t)),mD(function(){!(hr&6)&&Gl()}),o=null;else{switch(Dk(u)){case 1:o=x1;break;case 4:o=Rk;break;case 16:o=Ng;break;case 536870912:o=Lk;break;default:o=Ng}o=iA(o,YI.bind(null,t))}t.callbackPriority=r,t.callbackNode=o}}function YI(t,r){if(Ig=-1,Ag=0,hr&6)throw Error(at(327));var o=t.callbackNode;if(wh()&&t.callbackNode!==o)return null;var u=Ug(t,t===Xn?ri:0);if(u===0)return null;if(u&30||u&t.expiredLanes||r)r=s_(t,u);else{r=u;var f=hr;hr|=2;var _=QI();(Xn!==t||ri!==r)&&(ya=null,Ph=Tn()+500,$u(t,r));do try{ND();break}catch(T){JI(t,T)}while(!0);L1(),r_.current=_,hr=f,An!==null?r=0:(Xn=null,ri=0,r=Fn)}if(r!==0){if(r===2&&(f=Xx(t),f!==0&&(u=f,r=S0(t,f))),r===1)throw o=sp,$u(t,0),El(t,u),Yi(t,Tn()),o;if(r===6)El(t,u);else{if(f=t.current.alternate,!(u&30)&&!FD(f)&&(r=s_(t,u),r===2&&(_=Xx(t),_!==0&&(u=_,r=S0(t,_))),r===1))throw o=sp,$u(t,0),El(t,u),Yi(t,Tn()),o;switch(t.finishedWork=f,t.finishedLanes=u,r){case 0:case 1:throw Error(at(345));case 2:zu(t,Wi,ya);break;case 3:if(El(t,u),(u&130023424)===u&&(r=Z1+500-Tn(),10<r)){if(Ug(t,0)!==0)break;if(f=t.suspendedLanes,(f&u)!==u){Ei(),t.pingedLanes|=t.suspendedLanes&f;break}t.timeoutHandle=n0(zu.bind(null,t,Wi,ya),r);break}zu(t,Wi,ya);break;case 4:if(El(t,u),(u&4194240)===u)break;for(r=t.eventTimes,f=-1;0<u;){var b=31-_o(u);_=1<<b,b=r[b],b>f&&(f=b),u&=~_}if(u=f,u=Tn()-u,u=(120>u?120:480>u?480:1080>u?1080:1920>u?1920:3e3>u?3e3:4320>u?4320:1960*BD(u/1960))-u,10<u){t.timeoutHandle=n0(zu.bind(null,t,Wi,ya),u);break}zu(t,Wi,ya);break;case 5:zu(t,Wi,ya);break;default:throw Error(at(329))}}}return Yi(t,Tn()),t.callbackNode===o?YI.bind(null,t):null}function S0(t,r){var o=Df;return t.current.memoizedState.isDehydrated&&($u(t,r).flags|=256),t=s_(t,r),t!==2&&(r=Wi,Wi=o,r!==null&&T0(r)),t}function T0(t){Wi===null?Wi=t:Wi.push.apply(Wi,t)}function FD(t){for(var r=t;;){if(r.flags&16384){var o=r.updateQueue;if(o!==null&&(o=o.stores,o!==null))for(var u=0;u<o.length;u++){var f=o[u],_=f.getSnapshot;f=f.value;try{if(!vo(_(),f))return!1}catch{return!1}}}if(o=r.child,r.subtreeFlags&16384&&o!==null)o.return=r,r=o;else{if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function El(t,r){for(r&=~H1,r&=~A_,t.suspendedLanes|=r,t.pingedLanes&=~r,t=t.expirationTimes;0<r;){var o=31-_o(r),u=1<<o;t[o]=-1,r&=~u}}function pE(t){if(hr&6)throw Error(at(327));wh();var r=Ug(t,0);if(!(r&1))return Yi(t,Tn()),null;var o=s_(t,r);if(t.tag!==0&&o===2){var u=Xx(t);u!==0&&(r=u,o=S0(t,u))}if(o===1)throw o=sp,$u(t,0),El(t,r),Yi(t,Tn()),o;if(o===6)throw Error(at(345));return t.finishedWork=t.current.alternate,t.finishedLanes=r,zu(t,Wi,ya),Yi(t,Tn()),null}function X1(t,r){var o=hr;hr|=1;try{return t(r)}finally{hr=o,hr===0&&(Ph=Tn()+500,E_&&Gl())}}function Ju(t){Il!==null&&Il.tag===0&&!(hr&6)&&wh();var r=hr;hr|=1;var o=Ds.transition,u=Pr;try{if(Ds.transition=null,Pr=1,t)return t()}finally{Pr=u,Ds.transition=o,hr=r,!(hr&6)&&Gl()}}function K1(){cs=gh.current,Xr(gh)}function $u(t,r){t.finishedWork=null,t.finishedLanes=0;var o=t.timeoutHandle;if(o!==-1&&(t.timeoutHandle=-1,pD(o)),An!==null)for(o=An.return;o!==null;){var u=o;switch(M1(u),u.tag){case 1:u=u.type.childContextTypes,u!=null&&qg();break;case 3:Ah(),Xr(Xi),Xr(gi),j1();break;case 5:F1(u);break;case 4:Ah();break;case 13:Xr(fn);break;case 19:Xr(fn);break;case 10:z1(u.type._context);break;case 22:case 23:K1()}o=o.return}if(Xn=t,An=t=Fl(t.current,null),ri=cs=r,Fn=0,sp=null,H1=A_=Yu=0,Wi=Df=null,Fu!==null){for(r=0;r<Fu.length;r++)if(o=Fu[r],u=o.interleaved,u!==null){o.interleaved=null;var f=u.next,_=o.pending;if(_!==null){var b=_.next;_.next=f,u.next=b}o.pending=u}Fu=null}return t}function JI(t,r){do{var o=An;try{if(L1(),Eg.current=t_,e_){for(var u=pn.memoizedState;u!==null;){var f=u.queue;f!==null&&(f.pending=null),u=u.next}e_=!1}if(Ku=0,Zn=Bn=pn=null,Lf=!1,rp=0,q1.current=null,o===null||o.return===null){Fn=1,sp=r,An=null;break}e:{var _=t,b=o.return,T=o,a=r;if(r=ri,T.flags|=32768,a!==null&&typeof a=="object"&&typeof a.then=="function"){var I=a,D=T,j=D.tag;if(!(D.mode&1)&&(j===0||j===11||j===15)){var V=D.alternate;V?(D.updateQueue=V.updateQueue,D.memoizedState=V.memoizedState,D.lanes=V.lanes):(D.updateQueue=null,D.memoizedState=null)}var q=tE(b);if(q!==null){q.flags&=-257,rE(q,b,T,_,r),q.mode&1&&eE(_,I,r),r=q,a=I;var se=r.updateQueue;if(se===null){var pe=new Set;pe.add(a),r.updateQueue=pe}else se.add(a);break e}else{if(!(r&1)){eE(_,I,r),Y1();break e}a=Error(at(426))}}else if(Qr&&T.mode&1){var be=tE(b);if(be!==null){!(be.flags&65536)&&(be.flags|=256),rE(be,b,T,_,r),P1(Mh(a,T));break e}}_=a=Mh(a,T),Fn!==4&&(Fn=2),Df===null?Df=[_]:Df.push(_),_=b;do{switch(_.tag){case 3:_.flags|=65536,r&=-r,_.lanes|=r;var te=DI(_,a,r);ZT(_,te);break e;case 1:T=a;var X=_.type,ie=_.stateNode;if(!(_.flags&128)&&(typeof X.getDerivedStateFromError=="function"||ie!==null&&typeof ie.componentDidCatch=="function"&&(Ol===null||!Ol.has(ie)))){_.flags|=65536,r&=-r,_.lanes|=r;var Se=OI(_,T,r);ZT(_,Se);break e}}_=_.return}while(_!==null)}tA(o)}catch(Ce){r=Ce,An===o&&o!==null&&(An=o=o.return);continue}break}while(!0)}function QI(){var t=r_.current;return r_.current=t_,t===null?t_:t}function Y1(){(Fn===0||Fn===3||Fn===2)&&(Fn=4),Xn===null||!(Yu&268435455)&&!(A_&268435455)||El(Xn,ri)}function s_(t,r){var o=hr;hr|=2;var u=QI();(Xn!==t||ri!==r)&&(ya=null,$u(t,r));do try{jD();break}catch(f){JI(t,f)}while(!0);if(L1(),hr=o,r_.current=u,An!==null)throw Error(at(261));return Xn=null,ri=0,Fn}function jD(){for(;An!==null;)eA(An)}function ND(){for(;An!==null&&!hz();)eA(An)}function eA(t){var r=nA(t.alternate,t,cs);t.memoizedProps=t.pendingProps,r===null?tA(t):An=r,q1.current=null}function tA(t){var r=t;do{var o=r.alternate;if(t=r.return,r.flags&32768){if(o=LD(o,r),o!==null){o.flags&=32767,An=o;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Fn=6,An=null;return}}else if(o=RD(o,r,cs),o!==null){An=o;return}if(r=r.sibling,r!==null){An=r;return}An=r=t}while(r!==null);Fn===0&&(Fn=5)}function zu(t,r,o){var u=Pr,f=Ds.transition;try{Ds.transition=null,Pr=1,UD(t,r,o,u)}finally{Ds.transition=f,Pr=u}return null}function UD(t,r,o,u){do wh();while(Il!==null);if(hr&6)throw Error(at(327));o=t.finishedWork;var f=t.finishedLanes;if(o===null)return null;if(t.finishedWork=null,t.finishedLanes=0,o===t.current)throw Error(at(177));t.callbackNode=null,t.callbackPriority=0;var _=o.lanes|o.childLanes;if(bz(t,_),t===Xn&&(An=Xn=null,ri=0),!(o.subtreeFlags&2064)&&!(o.flags&2064)||og||(og=!0,iA(Ng,function(){return wh(),null})),_=(o.flags&15990)!==0,o.subtreeFlags&15990||_){_=Ds.transition,Ds.transition=null;var b=Pr;Pr=1;var T=hr;hr|=4,q1.current=null,DD(t,o),XI(o,t),aD(t0),Vg=!!e0,t0=e0=null,t.current=o,OD(o),dz(),hr=T,Pr=b,Ds.transition=_}else t.current=o;if(og&&(og=!1,Il=t,i_=f),_=t.pendingLanes,_===0&&(Ol=null),mz(o.stateNode),Yi(t,Tn()),r!==null)for(u=t.onRecoverableError,o=0;o<r.length;o++)f=r[o],u(f.value,{componentStack:f.stack,digest:f.digest});if(n_)throw n_=!1,t=b0,b0=null,t;return i_&1&&t.tag!==0&&wh(),_=t.pendingLanes,_&1?t===w0?Of++:(Of=0,w0=t):Of=0,Gl(),null}function wh(){if(Il!==null){var t=Dk(i_),r=Ds.transition,o=Pr;try{if(Ds.transition=null,Pr=16>t?16:t,Il===null)var u=!1;else{if(t=Il,Il=null,i_=0,hr&6)throw Error(at(331));var f=hr;for(hr|=4,wt=t.current;wt!==null;){var _=wt,b=_.child;if(wt.flags&16){var T=_.deletions;if(T!==null){for(var a=0;a<T.length;a++){var I=T[a];for(wt=I;wt!==null;){var D=wt;switch(D.tag){case 0:case 11:case 15:zf(8,D,_)}var j=D.child;if(j!==null)j.return=D,wt=j;else for(;wt!==null;){D=wt;var V=D.sibling,q=D.return;if(qI(D),D===I){wt=null;break}if(V!==null){V.return=q,wt=V;break}wt=q}}}var se=_.alternate;if(se!==null){var pe=se.child;if(pe!==null){se.child=null;do{var be=pe.sibling;pe.sibling=null,pe=be}while(pe!==null)}}wt=_}}if(_.subtreeFlags&2064&&b!==null)b.return=_,wt=b;else e:for(;wt!==null;){if(_=wt,_.flags&2048)switch(_.tag){case 0:case 11:case 15:zf(9,_,_.return)}var te=_.sibling;if(te!==null){te.return=_.return,wt=te;break e}wt=_.return}}var X=t.current;for(wt=X;wt!==null;){b=wt;var ie=b.child;if(b.subtreeFlags&2064&&ie!==null)ie.return=b,wt=ie;else e:for(b=X;wt!==null;){if(T=wt,T.flags&2048)try{switch(T.tag){case 0:case 11:case 15:I_(9,T)}}catch(Ce){vn(T,T.return,Ce)}if(T===b){wt=null;break e}var Se=T.sibling;if(Se!==null){Se.return=T.return,wt=Se;break e}wt=T.return}}if(hr=f,Gl(),Ko&&typeof Ko.onPostCommitFiberRoot=="function")try{Ko.onPostCommitFiberRoot(x_,t)}catch{}u=!0}return u}finally{Pr=o,Ds.transition=r}}return!1}function mE(t,r,o){r=Mh(o,r),r=DI(t,r,1),t=Dl(t,r,1),r=Ei(),t!==null&&(pp(t,1,r),Yi(t,r))}function vn(t,r,o){if(t.tag===3)mE(t,t,o);else for(;r!==null;){if(r.tag===3){mE(r,t,o);break}else if(r.tag===1){var u=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(Ol===null||!Ol.has(u))){t=Mh(o,t),t=OI(r,t,1),r=Dl(r,t,1),t=Ei(),r!==null&&(pp(r,1,t),Yi(r,t));break}}r=r.return}}function VD(t,r,o){var u=t.pingCache;u!==null&&u.delete(r),r=Ei(),t.pingedLanes|=t.suspendedLanes&o,Xn===t&&(ri&o)===o&&(Fn===4||Fn===3&&(ri&130023424)===ri&&500>Tn()-Z1?$u(t,0):H1|=o),Yi(t,r)}function rA(t,r){r===0&&(t.mode&1?(r=Km,Km<<=1,!(Km&130023424)&&(Km=4194304)):r=1);var o=Ei();t=Ia(t,r),t!==null&&(pp(t,r,o),Yi(t,o))}function $D(t){var r=t.memoizedState,o=0;r!==null&&(o=r.retryLane),rA(t,o)}function GD(t,r){var o=0;switch(t.tag){case 13:var u=t.stateNode,f=t.memoizedState;f!==null&&(o=f.retryLane);break;case 19:u=t.stateNode;break;default:throw Error(at(314))}u!==null&&u.delete(r),rA(t,o)}var nA;nA=function(t,r,o){if(t!==null)if(t.memoizedProps!==r.pendingProps||Xi.current)Hi=!0;else{if(!(t.lanes&o)&&!(r.flags&128))return Hi=!1,PD(t,r,o);Hi=!!(t.flags&131072)}else Hi=!1,Qr&&r.flags&1048576&&aI(r,Xg,r.index);switch(r.lanes=0,r.tag){case 2:var u=r.type;kg(t,r),t=r.pendingProps;var f=Ch(r,gi.current);bh(r,o),f=U1(null,r,u,t,f,o);var _=V1();return r.flags|=1,typeof f=="object"&&f!==null&&typeof f.render=="function"&&f.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,Ki(u)?(_=!0,Hg(r)):_=!1,r.memoizedState=f.state!==null&&f.state!==void 0?f.state:null,O1(r),f.updater=k_,r.stateNode=f,f._reactInternals=r,c0(r,u,t,o),r=f0(null,r,u,!0,_,o)):(r.tag=0,Qr&&_&&A1(r),Ti(null,r,f,o),r=r.child),r;case 16:u=r.elementType;e:{switch(kg(t,r),t=r.pendingProps,f=u._init,u=f(u._payload),r.type=u,f=r.tag=qD(u),t=fo(u,t),f){case 0:r=d0(null,r,u,t,o);break e;case 1:r=sE(null,r,u,t,o);break e;case 11:r=nE(null,r,u,t,o);break e;case 14:r=iE(null,r,u,fo(u.type,t),o);break e}throw Error(at(306,u,""))}return r;case 0:return u=r.type,f=r.pendingProps,f=r.elementType===u?f:fo(u,f),d0(t,r,u,f,o);case 1:return u=r.type,f=r.pendingProps,f=r.elementType===u?f:fo(u,f),sE(t,r,u,f,o);case 3:e:{if(NI(r),t===null)throw Error(at(387));u=r.pendingProps,_=r.memoizedState,f=_.element,fI(t,r),Jg(r,u,null,o);var b=r.memoizedState;if(u=b.element,_.isDehydrated)if(_={element:u,isDehydrated:!1,cache:b.cache,pendingSuspenseBoundaries:b.pendingSuspenseBoundaries,transitions:b.transitions},r.updateQueue.baseState=_,r.memoizedState=_,r.flags&256){f=Mh(Error(at(423)),r),r=oE(t,r,u,o,f);break e}else if(u!==f){f=Mh(Error(at(424)),r),r=oE(t,r,u,o,f);break e}else for(ds=zl(r.stateNode.containerInfo.firstChild),fs=r,Qr=!0,go=null,o=hI(r,null,u,o),r.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(kh(),u===f){r=Aa(t,r,o);break e}Ti(t,r,u,o)}r=r.child}return r;case 5:return pI(r),t===null&&a0(r),u=r.type,f=r.pendingProps,_=t!==null?t.memoizedProps:null,b=f.children,r0(u,f)?b=null:_!==null&&r0(u,_)&&(r.flags|=32),jI(t,r),Ti(t,r,b,o),r.child;case 6:return t===null&&a0(r),null;case 13:return UI(t,r,o);case 4:return B1(r,r.stateNode.containerInfo),u=r.pendingProps,t===null?r.child=Ih(r,null,u,o):Ti(t,r,u,o),r.child;case 11:return u=r.type,f=r.pendingProps,f=r.elementType===u?f:fo(u,f),nE(t,r,u,f,o);case 7:return Ti(t,r,r.pendingProps,o),r.child;case 8:return Ti(t,r,r.pendingProps.children,o),r.child;case 12:return Ti(t,r,r.pendingProps.children,o),r.child;case 10:e:{if(u=r.type._context,f=r.pendingProps,_=r.memoizedProps,b=f.value,Wr(Kg,u._currentValue),u._currentValue=b,_!==null)if(vo(_.value,b)){if(_.children===f.children&&!Xi.current){r=Aa(t,r,o);break e}}else for(_=r.child,_!==null&&(_.return=r);_!==null;){var T=_.dependencies;if(T!==null){b=_.child;for(var a=T.firstContext;a!==null;){if(a.context===u){if(_.tag===1){a=Ea(-1,o&-o),a.tag=2;var I=_.updateQueue;if(I!==null){I=I.shared;var D=I.pending;D===null?a.next=a:(a.next=D.next,D.next=a),I.pending=a}}_.lanes|=o,a=_.alternate,a!==null&&(a.lanes|=o),l0(_.return,o,r),T.lanes|=o;break}a=a.next}}else if(_.tag===10)b=_.type===r.type?null:_.child;else if(_.tag===18){if(b=_.return,b===null)throw Error(at(341));b.lanes|=o,T=b.alternate,T!==null&&(T.lanes|=o),l0(b,o,r),b=_.sibling}else b=_.child;if(b!==null)b.return=_;else for(b=_;b!==null;){if(b===r){b=null;break}if(_=b.sibling,_!==null){_.return=b.return,b=_;break}b=b.return}_=b}Ti(t,r,f.children,o),r=r.child}return r;case 9:return f=r.type,u=r.pendingProps.children,bh(r,o),f=Bs(f),u=u(f),r.flags|=1,Ti(t,r,u,o),r.child;case 14:return u=r.type,f=fo(u,r.pendingProps),f=fo(u.type,f),iE(t,r,u,f,o);case 15:return BI(t,r,r.type,r.pendingProps,o);case 17:return u=r.type,f=r.pendingProps,f=r.elementType===u?f:fo(u,f),kg(t,r),r.tag=1,Ki(u)?(t=!0,Hg(r)):t=!1,bh(r,o),zI(r,u,f),c0(r,u,f,o),f0(null,r,u,!0,t,o);case 19:return VI(t,r,o);case 22:return FI(t,r,o)}throw Error(at(156,r.tag))};function iA(t,r){return Pk(t,r)}function WD(t,r,o,u){this.tag=t,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zs(t,r,o,u){return new WD(t,r,o,u)}function J1(t){return t=t.prototype,!(!t||!t.isReactComponent)}function qD(t){if(typeof t=="function")return J1(t)?1:0;if(t!=null){if(t=t.$$typeof,t===_1)return 11;if(t===y1)return 14}return 2}function Fl(t,r){var o=t.alternate;return o===null?(o=zs(t.tag,r,t.key,t.mode),o.elementType=t.elementType,o.type=t.type,o.stateNode=t.stateNode,o.alternate=t,t.alternate=o):(o.pendingProps=r,o.type=t.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=t.flags&14680064,o.childLanes=t.childLanes,o.lanes=t.lanes,o.child=t.child,o.memoizedProps=t.memoizedProps,o.memoizedState=t.memoizedState,o.updateQueue=t.updateQueue,r=t.dependencies,o.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},o.sibling=t.sibling,o.index=t.index,o.ref=t.ref,o}function Mg(t,r,o,u,f,_){var b=2;if(u=t,typeof t=="function")J1(t)&&(b=1);else if(typeof t=="string")b=5;else e:switch(t){case oh:return Gu(o.children,f,_,r);case g1:b=8,f|=8;break;case zx:return t=zs(12,o,r,f|2),t.elementType=zx,t.lanes=_,t;case Dx:return t=zs(13,o,r,f),t.elementType=Dx,t.lanes=_,t;case Ox:return t=zs(19,o,r,f),t.elementType=Ox,t.lanes=_,t;case pk:return M_(o,f,_,r);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case dk:b=10;break e;case fk:b=9;break e;case _1:b=11;break e;case y1:b=14;break e;case xl:b=16,u=null;break e}throw Error(at(130,t==null?t:typeof t,""))}return r=zs(b,o,r,f),r.elementType=t,r.type=u,r.lanes=_,r}function Gu(t,r,o,u){return t=zs(7,t,u,r),t.lanes=o,t}function M_(t,r,o,u){return t=zs(22,t,u,r),t.elementType=pk,t.lanes=o,t.stateNode={isHidden:!1},t}function rx(t,r,o){return t=zs(6,t,null,r),t.lanes=o,t}function nx(t,r,o){return r=zs(4,t.children!==null?t.children:[],t.key,r),r.lanes=o,r.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},r}function HD(t,r,o,u,f){this.tag=r,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Bv(0),this.expirationTimes=Bv(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Bv(0),this.identifierPrefix=u,this.onRecoverableError=f,this.mutableSourceEagerHydrationData=null}function Q1(t,r,o,u,f,_,b,T,a){return t=new HD(t,r,o,T,a),r===1?(r=1,_===!0&&(r|=8)):r=0,_=zs(3,null,null,r),t.current=_,_.stateNode=t,_.memoizedState={element:u,isDehydrated:o,cache:null,transitions:null,pendingSuspenseBoundaries:null},O1(_),t}function ZD(t,r,o){var u=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:sh,key:u==null?null:""+u,children:t,containerInfo:r,implementation:o}}function sA(t){if(!t)return Ul;t=t._reactInternals;e:{if(ec(t)!==t||t.tag!==1)throw Error(at(170));var r=t;do{switch(r.tag){case 3:r=r.stateNode.context;break e;case 1:if(Ki(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break e}}r=r.return}while(r!==null);throw Error(at(171))}if(t.tag===1){var o=t.type;if(Ki(o))return sI(t,o,r)}return r}function oA(t,r,o,u,f,_,b,T,a){return t=Q1(o,u,!0,t,f,_,b,T,a),t.context=sA(null),o=t.current,u=Ei(),f=Bl(o),_=Ea(u,f),_.callback=r??null,Dl(o,_,f),t.current.lanes=f,pp(t,f,u),Yi(t,u),t}function P_(t,r,o,u){var f=r.current,_=Ei(),b=Bl(f);return o=sA(o),r.context===null?r.context=o:r.pendingContext=o,r=Ea(_,b),r.payload={element:t},u=u===void 0?null:u,u!==null&&(r.callback=u),t=Dl(f,r,b),t!==null&&(yo(t,f,b,_),Tg(t,f,b)),b}function o_(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function gE(t,r){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var o=t.retryLane;t.retryLane=o!==0&&o<r?o:r}}function eb(t,r){gE(t,r),(t=t.alternate)&&gE(t,r)}var aA=typeof reportError=="function"?reportError:function(t){console.error(t)};function tb(t){this._internalRoot=t}R_.prototype.render=tb.prototype.render=function(t){var r=this._internalRoot;if(r===null)throw Error(at(409));P_(t,r,null,null)};R_.prototype.unmount=tb.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var r=t.containerInfo;Ju(function(){P_(null,t,null,null)}),r[ka]=null}};function R_(t){this._internalRoot=t}R_.prototype.unstable_scheduleHydration=function(t){if(t){var r=Fk();t={blockedOn:null,target:t,priority:r};for(var o=0;o<Tl.length&&r!==0&&r<Tl[o].priority;o++);Tl.splice(o,0,t),o===0&&Nk(t)}};function rb(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function L_(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function _E(){}function XD(t,r,o,u,f){if(f){if(typeof u=="function"){var _=u;u=function(){var I=o_(b);_.call(I)}}var b=oA(r,u,t,0,null,!1,!1,"",_E);return t._reactRootContainer=b,t[ka]=b.current,Yf(t.nodeType===8?t.parentNode:t),Ju(),b}for(;f=t.lastChild;)t.removeChild(f);if(typeof u=="function"){var T=u;u=function(){var I=o_(a);T.call(I)}}var a=Q1(t,0,!1,null,null,!1,!1,"",_E);return t._reactRootContainer=a,t[ka]=a.current,Yf(t.nodeType===8?t.parentNode:t),Ju(function(){P_(r,a,o,u)}),a}function z_(t,r,o,u,f){var _=o._reactRootContainer;if(_){var b=_;if(typeof f=="function"){var T=f;f=function(){var a=o_(b);T.call(a)}}P_(r,b,t,f)}else b=XD(o,r,t,f,u);return o_(b)}Ok=function(t){switch(t.tag){case 3:var r=t.stateNode;if(r.current.memoizedState.isDehydrated){var o=Ef(r.pendingLanes);o!==0&&(b1(r,o|1),Yi(r,Tn()),!(hr&6)&&(Ph=Tn()+500,Gl()))}break;case 13:Ju(function(){var u=Ia(t,1);if(u!==null){var f=Ei();yo(u,t,1,f)}}),eb(t,1)}};w1=function(t){if(t.tag===13){var r=Ia(t,134217728);if(r!==null){var o=Ei();yo(r,t,134217728,o)}eb(t,134217728)}};Bk=function(t){if(t.tag===13){var r=Bl(t),o=Ia(t,r);if(o!==null){var u=Ei();yo(o,t,r,u)}eb(t,r)}};Fk=function(){return Pr};jk=function(t,r){var o=Pr;try{return Pr=t,r()}finally{Pr=o}};qx=function(t,r,o){switch(r){case"input":if(jx(t,o),r=o.name,o.type==="radio"&&r!=null){for(o=t;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<o.length;r++){var u=o[r];if(u!==t&&u.form===t.form){var f=T_(u);if(!f)throw Error(at(90));gk(u),jx(u,f)}}}break;case"textarea":yk(t,o);break;case"select":r=o.value,r!=null&&_h(t,!!o.multiple,r,!1)}};Ek=X1;Ck=Ju;var KD={usingClientEntryPoint:!1,Events:[gp,ch,T_,Sk,Tk,X1]},vf={findFiberByHostInstance:Bu,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},YD={bundleType:vf.bundleType,version:vf.version,rendererPackageName:vf.rendererPackageName,rendererConfig:vf.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ma.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Ak(t),t===null?null:t.stateNode},findFiberByHostInstance:vf.findFiberByHostInstance,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ag=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ag.isDisabled&&ag.supportsFiber)try{x_=ag.inject(YD),Ko=ag}catch{}}gs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=KD;gs.createPortal=function(t,r){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!rb(r))throw Error(at(200));return ZD(t,r,null,o)};gs.createRoot=function(t,r){if(!rb(t))throw Error(at(299));var o=!1,u="",f=aA;return r!=null&&(r.unstable_strictMode===!0&&(o=!0),r.identifierPrefix!==void 0&&(u=r.identifierPrefix),r.onRecoverableError!==void 0&&(f=r.onRecoverableError)),r=Q1(t,1,!1,null,null,o,!1,u,f),t[ka]=r.current,Yf(t.nodeType===8?t.parentNode:t),new tb(r)};gs.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var r=t._reactInternals;if(r===void 0)throw typeof t.render=="function"?Error(at(188)):(t=Object.keys(t).join(","),Error(at(268,t)));return t=Ak(r),t=t===null?null:t.stateNode,t};gs.flushSync=function(t){return Ju(t)};gs.hydrate=function(t,r,o){if(!L_(r))throw Error(at(200));return z_(null,t,r,!0,o)};gs.hydrateRoot=function(t,r,o){if(!rb(t))throw Error(at(405));var u=o!=null&&o.hydratedSources||null,f=!1,_="",b=aA;if(o!=null&&(o.unstable_strictMode===!0&&(f=!0),o.identifierPrefix!==void 0&&(_=o.identifierPrefix),o.onRecoverableError!==void 0&&(b=o.onRecoverableError)),r=oA(r,null,t,1,o??null,f,!1,_,b),t[ka]=r.current,Yf(t),u)for(t=0;t<u.length;t++)o=u[t],f=o._getVersion,f=f(o._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[o,f]:r.mutableSourceEagerHydrationData.push(o,f);return new R_(r)};gs.render=function(t,r,o){if(!L_(r))throw Error(at(200));return z_(null,t,r,!1,o)};gs.unmountComponentAtNode=function(t){if(!L_(t))throw Error(at(40));return t._reactRootContainer?(Ju(function(){z_(null,null,t,!1,function(){t._reactRootContainer=null,t[ka]=null})}),!0):!1};gs.unstable_batchedUpdates=X1;gs.unstable_renderSubtreeIntoContainer=function(t,r,o,u){if(!L_(o))throw Error(at(200));if(t==null||t._reactInternals===void 0)throw Error(at(38));return z_(t,r,o,!1,u)};gs.version="18.3.1-next-f1338f8080-20240426";function lA(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(lA)}catch(t){console.error(t)}}lA(),lk.exports=gs;var JD=lk.exports,uA,yE=JD;uA=yE.createRoot,yE.hydrateRoot;/**
 * @remix-run/router v1.21.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function op(){return op=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(t[u]=o[u])}return t},op.apply(this,arguments)}var Al;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Al||(Al={}));const vE="popstate";function QD(t){t===void 0&&(t={});function r(u,f){let{pathname:_,search:b,hash:T}=u.location;return E0("",{pathname:_,search:b,hash:T},f.state&&f.state.usr||null,f.state&&f.state.key||"default")}function o(u,f){return typeof f=="string"?f:hA(f)}return t3(r,o,null,t)}function Mn(t,r){if(t===!1||t===null||typeof t>"u")throw new Error(r)}function cA(t,r){if(!t){typeof console<"u"&&console.warn(r);try{throw new Error(r)}catch{}}}function e3(){return Math.random().toString(36).substr(2,8)}function xE(t,r){return{usr:t.state,key:t.key,idx:r}}function E0(t,r,o,u){return o===void 0&&(o=null),op({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof r=="string"?jh(r):r,{state:o,key:r&&r.key||u||e3()})}function hA(t){let{pathname:r="/",search:o="",hash:u=""}=t;return o&&o!=="?"&&(r+=o.charAt(0)==="?"?o:"?"+o),u&&u!=="#"&&(r+=u.charAt(0)==="#"?u:"#"+u),r}function jh(t){let r={};if(t){let o=t.indexOf("#");o>=0&&(r.hash=t.substr(o),t=t.substr(0,o));let u=t.indexOf("?");u>=0&&(r.search=t.substr(u),t=t.substr(0,u)),t&&(r.pathname=t)}return r}function t3(t,r,o,u){u===void 0&&(u={});let{window:f=document.defaultView,v5Compat:_=!1}=u,b=f.history,T=Al.Pop,a=null,I=D();I==null&&(I=0,b.replaceState(op({},b.state,{idx:I}),""));function D(){return(b.state||{idx:null}).idx}function j(){T=Al.Pop;let be=D(),te=be==null?null:be-I;I=be,a&&a({action:T,location:pe.location,delta:te})}function V(be,te){T=Al.Push;let X=E0(pe.location,be,te);I=D()+1;let ie=xE(X,I),Se=pe.createHref(X);try{b.pushState(ie,"",Se)}catch(Ce){if(Ce instanceof DOMException&&Ce.name==="DataCloneError")throw Ce;f.location.assign(Se)}_&&a&&a({action:T,location:pe.location,delta:1})}function q(be,te){T=Al.Replace;let X=E0(pe.location,be,te);I=D();let ie=xE(X,I),Se=pe.createHref(X);b.replaceState(ie,"",Se),_&&a&&a({action:T,location:pe.location,delta:0})}function se(be){let te=f.location.origin!=="null"?f.location.origin:f.location.href,X=typeof be=="string"?be:hA(be);return X=X.replace(/ $/,"%20"),Mn(te,"No window.location.(origin|href) available to create URL for href: "+X),new URL(X,te)}let pe={get action(){return T},get location(){return t(f,b)},listen(be){if(a)throw new Error("A history only accepts one active listener");return f.addEventListener(vE,j),a=be,()=>{f.removeEventListener(vE,j),a=null}},createHref(be){return r(f,be)},createURL:se,encodeLocation(be){let te=se(be);return{pathname:te.pathname,search:te.search,hash:te.hash}},push:V,replace:q,go(be){return b.go(be)}};return pe}var bE;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(bE||(bE={}));function r3(t,r,o){return o===void 0&&(o="/"),n3(t,r,o)}function n3(t,r,o,u){let f=typeof r=="string"?jh(r):r,_=pA(f.pathname||"/",o);if(_==null)return null;let b=dA(t);i3(b);let T=null;for(let a=0;T==null&&a<b.length;++a){let I=g3(_);T=f3(b[a],I)}return T}function dA(t,r,o,u){r===void 0&&(r=[]),o===void 0&&(o=[]),u===void 0&&(u="");let f=(_,b,T)=>{let a={relativePath:T===void 0?_.path||"":T,caseSensitive:_.caseSensitive===!0,childrenIndex:b,route:_};a.relativePath.startsWith("/")&&(Mn(a.relativePath.startsWith(u),'Absolute route path "'+a.relativePath+'" nested under path '+('"'+u+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),a.relativePath=a.relativePath.slice(u.length));let I=Wu([u,a.relativePath]),D=o.concat(a);_.children&&_.children.length>0&&(Mn(_.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+I+'".')),dA(_.children,r,D,I)),!(_.path==null&&!_.index)&&r.push({path:I,score:h3(I,_.index),routesMeta:D})};return t.forEach((_,b)=>{var T;if(_.path===""||!((T=_.path)!=null&&T.includes("?")))f(_,b);else for(let a of fA(_.path))f(_,b,a)}),r}function fA(t){let r=t.split("/");if(r.length===0)return[];let[o,...u]=r,f=o.endsWith("?"),_=o.replace(/\?$/,"");if(u.length===0)return f?[_,""]:[_];let b=fA(u.join("/")),T=[];return T.push(...b.map(a=>a===""?_:[_,a].join("/"))),f&&T.push(...b),T.map(a=>t.startsWith("/")&&a===""?"/":a)}function i3(t){t.sort((r,o)=>r.score!==o.score?o.score-r.score:d3(r.routesMeta.map(u=>u.childrenIndex),o.routesMeta.map(u=>u.childrenIndex)))}const s3=/^:[\w-]+$/,o3=3,a3=2,l3=1,u3=10,c3=-2,wE=t=>t==="*";function h3(t,r){let o=t.split("/"),u=o.length;return o.some(wE)&&(u+=c3),r&&(u+=a3),o.filter(f=>!wE(f)).reduce((f,_)=>f+(s3.test(_)?o3:_===""?l3:u3),u)}function d3(t,r){return t.length===r.length&&t.slice(0,-1).every((u,f)=>u===r[f])?t[t.length-1]-r[r.length-1]:0}function f3(t,r,o){let{routesMeta:u}=t,f={},_="/",b=[];for(let T=0;T<u.length;++T){let a=u[T],I=T===u.length-1,D=_==="/"?r:r.slice(_.length)||"/",j=p3({path:a.relativePath,caseSensitive:a.caseSensitive,end:I},D),V=a.route;if(!j)return null;Object.assign(f,j.params),b.push({params:f,pathname:Wu([_,j.pathname]),pathnameBase:x3(Wu([_,j.pathnameBase])),route:V}),j.pathnameBase!=="/"&&(_=Wu([_,j.pathnameBase]))}return b}function p3(t,r){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[o,u]=m3(t.path,t.caseSensitive,t.end),f=r.match(o);if(!f)return null;let _=f[0],b=_.replace(/(.)\/+$/,"$1"),T=f.slice(1);return{params:u.reduce((I,D,j)=>{let{paramName:V,isOptional:q}=D;if(V==="*"){let pe=T[j]||"";b=_.slice(0,_.length-pe.length).replace(/(.)\/+$/,"$1")}const se=T[j];return q&&!se?I[V]=void 0:I[V]=(se||"").replace(/%2F/g,"/"),I},{}),pathname:_,pathnameBase:b,pattern:t}}function m3(t,r,o){r===void 0&&(r=!1),o===void 0&&(o=!0),cA(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let u=[],f="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(b,T,a)=>(u.push({paramName:T,isOptional:a!=null}),a?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(u.push({paramName:"*"}),f+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):o?f+="\\/*$":t!==""&&t!=="/"&&(f+="(?:(?=\\/|$))"),[new RegExp(f,r?void 0:"i"),u]}function g3(t){try{return t.split("/").map(r=>decodeURIComponent(r).replace(/\//g,"%2F")).join("/")}catch(r){return cA(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+r+").")),t}}function pA(t,r){if(r==="/")return t;if(!t.toLowerCase().startsWith(r.toLowerCase()))return null;let o=r.endsWith("/")?r.length-1:r.length,u=t.charAt(o);return u&&u!=="/"?null:t.slice(o)||"/"}function _3(t,r){r===void 0&&(r="/");let{pathname:o,search:u="",hash:f=""}=typeof t=="string"?jh(t):t;return{pathname:o?o.startsWith("/")?o:y3(o,r):r,search:b3(u),hash:w3(f)}}function y3(t,r){let o=r.replace(/\/+$/,"").split("/");return t.split("/").forEach(f=>{f===".."?o.length>1&&o.pop():f!=="."&&o.push(f)}),o.length>1?o.join("/"):"/"}function ix(t,r,o,u){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+r+"` field ["+JSON.stringify(u)+"].  Please separate it out to the ")+("`to."+o+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function v3(t){return t.filter((r,o)=>o===0||r.route.path&&r.route.path.length>0)}function mA(t,r){let o=v3(t);return r?o.map((u,f)=>f===o.length-1?u.pathname:u.pathnameBase):o.map(u=>u.pathnameBase)}function gA(t,r,o,u){u===void 0&&(u=!1);let f;typeof t=="string"?f=jh(t):(f=op({},t),Mn(!f.pathname||!f.pathname.includes("?"),ix("?","pathname","search",f)),Mn(!f.pathname||!f.pathname.includes("#"),ix("#","pathname","hash",f)),Mn(!f.search||!f.search.includes("#"),ix("#","search","hash",f)));let _=t===""||f.pathname==="",b=_?"/":f.pathname,T;if(b==null)T=o;else{let j=r.length-1;if(!u&&b.startsWith("..")){let V=b.split("/");for(;V[0]==="..";)V.shift(),j-=1;f.pathname=V.join("/")}T=j>=0?r[j]:"/"}let a=_3(f,T),I=b&&b!=="/"&&b.endsWith("/"),D=(_||b===".")&&o.endsWith("/");return!a.pathname.endsWith("/")&&(I||D)&&(a.pathname+="/"),a}const Wu=t=>t.join("/").replace(/\/\/+/g,"/"),x3=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),b3=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,w3=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function S3(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const _A=["post","put","patch","delete"];new Set(_A);const T3=["get",..._A];new Set(T3);/**
 * React Router v6.28.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ap(){return ap=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(t[u]=o[u])}return t},ap.apply(this,arguments)}const nb=ve.createContext(null),E3=ve.createContext(null),yp=ve.createContext(null),D_=ve.createContext(null),Wl=ve.createContext({outlet:null,matches:[],isDataRoute:!1}),yA=ve.createContext(null);function vp(){return ve.useContext(D_)!=null}function ib(){return vp()||Mn(!1),ve.useContext(D_).location}function vA(t){ve.useContext(yp).static||ve.useLayoutEffect(t)}function xp(){let{isDataRoute:t}=ve.useContext(Wl);return t?j3():C3()}function C3(){vp()||Mn(!1);let t=ve.useContext(nb),{basename:r,future:o,navigator:u}=ve.useContext(yp),{matches:f}=ve.useContext(Wl),{pathname:_}=ib(),b=JSON.stringify(mA(f,o.v7_relativeSplatPath)),T=ve.useRef(!1);return vA(()=>{T.current=!0}),ve.useCallback(function(I,D){if(D===void 0&&(D={}),!T.current)return;if(typeof I=="number"){u.go(I);return}let j=gA(I,JSON.parse(b),_,D.relative==="path");t==null&&r!=="/"&&(j.pathname=j.pathname==="/"?r:Wu([r,j.pathname])),(D.replace?u.replace:u.push)(j,D.state,D)},[r,u,b,_,t])}function k3(){let{matches:t}=ve.useContext(Wl),r=t[t.length-1];return r?r.params:{}}function I3(t,r){return A3(t,r)}function A3(t,r,o,u){vp()||Mn(!1);let{navigator:f}=ve.useContext(yp),{matches:_}=ve.useContext(Wl),b=_[_.length-1],T=b?b.params:{};b&&b.pathname;let a=b?b.pathnameBase:"/";b&&b.route;let I=ib(),D;if(r){var j;let be=typeof r=="string"?jh(r):r;a==="/"||(j=be.pathname)!=null&&j.startsWith(a)||Mn(!1),D=be}else D=I;let V=D.pathname||"/",q=V;if(a!=="/"){let be=a.replace(/^\//,"").split("/");q="/"+V.replace(/^\//,"").split("/").slice(be.length).join("/")}let se=r3(t,{pathname:q}),pe=z3(se&&se.map(be=>Object.assign({},be,{params:Object.assign({},T,be.params),pathname:Wu([a,f.encodeLocation?f.encodeLocation(be.pathname).pathname:be.pathname]),pathnameBase:be.pathnameBase==="/"?a:Wu([a,f.encodeLocation?f.encodeLocation(be.pathnameBase).pathname:be.pathnameBase])})),_,o,u);return r&&pe?ve.createElement(D_.Provider,{value:{location:ap({pathname:"/",search:"",hash:"",state:null,key:"default"},D),navigationType:Al.Pop}},pe):pe}function M3(){let t=F3(),r=S3(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),o=t instanceof Error?t.stack:null,f={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ve.createElement(ve.Fragment,null,ve.createElement("h2",null,"Unexpected Application Error!"),ve.createElement("h3",{style:{fontStyle:"italic"}},r),o?ve.createElement("pre",{style:f},o):null,null)}const P3=ve.createElement(M3,null);class R3 extends ve.Component{constructor(r){super(r),this.state={location:r.location,revalidation:r.revalidation,error:r.error}}static getDerivedStateFromError(r){return{error:r}}static getDerivedStateFromProps(r,o){return o.location!==r.location||o.revalidation!=="idle"&&r.revalidation==="idle"?{error:r.error,location:r.location,revalidation:r.revalidation}:{error:r.error!==void 0?r.error:o.error,location:o.location,revalidation:r.revalidation||o.revalidation}}componentDidCatch(r,o){console.error("React Router caught the following error during render",r,o)}render(){return this.state.error!==void 0?ve.createElement(Wl.Provider,{value:this.props.routeContext},ve.createElement(yA.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function L3(t){let{routeContext:r,match:o,children:u}=t,f=ve.useContext(nb);return f&&f.static&&f.staticContext&&(o.route.errorElement||o.route.ErrorBoundary)&&(f.staticContext._deepestRenderedBoundaryId=o.route.id),ve.createElement(Wl.Provider,{value:r},u)}function z3(t,r,o,u){var f;if(r===void 0&&(r=[]),o===void 0&&(o=null),u===void 0&&(u=null),t==null){var _;if(!o)return null;if(o.errors)t=o.matches;else if((_=u)!=null&&_.v7_partialHydration&&r.length===0&&!o.initialized&&o.matches.length>0)t=o.matches;else return null}let b=t,T=(f=o)==null?void 0:f.errors;if(T!=null){let D=b.findIndex(j=>j.route.id&&(T==null?void 0:T[j.route.id])!==void 0);D>=0||Mn(!1),b=b.slice(0,Math.min(b.length,D+1))}let a=!1,I=-1;if(o&&u&&u.v7_partialHydration)for(let D=0;D<b.length;D++){let j=b[D];if((j.route.HydrateFallback||j.route.hydrateFallbackElement)&&(I=D),j.route.id){let{loaderData:V,errors:q}=o,se=j.route.loader&&V[j.route.id]===void 0&&(!q||q[j.route.id]===void 0);if(j.route.lazy||se){a=!0,I>=0?b=b.slice(0,I+1):b=[b[0]];break}}}return b.reduceRight((D,j,V)=>{let q,se=!1,pe=null,be=null;o&&(q=T&&j.route.id?T[j.route.id]:void 0,pe=j.route.errorElement||P3,a&&(I<0&&V===0?(se=!0,be=null):I===V&&(se=!0,be=j.route.hydrateFallbackElement||null)));let te=r.concat(b.slice(0,V+1)),X=()=>{let ie;return q?ie=pe:se?ie=be:j.route.Component?ie=ve.createElement(j.route.Component,null):j.route.element?ie=j.route.element:ie=D,ve.createElement(L3,{match:j,routeContext:{outlet:D,matches:te,isDataRoute:o!=null},children:ie})};return o&&(j.route.ErrorBoundary||j.route.errorElement||V===0)?ve.createElement(R3,{location:o.location,revalidation:o.revalidation,component:pe,error:q,children:X(),routeContext:{outlet:null,matches:te,isDataRoute:!0}}):X()},null)}var xA=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(xA||{}),a_=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(a_||{});function D3(t){let r=ve.useContext(nb);return r||Mn(!1),r}function O3(t){let r=ve.useContext(E3);return r||Mn(!1),r}function B3(t){let r=ve.useContext(Wl);return r||Mn(!1),r}function bA(t){let r=B3(),o=r.matches[r.matches.length-1];return o.route.id||Mn(!1),o.route.id}function F3(){var t;let r=ve.useContext(yA),o=O3(a_.UseRouteError),u=bA(a_.UseRouteError);return r!==void 0?r:(t=o.errors)==null?void 0:t[u]}function j3(){let{router:t}=D3(xA.UseNavigateStable),r=bA(a_.UseNavigateStable),o=ve.useRef(!1);return vA(()=>{o.current=!0}),ve.useCallback(function(f,_){_===void 0&&(_={}),o.current&&(typeof f=="number"?t.navigate(f):t.navigate(f,ap({fromRouteId:r},_)))},[t,r])}const SE={};function N3(t,r){SE[r]||(SE[r]=!0,console.warn(r))}const TE=(t,r,o)=>N3(t,"⚠️ React Router Future Flag Warning: "+r+". "+("You can use the `"+t+"` future flag to opt-in early. ")+("For more information, see "+o+"."));function U3(t,r){(t==null?void 0:t.v7_startTransition)===void 0&&TE("v7_startTransition","React Router will begin wrapping state updates in `React.startTransition` in v7","https://reactrouter.com/v6/upgrading/future#v7_starttransition"),(t==null?void 0:t.v7_relativeSplatPath)===void 0&&TE("v7_relativeSplatPath","Relative route resolution within Splat routes is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_relativesplatpath")}function wA(t){let{to:r,replace:o,state:u,relative:f}=t;vp()||Mn(!1);let{future:_,static:b}=ve.useContext(yp),{matches:T}=ve.useContext(Wl),{pathname:a}=ib(),I=xp(),D=gA(r,mA(T,_.v7_relativeSplatPath),a,f==="path"),j=JSON.stringify(D);return ve.useEffect(()=>I(JSON.parse(j),{replace:o,state:u,relative:f}),[I,j,f,o,u]),null}function ih(t){Mn(!1)}function V3(t){let{basename:r="/",children:o=null,location:u,navigationType:f=Al.Pop,navigator:_,static:b=!1,future:T}=t;vp()&&Mn(!1);let a=r.replace(/^\/*/,"/"),I=ve.useMemo(()=>({basename:a,navigator:_,static:b,future:ap({v7_relativeSplatPath:!1},T)}),[a,T,_,b]);typeof u=="string"&&(u=jh(u));let{pathname:D="/",search:j="",hash:V="",state:q=null,key:se="default"}=u,pe=ve.useMemo(()=>{let be=pA(D,a);return be==null?null:{location:{pathname:be,search:j,hash:V,state:q,key:se},navigationType:f}},[a,D,j,V,q,se,f]);return pe==null?null:ve.createElement(yp.Provider,{value:I},ve.createElement(D_.Provider,{children:o,value:pe}))}function $3(t){let{children:r,location:o}=t;return I3(C0(r),o)}new Promise(()=>{});function C0(t,r){r===void 0&&(r=[]);let o=[];return ve.Children.forEach(t,(u,f)=>{if(!ve.isValidElement(u))return;let _=[...r,f];if(u.type===ve.Fragment){o.push.apply(o,C0(u.props.children,_));return}u.type!==ih&&Mn(!1),!u.props.index||!u.props.children||Mn(!1);let b={id:u.props.id||_.join("-"),caseSensitive:u.props.caseSensitive,element:u.props.element,Component:u.props.Component,index:u.props.index,path:u.props.path,loader:u.props.loader,action:u.props.action,errorElement:u.props.errorElement,ErrorBoundary:u.props.ErrorBoundary,hasErrorBoundary:u.props.ErrorBoundary!=null||u.props.errorElement!=null,shouldRevalidate:u.props.shouldRevalidate,handle:u.props.handle,lazy:u.props.lazy};u.props.children&&(b.children=C0(u.props.children,_)),o.push(b)}),o}/**
 * React Router DOM v6.28.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const G3="6";try{window.__reactRouterVersion=G3}catch{}const W3="startTransition",EE=VL[W3];function q3(t){let{basename:r,children:o,future:u,window:f}=t,_=ve.useRef();_.current==null&&(_.current=QD({window:f,v5Compat:!0}));let b=_.current,[T,a]=ve.useState({action:b.action,location:b.location}),{v7_startTransition:I}=u||{},D=ve.useCallback(j=>{I&&EE?EE(()=>a(j)):a(j)},[a,I]);return ve.useLayoutEffect(()=>b.listen(D),[b,D]),ve.useEffect(()=>U3(u),[u]),ve.createElement(V3,{basename:r,children:o,location:T.location,navigationType:T.action,navigator:b,future:u})}var CE;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(CE||(CE={}));var kE;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(kE||(kE={}));var H3=t=>t.disabled||Array.isArray(t.accessibilityStates)&&t.accessibilityStates.indexOf("disabled")>-1,Z3={adjustable:"slider",button:"button",header:"heading",image:"img",imagebutton:null,keyboardkey:null,label:null,link:"link",none:"presentation",search:"search",summary:"region",text:null},SA=t=>{var r=t.accessibilityRole,o=t.role,u=o||r;if(u){var f=Z3[u];if(f!==null)return f||u}},X3={article:"article",banner:"header",blockquote:"blockquote",button:"button",code:"code",complementary:"aside",contentinfo:"footer",deletion:"del",emphasis:"em",figure:"figure",insertion:"ins",form:"form",list:"ul",listitem:"li",main:"main",navigation:"nav",paragraph:"p",region:"section",strong:"strong"},K3={},Y3=function(r){r===void 0&&(r=K3);var o=r.role||r.accessibilityRole;if(o==="label")return"label";var u=SA(r);if(u){if(u==="heading"){var f=r.accessibilityLevel||r["aria-level"];return f!=null?"h"+f:"h1"}return X3[u]}},TA={isDisabled:H3,propsToAccessibilityComponent:Y3,propsToAriaRole:SA};function lp(t){"@babel/helpers - typeof";return lp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},lp(t)}function J3(t,r){if(lp(t)!="object"||!t)return t;var o=t[Symbol.toPrimitive];if(o!==void 0){var u=o.call(t,r||"default");if(lp(u)!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function Q3(t){var r=J3(t,"string");return lp(r)=="symbol"?r:r+""}function eO(t,r,o){return(r=Q3(r))in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}function IE(t,r){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(t);r&&(u=u.filter(function(f){return Object.getOwnPropertyDescriptor(t,f).enumerable})),o.push.apply(o,u)}return o}function er(t){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?IE(Object(o),!0).forEach(function(u){eO(t,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):IE(Object(o)).forEach(function(u){Object.defineProperty(t,u,Object.getOwnPropertyDescriptor(o,u))})}return t}function ys(t,r){if(t==null)return{};var o={};for(var u in t)if({}.hasOwnProperty.call(t,u)){if(r.includes(u))continue;o[u]=t[u]}return o}var Pg={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexOrder:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,fontWeight:!0,gridRow:!0,gridRowEnd:!0,gridRowGap:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnGap:!0,gridColumnStart:!0,lineClamp:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0,scale:!0,scaleX:!0,scaleY:!0,scaleZ:!0,shadowOpacity:!0},tO=["ms","Moz","O","Webkit"],rO=(t,r)=>t+r.charAt(0).toUpperCase()+r.substring(1);Object.keys(Pg).forEach(t=>{tO.forEach(r=>{Pg[rO(r,t)]=Pg[t]})});var nO=t=>t==="currentcolor"||t==="currentColor"||t==="inherit"||t.indexOf("var(")===0;function iO(t){if(typeof t=="number")return t>>>0===t&&t>=0&&t<=4294967295?t:null;if(typeof t!="string")return null;const r=oO();let o;if(o=r.hex6.exec(t))return parseInt(o[1]+"ff",16)>>>0;const u=aO(t);return u??((o=r.rgb.exec(t))?(_a(o[1])<<24|_a(o[2])<<16|_a(o[3])<<8|255)>>>0:(o=r.rgba.exec(t))?o[6]!==void 0?(_a(o[6])<<24|_a(o[7])<<16|_a(o[8])<<8|ug(o[9]))>>>0:(_a(o[2])<<24|_a(o[3])<<16|_a(o[4])<<8|ug(o[5]))>>>0:(o=r.hex3.exec(t))?parseInt(o[1]+o[1]+o[2]+o[2]+o[3]+o[3]+"ff",16)>>>0:(o=r.hex8.exec(t))?parseInt(o[1],16)>>>0:(o=r.hex4.exec(t))?parseInt(o[1]+o[1]+o[2]+o[2]+o[3]+o[3]+o[4]+o[4],16)>>>0:(o=r.hsl.exec(t))?(sx(lg(o[1]),pl(o[2]),pl(o[3]))|255)>>>0:(o=r.hsla.exec(t))?o[6]!==void 0?(sx(lg(o[6]),pl(o[7]),pl(o[8]))|ug(o[9]))>>>0:(sx(lg(o[2]),pl(o[3]),pl(o[4]))|ug(o[5]))>>>0:(o=r.hwb.exec(t))?(sO(lg(o[1]),pl(o[2]),pl(o[3]))|255)>>>0:null)}function Sh(t,r,o){return o<0&&(o+=1),o>1&&(o-=1),o<1/6?t+(r-t)*6*o:o<1/2?r:o<2/3?t+(r-t)*(2/3-o)*6:t}function sx(t,r,o){const u=o<.5?o*(1+r):o+r-o*r,f=2*o-u,_=Sh(f,u,t+1/3),b=Sh(f,u,t),T=Sh(f,u,t-1/3);return Math.round(_*255)<<24|Math.round(b*255)<<16|Math.round(T*255)<<8}function sO(t,r,o){if(r+o>=1){const b=Math.round(r*255/(r+o));return b<<24|b<<16|b<<8}const u=Sh(0,1,t+1/3)*(1-r-o)+r,f=Sh(0,1,t)*(1-r-o)+r,_=Sh(0,1,t-1/3)*(1-r-o)+r;return Math.round(u*255)<<24|Math.round(f*255)<<16|Math.round(_*255)<<8}const qn="[-+]?\\d*\\.?\\d+",fl=qn+"%";function ox(...t){return"\\(\\s*("+t.join(")\\s*,?\\s*(")+")\\s*\\)"}function AE(...t){return"\\(\\s*("+t.slice(0,t.length-1).join(")\\s*,?\\s*(")+")\\s*/\\s*("+t[t.length-1]+")\\s*\\)"}function ME(...t){return"\\(\\s*("+t.join(")\\s*,\\s*(")+")\\s*\\)"}let ax;function oO(){return ax===void 0&&(ax={rgb:new RegExp("rgb"+ox(qn,qn,qn)),rgba:new RegExp("rgba("+ME(qn,qn,qn,qn)+"|"+AE(qn,qn,qn,qn)+")"),hsl:new RegExp("hsl"+ox(qn,fl,fl)),hsla:new RegExp("hsla("+ME(qn,fl,fl,qn)+"|"+AE(qn,fl,fl,qn)+")"),hwb:new RegExp("hwb"+ox(qn,fl,fl)),hex3:/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex4:/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#([0-9a-fA-F]{6})$/,hex8:/^#([0-9a-fA-F]{8})$/}),ax}function _a(t){const r=parseInt(t,10);return r<0?0:r>255?255:r}function lg(t){return(parseFloat(t)%360+360)%360/360}function ug(t){const r=parseFloat(t);return r<0?0:r>1?255:Math.round(r*255)}function pl(t){const r=parseFloat(t);return r<0?0:r>100?1:r/100}function aO(t){switch(t){case"transparent":return 0;case"aliceblue":return 4042850303;case"antiquewhite":return 4209760255;case"aqua":return 16777215;case"aquamarine":return 2147472639;case"azure":return 4043309055;case"beige":return 4126530815;case"bisque":return 4293182719;case"black":return 255;case"blanchedalmond":return 4293643775;case"blue":return 65535;case"blueviolet":return 2318131967;case"brown":return 2771004159;case"burlywood":return 3736635391;case"burntsienna":return 3934150143;case"cadetblue":return 1604231423;case"chartreuse":return 2147418367;case"chocolate":return 3530104575;case"coral":return 4286533887;case"cornflowerblue":return 1687547391;case"cornsilk":return 4294499583;case"crimson":return 3692313855;case"cyan":return 16777215;case"darkblue":return 35839;case"darkcyan":return 9145343;case"darkgoldenrod":return 3095792639;case"darkgray":return 2846468607;case"darkgreen":return 6553855;case"darkgrey":return 2846468607;case"darkkhaki":return 3182914559;case"darkmagenta":return 2332068863;case"darkolivegreen":return 1433087999;case"darkorange":return 4287365375;case"darkorchid":return 2570243327;case"darkred":return 2332033279;case"darksalmon":return 3918953215;case"darkseagreen":return 2411499519;case"darkslateblue":return 1211993087;case"darkslategray":return 793726975;case"darkslategrey":return 793726975;case"darkturquoise":return 13554175;case"darkviolet":return 2483082239;case"deeppink":return 4279538687;case"deepskyblue":return 12582911;case"dimgray":return 1768516095;case"dimgrey":return 1768516095;case"dodgerblue":return 512819199;case"firebrick":return 2988581631;case"floralwhite":return 4294635775;case"forestgreen":return 579543807;case"fuchsia":return 4278255615;case"gainsboro":return 3705462015;case"ghostwhite":return 4177068031;case"gold":return 4292280575;case"goldenrod":return 3668254975;case"gray":return 2155905279;case"green":return 8388863;case"greenyellow":return 2919182335;case"grey":return 2155905279;case"honeydew":return 4043305215;case"hotpink":return 4285117695;case"indianred":return 3445382399;case"indigo":return 1258324735;case"ivory":return 4294963455;case"khaki":return 4041641215;case"lavender":return 3873897215;case"lavenderblush":return 4293981695;case"lawngreen":return 2096890111;case"lemonchiffon":return 4294626815;case"lightblue":return 2916673279;case"lightcoral":return 4034953471;case"lightcyan":return 3774873599;case"lightgoldenrodyellow":return 4210742015;case"lightgray":return 3553874943;case"lightgreen":return 2431553791;case"lightgrey":return 3553874943;case"lightpink":return 4290167295;case"lightsalmon":return 4288707327;case"lightseagreen":return 548580095;case"lightskyblue":return 2278488831;case"lightslategray":return 2005441023;case"lightslategrey":return 2005441023;case"lightsteelblue":return 2965692159;case"lightyellow":return 4294959359;case"lime":return 16711935;case"limegreen":return 852308735;case"linen":return 4210091775;case"magenta":return 4278255615;case"maroon":return 2147483903;case"mediumaquamarine":return 1724754687;case"mediumblue":return 52735;case"mediumorchid":return 3126187007;case"mediumpurple":return 2473647103;case"mediumseagreen":return 1018393087;case"mediumslateblue":return 2070474495;case"mediumspringgreen":return 16423679;case"mediumturquoise":return 1221709055;case"mediumvioletred":return 3340076543;case"midnightblue":return 421097727;case"mintcream":return 4127193855;case"mistyrose":return 4293190143;case"moccasin":return 4293178879;case"navajowhite":return 4292783615;case"navy":return 33023;case"oldlace":return 4260751103;case"olive":return 2155872511;case"olivedrab":return 1804477439;case"orange":return 4289003775;case"orangered":return 4282712319;case"orchid":return 3664828159;case"palegoldenrod":return 4008225535;case"palegreen":return 2566625535;case"paleturquoise":return 2951671551;case"palevioletred":return 3681588223;case"papayawhip":return 4293907967;case"peachpuff":return 4292524543;case"peru":return 3448061951;case"pink":return 4290825215;case"plum":return 3718307327;case"powderblue":return 2967529215;case"purple":return 2147516671;case"rebeccapurple":return 1714657791;case"red":return 4278190335;case"rosybrown":return 3163525119;case"royalblue":return 1097458175;case"saddlebrown":return 2336560127;case"salmon":return 4202722047;case"sandybrown":return 4104413439;case"seagreen":return 780883967;case"seashell":return 4294307583;case"sienna":return 2689740287;case"silver":return 3233857791;case"skyblue":return 2278484991;case"slateblue":return 1784335871;case"slategray":return 1887473919;case"slategrey":return 1887473919;case"snow":return 4294638335;case"springgreen":return 16744447;case"steelblue":return 1182971135;case"tan":return 3535047935;case"teal":return 8421631;case"thistle":return 3636451583;case"tomato":return 4284696575;case"turquoise":return 1088475391;case"violet":return 4001558271;case"wheat":return 4125012991;case"white":return 4294967295;case"whitesmoke":return 4126537215;case"yellow":return 4294902015;case"yellowgreen":return 2597139199}return null}var lO=iO;const uO=Dh(lO);var cO=t=>{if(t==null)return t;var r=uO(t);if(r!=null)return r=(r<<24|r>>>8)>>>0,r},EA=function(r,o){if(o===void 0&&(o=1),r!=null){if(typeof r=="string"&&nO(r))return r;var u=cO(r);if(u!=null){var f=u>>16&255,_=u>>8&255,b=u&255,T=(u>>24&255)/255,a=(T*o).toFixed(2);return"rgba("+f+","+_+","+b+","+a+")"}}},hO={backgroundColor:!0,borderColor:!0,borderTopColor:!0,borderRightColor:!0,borderBottomColor:!0,borderLeftColor:!0,color:!0,shadowColor:!0,textDecorationColor:!0,textShadowColor:!0};function Zo(t,r){var o=t;return(r==null||!Pg[r])&&typeof t=="number"?o=t+"px":r!=null&&hO[r]&&(o=EA(t)),o}var js=!!(typeof window<"u"&&window.document&&window.document.createElement),dO={},fO=!js||window.CSS!=null&&window.CSS.supports!=null&&(window.CSS.supports("text-decoration-line","none")||window.CSS.supports("-webkit-text-decoration-line","none")),pO="monospace,monospace",PE='-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif',mO={borderColor:["borderTopColor","borderRightColor","borderBottomColor","borderLeftColor"],borderBlockColor:["borderTopColor","borderBottomColor"],borderInlineColor:["borderRightColor","borderLeftColor"],borderRadius:["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"],borderStyle:["borderTopStyle","borderRightStyle","borderBottomStyle","borderLeftStyle"],borderBlockStyle:["borderTopStyle","borderBottomStyle"],borderInlineStyle:["borderRightStyle","borderLeftStyle"],borderWidth:["borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth"],borderBlockWidth:["borderTopWidth","borderBottomWidth"],borderInlineWidth:["borderRightWidth","borderLeftWidth"],insetBlock:["top","bottom"],insetInline:["left","right"],marginBlock:["marginTop","marginBottom"],marginInline:["marginRight","marginLeft"],paddingBlock:["paddingTop","paddingBottom"],paddingInline:["paddingRight","paddingLeft"],overflow:["overflowX","overflowY"],overscrollBehavior:["overscrollBehaviorX","overscrollBehaviorY"],borderBlockStartColor:["borderTopColor"],borderBlockStartStyle:["borderTopStyle"],borderBlockStartWidth:["borderTopWidth"],borderBlockEndColor:["borderBottomColor"],borderBlockEndStyle:["borderBottomStyle"],borderBlockEndWidth:["borderBottomWidth"],borderEndStartRadius:["borderBottomLeftRadius"],borderEndEndRadius:["borderBottomRightRadius"],borderStartStartRadius:["borderTopLeftRadius"],borderStartEndRadius:["borderTopRightRadius"],insetBlockEnd:["bottom"],insetBlockStart:["top"],marginBlockStart:["marginTop"],marginBlockEnd:["marginBottom"],paddingBlockStart:["paddingTop"],paddingBlockEnd:["paddingBottom"]},CA=(t,r)=>{if(!t)return dO;var o={},u=function(){var T=t[f];if(T==null)return"continue";if(f==="backgroundClip")T==="text"&&(o.backgroundClip=T,o.WebkitBackgroundClip=T);else if(f==="flex")T===-1?(o.flexGrow=0,o.flexShrink=1,o.flexBasis="auto"):o.flex=T;else if(f==="font")o[f]=T.replace("System",PE);else if(f==="fontFamily")if(T.indexOf("System")>-1){var a=T.split(/,\s*/);a[a.indexOf("System")]=PE,o[f]=a.join(",")}else T==="monospace"?o[f]=pO:o[f]=T;else if(f==="textDecorationLine")fO?o.textDecorationLine=T:o.textDecoration=T;else if(f==="writingDirection")o.direction=T;else{var I=Zo(t[f],f),D=mO[f];r&&f==="inset"?(t.insetInline==null&&(o.left=I,o.right=I),t.insetBlock==null&&(o.top=I,o.bottom=I)):r&&f==="margin"?(t.marginInline==null&&(o.marginLeft=I,o.marginRight=I),t.marginBlock==null&&(o.marginTop=I,o.marginBottom=I)):r&&f==="padding"?(t.paddingInline==null&&(o.paddingLeft=I,o.paddingRight=I),t.paddingBlock==null&&(o.paddingTop=I,o.paddingBottom=I)):D?D.forEach((j,V)=>{t[j]==null&&(o[j]=I)}):o[f]=I}};for(var f in t)var _=u();return o};function gO(t,r){for(var o=t.length,u=r^o,f=0,_;o>=4;)_=t.charCodeAt(f)&255|(t.charCodeAt(++f)&255)<<8|(t.charCodeAt(++f)&255)<<16|(t.charCodeAt(++f)&255)<<24,_=(_&65535)*1540483477+(((_>>>16)*1540483477&65535)<<16),_^=_>>>24,_=(_&65535)*1540483477+(((_>>>16)*1540483477&65535)<<16),u=(u&65535)*1540483477+(((u>>>16)*1540483477&65535)<<16)^_,o-=4,++f;switch(o){case 3:u^=(t.charCodeAt(f+2)&255)<<16;case 2:u^=(t.charCodeAt(f+1)&255)<<8;case 1:u^=t.charCodeAt(f)&255,u=(u&65535)*1540483477+(((u>>>16)*1540483477&65535)<<16)}return u^=u>>>13,u=(u&65535)*1540483477+(((u>>>16)*1540483477&65535)<<16),u^=u>>>15,u>>>0}var _O=t=>gO(t,1).toString(36),yO=/[A-Z]/g,vO=/^ms-/,lx={};function xO(t){return"-"+t.toLowerCase()}function bO(t){if(t in lx)return lx[t];var r=t.replace(yO,xO);return lx[t]=vO.test(r)?"-"+r:r}var kA={},sb={},O_={};Object.defineProperty(O_,"__esModule",{value:!0});O_.default=wO;function wO(t){return t.charAt(0).toUpperCase()+t.slice(1)}Object.defineProperty(sb,"__esModule",{value:!0});sb.default=CO;var SO=O_,TO=EO(SO);function EO(t){return t.__esModule?t:{default:t}}function CO(t,r,o){var u=t[r];if(u&&o.hasOwnProperty(r))for(var f=(0,TO.default)(r),_=0;_<u.length;++_){var b=u[_]+f;o[b]||(o[b]=o[r])}return o}var ob={};Object.defineProperty(ob,"__esModule",{value:!0});ob.default=kO;function kO(t,r,o,u,f){for(var _=0,b=t.length;_<b;++_){var T=t[_](r,o,u,f);if(T)return T}}var ab={};Object.defineProperty(ab,"__esModule",{value:!0});ab.default=IO;function RE(t,r){t.indexOf(r)===-1&&t.push(r)}function IO(t,r){if(Array.isArray(r))for(var o=0,u=r.length;o<u;++o)RE(t,r[o]);else RE(t,r)}var lb={};Object.defineProperty(lb,"__esModule",{value:!0});lb.default=AO;function AO(t){return t instanceof Object&&!Array.isArray(t)}Object.defineProperty(kA,"__esModule",{value:!0});var MO=kA.default=FO,PO=sb,RO=B_(PO),LO=ob,LE=B_(LO),zO=ab,DO=B_(zO),OO=lb,BO=B_(OO);function B_(t){return t&&t.__esModule?t:{default:t}}function FO(t){var r=t.prefixMap,o=t.plugins;return function u(f){for(var _ in f){var b=f[_];if((0,BO.default)(b))f[_]=u(b);else if(Array.isArray(b)){for(var T=[],a=0,I=b.length;a<I;++a){var D=(0,LE.default)(o,_,b[a],f,r);(0,DO.default)(T,D||b[a])}T.length>0&&(f[_]=T)}else{var j=(0,LE.default)(o,_,b,f,r);j&&(f[_]=j),f=(0,RO.default)(r,_,f)}}return f}}var IA={};Object.defineProperty(IA,"__esModule",{value:!0});var jO=IA.default=NO;function NO(){return null}var AA={};function Rg(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Rg=function(o){return typeof o}:Rg=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},Rg(t)}function UO(t){return WO(t)||GO(t)||$O(t)||VO()}function VO(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $O(t,r){if(t){if(typeof t=="string")return k0(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);if(o==="Object"&&t.constructor&&(o=t.constructor.name),o==="Map"||o==="Set")return Array.from(o);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return k0(t,r)}}function GO(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function WO(t){if(Array.isArray(t))return k0(t)}function k0(t,r){(r==null||r>t.length)&&(r=t.length);for(var o=0,u=new Array(r);o<r;o++)u[o]=t[o];return u}function zE(t){return t.filter(function(r,o){return t.lastIndexOf(r)===o})}function MA(t){for(var r=0,o=arguments.length<=1?0:arguments.length-1;r<o;++r){var u=r+1<1||arguments.length<=r+1?void 0:arguments[r+1];for(var f in u){var _=u[f],b=t[f];if(b&&_){if(Array.isArray(b)){t[f]=zE(b.concat(_));continue}if(Array.isArray(_)){t[f]=zE([b].concat(UO(_)));continue}if(Rg(_)==="object"){t[f]=MA({},b,_);continue}}t[f]=_}}return t}var qO=/-([a-z])/g,HO=/^Ms/g,ux={};function ZO(t){return t[1].toUpperCase()}function PA(t){if(ux.hasOwnProperty(t))return ux[t];var r=t.replace(qO,ZO).replace(HO,"ms");return ux[t]=r,r}var XO=/[A-Z]/g,KO=/^ms-/,cx={};function YO(t){return"-"+t.toLowerCase()}function RA(t){if(cx.hasOwnProperty(t))return cx[t];var r=t.replace(XO,YO);return cx[t]=KO.test(r)?"-"+r:r}const JO=Object.freeze(Object.defineProperty({__proto__:null,default:RA},Symbol.toStringTag,{value:"Module"}));function F_(t){return RA(t)}function LA(t,r){return F_(t)+":"+r}function QO(t){var r="";for(var o in t){var u=t[o];typeof u!="string"&&typeof u!="number"||(r&&(r+=";"),r+=LA(o,u))}return r}var eB=/^(Webkit|Moz|O|ms)/;function tB(t){return eB.test(t)}var rB=/-webkit-|-moz-|-ms-/;function nB(t){return typeof t=="string"&&rB.test(t)}var up={borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},DE=["animationIterationCount","boxFlex","boxFlexGroup","boxOrdinalGroup","columnCount","flex","flexGrow","flexPositive","flexShrink","flexNegative","flexOrder","gridColumn","gridColumnEnd","gridColumnStart","gridRow","gridRowEnd","gridRowStart","lineClamp","order"],OE=["Webkit","ms","Moz","O"];function iB(t,r){return t+r.charAt(0).toUpperCase()+r.slice(1)}for(var hx=0,sB=DE.length;hx<sB;++hx){var BE=DE[hx];up[BE]=!0;for(var dx=0,oB=OE.length;dx<oB;++dx)up[iB(OE[dx],BE)]=!0}for(var aB in up)up[F_(aB)]=!0;function lB(t){return up.hasOwnProperty(t)}var uB=/^(ms|Webkit|Moz|O)/;function zA(t){var r=t.replace(uB,"");return r.charAt(0).toLowerCase()+r.slice(1)}function cB(t){return zA(PA(t))}function hB(t,r){return r.join(";"+F_(t)+":")}var dB=/(-ms-|-webkit-|-moz-|-o-)/g;function fB(t){return typeof t=="string"?t.replace(dB,""):t}const pB=Object.freeze(Object.defineProperty({__proto__:null,assignStyle:MA,camelCaseProperty:PA,cssifyDeclaration:LA,cssifyObject:QO,hyphenateProperty:F_,isPrefixedProperty:tB,isPrefixedValue:nB,isUnitlessProperty:lB,normalizeProperty:cB,resolveArrayValue:hB,unprefixProperty:zA,unprefixValue:fB},Symbol.toStringTag,{value:"Module"})),DA=l1(pB);Object.defineProperty(AA,"__esModule",{value:!0});var mB=AA.default=vB,gB=DA,_B=/cross-fade\(/g,yB=["-webkit-",""];function vB(t,r){if(typeof r=="string"&&!(0,gB.isPrefixedValue)(r)&&r.indexOf("cross-fade(")!==-1)return yB.map(function(o){return r.replace(_B,o+"cross-fade(")})}var OA={};Object.defineProperty(OA,"__esModule",{value:!0});var xB=OA.default=SB,bB=["-webkit-","-moz-",""],wB={"zoom-in":!0,"zoom-out":!0,grab:!0,grabbing:!0};function SB(t,r){if(t==="cursor"&&wB.hasOwnProperty(r))return bB.map(function(o){return o+r})}var BA={};Object.defineProperty(BA,"__esModule",{value:!0});var TB=BA.default=IB,EB=DA,CB=/filter\(/g,kB=["-webkit-",""];function IB(t,r){if(typeof r=="string"&&!(0,EB.isPrefixedValue)(r)&&r.indexOf("filter(")!==-1)return kB.map(function(o){return r.replace(CB,o+"filter(")})}var FA={},ub={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var r=/-webkit-|-moz-|-ms-/;function o(u){return typeof u=="string"&&r.test(u)}})(ub);Object.defineProperty(FA,"__esModule",{value:!0});var AB=FA.default=zB,MB=ub,PB=RB(MB);function RB(t){return t.__esModule?t:{default:t}}var LB=["-webkit-",""];function zB(t,r){if(typeof r=="string"&&!(0,PB.default)(r)&&r.indexOf("image-set(")>-1)return LB.map(function(o){return r.replace(/image-set\(/g,o+"image-set(")})}var jA={};Object.defineProperty(jA,"__esModule",{value:!0});var DB=jA.default=OB,FE={marginBlockStart:["WebkitMarginBefore"],marginBlockEnd:["WebkitMarginAfter"],marginInlineStart:["WebkitMarginStart","MozMarginStart"],marginInlineEnd:["WebkitMarginEnd","MozMarginEnd"],paddingBlockStart:["WebkitPaddingBefore"],paddingBlockEnd:["WebkitPaddingAfter"],paddingInlineStart:["WebkitPaddingStart","MozPaddingStart"],paddingInlineEnd:["WebkitPaddingEnd","MozPaddingEnd"],borderBlockStart:["WebkitBorderBefore"],borderBlockStartColor:["WebkitBorderBeforeColor"],borderBlockStartStyle:["WebkitBorderBeforeStyle"],borderBlockStartWidth:["WebkitBorderBeforeWidth"],borderBlockEnd:["WebkitBorderAfter"],borderBlockEndColor:["WebkitBorderAfterColor"],borderBlockEndStyle:["WebkitBorderAfterStyle"],borderBlockEndWidth:["WebkitBorderAfterWidth"],borderInlineStart:["WebkitBorderStart","MozBorderStart"],borderInlineStartColor:["WebkitBorderStartColor","MozBorderStartColor"],borderInlineStartStyle:["WebkitBorderStartStyle","MozBorderStartStyle"],borderInlineStartWidth:["WebkitBorderStartWidth","MozBorderStartWidth"],borderInlineEnd:["WebkitBorderEnd","MozBorderEnd"],borderInlineEndColor:["WebkitBorderEndColor","MozBorderEndColor"],borderInlineEndStyle:["WebkitBorderEndStyle","MozBorderEndStyle"],borderInlineEndWidth:["WebkitBorderEndWidth","MozBorderEndWidth"]};function OB(t,r,o){if(Object.prototype.hasOwnProperty.call(FE,t))for(var u=FE[t],f=0,_=u.length;f<_;++f)o[u[f]]=r}var NA={};Object.defineProperty(NA,"__esModule",{value:!0});var BB=NA.default=FB;function FB(t,r){if(t==="position"&&r==="sticky")return["-webkit-sticky","sticky"]}var UA={};Object.defineProperty(UA,"__esModule",{value:!0});var jB=UA.default=$B,NB=["-webkit-","-moz-",""],UB={maxHeight:!0,maxWidth:!0,width:!0,height:!0,columnWidth:!0,minWidth:!0,minHeight:!0},VB={"min-content":!0,"max-content":!0,"fill-available":!0,"fit-content":!0,"contain-floats":!0};function $B(t,r){if(UB.hasOwnProperty(t)&&VB.hasOwnProperty(r))return NB.map(function(o){return o+r})}var VA={},$A={};const GB=l1(JO);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=f;var r=GB,o=u(r);function u(_){return _&&_.__esModule?_:{default:_}}function f(_){return(0,o.default)(_)}})($A);Object.defineProperty(VA,"__esModule",{value:!0});var WB=VA.default=e4,qB=$A,HB=cb(qB),ZB=ub,XB=cb(ZB),KB=O_,jE=cb(KB);function cb(t){return t&&t.__esModule?t:{default:t}}var YB={transition:!0,transitionProperty:!0,WebkitTransition:!0,WebkitTransitionProperty:!0,MozTransition:!0,MozTransitionProperty:!0},JB={Webkit:"-webkit-",Moz:"-moz-",ms:"-ms-"};function QB(t,r){if((0,XB.default)(t))return t;for(var o=t.split(/,(?![^()]*(?:\([^()]*\))?\))/g),u=0,f=o.length;u<f;++u){var _=o[u],b=[_];for(var T in r){var a=(0,HB.default)(T);if(_.indexOf(a)>-1&&a!=="order")for(var I=r[T],D=0,j=I.length;D<j;++D)b.unshift(_.replace(a,JB[I[D]]+a))}o[u]=b.join(",")}return o.join(",")}function e4(t,r,o,u){if(typeof r=="string"&&YB.hasOwnProperty(t)){var f=QB(r,u),_=f.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter(function(T){return!/-moz-|-ms-/.test(T)}).join(",");if(t.indexOf("Webkit")>-1)return _;var b=f.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter(function(T){return!/-webkit-|-ms-/.test(T)}).join(",");return t.indexOf("Moz")>-1?b:(o["Webkit"+(0,jE.default)(t)]=_,o["Moz"+(0,jE.default)(t)]=b,f)}}var Fr=["Webkit"],t4=["Moz"],r4=["Webkit","Moz"],yn=["Webkit","ms"],n4=["Webkit","Moz","ms"];const i4={plugins:[jO,mB,xB,TB,AB,DB,BB,jB,WB],prefixMap:{appearance:n4,userSelect:r4,textEmphasisPosition:yn,textEmphasis:yn,textEmphasisStyle:yn,textEmphasisColor:yn,boxDecorationBreak:yn,clipPath:Fr,maskImage:yn,maskMode:yn,maskRepeat:yn,maskPosition:yn,maskClip:yn,maskOrigin:yn,maskSize:yn,maskComposite:yn,mask:yn,maskBorderSource:yn,maskBorderMode:yn,maskBorderSlice:yn,maskBorderWidth:yn,maskBorderOutset:yn,maskBorderRepeat:yn,maskBorder:yn,maskType:yn,textDecorationStyle:Fr,textDecorationSkip:Fr,textDecorationLine:Fr,textDecorationColor:Fr,filter:Fr,breakAfter:Fr,breakBefore:Fr,breakInside:Fr,columnCount:Fr,columnFill:Fr,columnGap:Fr,columnRule:Fr,columnRuleColor:Fr,columnRuleStyle:Fr,columnRuleWidth:Fr,columns:Fr,columnSpan:Fr,columnWidth:Fr,backdropFilter:Fr,hyphens:Fr,flowInto:Fr,flowFrom:Fr,regionFragment:Fr,textOrientation:Fr,tabSize:t4,fontKerning:Fr,textSizeAdjust:Fr}};var s4=MO(i4),o4=["animationKeyframes"],NE=new Map,a4={},l4=1,u4=3,c4={borderColor:2,borderRadius:2,borderStyle:2,borderWidth:2,display:2,flex:2,inset:2,margin:2,overflow:2,overscrollBehavior:2,padding:2,insetBlock:2.1,insetInline:2.1,marginInline:2.1,marginBlock:2.1,paddingInline:2.1,paddingBlock:2.1,borderBlockStartColor:2.2,borderBlockStartStyle:2.2,borderBlockStartWidth:2.2,borderBlockEndColor:2.2,borderBlockEndStyle:2.2,borderBlockEndWidth:2.2,borderInlineStartColor:2.2,borderInlineStartStyle:2.2,borderInlineStartWidth:2.2,borderInlineEndColor:2.2,borderInlineEndStyle:2.2,borderInlineEndWidth:2.2,borderEndStartRadius:2.2,borderEndEndRadius:2.2,borderStartStartRadius:2.2,borderStartEndRadius:2.2,insetBlockEnd:2.2,insetBlockStart:2.2,insetInlineEnd:2.2,insetInlineStart:2.2,marginBlockStart:2.2,marginBlockEnd:2.2,marginInlineStart:2.2,marginInlineEnd:2.2,paddingBlockStart:2.2,paddingBlockEnd:2.2,paddingInlineStart:2.2,paddingInlineEnd:2.2},I0="borderTopLeftRadius",A0="borderTopRightRadius",M0="borderBottomLeftRadius",P0="borderBottomRightRadius",R0="borderLeftColor",L0="borderLeftStyle",z0="borderLeftWidth",D0="borderRightColor",O0="borderRightStyle",B0="borderRightWidth",F0="right",j0="marginLeft",N0="marginRight",U0="paddingLeft",V0="paddingRight",$0="left",l_={[I0]:A0,[A0]:I0,[M0]:P0,[P0]:M0,[R0]:D0,[L0]:O0,[z0]:B0,[D0]:R0,[O0]:L0,[B0]:z0,[$0]:F0,[j0]:N0,[N0]:j0,[U0]:V0,[V0]:U0,[F0]:$0},Bf={borderStartStartRadius:I0,borderStartEndRadius:A0,borderEndStartRadius:M0,borderEndEndRadius:P0,borderInlineStartColor:R0,borderInlineStartStyle:L0,borderInlineStartWidth:z0,borderInlineEndColor:D0,borderInlineEndStyle:O0,borderInlineEndWidth:B0,insetInlineEnd:F0,insetInlineStart:$0,marginInlineStart:j0,marginInlineEnd:N0,paddingInlineStart:U0,paddingInlineEnd:V0},GA=["clear","float","textAlign"];function h4(t){var r={$$css:!0},o=[];function u(f,_,b){var T=p4(b,_),a=_+T,I=NE.get(a),D;if(I!=null)D=I[0],o.push(I[1]);else{var j=f!==_?a:T;D=hb("r",f,j);var V=c4[f]||u4,q=m4(D,_,b),se=[q,V];o.push(se),NE.set(a,[D,se])}return D}return Object.keys(t).sort().forEach(f=>{var _=t[f];if(_!=null){var b;if(GA.indexOf(f)>-1){var T=u(f,f,"left"),a=u(f,f,"right");_==="start"?b=[T,a]:_==="end"&&(b=[a,T])}var I=Bf[f];if(I!=null){var D=u(f,I,_),j=u(f,l_[I],_);b=[D,j]}if(f==="transitionProperty"){for(var V=Array.isArray(_)?_:[_],q=[],se=0;se<V.length;se++){var pe=V[se];typeof pe=="string"&&Bf[pe]!=null&&q.push(se)}if(q.length>0){var be=[...V],te=[...V];q.forEach(X=>{var ie=be[X];if(typeof ie=="string"){var Se=Bf[ie],Ce=l_[Se];be[X]=Se,te[X]=Ce;var Le=u(f,f,be),Ne=u(f,f,te);b=[Le,Ne]}})}}b==null?b=u(f,f,_):r.$$css$localize=!0,r[f]=b}}),[r,o]}function d4(t,r){var o={$$css:!0},u=[],f=t.animationKeyframes,_=ys(t,o4),b=hb("css",r,JSON.stringify(t)),T="."+b,a;if(f!=null){var I=WA(f),D=I[0],j=I[1];a=D.join(","),u.push(...j)}var V=va(er(er({},_),{},{animationName:a}));return u.push(""+T+V),o[b]=b,[o,[[u,l4]]]}function f4(t,r){var o=t||a4,u={},f={},_=function(){var I=o[b],D=b,j=I;if(!Object.prototype.hasOwnProperty.call(o,b)||I==null)return"continue";GA.indexOf(b)>-1&&(I==="start"?j=r?"right":"left":I==="end"&&(j=r?"left":"right"));var V=Bf[b];if(V!=null&&(D=r?l_[V]:V),b==="transitionProperty"){var q=Array.isArray(I)?I:[I];q.forEach((se,pe)=>{if(typeof se=="string"){var be=Bf[se];be!=null&&(q[pe]=r?l_[be]:be,j=q.join(" "))}})}u[D]||(f[D]=j),D===b&&(u[D]=!0)};for(var b in o)var T=_();return CA(f,!0)}function p4(t,r){var o=Zo(t,r);return typeof o!="string"?JSON.stringify(o||""):o}function m4(t,r,o){var u=[],f="."+t;switch(r){case"animationKeyframes":{var _=WA(o),b=_[0],T=_[1],a=va({animationName:b.join(",")});u.push(""+f+a,...T);break}case"placeholderTextColor":{var I=va({color:o,opacity:1});u.push(f+"::-webkit-input-placeholder"+I,f+"::-moz-placeholder"+I,f+":-ms-input-placeholder"+I,f+"::placeholder"+I);break}case"pointerEvents":{var D=o;if(o==="auto"||o==="box-only"){if(D="auto!important",o==="box-only"){var j=va({pointerEvents:"none"});u.push(f+">*"+j)}}else if((o==="none"||o==="box-none")&&(D="none!important",o==="box-none")){var V=va({pointerEvents:"auto"});u.push(f+">*"+V)}var q=va({pointerEvents:D});u.push(""+f+q);break}case"scrollbarWidth":{o==="none"&&u.push(f+"::-webkit-scrollbar{display:none}");var se=va({scrollbarWidth:o});u.push(""+f+se);break}default:{var pe=va({[r]:o});u.push(""+f+pe);break}}return u}function va(t){var r=s4(CA(t)),o=Object.keys(r).map(u=>{var f=r[u],_=bO(u);return Array.isArray(f)?f.map(b=>_+":"+b).join(";"):_+":"+f}).sort().join(";");return"{"+o+";}"}function hb(t,r,o){var u=_O(r+o);return t+"-"+u}function g4(t){var r=["-webkit-",""],o=hb("r","animation",JSON.stringify(t)),u="{"+Object.keys(t).map(_=>{var b=t[_],T=va(b);return""+_+T}).join("")+"}",f=r.map(_=>"@"+_+"keyframes "+o+u);return[o,f]}function WA(t){if(typeof t=="number")throw new Error("Invalid CSS keyframes type: "+typeof t);var r=[],o=[],u=Array.isArray(t)?t:[t];return u.forEach(f=>{if(typeof f=="string")r.push(f);else{var _=g4(f),b=_[0],T=_[1];r.push(b),o.push(...T)}}),[r,o]}function fx(t,r,o){if(js){var u=r??document,f=u.getElementById(t);if(f==null)if(f=document.createElement("style"),f.setAttribute("id",t),typeof o=="string"&&f.appendChild(document.createTextNode(o)),u instanceof ShadowRoot)u.insertBefore(f,u.firstChild);else{var _=u.head;_&&_.insertBefore(f,_.firstChild)}return f.sheet}else return null}var _4=Array.prototype.slice;function px(t){var r={},o={};if(t!=null){var u;_4.call(t.cssRules).forEach((b,T)=>{var a=b.cssText;if(a.indexOf("stylesheet-group")>-1)u=x4(b),r[u]={start:T,rules:[a]};else{var I=VE(a);I!=null&&(o[I]=!0,r[u].rules.push(a))}})}function f(b,T,a){var I=UE(r),D=I.indexOf(T),j=D+1,V=I[j],q=V!=null&&r[V].start!=null?r[V].start:b.cssRules.length,se=w4(b,a,q);if(se){r[T].start==null&&(r[T].start=q);for(var pe=j;pe<I.length;pe+=1){var be=I[pe],te=r[be].start||0;r[be].start=te+1}}return se}var _={getTextContent(){return UE(r).map(b=>{var T=r[b].rules,a=T.shift();return T.sort(),T.unshift(a),T.join(`
`)}).join(`
`)},insert(b,T){var a=Number(T);if(r[a]==null){var I=y4(a);r[a]={start:null,rules:[I]},t!=null&&f(t,a,I)}var D=VE(b);if(D!=null&&o[D]==null&&(o[D]=!0,r[a].rules.push(b),t!=null)){var j=f(t,a,b);j||r[a].rules.pop()}}};return _}function y4(t){return'[stylesheet-group="'+t+'"]{}'}var v4=/["']/g;function x4(t){return Number(t.selectorText.split(v4)[1])}function UE(t){return Object.keys(t).map(Number).sort((r,o)=>r>o?1:-1)}var b4=/\s*([,])\s*/g;function VE(t){var r=t.split("{")[0].trim();return r!==""?r.replace(b4,"$1"):null}function w4(t,r,o){try{return t.insertRule(r,o),!0}catch{return!1}}var S4="react-native-stylesheet",mx=new WeakMap,uo=[],$E=["html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgba(0,0,0,0);}","body{margin:0;}","button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0;}","input::-webkit-search-cancel-button,input::-webkit-search-decoration,input::-webkit-search-results-button,input::-webkit-search-results-decoration{display:none;}"];function T4(t,r){r===void 0&&(r=S4);var o;if(js){var u=document;if(uo.length===0)o=px(fx(r)),$E.forEach(T=>{o.insert(T,0)}),mx.set(u,uo.length),uo.push(o);else{var f=mx.get(u);if(f==null){var _=uo[0],b=_!=null?_.getTextContent():"";o=px(fx(r,u,b)),mx.set(u,uo.length),uo.push(o)}else o=uo[f]}}else uo.length===0?(o=px(fx(r)),$E.forEach(T=>{o.insert(T,0)}),uo.push(o)):o=uo[0];return{getTextContent(){return o.getTextContent()},id:r,insert(T,a){uo.forEach(I=>{I.insert(T,a)})}}}var db={};Object.defineProperty(db,"__esModule",{value:!0});db.localizeStyle=E4;var cg=new WeakMap,qA="$$css$localize";function GE(t,r){var o={};for(var u in t)if(u!==qA){var f=t[u];Array.isArray(f)?o[u]=r?f[1]:f[0]:o[u]=f}return o}function E4(t,r){if(t[qA]!=null){var o=r?1:0;if(cg.has(t)){var u=cg.get(t),f=u[o];return f==null&&(f=GE(t,r),u[o]=f,cg.set(t,u)),f}var _=GE(t,r),b=new Array(2);return b[o]=_,cg.set(t,b),_}return t}var C4=db,k4={},HA={height:0,width:0},ZA=t=>{var r=t.shadowColor,o=t.shadowOffset,u=t.shadowOpacity,f=t.shadowRadius,_=o||HA,b=_.height,T=_.width,a=Zo(T),I=Zo(b),D=Zo(f||0),j=EA(r||"black",u);if(j!=null&&a!=null&&I!=null&&D!=null)return a+" "+I+" "+D+" "+j},I4=t=>{var r=t.textShadowColor,o=t.textShadowOffset,u=t.textShadowRadius,f=o||HA,_=f.height,b=f.width,T=u||0,a=Zo(b),I=Zo(_),D=Zo(T),j=Zo(r,"textShadowColor");if(j&&(_!==0||b!==0||T!==0)&&a!=null&&I!=null&&D!=null)return a+" "+I+" "+D+" "+j},A4=t=>{var r=Object.keys(t)[0],o=t[r];if(r==="matrix"||r==="matrix3d")return r+"("+o.join(",")+")";var u=Zo(o,r);return r+"("+u+")"},M4=t=>t.map(A4).join(" "),P4={borderBottomEndRadius:"borderEndEndRadius",borderBottomStartRadius:"borderEndStartRadius",borderTopEndRadius:"borderStartEndRadius",borderTopStartRadius:"borderStartStartRadius",borderEndColor:"borderInlineEndColor",borderEndStyle:"borderInlineEndStyle",borderEndWidth:"borderInlineEndWidth",borderStartColor:"borderInlineStartColor",borderStartStyle:"borderInlineStartStyle",borderStartWidth:"borderInlineStartWidth",end:"insetInlineEnd",marginEnd:"marginInlineEnd",marginHorizontal:"marginInline",marginStart:"marginInlineStart",marginVertical:"marginBlock",paddingEnd:"paddingInlineEnd",paddingHorizontal:"paddingInline",paddingStart:"paddingInlineStart",paddingVertical:"paddingBlock",start:"insetInlineStart"},R4={elevation:!0,overlayColor:!0,resizeMode:!0,tintColor:!0},XA=function(r,o){o===void 0&&(o={});var u=r||k4,f={};if(o.shadow,u.shadowColor!=null||u.shadowOffset!=null||u.shadowOpacity!=null||u.shadowRadius!=null){var _=ZA(u);if(_!=null&&f.boxShadow==null){var b=u.boxShadow,T=b?b+", "+_:_;f.boxShadow=T}}if(o.textShadow,u.textShadowColor!=null||u.textShadowOffset!=null||u.textShadowRadius!=null){var a=I4(u);if(a!=null&&f.textShadow==null){var I=u.textShadow,D=I?I+", "+a:a;f.textShadow=D}}for(var j in u)if(!(R4[j]!=null||j==="shadowColor"||j==="shadowOffset"||j==="shadowOpacity"||j==="shadowRadius"||j==="textShadowColor"||j==="textShadowOffset"||j==="textShadowRadius")){var V=u[j],q=P4[j]||j,se=V;!Object.prototype.hasOwnProperty.call(u,j)||q!==j&&u[q]!=null||(q==="aspectRatio"&&typeof se=="number"?f[q]=se.toString():q==="fontVariant"?(Array.isArray(se)&&se.length>0&&(se=se.join(" ")),f[q]=se):q==="textAlignVertical"?u.verticalAlign==null&&(f.verticalAlign=se==="center"?"middle":se):q==="transform"?(Array.isArray(se)&&(se=M4(se)),f.transform=se):f[q]=se)}return f},fb={};Object.defineProperty(fb,"__esModule",{value:!0});var KA=fb.styleq=void 0,L4=new WeakMap,z4="$$css";function YA(t){var r,o,u;return t!=null&&(r=t.disableCache===!0,o=t.disableMix===!0,u=t.transform),function(){for(var _=[],b="",T=null,a=r?null:L4,I=new Array(arguments.length),D=0;D<arguments.length;D++)I[D]=arguments[D];for(;I.length>0;){var j=I.pop();if(!(j==null||j===!1)){if(Array.isArray(j)){for(var V=0;V<j.length;V++)I.push(j[V]);continue}var q=u!=null?u(j):j;if(q.$$css){var se="";if(a!=null&&a.has(q)){var pe=a.get(q);pe!=null&&(se=pe[0],_.push.apply(_,pe[1]),a=pe[2])}else{var be=[];for(var te in q){var X=q[te];te!==z4&&(typeof X=="string"||X===null?_.includes(te)||(_.push(te),a!=null&&be.push(te),typeof X=="string"&&(se+=se?" "+X:X)):console.error("styleq: ".concat(te," typeof ").concat(String(X),' is not "string" or "null".')))}if(a!=null){var ie=new WeakMap;a.set(q,[se,be,ie]),a=ie}}se&&(b=b?se+" "+b:se)}else if(o)T==null&&(T={}),T=Object.assign({},q,T);else{var Se=null;for(var Ce in q){var Le=q[Ce];Le!==void 0&&(_.includes(Ce)||(Le!=null&&(T==null&&(T={}),Se==null&&(Se={}),Se[Ce]=Le),_.push(Ce),a=null))}Se!=null&&(T=Object.assign(Se,T))}}}var Ne=[b,T];return Ne}}var JA=YA();KA=fb.styleq=JA;JA.factory=YA;var D4=["writingDirection"],QA=new WeakMap,u_=T4(),eM={shadow:!0,textShadow:!0};function O4(t,r){r===void 0&&(r={});var o=r,u=o.writingDirection,f=ys(o,D4),_=u==="rtl";return KA.factory({transform(b){var T=QA.get(b);return T!=null?C4.localizeStyle(T,_):XA(b,er(er({},eM),f))}})(t)}function tM(t){t.forEach(r=>{var o=r[0],u=r[1];u_!=null&&o.forEach(f=>{u_.insert(f,u)})})}function B4(t){var r=h4(XA(t,eM)),o=r[0],u=r[1];return tM(u),o}function F4(t,r){var o=d4(t,r),u=o[0],f=o[1];return tM(f),u}var rM={position:"absolute",left:0,right:0,top:0,bottom:0},j4=nM({x:er({},rM)}).x;function nM(t){return Object.keys(t).forEach(r=>{var o=t[r];if(o!=null&&o.$$css!==!0){var u;r.indexOf("$raw")>-1?u=F4(o,r.split("$raw")[0]):u=B4(o),QA.set(o,u)}}),t}function N4(t,r){return[t,r]}function U4(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];for(var u=r.flat(1/0),f={},_=0;_<u.length;_++){var b=u[_];b!=null&&typeof b=="object"&&Object.assign(f,b)}return f}function V4(){return{id:u_.id,textContent:u_.getTextContent()}}function Pa(t,r){r===void 0&&(r={});var o=r.writingDirection==="rtl",u=O4(t,r);return Array.isArray(u)&&u[1]!=null&&(u[1]=f4(u[1],o)),u}Pa.absoluteFill=j4;Pa.absoluteFillObject=rM;Pa.create=nM;Pa.compose=N4;Pa.flatten=U4;Pa.getSheet=V4;Pa.hairlineWidth=1;js&&window.__REACT_DEVTOOLS_GLOBAL_HOOK__&&(window.__REACT_DEVTOOLS_GLOBAL_HOOK__.resolveRNStyle=Pa.flatten);var en=Pa,$4=["aria-activedescendant","accessibilityActiveDescendant","aria-atomic","accessibilityAtomic","aria-autocomplete","accessibilityAutoComplete","aria-busy","accessibilityBusy","aria-checked","accessibilityChecked","aria-colcount","accessibilityColumnCount","aria-colindex","accessibilityColumnIndex","aria-colspan","accessibilityColumnSpan","aria-controls","accessibilityControls","aria-current","accessibilityCurrent","aria-describedby","accessibilityDescribedBy","aria-details","accessibilityDetails","aria-disabled","accessibilityDisabled","aria-errormessage","accessibilityErrorMessage","aria-expanded","accessibilityExpanded","aria-flowto","accessibilityFlowTo","aria-haspopup","accessibilityHasPopup","aria-hidden","accessibilityHidden","aria-invalid","accessibilityInvalid","aria-keyshortcuts","accessibilityKeyShortcuts","aria-label","accessibilityLabel","aria-labelledby","accessibilityLabelledBy","aria-level","accessibilityLevel","aria-live","accessibilityLiveRegion","aria-modal","accessibilityModal","aria-multiline","accessibilityMultiline","aria-multiselectable","accessibilityMultiSelectable","aria-orientation","accessibilityOrientation","aria-owns","accessibilityOwns","aria-placeholder","accessibilityPlaceholder","aria-posinset","accessibilityPosInSet","aria-pressed","accessibilityPressed","aria-readonly","accessibilityReadOnly","aria-required","accessibilityRequired","role","accessibilityRole","aria-roledescription","accessibilityRoleDescription","aria-rowcount","accessibilityRowCount","aria-rowindex","accessibilityRowIndex","aria-rowspan","accessibilityRowSpan","aria-selected","accessibilitySelected","aria-setsize","accessibilitySetSize","aria-sort","accessibilitySort","aria-valuemax","accessibilityValueMax","aria-valuemin","accessibilityValueMin","aria-valuenow","accessibilityValueNow","aria-valuetext","accessibilityValueText","dataSet","focusable","id","nativeID","pointerEvents","style","tabIndex","testID"],G4={},W4=Object.prototype.hasOwnProperty,q4=Array.isArray,H4=/[A-Z]/g;function Z4(t){return"-"+t.toLowerCase()}function X4(t){return t.replace(H4,Z4)}function eh(t){return q4(t)?t.join(" "):t}var K4=en.create({auto:{pointerEvents:"auto"},"box-none":{pointerEvents:"box-none"},"box-only":{pointerEvents:"box-only"},none:{pointerEvents:"none"}}),Y4=(t,r,o)=>{r||(r=G4);var u=r,f=u["aria-activedescendant"],_=u.accessibilityActiveDescendant,b=u["aria-atomic"],T=u.accessibilityAtomic,a=u["aria-autocomplete"],I=u.accessibilityAutoComplete,D=u["aria-busy"],j=u.accessibilityBusy,V=u["aria-checked"],q=u.accessibilityChecked,se=u["aria-colcount"],pe=u.accessibilityColumnCount,be=u["aria-colindex"],te=u.accessibilityColumnIndex,X=u["aria-colspan"],ie=u.accessibilityColumnSpan,Se=u["aria-controls"],Ce=u.accessibilityControls,Le=u["aria-current"],Ne=u.accessibilityCurrent,qe=u["aria-describedby"],it=u.accessibilityDescribedBy,Ae=u["aria-details"],Tt=u.accessibilityDetails,$t=u["aria-disabled"],pt=u.accessibilityDisabled,Kt=u["aria-errormessage"],Dr=u.accessibilityErrorMessage,Sr=u["aria-expanded"],xn=u.accessibilityExpanded,lt=u["aria-flowto"],st=u.accessibilityFlowTo,kt=u["aria-haspopup"],It=u.accessibilityHasPopup,Bt=u["aria-hidden"],tn=u.accessibilityHidden,Yt=u["aria-invalid"],Kr=u.accessibilityInvalid,jr=u["aria-keyshortcuts"],dr=u.accessibilityKeyShortcuts,Nr=u["aria-label"],Kn=u.accessibilityLabel,Yn=u["aria-labelledby"],_i=u.accessibilityLabelledBy,Lt=u["aria-level"],yi=u.accessibilityLevel,qr=u["aria-live"],Ji=u.accessibilityLiveRegion,fr=u["aria-modal"],jn=u.accessibilityModal,vs=u["aria-multiline"],Ur=u.accessibilityMultiline,rn=u["aria-multiselectable"],ii=u.accessibilityMultiSelectable,Pn=u["aria-orientation"],Qi=u.accessibilityOrientation,si=u["aria-owns"],Ai=u.accessibilityOwns,Ns=u["aria-placeholder"],xo=u.accessibilityPlaceholder,Rn=u["aria-posinset"],Mi=u.accessibilityPosInSet,xs=u["aria-pressed"],es=u.accessibilityPressed,ts=u["aria-readonly"],Us=u.accessibilityReadOnly,Pi=u["aria-required"],cr=u.accessibilityRequired;u.role,u.accessibilityRole;var Ri=u["aria-roledescription"],rs=u.accessibilityRoleDescription,ns=u["aria-rowcount"],bo=u.accessibilityRowCount,ae=u["aria-rowindex"],$=u.accessibilityRowIndex,U=u["aria-rowspan"],re=u.accessibilityRowSpan,ce=u["aria-selected"],_e=u.accessibilitySelected,Te=u["aria-setsize"],Ee=u.accessibilitySetSize,ye=u["aria-sort"],ze=u.accessibilitySort,et=u["aria-valuemax"],ot=u.accessibilityValueMax,Ye=u["aria-valuemin"],Mt=u.accessibilityValueMin,Nt=u["aria-valuenow"],Pt=u.accessibilityValueNow,Ut=u["aria-valuetext"],Xt=u.accessibilityValueText,pr=u.dataSet,Rr=u.focusable,bn=u.id,Yr=u.nativeID,vi=u.pointerEvents,gn=u.style,nn=u.tabIndex,Vs=u.testID,bt=ys(u,$4),ic=$t||pt,Wt=TA.propsToAriaRole(r),Ra=f??_;Ra!=null&&(bt["aria-activedescendant"]=Ra);var wo=b!=null?f:T;wo!=null&&(bt["aria-atomic"]=wo);var La=a??I;La!=null&&(bt["aria-autocomplete"]=La);var Jo=D??j;Jo!=null&&(bt["aria-busy"]=Jo);var xi=V??q;xi!=null&&(bt["aria-checked"]=xi);var Li=se??pe;Li!=null&&(bt["aria-colcount"]=Li);var za=be??te;za!=null&&(bt["aria-colindex"]=za);var Da=X??ie;Da!=null&&(bt["aria-colspan"]=Da);var bs=Se??Ce;bs!=null&&(bt["aria-controls"]=eh(bs));var zi=Le??Ne;zi!=null&&(bt["aria-current"]=zi);var So=qe??it;So!=null&&(bt["aria-describedby"]=eh(So));var Be=Ae??Tt;Be!=null&&(bt["aria-details"]=Be),ic===!0&&(bt["aria-disabled"]=!0,(t==="button"||t==="form"||t==="input"||t==="select"||t==="textarea")&&(bt.disabled=!0));var Di=Kt??Dr;Di!=null&&(bt["aria-errormessage"]=Di);var Vr=Sr??xn;Vr!=null&&(bt["aria-expanded"]=Vr);var sn=lt??st;sn!=null&&(bt["aria-flowto"]=eh(sn));var ql=kt??It;ql!=null&&(bt["aria-haspopup"]=ql);var bi=Bt??tn;bi===!0&&(bt["aria-hidden"]=bi);var Oa=Yt??Kr;Oa!=null&&(bt["aria-invalid"]=Oa);var Hl=jr??dr;Hl!=null&&(bt["aria-keyshortcuts"]=eh(Hl));var $s=Nr??Kn;$s!=null&&(bt["aria-label"]=$s);var ct=Yn??_i;ct!=null&&(bt["aria-labelledby"]=eh(ct));var qt=Lt??yi;qt!=null&&(bt["aria-level"]=qt);var Vt=qr??Ji;Vt!=null&&(bt["aria-live"]=Vt==="none"?"off":Vt);var Nn=fr??jn;Nn!=null&&(bt["aria-modal"]=Nn);var oi=vs??Ur;oi!=null&&(bt["aria-multiline"]=oi);var Gt=rn??ii;Gt!=null&&(bt["aria-multiselectable"]=Gt);var Un=Pn??Qi;Un!=null&&(bt["aria-orientation"]=Un);var To=si??Ai;To!=null&&(bt["aria-owns"]=eh(To));var ws=Ns??xo;ws!=null&&(bt["aria-placeholder"]=ws);var Jn=Rn??Mi;Jn!=null&&(bt["aria-posinset"]=Jn);var Tr=xs??es;Tr!=null&&(bt["aria-pressed"]=Tr);var Zl=ts??Us;Zl!=null&&(bt["aria-readonly"]=Zl,(t==="input"||t==="select"||t==="textarea")&&(bt.readOnly=!0));var Oi=Pi??cr;Oi!=null&&(bt["aria-required"]=Oi,(t==="input"||t==="select"||t==="textarea")&&(bt.required=cr)),Wt!=null&&(bt.role=Wt==="none"?"presentation":Wt);var Eo=Ri??rs;Eo!=null&&(bt["aria-roledescription"]=Eo);var Co=ns??bo;Co!=null&&(bt["aria-rowcount"]=Co);var Ba=ae??$;Ba!=null&&(bt["aria-rowindex"]=Ba);var Xl=U??re;Xl!=null&&(bt["aria-rowspan"]=Xl);var ko=ce??_e;ko!=null&&(bt["aria-selected"]=ko);var Io=Te??Ee;Io!=null&&(bt["aria-setsize"]=Io);var Qo=ye??ze;Qo!=null&&(bt["aria-sort"]=Qo);var Gs=et??ot;Gs!=null&&(bt["aria-valuemax"]=Gs);var Ln=Ye??Mt;Ln!=null&&(bt["aria-valuemin"]=Ln);var Or=Nt??Pt;Or!=null&&(bt["aria-valuenow"]=Or);var Fa=Ut??Xt;if(Fa!=null&&(bt["aria-valuetext"]=Fa),pr!=null){for(var ea in pr)if(W4.call(pr,ea)){var Vn=X4(ea),Qn=pr[ea];Qn!=null&&(bt["data-"+Vn]=Qn)}}nn===0||nn==="0"||nn===-1||nn==="-1"?bt.tabIndex=nn:(Rr===!1&&(bt.tabIndex="-1"),t==="a"||t==="button"||t==="input"||t==="select"||t==="textarea"?(Rr===!1||pt===!0)&&(bt.tabIndex="-1"):Wt==="button"||Wt==="checkbox"||Wt==="link"||Wt==="radio"||Wt==="textbox"||Wt==="switch"?Rr!==!1&&(bt.tabIndex="0"):Rr===!0&&(bt.tabIndex="0"));var Kl=en([gn,vi&&K4[vi]],er({writingDirection:"ltr"},o)),Ao=Kl[0],Lr=Kl[1];Ao&&(bt.className=Ao),Lr&&(bt.style=Lr);var Mo=bn??Yr;return Mo!=null&&(bt.id=Mo),Vs!=null&&(bt["data-testid"]=Vs),bt.type==null&&t==="button"&&(bt.type="button"),bt},J4=new Set(["Arab","Syrc","Samr","Mand","Thaa","Mend","Nkoo","Adlm","Rohg","Hebr"]),WE=new Set(["ae","ar","arc","bcc","bqi","ckb","dv","fa","far","glk","he","iw","khw","ks","ku","mzn","nqo","pnb","ps","sd","ug","ur","yi"]),qE=new Map;function Q4(t){var r=qE.get(t);if(r)return r;var o=!1;if(Intl.Locale)try{var u=new Intl.Locale(t).maximize().script;o=J4.has(u)}catch{var f=t.split("-")[0];o=WE.has(f)}else{var _=t.split("-")[0];o=WE.has(_)}return qE.set(t,o),o}var eF={direction:"ltr",locale:"en-US"},iM=ve.createContext(eF);function j_(t){return Q4(t)?"rtl":"ltr"}function tF(t){var r=t.direction,o=t.locale,u=t.children,f=r||o;return f?Sn.createElement(iM.Provider,{children:u,value:{direction:o?j_(o):r,locale:o}}):u}function pb(){return ve.useContext(iM)}var N_=(t,r,o)=>{var u;t&&t.constructor===String&&(u=TA.propsToAccessibilityComponent(r));var f=u||t,_=Y4(f,r,o),b=Sn.createElement(f,_),T=_.dir?Sn.createElement(tF,{children:b,direction:_.dir,locale:_.lang}):b;return T},G0=t=>{if(t!=null){var r=t.nodeType===1;if(r&&typeof t.getBoundingClientRect=="function")return t.getBoundingClientRect()}},Ff={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexOrder:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,fontWeight:!0,gridRow:!0,gridRowEnd:!0,gridRowGap:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnGap:!0,gridColumnStart:!0,lineClamp:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0,scale:!0,scaleX:!0,scaleY:!0,scaleZ:!0,shadowOpacity:!0},rF=["ms","Moz","O","Webkit"],nF=(t,r)=>t+r.charAt(0).toUpperCase()+r.substring(1);Object.keys(Ff).forEach(t=>{rF.forEach(r=>{Ff[nF(r,t)]=Ff[t]})});function iF(t,r,o){var u=r==null||typeof r=="boolean"||r==="";return u?"":!o&&typeof r=="number"&&r!==0&&!(Ff.hasOwnProperty(t)&&Ff[t])?r+"px":(""+r).trim()}function sF(t,r){var o=t.style;for(var u in r)if(r.hasOwnProperty(u)){var f=u.indexOf("--")===0,_=iF(u,r[u],f);u==="float"&&(u="cssFloat"),f?o.setProperty(u,_):o[u]=_}}var HE=t=>{var r=t.offsetHeight,o=t.offsetWidth,u=t.offsetLeft,f=t.offsetTop;for(t=t.offsetParent;t&&t.nodeType===1;)u+=t.offsetLeft+t.clientLeft-t.scrollLeft,f+=t.offsetTop+t.clientTop-t.scrollTop,t=t.offsetParent;return f-=window.scrollY,u-=window.scrollX,{width:o,height:r,top:f,left:u}},ZE=(t,r,o)=>{var u=r||t&&t.parentNode;t&&u&&setTimeout(()=>{if(t.isConnected&&u.isConnected){var f=HE(u),_=HE(t),b=_.height,T=_.left,a=_.top,I=_.width,D=T-f.left,j=a-f.top;o(D,j,I,b,T,a)}},0)},oF={A:!0,BODY:!0,INPUT:!0,SELECT:!0,TEXTAREA:!0},qu={blur(t){try{t.blur()}catch{}},focus(t){try{var r=t.nodeName;t.getAttribute("tabIndex")==null&&t.isContentEditable!==!0&&oF[r]==null&&t.setAttribute("tabIndex","-1"),t.focus()}catch{}},measure(t,r){ZE(t,null,r)},measureInWindow(t,r){t&&setTimeout(()=>{var o=G0(t),u=o.height,f=o.left,_=o.top,b=o.width;r(f,_,b,u)},0)},measureLayout(t,r,o,u){ZE(t,r,u)},updateView(t,r){for(var o in r)if(Object.prototype.hasOwnProperty.call(r,o)){var u=r[o];switch(o){case"style":{sF(t,u);break}case"class":case"className":{t.setAttribute("class",u);break}case"text":case"value":t.value=u;break;default:t.setAttribute(o,u)}}},configureNextLayoutAnimation(t,r){r()},setLayoutAnimationEnabledExperimental(){}},aF={OS:"web",select:t=>"web"in t?t.web:t.default,get isTesting(){return!1}};function Ci(){return Ci=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var u in o)({}).hasOwnProperty.call(o,u)&&(t[u]=o[u])}return t},Ci.apply(null,arguments)}var mb={children:!0,dataSet:!0,dir:!0,id:!0,ref:!0,suppressHydrationWarning:!0,tabIndex:!0,testID:!0,focusable:!0,nativeID:!0},gb={"aria-activedescendant":!0,"aria-atomic":!0,"aria-autocomplete":!0,"aria-busy":!0,"aria-checked":!0,"aria-colcount":!0,"aria-colindex":!0,"aria-colspan":!0,"aria-controls":!0,"aria-current":!0,"aria-describedby":!0,"aria-details":!0,"aria-disabled":!0,"aria-errormessage":!0,"aria-expanded":!0,"aria-flowto":!0,"aria-haspopup":!0,"aria-hidden":!0,"aria-invalid":!0,"aria-keyshortcuts":!0,"aria-label":!0,"aria-labelledby":!0,"aria-level":!0,"aria-live":!0,"aria-modal":!0,"aria-multiline":!0,"aria-multiselectable":!0,"aria-orientation":!0,"aria-owns":!0,"aria-placeholder":!0,"aria-posinset":!0,"aria-pressed":!0,"aria-readonly":!0,"aria-required":!0,role:!0,"aria-roledescription":!0,"aria-rowcount":!0,"aria-rowindex":!0,"aria-rowspan":!0,"aria-selected":!0,"aria-setsize":!0,"aria-sort":!0,"aria-valuemax":!0,"aria-valuemin":!0,"aria-valuenow":!0,"aria-valuetext":!0,accessibilityActiveDescendant:!0,accessibilityAtomic:!0,accessibilityAutoComplete:!0,accessibilityBusy:!0,accessibilityChecked:!0,accessibilityColumnCount:!0,accessibilityColumnIndex:!0,accessibilityColumnSpan:!0,accessibilityControls:!0,accessibilityCurrent:!0,accessibilityDescribedBy:!0,accessibilityDetails:!0,accessibilityDisabled:!0,accessibilityErrorMessage:!0,accessibilityExpanded:!0,accessibilityFlowTo:!0,accessibilityHasPopup:!0,accessibilityHidden:!0,accessibilityInvalid:!0,accessibilityKeyShortcuts:!0,accessibilityLabel:!0,accessibilityLabelledBy:!0,accessibilityLevel:!0,accessibilityLiveRegion:!0,accessibilityModal:!0,accessibilityMultiline:!0,accessibilityMultiSelectable:!0,accessibilityOrientation:!0,accessibilityOwns:!0,accessibilityPlaceholder:!0,accessibilityPosInSet:!0,accessibilityPressed:!0,accessibilityReadOnly:!0,accessibilityRequired:!0,accessibilityRole:!0,accessibilityRoleDescription:!0,accessibilityRowCount:!0,accessibilityRowIndex:!0,accessibilityRowSpan:!0,accessibilitySelected:!0,accessibilitySetSize:!0,accessibilitySort:!0,accessibilityValueMax:!0,accessibilityValueMin:!0,accessibilityValueNow:!0,accessibilityValueText:!0},_b={onClick:!0,onAuxClick:!0,onContextMenu:!0,onGotPointerCapture:!0,onLostPointerCapture:!0,onPointerCancel:!0,onPointerDown:!0,onPointerEnter:!0,onPointerMove:!0,onPointerLeave:!0,onPointerOut:!0,onPointerOver:!0,onPointerUp:!0},yb={onBlur:!0,onFocus:!0},vb={onKeyDown:!0,onKeyDownCapture:!0,onKeyUp:!0,onKeyUpCapture:!0},xb={onMouseDown:!0,onMouseEnter:!0,onMouseLeave:!0,onMouseMove:!0,onMouseOver:!0,onMouseOut:!0,onMouseUp:!0},bb={onTouchCancel:!0,onTouchCancelCapture:!0,onTouchEnd:!0,onTouchEndCapture:!0,onTouchMove:!0,onTouchMoveCapture:!0,onTouchStart:!0,onTouchStartCapture:!0},wb={style:!0};function Sb(t,r){var o={};for(var u in t)t.hasOwnProperty(u)&&r[u]===!0&&(o[u]=t[u]);return o}var W0=js?ve.useLayoutEffect:ve.useEffect,q0="__reactLayoutHandler",gx=null;function lF(){return js&&typeof window.ResizeObserver<"u"&&gx==null&&(gx=new window.ResizeObserver(function(t){t.forEach(r=>{var o=r.target,u=o[q0];typeof u=="function"&&qu.measure(o,(f,_,b,T,a,I)=>{var D={nativeEvent:{layout:{x:f,y:_,width:b,height:T,left:a,top:I}},timeStamp:Date.now()};Object.defineProperty(D.nativeEvent,"target",{enumerable:!0,get:()=>r.target}),u(D)})})})),gx}function Tb(t,r){var o=lF();W0(()=>{var u=t.current;u!=null&&(u[q0]=r)},[t,r]),W0(()=>{var u=t.current;return u!=null&&o!=null&&(typeof u[q0]=="function"?o.observe(u):o.unobserve(u)),()=>{u!=null&&o!=null&&o.unobserve(u)}},[t,o])}function sM(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return function(f){r.forEach(_=>{if(_!=null){if(typeof _=="function"){_(f);return}if(typeof _=="object"){_.current=f;return}console.error("mergeRefs cannot handle Refs of type boolean, number or string, received ref "+String(_))}})}}function bp(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return ve.useMemo(()=>sM(...r),[...r])}var XE=typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol():Object.freeze({});function uF(t){var r=ve.useRef(XE);return r.current===XE&&(r.current=t()),r.current}function Eb(t){t.pointerEvents,t.style;var r=uF(()=>o=>{o!=null&&(o.measure=u=>qu.measure(o,u),o.measureLayout=(u,f,_)=>qu.measureLayout(o,u,_,f),o.measureInWindow=u=>qu.measureInWindow(o,u))});return r}var KE=()=>{},cF={},hF=[];function YE(t){return t>20?t%20:t}function oM(t,r){var o,u=!1,f,_,b=t.changedTouches,T=t.type,a=t.metaKey===!0,I=t.shiftKey===!0,D=b&&b[0].force||0,j=YE(b&&b[0].identifier||0),V=b&&b[0].clientX||t.clientX,q=b&&b[0].clientY||t.clientY,se=b&&b[0].pageX||t.pageX,pe=b&&b[0].pageY||t.pageY,be=typeof t.preventDefault=="function"?t.preventDefault.bind(t):KE,te=t.timeStamp;function X(Ne){return Array.prototype.slice.call(Ne).map(qe=>({force:qe.force,identifier:YE(qe.identifier),get locationX(){return Ce(qe.clientX)},get locationY(){return Le(qe.clientY)},pageX:qe.pageX,pageY:qe.pageY,target:qe.target,timestamp:te}))}if(b!=null)f=X(b),_=X(t.touches);else{var ie=[{force:D,identifier:j,get locationX(){return Ce(V)},get locationY(){return Le(q)},pageX:se,pageY:pe,target:t.target,timestamp:te}];f=ie,_=T==="mouseup"||T==="dragstart"?hF:ie}var Se={bubbles:!0,cancelable:!0,currentTarget:null,defaultPrevented:t.defaultPrevented,dispatchConfig:cF,eventPhase:t.eventPhase,isDefaultPrevented(){return t.defaultPrevented},isPropagationStopped(){return u},isTrusted:t.isTrusted,nativeEvent:{altKey:!1,ctrlKey:!1,metaKey:a,shiftKey:I,changedTouches:f,force:D,identifier:j,get locationX(){return Ce(V)},get locationY(){return Le(q)},pageX:se,pageY:pe,target:t.target,timestamp:te,touches:_,type:T},persist:KE,preventDefault:be,stopPropagation(){u=!0},target:t.target,timeStamp:te,touchHistory:r.touchHistory};function Ce(Ne){if(o=o||G0(Se.currentTarget),o)return Ne-o.left}function Le(Ne){if(o=o||G0(Se.currentTarget),o)return Ne-o.top}return Se}var dF="mousedown",fF="mousemove",pF="mouseup",mF="dragstart",gF="touchstart",_F="touchmove",yF="touchend",vF="touchcancel",xF="scroll",bF="select",wF="selectionchange";function aM(t){return t===gF||t===dF}function lM(t){return t===_F||t===fF}function uM(t){return t===yF||t===pF||cM(t)}function cM(t){return t===vF||t===mF}function SF(t){return t===xF}function TF(t){return t===bF||t===wF}function EF(){var t=window.getSelection(),r=t.toString(),o=t.anchorNode,u=t.focusNode,f=o&&o.nodeType===window.Node.TEXT_NODE||u&&u.nodeType===window.Node.TEXT_NODE;return r.length>=1&&r!==`
`&&f}var hM="__reactResponderId";function CF(t){if(t.type==="selectionchange"){var r=window.getSelection().anchorNode;return JE(r)}else{var o=t.composedPath!=null?t.composedPath():JE(t.target);return o}}function JE(t){for(var r=[];t!=null&&t!==document.body;)r.push(t),t=t.parentNode;return r}function kF(t){return t!=null?t[hM]:null}function IF(t,r){t!=null&&(t[hM]=r)}function AF(t){for(var r=[],o=[],u=CF(t),f=0;f<u.length;f++){var _=u[f],b=kF(_);b!=null&&(r.push(b),o.push(_))}return{idPath:r,nodePath:o}}function MF(t,r){var o=t.length,u=r.length;if(o===0||u===0||t[o-1]!==r[u-1])return null;var f=t[0],_=0,b=r[0],T=0;o-u>0&&(_=o-u,f=t[_],o=u),u-o>0&&(T=u-o,b=r[T],u=o);for(var a=o;a--;){if(f===b)return f;f=t[_++],b=r[T++]}return null}function PF(t,r){if(!r||r.length===0)return!1;for(var o=0;o<r.length;o++){var u=r[o].target;if(u!=null&&t.contains(u))return!0}return!1}function RF(t){return t.type==="selectionchange"?EF():t.type==="select"}function LF(t){var r=t.altKey,o=t.button,u=t.buttons,f=t.ctrlKey,_=t.type,b=_==="touchstart"||_==="touchmove",T=_==="mousedown"&&(o===0||u===1),a=_==="mousemove"&&u===1,I=r===!1&&f===!1;return!!(b||T&&I||a&&I)}var QE=20;function Os(t){return t.timeStamp||t.timestamp}function zF(t){return{touchActive:!0,startPageX:t.pageX,startPageY:t.pageY,startTimeStamp:Os(t),currentPageX:t.pageX,currentPageY:t.pageY,currentTimeStamp:Os(t),previousPageX:t.pageX,previousPageY:t.pageY,previousTimeStamp:Os(t)}}function DF(t,r){t.touchActive=!0,t.startPageX=r.pageX,t.startPageY=r.pageY,t.startTimeStamp=Os(r),t.currentPageX=r.pageX,t.currentPageY=r.pageY,t.currentTimeStamp=Os(r),t.previousPageX=r.pageX,t.previousPageY=r.pageY,t.previousTimeStamp=Os(r)}function Cb(t){var r=t.identifier;return r==null&&console.error("Touch object is missing identifier."),r}function OF(t,r){var o=Cb(t),u=r.touchBank[o];u?DF(u,t):r.touchBank[o]=zF(t),r.mostRecentTimeStamp=Os(t)}function BF(t,r){var o=r.touchBank[Cb(t)];o?(o.touchActive=!0,o.previousPageX=o.currentPageX,o.previousPageY=o.currentPageY,o.previousTimeStamp=o.currentTimeStamp,o.currentPageX=t.pageX,o.currentPageY=t.pageY,o.currentTimeStamp=Os(t),r.mostRecentTimeStamp=Os(t)):console.warn(`Cannot record touch move without a touch start.
`,"Touch Move: "+dM(t)+`
`,"Touch Bank: "+fM(r))}function FF(t,r){var o=r.touchBank[Cb(t)];o?(o.touchActive=!1,o.previousPageX=o.currentPageX,o.previousPageY=o.currentPageY,o.previousTimeStamp=o.currentTimeStamp,o.currentPageX=t.pageX,o.currentPageY=t.pageY,o.currentTimeStamp=Os(t),r.mostRecentTimeStamp=Os(t)):console.warn(`Cannot record touch end without a touch start.
`,"Touch End: "+dM(t)+`
`,"Touch Bank: "+fM(r))}function dM(t){return JSON.stringify({identifier:t.identifier,pageX:t.pageX,pageY:t.pageY,timestamp:Os(t)})}function fM(t){var r=t.touchBank,o=JSON.stringify(r.slice(0,QE));return r.length>QE&&(o+=" (original size: "+r.length+")"),o}class jF{constructor(){this._touchHistory={touchBank:[],numberActiveTouches:0,indexOfSingleActiveTouch:-1,mostRecentTimeStamp:0}}recordTouchTrack(r,o){var u=this._touchHistory;if(lM(r))o.changedTouches.forEach(T=>BF(T,u));else if(aM(r))o.changedTouches.forEach(T=>OF(T,u)),u.numberActiveTouches=o.touches.length,u.numberActiveTouches===1&&(u.indexOfSingleActiveTouch=o.touches[0].identifier);else if(uM(r)&&(o.changedTouches.forEach(T=>FF(T,u)),u.numberActiveTouches=o.touches.length,u.numberActiveTouches===1))for(var f=u.touchBank,_=0;_<f.length;_++){var b=f[_];if(b!=null&&b.touchActive){u.indexOfSingleActiveTouch=_;break}}}get touchHistory(){return this._touchHistory}}var NF={},eC=["onStartShouldSetResponderCapture","onStartShouldSetResponder",{bubbles:!0}],tC=["onMoveShouldSetResponderCapture","onMoveShouldSetResponder",{bubbles:!0}],UF=["onScrollShouldSetResponderCapture","onScrollShouldSetResponder",{bubbles:!1}],VF={touchstart:eC,mousedown:eC,touchmove:tC,mousemove:tC,scroll:UF},H0={id:null,idPath:null,node:null},c_=new Map,gl=!1,$o=0,Ho={id:null,node:null,idPath:null},Z0=new jF;function cp(t){Ho=t}function hp(t){var r=c_.get(t);return r??NF}function _x(t){var r=t.type,o=t.target;if(r==="touchstart"&&(gl=!0),(r==="touchmove"||$o>1)&&(gl=!1),!(r==="mousedown"&&gl||r==="mousemove"&&gl||r==="mousemove"&&$o<1)){if(gl&&r==="mouseup"){$o===0&&(gl=!1);return}var u=aM(r)&&LF(t),f=lM(r),_=uM(r),b=SF(r),T=TF(r),a=oM(t,Z0);(u||f||_)&&(t.touches?$o=t.touches.length:u?$o=1:_&&($o=0),Z0.recordTouchTrack(r,a.nativeEvent));var I=AF(t),D=!1,j;if(u||f||b&&$o>0){var V=Ho.idPath,q=I.idPath;if(V!=null&&q!=null){var se=MF(V,q);if(se!=null){var pe=q.indexOf(se),be=pe+(se===Ho.id?1:0);I={idPath:q.slice(be),nodePath:I.nodePath.slice(be)}}else I=null}I!=null&&(j=$F(I,t,a),j!=null&&(GF(a,j),D=!0))}if(Ho.id!=null&&Ho.node!=null){var te=Ho,X=te.id,ie=te.node,Se=hp(X),Ce=Se.onResponderStart,Le=Se.onResponderMove,Ne=Se.onResponderEnd,qe=Se.onResponderRelease,it=Se.onResponderTerminate,Ae=Se.onResponderTerminationRequest;if(a.bubbles=!1,a.cancelable=!1,a.currentTarget=ie,u)Ce!=null&&(a.dispatchConfig.registrationName="onResponderStart",Ce(a));else if(f)Le!=null&&(a.dispatchConfig.registrationName="onResponderMove",Le(a));else{var Tt=cM(r)||r==="contextmenu"||r==="blur"&&o===window||r==="blur"&&o.contains(ie)&&t.relatedTarget!==ie||b&&$o===0||b&&o.contains(ie)&&o!==ie||T&&RF(t),$t=_&&!Tt&&!PF(ie,t.touches);if(_&&Ne!=null&&(a.dispatchConfig.registrationName="onResponderEnd",Ne(a)),$t&&(qe!=null&&(a.dispatchConfig.registrationName="onResponderRelease",qe(a)),cp(H0)),Tt){var pt=!0;(r==="contextmenu"||r==="scroll"||r==="selectionchange")&&(D?pt=!1:Ae!=null&&(a.dispatchConfig.registrationName="onResponderTerminationRequest",Ae(a)===!1&&(pt=!1))),pt&&(it!=null&&(a.dispatchConfig.registrationName="onResponderTerminate",it(a)),cp(H0),gl=!1,$o=0)}}}}}function $F(t,r,o){var u=VF[r.type];if(u!=null){for(var f=t.idPath,_=t.nodePath,b=u[0],T=u[1],a=u[2].bubbles,I=function(Le,Ne,qe){var it=hp(Le),Ae=it[qe];if(Ae!=null&&(o.currentTarget=Ne,Ae(o)===!0)){var Tt=f.slice(f.indexOf(Le));return{id:Le,node:Ne,idPath:Tt}}},D=f.length-1;D>=0;D--){var j=f[D],V=_[D],q=I(j,V,b);if(q!=null)return q;if(o.isPropagationStopped()===!0)return}if(a)for(var se=0;se<f.length;se++){var pe=f[se],be=_[se],te=I(pe,be,T);if(te!=null)return te;if(o.isPropagationStopped()===!0)return}else{var X=f[0],ie=_[0],Se=r.target;if(Se===ie)return I(X,ie,T)}}}function GF(t,r){var o=Ho,u=o.id,f=o.node,_=r.id,b=r.node,T=hp(_),a=T.onResponderGrant,I=T.onResponderReject;if(t.bubbles=!1,t.cancelable=!1,t.currentTarget=b,u==null)a!=null&&(t.currentTarget=b,t.dispatchConfig.registrationName="onResponderGrant",a(t)),cp(r);else{var D=hp(u),j=D.onResponderTerminate,V=D.onResponderTerminationRequest,q=!0;V!=null&&(t.currentTarget=f,t.dispatchConfig.registrationName="onResponderTerminationRequest",V(t)===!1&&(q=!1)),q?(j!=null&&(t.currentTarget=f,t.dispatchConfig.registrationName="onResponderTerminate",j(t)),a!=null&&(t.currentTarget=b,t.dispatchConfig.registrationName="onResponderGrant",a(t)),cp(r)):I!=null&&(t.currentTarget=b,t.dispatchConfig.registrationName="onResponderReject",I(t))}}var WF=["blur","scroll"],qF=["mousedown","mousemove","mouseup","dragstart","touchstart","touchmove","touchend","touchcancel","contextmenu","select","selectionchange"];function HF(){js&&window.__reactResponderSystemActive==null&&(window.addEventListener("blur",_x),qF.forEach(t=>{document.addEventListener(t,_x)}),WF.forEach(t=>{document.addEventListener(t,_x,!0)}),window.__reactResponderSystemActive=!0)}function ZF(t,r,o){IF(r,t),c_.set(t,o)}function rC(t){Ho.id===t&&XF(),c_.has(t)&&c_.delete(t)}function XF(){var t=Ho,r=t.id,o=t.node;if(r!=null&&o!=null){var u=hp(r),f=u.onResponderTerminate;if(f!=null){var _=oM({},Z0);_.currentTarget=o,f(_)}cp(H0)}gl=!1,$o=0}function KF(){return Ho.node}var YF={},JF=0;function QF(t){var r=ve.useRef(null);return r.current==null&&(r.current=t()),r.current}function kb(t,r){r===void 0&&(r=YF);var o=QF(()=>JF++),u=ve.useRef(!1);ve.useEffect(()=>(HF(),()=>{rC(o)}),[o]),ve.useEffect(()=>{var f=r,_=f.onMoveShouldSetResponder,b=f.onMoveShouldSetResponderCapture,T=f.onScrollShouldSetResponder,a=f.onScrollShouldSetResponderCapture,I=f.onSelectionChangeShouldSetResponder,D=f.onSelectionChangeShouldSetResponderCapture,j=f.onStartShouldSetResponder,V=f.onStartShouldSetResponderCapture,q=_!=null||b!=null||T!=null||a!=null||I!=null||D!=null||j!=null||V!=null,se=t.current;q?(ZF(o,se,r),u.current=!0):u.current&&(rC(o),u.current=!1)},[r,t,o]),ve.useDebugValue({isResponder:t.current===KF()}),ve.useDebugValue(r)}var h_=ve.createContext(!1),e5=["hrefAttrs","onLayout","onMoveShouldSetResponder","onMoveShouldSetResponderCapture","onResponderEnd","onResponderGrant","onResponderMove","onResponderReject","onResponderRelease","onResponderStart","onResponderTerminate","onResponderTerminationRequest","onScrollShouldSetResponder","onScrollShouldSetResponderCapture","onSelectionChangeShouldSetResponder","onSelectionChangeShouldSetResponderCapture","onStartShouldSetResponder","onStartShouldSetResponderCapture"],t5=Object.assign({},mb,gb,_b,yb,vb,xb,bb,wb,{href:!0,lang:!0,onScroll:!0,onWheel:!0,pointerEvents:!0}),r5=t=>Sb(t,t5),Rt=ve.forwardRef((t,r)=>{var o=t.hrefAttrs,u=t.onLayout,f=t.onMoveShouldSetResponder,_=t.onMoveShouldSetResponderCapture,b=t.onResponderEnd,T=t.onResponderGrant,a=t.onResponderMove,I=t.onResponderReject,D=t.onResponderRelease,j=t.onResponderStart,V=t.onResponderTerminate,q=t.onResponderTerminationRequest,se=t.onScrollShouldSetResponder,pe=t.onScrollShouldSetResponderCapture,be=t.onSelectionChangeShouldSetResponder,te=t.onSelectionChangeShouldSetResponderCapture,X=t.onStartShouldSetResponder,ie=t.onStartShouldSetResponderCapture,Se=ys(t,e5),Ce=ve.useContext(h_),Le=ve.useRef(null),Ne=pb(),qe=Ne.direction;Tb(Le,u),kb(Le,{onMoveShouldSetResponder:f,onMoveShouldSetResponderCapture:_,onResponderEnd:b,onResponderGrant:T,onResponderMove:a,onResponderReject:I,onResponderRelease:D,onResponderStart:j,onResponderTerminate:V,onResponderTerminationRequest:q,onScrollShouldSetResponder:se,onScrollShouldSetResponderCapture:pe,onSelectionChangeShouldSetResponder:be,onSelectionChangeShouldSetResponderCapture:te,onStartShouldSetResponder:X,onStartShouldSetResponderCapture:ie});var it="div",Ae=t.lang!=null?j_(t.lang):null,Tt=t.dir||Ae,$t=Tt||qe,pt=r5(Se);if(pt.dir=Tt,pt.style=[nC.view$raw,Ce&&nC.inline,t.style],t.href!=null&&(it="a",o!=null)){var Kt=o.download,Dr=o.rel,Sr=o.target;Kt!=null&&(pt.download=Kt),Dr!=null&&(pt.rel=Dr),typeof Sr=="string"&&(pt.target=Sr.charAt(0)!=="_"?"_"+Sr:Sr)}var xn=Eb(pt),lt=bp(Le,xn,r);return pt.ref=lt,N_(it,pt,{writingDirection:$t})});Rt.displayName="View";var nC=en.create({view$raw:{alignItems:"stretch",backgroundColor:"transparent",border:"0 solid black",boxSizing:"border-box",display:"flex",flexBasis:"auto",flexDirection:"column",flexShrink:0,listStyle:"none",margin:0,minHeight:0,minWidth:0,padding:0,position:"relative",textDecoration:"none",zIndex:0},inline:{display:"inline-flex"}}),n5=function t(r,o,u){if(u===void 0&&(u=-1),u===0)return!0;if(r===o||typeof r=="function"&&typeof o=="function")return!1;if(typeof r!="object"||r===null)return r!==o;if(typeof o!="object"||o===null||r.constructor!==o.constructor)return!0;if(Array.isArray(r)){var f=r.length;if(o.length!==f)return!0;for(var _=0;_<f;_++)if(t(r[_],o[_],u-1))return!0}else{for(var b in r)if(t(r[b],o[b],u-1))return!0;for(var T in o)if(r[T]===void 0&&o[T]!==void 0)return!0}return!1};function i5(t,r){for(var o=arguments.length,u=new Array(o>2?o-2:0),f=2;f<o;f++)u[f-2]=arguments[f];if(!t){var _;if(r===void 0)_=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var b=0;_=new Error(r.replace(/%s/g,function(){return String(u[b++])})),_.name="Invariant Violation"}throw _.framesToPop=1,_}}var s5=i5;const Qt=Dh(s5);function iC(t,r){(r==null||r>t.length)&&(r=t.length);for(var o=0,u=Array(r);o<r;o++)u[o]=t[o];return u}function o5(t,r){if(t){if(typeof t=="string")return iC(t,r);var o={}.toString.call(t).slice(8,-1);return o==="Object"&&t.constructor&&(o=t.constructor.name),o==="Map"||o==="Set"?Array.from(t):o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?iC(t,r):void 0}}function Nu(t,r){var o=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(o)return(o=o.call(t)).next.bind(o);if(Array.isArray(t)||(o=o5(t))||r){o&&(t=o);var u=0;return function(){return u>=t.length?{done:!0}:{done:!1,value:t[u++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a5=["colors","enabled","onRefresh","progressBackgroundColor","progressViewOffset","refreshing","size","tintColor","title","titleColor"];function l5(t){t.colors,t.enabled,t.onRefresh,t.progressBackgroundColor,t.progressViewOffset,t.refreshing,t.size,t.tintColor,t.title,t.titleColor;var r=ys(t,a5);return Sn.createElement(Rt,r)}var Uu={window:{fontScale:1,height:0,scale:1,width:0},screen:{fontScale:1,height:0,scale:1,width:0}},wl={},sC=js;function pM(){if(js){var t=window,r,o;if(t.visualViewport){var u=t.visualViewport;r=Math.round(u.height*u.scale),o=Math.round(u.width*u.scale)}else{var f=t.document.documentElement;r=f.clientHeight,o=f.clientWidth}Uu.window={fontScale:1,height:r,scale:t.devicePixelRatio||1,width:o},Uu.screen={fontScale:1,height:t.screen.height,scale:t.devicePixelRatio||1,width:t.screen.width}}}function oC(){pM(),Array.isArray(wl.change)&&wl.change.forEach(t=>t(Uu))}class Vu{static get(r){return sC&&(sC=!1,pM()),Qt(Uu[r],"No dimension set for key "+r),Uu[r]}static set(r){r&&(js?Qt(!1,"Dimensions cannot be set in the browser"):(r.screen!=null&&(Uu.screen=r.screen),r.window!=null&&(Uu.window=r.window)))}static addEventListener(r,o){return wl[r]=wl[r]||[],wl[r].push(o),{remove:()=>{this.removeEventListener(r,o)}}}static removeEventListener(r,o){Array.isArray(wl[r])&&(wl[r]=wl[r].filter(u=>u!==o))}}js&&(window.visualViewport?window.visualViewport.addEventListener("resize",oC,!1):window.addEventListener("resize",oC,!1));var Ta={_currentlyFocusedNode:null,currentlyFocusedField(){return document.activeElement!==this._currentlyFocusedNode&&(this._currentlyFocusedNode=null),this._currentlyFocusedNode},focusTextInput(t){t!==null&&(this._currentlyFocusedNode=t,document.activeElement!==t&&qu.focus(t))},blurTextInput(t){t!==null&&(this._currentlyFocusedNode=null,document.activeElement===t&&qu.blur(t))}},u5=()=>{Ta.blurTextInput(Ta.currentlyFocusedField())},c5=["onScroll","onTouchMove","onWheel","scrollEnabled","scrollEventThrottle","showsHorizontalScrollIndicator","showsVerticalScrollIndicator","style"];function aC(t){return{nativeEvent:{contentOffset:{get x(){return t.target.scrollLeft},get y(){return t.target.scrollTop}},contentSize:{get height(){return t.target.scrollHeight},get width(){return t.target.scrollWidth}},layoutMeasurement:{get height(){return t.target.offsetHeight},get width(){return t.target.offsetWidth}}},timeStamp:Date.now()}}function h5(t,r){var o=Date.now()-t;return r>0&&o>=r}var d5=ve.forwardRef((t,r)=>{var o=t.onScroll,u=t.onTouchMove,f=t.onWheel,_=t.scrollEnabled,b=_===void 0?!0:_,T=t.scrollEventThrottle,a=T===void 0?0:T,I=t.showsHorizontalScrollIndicator,D=t.showsVerticalScrollIndicator,j=t.style,V=ys(t,c5),q=ve.useRef({isScrolling:!1,scrollLastTick:0}),se=ve.useRef(null),pe=ve.useRef(null);function be(Le){return Ne=>{b&&Le&&Le(Ne)}}function te(Le){Le.stopPropagation(),Le.target===pe.current&&(Le.persist(),se.current!=null&&clearTimeout(se.current),se.current=setTimeout(()=>{Se(Le)},100),q.current.isScrolling?h5(q.current.scrollLastTick,a)&&ie(Le):X(Le))}function X(Le){q.current.isScrolling=!0,ie(Le)}function ie(Le){q.current.scrollLastTick=Date.now(),o&&o(aC(Le))}function Se(Le){q.current.isScrolling=!1,o&&o(aC(Le))}var Ce=I===!1||D===!1;return ve.createElement(Rt,Ci({},V,{onScroll:te,onTouchMove:be(u),onWheel:be(f),ref:bp(pe,r),style:[j,!b&&lC.scrollDisabled,Ce&&lC.hideScrollbar]}))}),lC=en.create({scrollDisabled:{overflowX:"hidden",overflowY:"hidden",touchAction:"none"},hideScrollbar:{scrollbarWidth:"none"}});function U_(t){return function(){return t}}var tc=function(){};tc.thatReturns=U_;tc.thatReturnsFalse=U_(!1);tc.thatReturnsTrue=U_(!0);tc.thatReturnsNull=U_(null);tc.thatReturnsThis=function(){return this};tc.thatReturnsArgument=function(t){return t};var f5=tc,p5=f5,m5=p5,g5=m5;const _5=Dh(g5);var y5=["contentContainerStyle","horizontal","onContentSizeChange","refreshControl","stickyHeaderIndices","pagingEnabled","forwardedRef","keyboardDismissMode","onScroll","centerContent"],uC={},v5=16;class x5 extends Sn.Component{constructor(){super(...arguments),this._scrollNodeRef=null,this._innerViewRef=null,this.isTouching=!1,this.lastMomentumScrollBeginTime=0,this.lastMomentumScrollEndTime=0,this.observedScrollSinceBecomingResponder=!1,this.becameResponderWhileAnimating=!1,this.scrollResponderHandleScrollShouldSetResponder=()=>this.isTouching,this.scrollResponderHandleStartShouldSetResponderCapture=r=>this.scrollResponderIsAnimating(),this.scrollResponderHandleTerminationRequest=()=>!this.observedScrollSinceBecomingResponder,this.scrollResponderHandleTouchEnd=r=>{var o=r.nativeEvent;this.isTouching=o.touches.length!==0,this.props.onTouchEnd&&this.props.onTouchEnd(r)},this.scrollResponderHandleResponderRelease=r=>{this.props.onResponderRelease&&this.props.onResponderRelease(r);var o=Ta.currentlyFocusedField();!this.props.keyboardShouldPersistTaps&&o!=null&&r.target!==o&&!this.observedScrollSinceBecomingResponder&&!this.becameResponderWhileAnimating&&(this.props.onScrollResponderKeyboardDismissed&&this.props.onScrollResponderKeyboardDismissed(r),Ta.blurTextInput(o))},this.scrollResponderHandleScroll=r=>{this.observedScrollSinceBecomingResponder=!0,this.props.onScroll&&this.props.onScroll(r)},this.scrollResponderHandleResponderGrant=r=>{this.observedScrollSinceBecomingResponder=!1,this.props.onResponderGrant&&this.props.onResponderGrant(r),this.becameResponderWhileAnimating=this.scrollResponderIsAnimating()},this.scrollResponderHandleScrollBeginDrag=r=>{this.props.onScrollBeginDrag&&this.props.onScrollBeginDrag(r)},this.scrollResponderHandleScrollEndDrag=r=>{this.props.onScrollEndDrag&&this.props.onScrollEndDrag(r)},this.scrollResponderHandleMomentumScrollBegin=r=>{this.lastMomentumScrollBeginTime=Date.now(),this.props.onMomentumScrollBegin&&this.props.onMomentumScrollBegin(r)},this.scrollResponderHandleMomentumScrollEnd=r=>{this.lastMomentumScrollEndTime=Date.now(),this.props.onMomentumScrollEnd&&this.props.onMomentumScrollEnd(r)},this.scrollResponderHandleTouchStart=r=>{this.isTouching=!0,this.props.onTouchStart&&this.props.onTouchStart(r)},this.scrollResponderHandleTouchMove=r=>{this.props.onTouchMove&&this.props.onTouchMove(r)},this.scrollResponderIsAnimating=()=>{var r=Date.now(),o=r-this.lastMomentumScrollEndTime,u=o<v5||this.lastMomentumScrollEndTime<this.lastMomentumScrollBeginTime;return u},this.scrollResponderScrollTo=(r,o,u)=>{if(typeof r=="number")console.warn("`scrollResponderScrollTo(x, y, animated)` is deprecated. Use `scrollResponderScrollTo({x: 5, y: 5, animated: true})` instead.");else{var f=r||uC;r=f.x,o=f.y,u=f.animated}var _=this.getScrollableNode(),b=r||0,T=o||0;_!=null&&(typeof _.scroll=="function"?_.scroll({top:T,left:b,behavior:u?"smooth":"auto"}):(_.scrollLeft=b,_.scrollTop=T))},this.scrollResponderZoomTo=(r,o)=>{Qt("zoomToRect is not implemented")},this.scrollResponderScrollNativeHandleToKeyboard=(r,o,u)=>{this.additionalScrollOffset=o||0,this.preventNegativeScrollOffset=!!u,qu.measureLayout(r,this.getInnerViewNode(),this.scrollResponderTextInputFocusError,this.scrollResponderInputMeasureAndScrollToKeyboard)},this.scrollResponderInputMeasureAndScrollToKeyboard=(r,o,u,f)=>{var _=Vu.get("window").height;this.keyboardWillOpenTo&&(_=this.keyboardWillOpenTo.endCoordinates.screenY);var b=o-_+f+this.additionalScrollOffset;this.preventNegativeScrollOffset&&(b=Math.max(0,b)),this.scrollResponderScrollTo({x:0,y:b,animated:!0}),this.additionalOffset=0,this.preventNegativeScrollOffset=!1},this.scrollResponderKeyboardWillShow=r=>{this.keyboardWillOpenTo=r,this.props.onKeyboardWillShow&&this.props.onKeyboardWillShow(r)},this.scrollResponderKeyboardWillHide=r=>{this.keyboardWillOpenTo=null,this.props.onKeyboardWillHide&&this.props.onKeyboardWillHide(r)},this.scrollResponderKeyboardDidShow=r=>{r&&(this.keyboardWillOpenTo=r),this.props.onKeyboardDidShow&&this.props.onKeyboardDidShow(r)},this.scrollResponderKeyboardDidHide=r=>{this.keyboardWillOpenTo=null,this.props.onKeyboardDidHide&&this.props.onKeyboardDidHide(r)},this.flashScrollIndicators=()=>{this.scrollResponderFlashScrollIndicators()},this.getScrollResponder=()=>this,this.getScrollableNode=()=>this._scrollNodeRef,this.getInnerViewRef=()=>this._innerViewRef,this.getInnerViewNode=()=>this._innerViewRef,this.getNativeScrollRef=()=>this._scrollNodeRef,this.scrollTo=(r,o,u)=>{if(typeof r=="number")console.warn("`scrollTo(y, x, animated)` is deprecated. Use `scrollTo({x: 5, y: 5, animated: true})` instead.");else{var f=r||uC;o=f.x,r=f.y,u=f.animated}this.scrollResponderScrollTo({x:o||0,y:r||0,animated:u!==!1})},this.scrollToEnd=r=>{var o=(r&&r.animated)!==!1,u=this.props.horizontal,f=this.getScrollableNode(),_=u?f.scrollWidth:0,b=u?0:f.scrollHeight;this.scrollResponderScrollTo({x:_,y:b,animated:o})},this._handleContentOnLayout=r=>{var o=r.nativeEvent.layout,u=o.width,f=o.height;this.props.onContentSizeChange(u,f)},this._handleScroll=r=>{this.props.keyboardDismissMode==="on-drag"&&u5(),this.scrollResponderHandleScroll(r)},this._setInnerViewRef=r=>{this._innerViewRef=r},this._setScrollNodeRef=r=>{this._scrollNodeRef=r,r!=null&&(r.getScrollResponder=this.getScrollResponder,r.getInnerViewNode=this.getInnerViewNode,r.getInnerViewRef=this.getInnerViewRef,r.getNativeScrollRef=this.getNativeScrollRef,r.getScrollableNode=this.getScrollableNode,r.scrollTo=this.scrollTo,r.scrollToEnd=this.scrollToEnd,r.flashScrollIndicators=this.flashScrollIndicators,r.scrollResponderZoomTo=this.scrollResponderZoomTo,r.scrollResponderScrollNativeHandleToKeyboard=this.scrollResponderScrollNativeHandleToKeyboard);var o=sM(this.props.forwardedRef);o(r)}}scrollResponderHandleStartShouldSetResponder(){return!1}scrollResponderHandleResponderReject(){_5(!1,"ScrollView doesn't take rejection well - scrolls anyway")}scrollResponderFlashScrollIndicators(){}scrollResponderTextInputFocusError(r){console.error("Error measuring text field: ",r)}render(){var r=this.props,o=r.contentContainerStyle,u=r.horizontal,f=r.onContentSizeChange,_=r.refreshControl,b=r.stickyHeaderIndices,T=r.pagingEnabled;r.forwardedRef,r.keyboardDismissMode,r.onScroll;var a=r.centerContent,I=ys(r,y5),D={};f&&(D={onLayout:this._handleContentOnLayout});var j=!u&&Array.isArray(b),V=j||T?Sn.Children.map(this.props.children,(ie,Se)=>{var Ce=j&&b.indexOf(Se)>-1;return ie!=null&&(Ce||T)?Sn.createElement(Rt,{style:[Ce&&ml.stickyHeader,T&&ml.pagingEnabledChild]},ie):ie}):this.props.children,q=Sn.createElement(Rt,Ci({},D,{children:V,collapsable:!1,ref:this._setInnerViewRef,style:[u&&ml.contentContainerHorizontal,a&&ml.contentContainerCenterContent,o]})),se=u?ml.baseHorizontal:ml.baseVertical,pe=u?ml.pagingEnabledHorizontal:ml.pagingEnabledVertical,be=er(er({},I),{},{style:[se,T&&pe,this.props.style],onTouchStart:this.scrollResponderHandleTouchStart,onTouchMove:this.scrollResponderHandleTouchMove,onTouchEnd:this.scrollResponderHandleTouchEnd,onScrollBeginDrag:this.scrollResponderHandleScrollBeginDrag,onScrollEndDrag:this.scrollResponderHandleScrollEndDrag,onMomentumScrollBegin:this.scrollResponderHandleMomentumScrollBegin,onMomentumScrollEnd:this.scrollResponderHandleMomentumScrollEnd,onStartShouldSetResponder:this.scrollResponderHandleStartShouldSetResponder,onStartShouldSetResponderCapture:this.scrollResponderHandleStartShouldSetResponderCapture,onScrollShouldSetResponder:this.scrollResponderHandleScrollShouldSetResponder,onScroll:this._handleScroll,onResponderGrant:this.scrollResponderHandleResponderGrant,onResponderTerminationRequest:this.scrollResponderHandleTerminationRequest,onResponderTerminate:this.scrollResponderHandleTerminate,onResponderRelease:this.scrollResponderHandleResponderRelease,onResponderReject:this.scrollResponderHandleResponderReject}),te=d5;Qt(te!==void 0,"ScrollViewClass must not be undefined");var X=Sn.createElement(te,Ci({},be,{ref:this._setScrollNodeRef}),q);return _?Sn.cloneElement(_,{style:be.style},X):X}}var cC={flexGrow:1,flexShrink:1,transform:"translateZ(0)",WebkitOverflowScrolling:"touch"},ml=en.create({baseVertical:er(er({},cC),{},{flexDirection:"column",overflowX:"hidden",overflowY:"auto"}),baseHorizontal:er(er({},cC),{},{flexDirection:"row",overflowX:"auto",overflowY:"hidden"}),contentContainerHorizontal:{flexDirection:"row"},contentContainerCenterContent:{justifyContent:"center",flexGrow:1},stickyHeader:{position:"sticky",top:0,zIndex:10},pagingEnabledHorizontal:{scrollSnapType:"x mandatory"},pagingEnabledVertical:{scrollSnapType:"y mandatory"},pagingEnabledChild:{scrollSnapAlign:"start"}}),X0=Sn.forwardRef((t,r)=>Sn.createElement(x5,Ci({},t,{forwardedRef:r})));X0.displayName="ScrollView";class b5{constructor(r){var o=r.onMoreTasks;this._onMoreTasks=o,this._queueStack=[{tasks:[],popable:!0}]}enqueue(r){this._getCurrentQueue().push(r)}enqueueTasks(r){r.forEach(o=>this.enqueue(o))}cancelTasks(r){this._queueStack=this._queueStack.map(o=>er(er({},o),{},{tasks:o.tasks.filter(u=>r.indexOf(u)===-1)})).filter((o,u)=>o.tasks.length>0||u===0)}hasTasksToProcess(){return this._getCurrentQueue().length>0}processNext(){var r=this._getCurrentQueue();if(r.length){var o=r.shift();try{typeof o=="object"&&o.gen?this._genPromise(o):typeof o=="object"&&o.run?o.run():(Qt(typeof o=="function",`Expected Function, SimpleTask, or PromiseTask, but got:
`+JSON.stringify(o,null,2)),o())}catch(u){throw u.message="TaskQueue: Error with task "+(o.name||"")+": "+u.message,u}}}_getCurrentQueue(){var r=this._queueStack.length-1,o=this._queueStack[r];return o.popable&&o.tasks.length===0&&r>0?(this._queueStack.pop(),this._getCurrentQueue()):o.tasks}_genPromise(r){var o=this._queueStack.push({tasks:[],popable:!1}),u=o-1,f=this._queueStack[u];r.gen().then(()=>{f.popable=!0,this.hasTasksToProcess()&&this._onMoreTasks()}).catch(_=>{setTimeout(()=>{throw _.message="TaskQueue: Error resolving Promise in task "+r.name+": "+_.message,_},0)})}}class w5{constructor(){this._registry={}}addListener(r,o,u){var f=S5(this._registry,r),_={context:u,listener:o,remove(){f.delete(_)}};return f.add(_),_}emit(r){var o=this._registry[r];if(o!=null){for(var u=arguments.length,f=new Array(u>1?u-1:0),_=1;_<u;_++)f[_-1]=arguments[_];for(var b=0,T=[...o];b<T.length;b++){var a=T[b];a.listener.apply(a.context,f)}}}removeAllListeners(r){r==null?this._registry={}:delete this._registry[r]}listenerCount(r){var o=this._registry[r];return o==null?0:o.size}}function S5(t,r){var o=t[r];return o==null&&(o=new Set,t[r]=o),o}var T5=function(r,o){return setTimeout(()=>{var u=Date.now();r({didTimeout:!1,timeRemaining(){return Math.max(0,50-(Date.now()-u))}})},1)},E5=js&&typeof window.requestIdleCallback<"u",C5=E5?window.requestIdleCallback:T5,d_=new w5,K0={Events:{interactionStart:"interactionStart",interactionComplete:"interactionComplete"},runAfterInteractions(t){var r=[],o=new Promise(u=>{jf(),t&&r.push(t),r.push({run:u,name:"resolve "+(t&&t.name||"?")}),p_.enqueueTasks(r)});return{then:o.then.bind(o),done:o.then.bind(o),cancel:()=>{p_.cancelTasks(r)}}},createInteractionHandle(){jf();var t=++k5;return f_.add(t),t},clearInteractionHandle(t){Qt(!!t,"Must provide a handle to clear."),jf(),f_.delete(t),Y0.add(t)},addListener:d_.addListener.bind(d_),setDeadline(t){m_=t}},hg=new Set,f_=new Set,Y0=new Set,p_=new b5({onMoreTasks:jf}),Lg=0,k5=0,m_=-1;function jf(){Lg||(m_>0?Lg=setTimeout(hC):Lg=C5(hC))}function hC(){Lg=0;var t=hg.size;f_.forEach(u=>hg.add(u)),Y0.forEach(u=>hg.delete(u));var r=hg.size;if(t!==0&&r===0?d_.emit(K0.Events.interactionComplete):t===0&&r!==0&&d_.emit(K0.Events.interactionStart),r===0){for(var o=Date.now();p_.hasTasksToProcess();)if(p_.processNext(),m_>0&&Date.now()-o>=m_){jf();break}}f_.clear(),Y0.clear()}class I5{constructor(r,o){this._delay=o,this._callback=r}dispose(r){r===void 0&&(r={abort:!1}),this._taskHandle&&(this._taskHandle.cancel(),r.abort||this._callback(),this._taskHandle=null)}schedule(){if(!this._taskHandle){var r=setTimeout(()=>{this._taskHandle=K0.runAfterInteractions(()=>{this._taskHandle=null,this._callback()})},this._delay);this._taskHandle={cancel:()=>clearTimeout(r)}}}}function dC(t,r,o){return r<t?t:r>o?o:r}function A5(){return console.log(...arguments)}class M5{constructor(r){Qt(r>=0,"CellRenderMask must contain a non-negative number os cells"),this._numCells=r,r===0?this._regions=[]:this._regions=[{first:0,last:r-1,isSpacer:!0}]}enumerateRegions(){return this._regions}addCells(r){if(Qt(r.first>=0&&r.first<this._numCells&&r.last>=-1&&r.last<this._numCells&&r.last>=r.first-1,"CellRenderMask.addCells called with invalid cell range"),!(r.last<r.first)){var o=this._findRegion(r.first),u=o[0],f=o[1],_=this._findRegion(r.last),b=_[0],T=_[1];if(!(f===T&&!u.isSpacer)){var a=[],I=[],D=er(er({},r),{},{isSpacer:!1});u.first<D.first&&(u.isSpacer?a.push({first:u.first,last:D.first-1,isSpacer:!0}):D.first=u.first),b.last>D.last&&(b.isSpacer?I.push({first:D.last+1,last:b.last,isSpacer:!0}):D.last=b.last);var j=[...a,D,...I],V=T-f+1;this._regions.splice(f,V,...j)}}}numCells(){return this._numCells}equals(r){return this._numCells===r._numCells&&this._regions.length===r._regions.length&&this._regions.every((o,u)=>o.first===r._regions[u].first&&o.last===r._regions[u].last&&o.isSpacer===r._regions[u].isSpacer)}_findRegion(r){for(var o=0,u=this._regions.length-1;o<=u;){var f=Math.floor((o+u)/2),_=this._regions[f];if(r>=_.first&&r<=_.last)return[_,f];r<_.first?u=f-1:r>_.last&&(o=f+1)}Qt(!1,"A region was not found containing cellIdx "+r)}}class P5{constructor(){this._cellKeyToChildren=new Map,this._childrenToCellKey=new Map}add(r,o){var u;Qt(!this._childrenToCellKey.has(r),"Trying to add already present child list");var f=(u=this._cellKeyToChildren.get(o))!==null&&u!==void 0?u:new Set;f.add(r),this._cellKeyToChildren.set(o,f),this._childrenToCellKey.set(r,o)}remove(r){var o=this._childrenToCellKey.get(r);Qt(o!=null,"Trying to remove non-present child list"),this._childrenToCellKey.delete(r);var u=this._cellKeyToChildren.get(o);Qt(u,"_cellKeyToChildren should contain cellKey"),u.delete(r),u.size===0&&this._cellKeyToChildren.delete(o)}forEach(r){for(var o=Nu(this._cellKeyToChildren.values()),u;!(u=o()).done;)for(var f=u.value,_=Nu(f),b;!(b=_()).done;){var T=b.value;r(T)}}forEachInCell(r,o){for(var u,f=(u=this._cellKeyToChildren.get(r))!==null&&u!==void 0?u:[],_=Nu(f),b;!(b=_()).done;){var T=b.value;o(T)}}anyInCell(r,o){for(var u,f=(u=this._cellKeyToChildren.get(r))!==null&&u!==void 0?u:[],_=Nu(f),b;!(b=_()).done;){var T=b.value;if(o(T))return!0}return!1}size(){return this._childrenToCellKey.size}}class fC{constructor(){this.any_blank_count=0,this.any_blank_ms=0,this.any_blank_speed_sum=0,this.mostly_blank_count=0,this.mostly_blank_ms=0,this.pixels_blank=0,this.pixels_sampled=0,this.pixels_scrolled=0,this.total_time_spent=0,this.sample_count=0}}var dg=[],pC=10,yx=null;class R5{static addListener(r){return yx===null&&console.warn("Call `FillRateHelper.setSampleRate` before `addListener`."),dg.push(r),{remove:()=>{dg=dg.filter(o=>r!==o)}}}static setSampleRate(r){yx=r}static setMinSampleCount(r){pC=r}constructor(r){this._anyBlankStartTime=null,this._enabled=!1,this._info=new fC,this._mostlyBlankStartTime=null,this._samplesStartTime=null,this._getFrameMetrics=r,this._enabled=(yx||0)>Math.random(),this._resetData()}activate(){this._enabled&&this._samplesStartTime==null&&(this._samplesStartTime=global.performance.now())}deactivateAndFlush(){if(this._enabled){var r=this._samplesStartTime;if(r!=null){if(this._info.sample_count<pC){this._resetData();return}var o=global.performance.now()-r,u=er(er({},this._info),{},{total_time_spent:o});dg.forEach(f=>f(u)),this._resetData()}}}computeBlankness(r,o,u){if(!this._enabled||r.getItemCount(r.data)===0||o.last<o.first||this._samplesStartTime==null)return 0;var f=u.dOffset,_=u.offset,b=u.velocity,T=u.visibleLength;this._info.sample_count++,this._info.pixels_sampled+=Math.round(T),this._info.pixels_scrolled+=Math.round(Math.abs(f));var a=Math.round(Math.abs(b)*1e3),I=global.performance.now();this._anyBlankStartTime!=null&&(this._info.any_blank_ms+=I-this._anyBlankStartTime),this._anyBlankStartTime=null,this._mostlyBlankStartTime!=null&&(this._info.mostly_blank_ms+=I-this._mostlyBlankStartTime),this._mostlyBlankStartTime=null;for(var D=0,j=o.first,V=this._getFrameMetrics(j,r);j<=o.last&&(!V||!V.inLayout);)V=this._getFrameMetrics(j,r),j++;V&&j>0&&(D=Math.min(T,Math.max(0,V.offset-_)));for(var q=0,se=o.last,pe=this._getFrameMetrics(se,r);se>=o.first&&(!pe||!pe.inLayout);)pe=this._getFrameMetrics(se,r),se--;if(pe&&se<r.getItemCount(r.data)-1){var be=pe.offset+pe.length;q=Math.min(T,Math.max(0,_+T-be))}var te=Math.round(D+q),X=te/T;return X>0?(this._anyBlankStartTime=I,this._info.any_blank_speed_sum+=a,this._info.any_blank_count++,this._info.pixels_blank+=te,X>.5&&(this._mostlyBlankStartTime=I,this._info.mostly_blank_count++)):(a<.01||Math.abs(f)<1)&&this.deactivateAndFlush(),X}enabled(){return this._enabled}_resetData(){this._anyBlankStartTime=null,this._info=new fC,this._mostlyBlankStartTime=null,this._samplesStartTime=null}}class L5 extends ve.PureComponent{constructor(r){super(r),this._inAsyncStateUpdate=!1,this._installSetStateHooks()}setState(r,o){typeof r=="function"?super.setState((u,f)=>{this._inAsyncStateUpdate=!0;var _;try{_=r(u,f)}catch(b){throw b}finally{this._inAsyncStateUpdate=!1}return _},o):super.setState(r,o)}_installSetStateHooks(){var r=this,o=this.props,u=this.state;Object.defineProperty(this,"props",{get(){return Qt(!r._inAsyncStateUpdate,'"this.props" should not be accessed during state updates'),o},set(f){o=f}}),Object.defineProperty(this,"state",{get(){return Qt(!r._inAsyncStateUpdate,'"this.state" should not be acceessed during state updates'),u},set(f){u=f}})}}class mC{constructor(r){r===void 0&&(r={viewAreaCoveragePercentThreshold:0}),this._hasInteracted=!1,this._timers=new Set,this._viewableIndices=[],this._viewableItems=new Map,this._config=r}dispose(){this._timers.forEach(clearTimeout)}computeViewableItems(r,o,u,f,_){var b=r.getItemCount(r.data),T=this._config,a=T.itemVisiblePercentThreshold,I=T.viewAreaCoveragePercentThreshold,D=I!=null,j=D?I:a;Qt(j!=null&&a!=null!=(I!=null),"Must set exactly one of itemVisiblePercentThreshold or viewAreaCoveragePercentThreshold");var V=[];if(b===0)return V;var q=-1,se=_||{first:0,last:b-1},pe=se.first,be=se.last;if(be>=b)return console.warn("Invalid render range computing viewability "+JSON.stringify({renderRange:_,itemCount:b})),[];for(var te=pe;te<=be;te++){var X=f(te,r);if(X){var ie=X.offset-o,Se=ie+X.length;if(ie<u&&Se>0)q=te,z5(D,j,ie,Se,u,X.length)&&V.push(te);else if(q>=0)break}}return V}onUpdate(r,o,u,f,_,b,T){var a=r.getItemCount(r.data);if(!(this._config.waitForInteraction&&!this._hasInteracted||a===0||!f(0,r))){var I=[];if(a&&(I=this.computeViewableItems(r,o,u,f,T)),!(this._viewableIndices.length===I.length&&this._viewableIndices.every((j,V)=>j===I[V])))if(this._viewableIndices=I,this._config.minimumViewTime){var D=setTimeout(()=>{this._timers.delete(D),this._onUpdateSync(r,I,b,_)},this._config.minimumViewTime);this._timers.add(D)}else this._onUpdateSync(r,I,b,_)}}resetViewableIndices(){this._viewableIndices=[]}recordInteraction(){this._hasInteracted=!0}_onUpdateSync(r,o,u,f){o=o.filter(X=>this._viewableIndices.includes(X));for(var _=this._viewableItems,b=new Map(o.map(X=>{var ie=f(X,!0,r);return[ie.key,ie]})),T=[],a=Nu(b),I;!(I=a()).done;){var D=I.value,j=D[0],V=D[1];_.has(j)||T.push(V)}for(var q=Nu(_),se;!(se=q()).done;){var pe=se.value,be=pe[0],te=pe[1];b.has(be)||T.push(er(er({},te),{},{isViewable:!1}))}T.length>0&&(this._viewableItems=b,u({viewableItems:Array.from(b.values()),changed:T,viewabilityConfig:this._config}))}}function z5(t,r,o,u,f,_){if(O5(o,u,f))return!0;var b=D5(o,u,f),T=100*(t?b/f:b/_);return T>=r}function D5(t,r,o){var u=Math.min(r,o)-Math.max(t,0);return Math.max(0,u)}function O5(t,r,o){return t>=0&&r<=o&&r>t}var g_=ve.createContext(null);function B5(t){var r=t.children,o=t.value,u=ve.useMemo(()=>({cellKey:null,getScrollMetrics:o.getScrollMetrics,horizontal:o.horizontal,getOutermostParentListRef:o.getOutermostParentListRef,registerAsNestedChild:o.registerAsNestedChild,unregisterAsNestedChild:o.unregisterAsNestedChild}),[o.getScrollMetrics,o.horizontal,o.getOutermostParentListRef,o.registerAsNestedChild,o.unregisterAsNestedChild]);return ve.createElement(g_.Provider,{value:u},r)}function zg(t){var r=t.cellKey,o=t.children,u=ve.useContext(g_),f=ve.useMemo(()=>u==null?null:er(er({},u),{},{cellKey:r}),[u,r]);return ve.createElement(g_.Provider,{value:f},o)}class F5 extends ve.Component{constructor(){super(...arguments),this.state={separatorProps:{highlighted:!1,leadingItem:this.props.item}},this._separators={highlight:()=>{var r=this.props,o=r.cellKey,u=r.prevCellKey;this.props.onUpdateSeparators([o,u],{highlighted:!0})},unhighlight:()=>{var r=this.props,o=r.cellKey,u=r.prevCellKey;this.props.onUpdateSeparators([o,u],{highlighted:!1})},updateProps:(r,o)=>{var u=this.props,f=u.cellKey,_=u.prevCellKey;this.props.onUpdateSeparators([r==="leading"?_:f],o)}},this._onLayout=r=>{this.props.onCellLayout&&this.props.onCellLayout(r,this.props.cellKey,this.props.index)}}static getDerivedStateFromProps(r,o){return{separatorProps:er(er({},o.separatorProps),{},{leadingItem:r.item})}}updateSeparatorProps(r){this.setState(o=>({separatorProps:er(er({},o.separatorProps),r)}))}componentWillUnmount(){this.props.onUnmount(this.props.cellKey)}_renderElement(r,o,u,f){if(r&&o&&console.warn("VirtualizedList: Both ListItemComponent and renderItem props are present. ListItemComponent will take precedence over renderItem."),o)return ve.createElement(o,{item:u,index:f,separators:this._separators});if(r)return r({item:u,index:f,separators:this._separators});Qt(!1,"VirtualizedList: Either ListItemComponent or renderItem props are required but none were found.")}render(){var r=this.props,o=r.CellRendererComponent,u=r.ItemSeparatorComponent,f=r.ListItemComponent,_=r.cellKey,b=r.horizontal,T=r.item,a=r.index,I=r.inversionStyle,D=r.onCellFocusCapture,j=r.onCellLayout,V=r.renderItem,q=this._renderElement(V,f,T,a),se=ve.isValidElement(u)?u:u&&ve.createElement(u,this.state.separatorProps),pe=I?b?[vx.rowReverse,I]:[vx.columnReverse,I]:b?[vx.row,I]:I,be=o?ve.createElement(o,Ci({cellKey:_,index:a,item:T,style:pe,onFocusCapture:D},j&&{onLayout:this._onLayout}),q,se):ve.createElement(Rt,Ci({style:pe,onFocusCapture:D},j&&{onLayout:this._onLayout}),q,se);return ve.createElement(zg,{cellKey:this.props.cellKey},be)}}var vx=en.create({row:{flexDirection:"row"},rowReverse:{flexDirection:"row-reverse"},columnReverse:{flexDirection:"column-reverse"}});function j5(t,r,o,u){u===void 0&&(u=1);for(var f=r.getItemCount(r.data),_=[],b=0;b<t.length;b++)for(var T=t[b],a=0,I=f-1;a<=I;){var D=a+(I-a>>>1),j=o(D,r),V=j.offset*u,q=(j.offset+j.length)*u;if(D===0&&T<V||D!==0&&T<=V)I=D-1;else if(T>q)a=D+1;else{_[b]=D;break}}return _}function N5(t,r){return r.last-r.first+1-Math.max(0,1+Math.min(r.last,t.last)-Math.max(r.first,t.first))}function U5(t,r,o,u,f,_){var b=t.getItemCount(t.data);if(b===0)return{first:0,last:-1};var T=_.offset,a=_.velocity,I=_.visibleLength,D=_.zoomScale,j=D===void 0?1:D,V=Math.max(0,T),q=V+I,se=(o-1)*I,pe=.5,be=a>1?"after":a<-1?"before":"none",te=Math.max(0,V-(1-pe)*se),X=Math.max(0,q+pe*se),ie=f(b-1,t).offset*j;if(ie<te)return{first:Math.max(0,b-1-r),last:b-1};var Se=j5([te,V,q,X],t,f,j),Ce=Se[0],Le=Se[1],Ne=Se[2],qe=Se[3];Ce=Ce??0,Le=Le??Math.max(0,Ce),qe=qe??b-1,Ne=Ne??Math.min(qe,Le+r-1);for(var it={first:Le,last:Ne},Ae=N5(u,it);!(Le<=Ce&&Ne>=qe);){var Tt=Ae>=r,$t=Le<=u.first||Le>u.last,pt=Le>Ce&&(!Tt||!$t),Kt=Ne>=u.last||Ne<u.first,Dr=Ne<qe&&(!Tt||!Kt);if(Tt&&!pt&&!Dr)break;pt&&!(be==="after"&&Dr&&Kt)&&($t&&Ae++,Le--),Dr&&!(be==="before"&&pt&&$t)&&(Kt&&Ae++,Ne++)}if(!(Ne>=Le&&Le>=0&&Ne<b&&Le>=Ce&&Ne<=qe&&Le<=it.first&&Ne>=it.last))throw new Error("Bad window calculation "+JSON.stringify({first:Le,last:Ne,itemCount:b,overscanFirst:Ce,overscanLast:qe,visible:it}));return{first:Le,last:Ne}}function J0(t,r){return typeof t=="object"&&(t==null?void 0:t.key)!=null?t.key:typeof t=="object"&&(t==null?void 0:t.id)!=null?t.id:String(r)}var V_={exports:{}};function mM(t,r){if(t!=null)return t;var o=new Error(r!==void 0?r:"Got unexpected "+t);throw o.framesToPop=1,o}V_.exports=mM;V_.exports.default=mM;Object.defineProperty(V_.exports,"__esModule",{value:!0});var V5=V_.exports;const $5=Dh(V5);var gC=.001,xx=!1,bx="";function Au(t){return t??!1}function G5(t){return t??10}function wx(t){return t??10}function W5(t){return t??2}function _C(t){return t??2}function yC(t,r){return t*r/2}function q5(t){return t??50}function vC(t){return t??21}function H5(t,r){for(var o=t.length-1;o>=0;o--)if(r(t[o]))return t[o];return null}class Ps extends L5{scrollToEnd(r){var o=r?r.animated:!0,u=this.props.getItemCount(this.props.data)-1;if(!(u<0)){var f=this.__getFrameMetricsApprox(u,this.props),_=Math.max(0,f.offset+f.length+this._footerLength-this._scrollMetrics.visibleLength);if(this._scrollRef!=null){if(this._scrollRef.scrollTo==null){console.warn("No scrollTo method provided. This may be because you have two nested VirtualizedLists with the same orientation, or because you are using a custom component that does not implement scrollTo.");return}this._scrollRef.scrollTo(Au(this.props.horizontal)?{x:_,animated:o}:{y:_,animated:o})}}}scrollToIndex(r){var o=this.props,u=o.data,f=o.horizontal,_=o.getItemCount,b=o.getItemLayout,T=o.onScrollToIndexFailed,a=r.animated,I=r.index,D=r.viewOffset,j=r.viewPosition;if(Qt(I>=0,"scrollToIndex out of range: requested index "+I+" but minimum is 0"),Qt(_(u)>=1,"scrollToIndex out of range: item length "+_(u)+" but minimum is 1"),Qt(I<_(u),"scrollToIndex out of range: requested index "+I+" is out of 0 to "+(_(u)-1)),!b&&I>this._highestMeasuredFrameIndex){Qt(!!T,"scrollToIndex should be used in conjunction with getItemLayout or onScrollToIndexFailed, otherwise there is no way to know the location of offscreen indices or handle failures."),T({averageItemLength:this._averageCellLength,highestMeasuredFrameIndex:this._highestMeasuredFrameIndex,index:I});return}var V=this.__getFrameMetricsApprox(Math.floor(I),this.props),q=Math.max(0,this._getOffsetApprox(I,this.props)-(j||0)*(this._scrollMetrics.visibleLength-V.length))-(D||0);if(this._scrollRef!=null){if(this._scrollRef.scrollTo==null){console.warn("No scrollTo method provided. This may be because you have two nested VirtualizedLists with the same orientation, or because you are using a custom component that does not implement scrollTo.");return}this._scrollRef.scrollTo(f?{x:q,animated:a}:{y:q,animated:a})}}scrollToItem(r){for(var o=r.item,u=this.props,f=u.data,_=u.getItem,b=u.getItemCount,T=b(f),a=0;a<T;a++)if(_(f,a)===o){this.scrollToIndex(er(er({},r),{},{index:a}));break}}scrollToOffset(r){var o=r.animated,u=r.offset;if(this._scrollRef!=null){if(this._scrollRef.scrollTo==null){console.warn("No scrollTo method provided. This may be because you have two nested VirtualizedLists with the same orientation, or because you are using a custom component that does not implement scrollTo.");return}this._scrollRef.scrollTo(Au(this.props.horizontal)?{x:u,animated:o}:{y:u,animated:o})}}recordInteraction(){this._nestedChildLists.forEach(r=>{r.recordInteraction()}),this._viewabilityTuples.forEach(r=>{r.viewabilityHelper.recordInteraction()}),this._updateViewableItems(this.props,this.state.cellsAroundViewport)}flashScrollIndicators(){this._scrollRef!=null&&this._scrollRef.flashScrollIndicators()}getScrollResponder(){if(this._scrollRef&&this._scrollRef.getScrollResponder)return this._scrollRef.getScrollResponder()}getScrollableNode(){return this._scrollRef&&this._scrollRef.getScrollableNode?this._scrollRef.getScrollableNode():this._scrollRef}getScrollRef(){return this._scrollRef&&this._scrollRef.getScrollRef?this._scrollRef.getScrollRef():this._scrollRef}_getCellKey(){var r;return((r=this.context)==null?void 0:r.cellKey)||"rootList"}hasMore(){return this._hasMore}constructor(r){var o;if(super(r),this._getScrollMetrics=()=>this._scrollMetrics,this._getOutermostParentListRef=()=>this._isNestedWithSameOrientation()?this.context.getOutermostParentListRef():this,this._registerAsNestedChild=T=>{this._nestedChildLists.add(T.ref,T.cellKey),this._hasInteracted&&T.ref.recordInteraction()},this._unregisterAsNestedChild=T=>{this._nestedChildLists.remove(T.ref)},this._onUpdateSeparators=(T,a)=>{T.forEach(I=>{var D=I!=null&&this._cellRefs[I];D&&D.updateSeparatorProps(a)})},this._getSpacerKey=T=>T?"height":"width",this._averageCellLength=0,this._cellRefs={},this._frames={},this._footerLength=0,this._hasTriggeredInitialScrollToIndex=!1,this._hasInteracted=!1,this._hasMore=!1,this._hasWarned={},this._headerLength=0,this._hiPriInProgress=!1,this._highestMeasuredFrameIndex=0,this._indicesToKeys=new Map,this._lastFocusedCellKey=null,this._nestedChildLists=new P5,this._offsetFromParentVirtualizedList=0,this._prevParentOffset=0,this._scrollMetrics={contentLength:0,dOffset:0,dt:10,offset:0,timestamp:0,velocity:0,visibleLength:0,zoomScale:1},this._scrollRef=null,this._sentStartForContentLength=0,this._sentEndForContentLength=0,this._totalCellLength=0,this._totalCellsMeasured=0,this._viewabilityTuples=[],this._captureScrollRef=T=>{this._scrollRef=T},this._defaultRenderScrollComponent=T=>{var a=T.onRefresh;if(this._isNestedWithSameOrientation())return ve.createElement(Rt,T);if(a){var I;return Qt(typeof T.refreshing=="boolean","`refreshing` prop must be set as a boolean in order to use `onRefresh`, but got `"+JSON.stringify((I=T.refreshing)!==null&&I!==void 0?I:"undefined")+"`"),ve.createElement(X0,Ci({},T,{refreshControl:T.refreshControl==null?ve.createElement(l5,{refreshing:T.refreshing,onRefresh:a,progressViewOffset:T.progressViewOffset}):T.refreshControl}))}else return ve.createElement(X0,T)},this._onCellLayout=(T,a,I)=>{var D=T.nativeEvent.layout,j={offset:this._selectOffset(D),length:this._selectLength(D),index:I,inLayout:!0},V=this._frames[a];!V||j.offset!==V.offset||j.length!==V.length||I!==V.index?(this._totalCellLength+=j.length-(V?V.length:0),this._totalCellsMeasured+=V?0:1,this._averageCellLength=this._totalCellLength/this._totalCellsMeasured,this._frames[a]=j,this._highestMeasuredFrameIndex=Math.max(this._highestMeasuredFrameIndex,I),this._scheduleCellsToRenderUpdate()):this._frames[a].inLayout=!0,this._triggerRemeasureForChildListsInCell(a),this._computeBlankness(),this._updateViewableItems(this.props,this.state.cellsAroundViewport)},this._onCellUnmount=T=>{delete this._cellRefs[T];var a=this._frames[T];a&&(this._frames[T]=er(er({},a),{},{inLayout:!1}))},this._onLayout=T=>{this._isNestedWithSameOrientation()?this.measureLayoutRelativeToContainingList():this._scrollMetrics.visibleLength=this._selectLength(T.nativeEvent.layout),this.props.onLayout&&this.props.onLayout(T),this._scheduleCellsToRenderUpdate(),this._maybeCallOnEdgeReached()},this._onLayoutEmpty=T=>{this.props.onLayout&&this.props.onLayout(T)},this._onLayoutFooter=T=>{this._triggerRemeasureForChildListsInCell(this._getFooterCellKey()),this._footerLength=this._selectLength(T.nativeEvent.layout)},this._onLayoutHeader=T=>{this._headerLength=this._selectLength(T.nativeEvent.layout)},this._onContentSizeChange=(T,a)=>{T>0&&a>0&&this.props.initialScrollIndex!=null&&this.props.initialScrollIndex>0&&!this._hasTriggeredInitialScrollToIndex&&(this.props.contentOffset==null&&(this.props.initialScrollIndex<this.props.getItemCount(this.props.data)?this.scrollToIndex({animated:!1,index:$5(this.props.initialScrollIndex)}):this.scrollToEnd({animated:!1})),this._hasTriggeredInitialScrollToIndex=!0),this.props.onContentSizeChange&&this.props.onContentSizeChange(T,a),this._scrollMetrics.contentLength=this._selectLength({height:a,width:T}),this._scheduleCellsToRenderUpdate(),this._maybeCallOnEdgeReached()},this._convertParentScrollMetrics=T=>{var a=T.offset-this._offsetFromParentVirtualizedList,I=T.visibleLength,D=a-this._scrollMetrics.offset,j=this._scrollMetrics.contentLength;return{visibleLength:I,contentLength:j,offset:a,dOffset:D}},this._onScroll=T=>{this._nestedChildLists.forEach(te=>{te._onScroll(T)}),this.props.onScroll&&this.props.onScroll(T);var a=T.timeStamp,I=this._selectLength(T.nativeEvent.layoutMeasurement),D=this._selectLength(T.nativeEvent.contentSize),j=this._selectOffset(T.nativeEvent.contentOffset),V=j-this._scrollMetrics.offset;if(this._isNestedWithSameOrientation()){if(this._scrollMetrics.contentLength===0)return;var q=this._convertParentScrollMetrics({visibleLength:I,offset:j});I=q.visibleLength,D=q.contentLength,j=q.offset,V=q.dOffset}var se=this._scrollMetrics.timestamp?Math.max(1,a-this._scrollMetrics.timestamp):1,pe=V/se;se>500&&this._scrollMetrics.dt>500&&D>5*I&&!this._hasWarned.perf&&(A5("VirtualizedList: You have a large list that is slow to update - make sure your renderItem function renders components that follow React performance best practices like PureComponent, shouldComponentUpdate, etc.",{dt:se,prevDt:this._scrollMetrics.dt,contentLength:D}),this._hasWarned.perf=!0);var be=T.nativeEvent.zoomScale<0?1:T.nativeEvent.zoomScale;this._scrollMetrics={contentLength:D,dt:se,dOffset:V,offset:j,timestamp:a,velocity:pe,visibleLength:I,zoomScale:be},this._updateViewableItems(this.props,this.state.cellsAroundViewport),this.props&&(this._maybeCallOnEdgeReached(),pe!==0&&this._fillRateHelper.activate(),this._computeBlankness(),this._scheduleCellsToRenderUpdate())},this._onScrollBeginDrag=T=>{this._nestedChildLists.forEach(a=>{a._onScrollBeginDrag(T)}),this._viewabilityTuples.forEach(a=>{a.viewabilityHelper.recordInteraction()}),this._hasInteracted=!0,this.props.onScrollBeginDrag&&this.props.onScrollBeginDrag(T)},this._onScrollEndDrag=T=>{this._nestedChildLists.forEach(I=>{I._onScrollEndDrag(T)});var a=T.nativeEvent.velocity;a&&(this._scrollMetrics.velocity=this._selectOffset(a)),this._computeBlankness(),this.props.onScrollEndDrag&&this.props.onScrollEndDrag(T)},this._onMomentumScrollBegin=T=>{this._nestedChildLists.forEach(a=>{a._onMomentumScrollBegin(T)}),this.props.onMomentumScrollBegin&&this.props.onMomentumScrollBegin(T)},this._onMomentumScrollEnd=T=>{this._nestedChildLists.forEach(a=>{a._onMomentumScrollEnd(T)}),this._scrollMetrics.velocity=0,this._computeBlankness(),this.props.onMomentumScrollEnd&&this.props.onMomentumScrollEnd(T)},this._updateCellsToRender=()=>{this._updateViewableItems(this.props,this.state.cellsAroundViewport),this.setState((T,a)=>{var I=this._adjustCellsAroundViewport(a,T.cellsAroundViewport),D=Ps._createRenderMask(a,I,this._getNonViewportRenderRegions(a));return I.first===T.cellsAroundViewport.first&&I.last===T.cellsAroundViewport.last&&D.equals(T.renderMask)?null:{cellsAroundViewport:I,renderMask:D}})},this._createViewToken=(T,a,I)=>{var D=I.data,j=I.getItem,V=j(D,T);return{index:T,item:V,key:this._keyExtractor(V,T,I),isViewable:a}},this._getOffsetApprox=(T,a)=>{if(Number.isInteger(T))return this.__getFrameMetricsApprox(T,a).offset;var I=this.__getFrameMetricsApprox(Math.floor(T),a),D=T-Math.floor(T);return I.offset+D*I.length},this.__getFrameMetricsApprox=(T,a)=>{var I=this._getFrameMetrics(T,a);if(I&&I.index===T)return I;var D=a.data,j=a.getItemCount,V=a.getItemLayout;return Qt(T>=0&&T<j(D),"Tried to get frame for out of range index "+T),Qt(!V,"Should not have to estimate frames when a measurement metrics function is provided"),{length:this._averageCellLength,offset:this._averageCellLength*T}},this._getFrameMetrics=(T,a)=>{var I=a.data,D=a.getItem,j=a.getItemCount,V=a.getItemLayout;Qt(T>=0&&T<j(I),"Tried to get frame for out of range index "+T);var q=D(I,T),se=this._frames[this._keyExtractor(q,T,a)];return(!se||se.index!==T)&&V?V(I,T):se},this._getNonViewportRenderRegions=T=>{if(!(this._lastFocusedCellKey&&this._cellRefs[this._lastFocusedCellKey]))return[];var a=this._cellRefs[this._lastFocusedCellKey],I=a.props.index,D=T.getItemCount(T.data);if(I>=D||this._keyExtractor(T.getItem(T.data,I),I,T)!==this._lastFocusedCellKey)return[];for(var j=I,V=0,q=j-1;q>=0&&V<this._scrollMetrics.visibleLength;q--)j--,V+=this.__getFrameMetricsApprox(q,T).length;for(var se=I,pe=0,be=se+1;be<D&&pe<this._scrollMetrics.visibleLength;be++)se++,pe+=this.__getFrameMetricsApprox(be,T).length;return[{first:j,last:se}]},this._checkProps(r),this._fillRateHelper=new R5(this._getFrameMetrics),this._updateCellsToRenderBatcher=new I5(this._updateCellsToRender,(o=this.props.updateCellsBatchingPeriod)!==null&&o!==void 0?o:50),this.props.viewabilityConfigCallbackPairs)this._viewabilityTuples=this.props.viewabilityConfigCallbackPairs.map(T=>({viewabilityHelper:new mC(T.viewabilityConfig),onViewableItemsChanged:T.onViewableItemsChanged}));else{var u=this.props,f=u.onViewableItemsChanged,_=u.viewabilityConfig;f&&this._viewabilityTuples.push({viewabilityHelper:new mC(_),onViewableItemsChanged:f})}var b=Ps._initialRenderRegion(r);this.state={cellsAroundViewport:b,renderMask:Ps._createRenderMask(r,b)},this.invertedWheelEventHandler=T=>{var a=this.props.horizontal?T.target.scrollLeft:T.target.scrollTop,I=this.props.horizontal?T.target.scrollWidth:T.target.scrollHeight,D=this.props.horizontal?T.target.clientWidth:T.target.clientHeight,j=I>D,V=this.props.horizontal?T.deltaX||T.wheelDeltaX:T.deltaY||T.wheelDeltaY,q=V;j&&(q=V<0?Math.min(V+a,0):Math.max(V-(I-D-a),0));var se=V-q;if(this.props.inverted&&this._scrollRef&&this._scrollRef.getScrollableNode){var pe=this._scrollRef.getScrollableNode();if(this.props.horizontal){T.target.scrollLeft+=se;var be=pe.scrollLeft-q;pe.scrollLeft=this.props.getItemLayout?be:Math.min(be,this._totalCellLength)}else{T.target.scrollTop+=se;var te=pe.scrollTop-q;pe.scrollTop=this.props.getItemLayout?te:Math.min(te,this._totalCellLength)}T.preventDefault()}}}_checkProps(r){var o=r.onScroll,u=r.windowSize,f=r.getItemCount,_=r.data,b=r.initialScrollIndex;Qt(!o||!o.__isNative,"Components based on VirtualizedList must be wrapped with Animated.createAnimatedComponent to support native onScroll events with useNativeDriver"),Qt(vC(u)>0,"VirtualizedList: The windowSize prop must be present and set to a value greater than 0."),Qt(f,'VirtualizedList: The "getItemCount" prop must be provided');var T=f(_);b!=null&&!this._hasTriggeredInitialScrollToIndex&&(b<0||T>0&&b>=T)&&!this._hasWarned.initialScrollIndex&&(console.warn('initialScrollIndex "'+b+'" is not valid (list has '+T+" items)"),this._hasWarned.initialScrollIndex=!0)}static _createRenderMask(r,o,u){var f=r.getItemCount(r.data);Qt(o.first>=0&&o.last>=o.first-1&&o.last<f,'Invalid cells around viewport "['+o.first+", "+o.last+']" was passed to VirtualizedList._createRenderMask');var _=new M5(f);if(f>0){for(var b=[o,...u??[]],T=0,a=b;T<a.length;T++){var I=a[T];_.addCells(I)}if(r.initialScrollIndex==null||r.initialScrollIndex<=0){var D=Ps._initialRenderRegion(r);_.addCells(D)}var j=new Set(r.stickyHeaderIndices);Ps._ensureClosestStickyHeader(r,j,_,o.first)}return _}static _initialRenderRegion(r){var o,u=r.getItemCount(r.data),f=Math.max(0,Math.min(u-1,Math.floor((o=r.initialScrollIndex)!==null&&o!==void 0?o:0))),_=Math.min(u,f+G5(r.initialNumToRender))-1;return{first:f,last:_}}static _ensureClosestStickyHeader(r,o,u,f){for(var _=r.ListHeaderComponent?1:0,b=f-1;b>=0;b--)if(o.has(b+_)){u.addCells({first:b,last:b});break}}_adjustCellsAroundViewport(r,o){var u=r.data,f=r.getItemCount,_=_C(r.onEndReachedThreshold),b=this._scrollMetrics,T=b.contentLength,a=b.offset,I=b.visibleLength,D=T-I-a;if(I<=0||T<=0)return o.last>=f(u)?Ps._constrainToItemCount(o,r):o;var j;if(r.disableVirtualization){var V=D<_*I?wx(r.maxToRenderPerBatch):0;j={first:0,last:Math.min(o.last+V,f(u)-1)}}else{if(r.initialScrollIndex&&!this._scrollMetrics.offset&&Math.abs(D)>=Number.EPSILON)return o.last>=f(u)?Ps._constrainToItemCount(o,r):o;j=U5(r,wx(r.maxToRenderPerBatch),vC(r.windowSize),o,this.__getFrameMetricsApprox,this._scrollMetrics),Qt(j.last<f(u),"computeWindowedRenderLimits() should return range in-bounds")}if(this._nestedChildLists.size()>0){var q=this._findFirstChildWithMore(j.first,j.last);j.last=q??j.last}return j}_findFirstChildWithMore(r,o){for(var u=r;u<=o;u++){var f=this._indicesToKeys.get(u);if(f!=null&&this._nestedChildLists.anyInCell(f,_=>_.hasMore()))return u}return null}componentDidMount(){this._isNestedWithSameOrientation()&&this.context.registerAsNestedChild({ref:this,cellKey:this.context.cellKey}),this.setupWebWheelHandler()}componentWillUnmount(){this._isNestedWithSameOrientation()&&this.context.unregisterAsNestedChild({ref:this}),this._updateCellsToRenderBatcher.dispose({abort:!0}),this._viewabilityTuples.forEach(r=>{r.viewabilityHelper.dispose()}),this._fillRateHelper.deactivateAndFlush(),this.teardownWebWheelHandler()}setupWebWheelHandler(){if(this._scrollRef&&this._scrollRef.getScrollableNode)this._scrollRef.getScrollableNode().addEventListener("wheel",this.invertedWheelEventHandler);else{setTimeout(()=>this.setupWebWheelHandler(),50);return}}teardownWebWheelHandler(){this._scrollRef&&this._scrollRef.getScrollableNode&&this._scrollRef.getScrollableNode().removeEventListener("wheel",this.invertedWheelEventHandler)}static getDerivedStateFromProps(r,o){var u=r.getItemCount(r.data);if(u===o.renderMask.numCells())return o;var f=Ps._constrainToItemCount(o.cellsAroundViewport,r);return{cellsAroundViewport:f,renderMask:Ps._createRenderMask(r,f)}}_pushCells(r,o,u,f,_,b){var T=this,a=this.props,I=a.CellRendererComponent,D=a.ItemSeparatorComponent,j=a.ListHeaderComponent,V=a.ListItemComponent,q=a.data,se=a.debug,pe=a.getItem,be=a.getItemCount,te=a.getItemLayout,X=a.horizontal,ie=a.renderItem,Se=j?1:0,Ce=be(q)-1,Le;_=Math.min(Ce,_);for(var Ne=function(){var Ae=pe(q,qe),Tt=T._keyExtractor(Ae,qe,T.props);T._indicesToKeys.set(qe,Tt),u.has(qe+Se)&&o.push(r.length);var $t=te==null||se||T._fillRateHelper.enabled();r.push(ve.createElement(F5,Ci({CellRendererComponent:I,ItemSeparatorComponent:qe<Ce?D:void 0,ListItemComponent:V,cellKey:Tt,horizontal:X,index:qe,inversionStyle:b,item:Ae,key:Tt,prevCellKey:Le,onUpdateSeparators:T._onUpdateSeparators,onCellFocusCapture:pt=>T._onCellFocusCapture(Tt),onUnmount:T._onCellUnmount,ref:pt=>{T._cellRefs[Tt]=pt},renderItem:ie},$t&&{onCellLayout:T._onCellLayout}))),Le=Tt},qe=f;qe<=_;qe++)Ne()}static _constrainToItemCount(r,o){var u=o.getItemCount(o.data),f=Math.min(u-1,r.last),_=wx(o.maxToRenderPerBatch);return{first:dC(0,u-1-_,r.first),last:f}}_isNestedWithSameOrientation(){var r=this.context;return!!(r&&!!r.horizontal===Au(this.props.horizontal))}_keyExtractor(r,o,u){if(u.keyExtractor!=null)return u.keyExtractor(r,o);var f=J0(r,o);return f===String(o)&&(xx=!0,r.type&&r.type.displayName&&(bx=r.type.displayName)),f}render(){this._checkProps(this.props);var r=this.props,o=r.ListEmptyComponent,u=r.ListFooterComponent,f=r.ListHeaderComponent,_=this.props,b=_.data,T=_.horizontal,a=this.props.inverted?Au(this.props.horizontal)?co.horizontallyInverted:co.verticallyInverted:null,I=[],D=new Set(this.props.stickyHeaderIndices),j=[];if(f){D.has(0)&&j.push(0);var V=ve.isValidElement(f)?f:ve.createElement(f,null);I.push(ve.createElement(zg,{cellKey:this._getCellKey()+"-header",key:"$header"},ve.createElement(Rt,{onLayout:this._onLayoutHeader,style:[a,this.props.ListHeaderComponentStyle]},V)))}var q=this.props.getItemCount(b);if(q===0&&o){var se=ve.isValidElement(o)?o:ve.createElement(o,null);I.push(ve.createElement(zg,{cellKey:this._getCellKey()+"-empty",key:"$empty"},ve.cloneElement(se,{onLayout:Dr=>{this._onLayoutEmpty(Dr),se.props.onLayout&&se.props.onLayout(Dr)},style:[a,se.props.style]})))}if(q>0){xx=!1,bx="";for(var pe=this._getSpacerKey(!T),be=this.state.renderMask.enumerateRegions(),te=H5(be,Dr=>Dr.isSpacer),X=Nu(be),ie;!(ie=X()).done;){var Se=ie.value;if(Se.isSpacer){if(this.props.disableVirtualization)continue;var Ce=Se===te,Le=Ce&&!this.props.getItemLayout,Ne=Le?dC(Se.first-1,Se.last,this._highestMeasuredFrameIndex):Se.last,qe=this.__getFrameMetricsApprox(Se.first,this.props),it=this.__getFrameMetricsApprox(Ne,this.props),Ae=it.offset+it.length-qe.offset;I.push(ve.createElement(Rt,{key:"$spacer-"+Se.first,style:{[pe]:Ae}}))}else this._pushCells(I,j,D,Se.first,Se.last,a)}!this._hasWarned.keys&&xx&&(console.warn("VirtualizedList: missing keys for items, make sure to specify a key or id property on each item or provide a custom keyExtractor.",bx),this._hasWarned.keys=!0)}if(u){var Tt=ve.isValidElement(u)?u:ve.createElement(u,null);I.push(ve.createElement(zg,{cellKey:this._getFooterCellKey(),key:"$footer"},ve.createElement(Rt,{onLayout:this._onLayoutFooter,style:[a,this.props.ListFooterComponentStyle]},Tt)))}var $t=er(er({},this.props),{},{onContentSizeChange:this._onContentSizeChange,onLayout:this._onLayout,onScroll:this._onScroll,onScrollBeginDrag:this._onScrollBeginDrag,onScrollEndDrag:this._onScrollEndDrag,onMomentumScrollBegin:this._onMomentumScrollBegin,onMomentumScrollEnd:this._onMomentumScrollEnd,scrollEventThrottle:q5(this.props.scrollEventThrottle),invertStickyHeaders:this.props.invertStickyHeaders!==void 0?this.props.invertStickyHeaders:this.props.inverted,stickyHeaderIndices:j,style:a?[a,this.props.style]:this.props.style});this._hasMore=this.state.cellsAroundViewport.last<q-1;var pt=ve.createElement(B5,{value:{cellKey:null,getScrollMetrics:this._getScrollMetrics,horizontal:Au(this.props.horizontal),getOutermostParentListRef:this._getOutermostParentListRef,registerAsNestedChild:this._registerAsNestedChild,unregisterAsNestedChild:this._unregisterAsNestedChild}},ve.cloneElement((this.props.renderScrollComponent||this._defaultRenderScrollComponent)($t),{ref:this._captureScrollRef},I)),Kt=pt;return this.props.debug?ve.createElement(Rt,{style:co.debug},Kt,this._renderDebugOverlay()):Kt}componentDidUpdate(r){var o=this.props,u=o.data,f=o.extraData;(u!==r.data||f!==r.extraData)&&this._viewabilityTuples.forEach(b=>{b.viewabilityHelper.resetViewableIndices()});var _=this._hiPriInProgress;this._scheduleCellsToRenderUpdate(),_&&(this._hiPriInProgress=!1)}_computeBlankness(){this._fillRateHelper.computeBlankness(this.props,this.state.cellsAroundViewport,this._scrollMetrics)}_onCellFocusCapture(r){this._lastFocusedCellKey=r,this._updateCellsToRender()}_triggerRemeasureForChildListsInCell(r){this._nestedChildLists.forEachInCell(r,o=>{o.measureLayoutRelativeToContainingList()})}measureLayoutRelativeToContainingList(){try{if(!this._scrollRef)return;this._scrollRef.measureLayout(this.context.getOutermostParentListRef().getScrollRef(),(r,o,u,f)=>{this._offsetFromParentVirtualizedList=this._selectOffset({x:r,y:o}),this._scrollMetrics.contentLength=this._selectLength({width:u,height:f});var _=this._convertParentScrollMetrics(this.context.getScrollMetrics()),b=this._scrollMetrics.visibleLength!==_.visibleLength||this._scrollMetrics.offset!==_.offset;b&&(this._scrollMetrics.visibleLength=_.visibleLength,this._scrollMetrics.offset=_.offset,this._nestedChildLists.forEach(T=>{T.measureLayoutRelativeToContainingList()}))},r=>{console.warn("VirtualizedList: Encountered an error while measuring a list's offset from its containing VirtualizedList.")})}catch(r){console.warn("measureLayoutRelativeToContainingList threw an error",r.stack)}}_getFooterCellKey(){return this._getCellKey()+"-footer"}_renderDebugOverlay(){for(var r=this._scrollMetrics.visibleLength/(this._scrollMetrics.contentLength||1),o=[],u=this.props.getItemCount(this.props.data),f=0;f<u;f++){var _=this.__getFrameMetricsApprox(f,this.props);_.inLayout&&o.push(_)}var b=this.__getFrameMetricsApprox(this.state.cellsAroundViewport.first,this.props).offset,T=this.__getFrameMetricsApprox(this.state.cellsAroundViewport.last,this.props),a=T.offset+T.length-b,I=this._scrollMetrics.offset,D=this._scrollMetrics.visibleLength;return ve.createElement(Rt,{style:[co.debugOverlayBase,co.debugOverlay]},o.map((j,V)=>ve.createElement(Rt,{key:"f"+V,style:[co.debugOverlayBase,co.debugOverlayFrame,{top:j.offset*r,height:j.length*r}]})),ve.createElement(Rt,{style:[co.debugOverlayBase,co.debugOverlayFrameLast,{top:b*r,height:a*r}]}),ve.createElement(Rt,{style:[co.debugOverlayBase,co.debugOverlayFrameVis,{top:I*r,height:D*r}]}))}_selectLength(r){return Au(this.props.horizontal)?r.width:r.height}_selectOffset(r){return Au(this.props.horizontal)?r.x:r.y}_maybeCallOnEdgeReached(){var r=this.props,o=r.data,u=r.getItemCount,f=r.onStartReached,_=r.onStartReachedThreshold,b=r.onEndReached,T=r.onEndReachedThreshold,a=r.initialScrollIndex,I=this._scrollMetrics,D=I.contentLength,j=I.visibleLength,V=I.offset,q=V,se=D-j-V;q<gC&&(q=0),se<gC&&(se=0);var pe=2,be=_!=null?_*j:pe,te=T!=null?T*j:pe,X=q<=be,ie=se<=te;b&&this.state.cellsAroundViewport.last===u(o)-1&&ie&&this._scrollMetrics.contentLength!==this._sentEndForContentLength?(this._sentEndForContentLength=this._scrollMetrics.contentLength,b({distanceFromEnd:se})):f!=null&&this.state.cellsAroundViewport.first===0&&X&&this._scrollMetrics.contentLength!==this._sentStartForContentLength?(!a||this._scrollMetrics.timestamp!==0)&&(this._sentStartForContentLength=this._scrollMetrics.contentLength,f({distanceFromStart:q})):(this._sentStartForContentLength=X?this._sentStartForContentLength:0,this._sentEndForContentLength=ie?this._sentEndForContentLength:0)}_scheduleCellsToRenderUpdate(){var r=this.state.cellsAroundViewport,o=r.first,u=r.last,f=this._scrollMetrics,_=f.offset,b=f.visibleLength,T=f.velocity,a=this.props.getItemCount(this.props.data),I=!1,D=W5(this.props.onStartReachedThreshold),j=_C(this.props.onEndReachedThreshold);if(o>0){var V=_-this.__getFrameMetricsApprox(o,this.props).offset;I=V<0||T<-2&&V<yC(D,b)}if(!I&&u>=0&&u<a-1){var q=this.__getFrameMetricsApprox(u,this.props).offset-(_+b);I=q<0||T>2&&q<yC(j,b)}if(I&&(this._averageCellLength||this.props.getItemLayout)&&!this._hiPriInProgress){this._hiPriInProgress=!0,this._updateCellsToRenderBatcher.dispose({abort:!0}),this._updateCellsToRender();return}else this._updateCellsToRenderBatcher.schedule()}_updateViewableItems(r,o){this._viewabilityTuples.forEach(u=>{u.viewabilityHelper.onUpdate(r,this._scrollMetrics.offset,this._scrollMetrics.visibleLength,this._getFrameMetrics,this._createViewToken,u.onViewableItemsChanged,o)})}}Ps.contextType=g_;var co=en.create({verticallyInverted:{transform:"scaleY(-1)"},horizontallyInverted:{transform:"scaleX(-1)"},debug:{flex:1},debugOverlayBase:{position:"absolute",top:0,right:0},debugOverlay:{bottom:0,width:20,borderColor:"blue",borderWidth:1},debugOverlayFrame:{left:0,backgroundColor:"orange"},debugOverlayFrameLast:{left:0,borderColor:"green",borderWidth:2},debugOverlayFrameVis:{left:0,borderColor:"red",borderWidth:2}}),xC=Number.isNaN||function(r){return typeof r=="number"&&r!==r};function Z5(t,r){return!!(t===r||xC(t)&&xC(r))}function X5(t,r){if(t.length!==r.length)return!1;for(var o=0;o<t.length;o++)if(!Z5(t[o],r[o]))return!1;return!0}function K5(t,r){r===void 0&&(r=X5);var o=null;function u(){for(var f=[],_=0;_<arguments.length;_++)f[_]=arguments[_];if(o&&o.lastThis===this&&r(f,o.lastArgs))return o.lastResult;var b=t.apply(this,f);return o={lastResult:b,lastArgs:f,lastThis:this},b}return u.clear=function(){o=null},u}var Y5=["numColumns","columnWrapperStyle","removeClippedSubviews","strictMode"];function J5(t){return t??aF.OS==="android"}function Mu(t){return t??1}function Q5(t){return typeof Object(t).length=="number"}class ej extends ve.PureComponent{scrollToEnd(r){this._listRef&&this._listRef.scrollToEnd(r)}scrollToIndex(r){this._listRef&&this._listRef.scrollToIndex(r)}scrollToItem(r){this._listRef&&this._listRef.scrollToItem(r)}scrollToOffset(r){this._listRef&&this._listRef.scrollToOffset(r)}recordInteraction(){this._listRef&&this._listRef.recordInteraction()}flashScrollIndicators(){this._listRef&&this._listRef.flashScrollIndicators()}getScrollResponder(){if(this._listRef)return this._listRef.getScrollResponder()}getNativeScrollRef(){if(this._listRef)return this._listRef.getScrollRef()}getScrollableNode(){if(this._listRef)return this._listRef.getScrollableNode()}constructor(r){super(r),this._virtualizedListPairs=[],this._captureRef=o=>{this._listRef=o},this._getItem=(o,u)=>{var f=Mu(this.props.numColumns);if(f>1){for(var _=[],b=0;b<f;b++){var T=u*f+b;if(T<o.length){var a=o[T];_.push(a)}}return _}else return o[u]},this._getItemCount=o=>{if(o!=null&&Q5(o)){var u=Mu(this.props.numColumns);return u>1?Math.ceil(o.length/u):o.length}else return 0},this._keyExtractor=(o,u)=>{var f,_=Mu(this.props.numColumns),b=(f=this.props.keyExtractor)!==null&&f!==void 0?f:J0;return _>1?(Qt(Array.isArray(o),"FlatList: Encountered internal consistency error, expected each item to consist of an array with 1-%s columns; instead, received a single item.",_),o.map((T,a)=>b(T,u*_+a)).join(":")):b(o,u)},this._renderer=(o,u,f,_,b)=>{var T=Mu(_),a=D=>o?ve.createElement(o,D):u?u(D):null,I=D=>{if(T>1){var j=D.item,V=D.index;return Qt(Array.isArray(j),"Expected array of items with numColumns > 1"),ve.createElement(Rt,{style:[tj.row,f]},j.map((q,se)=>{var pe=a({item:q,index:V*T+se,separators:D.separators});return pe!=null?ve.createElement(ve.Fragment,{key:se},pe):null}))}else return a(D)};return o?{ListItemComponent:I}:{renderItem:I}},this._memoizedRenderer=K5(this._renderer),this._checkProps(this.props),this.props.viewabilityConfigCallbackPairs?this._virtualizedListPairs=this.props.viewabilityConfigCallbackPairs.map(o=>({viewabilityConfig:o.viewabilityConfig,onViewableItemsChanged:this._createOnViewableItemsChanged(o.onViewableItemsChanged)})):this.props.onViewableItemsChanged&&this._virtualizedListPairs.push({viewabilityConfig:this.props.viewabilityConfig,onViewableItemsChanged:this._createOnViewableItemsChanged(this.props.onViewableItemsChanged)})}componentDidUpdate(r){Qt(r.numColumns===this.props.numColumns,"Changing numColumns on the fly is not supported. Change the key prop on FlatList when changing the number of columns to force a fresh render of the component."),Qt(r.onViewableItemsChanged===this.props.onViewableItemsChanged,"Changing onViewableItemsChanged on the fly is not supported"),Qt(!n5(r.viewabilityConfig,this.props.viewabilityConfig),"Changing viewabilityConfig on the fly is not supported"),Qt(r.viewabilityConfigCallbackPairs===this.props.viewabilityConfigCallbackPairs,"Changing viewabilityConfigCallbackPairs on the fly is not supported"),this._checkProps(this.props)}_checkProps(r){var o=r.getItem,u=r.getItemCount,f=r.horizontal,_=r.columnWrapperStyle,b=r.onViewableItemsChanged,T=r.viewabilityConfigCallbackPairs,a=Mu(this.props.numColumns);Qt(!o&&!u,"FlatList does not support custom data formats."),a>1?Qt(!f,"numColumns does not support horizontal."):Qt(!_,"columnWrapperStyle not supported for single column lists"),Qt(!(b&&T),"FlatList does not support setting both onViewableItemsChanged and viewabilityConfigCallbackPairs.")}_pushMultiColumnViewable(r,o){var u,f=Mu(this.props.numColumns),_=(u=this.props.keyExtractor)!==null&&u!==void 0?u:J0;o.item.forEach((b,T)=>{Qt(o.index!=null,"Missing index!");var a=o.index*f+T;r.push(er(er({},o),{},{item:b,key:_(b,a),index:a}))})}_createOnViewableItemsChanged(r){return o=>{var u=Mu(this.props.numColumns);if(r)if(u>1){var f=[],_=[];o.viewableItems.forEach(b=>this._pushMultiColumnViewable(_,b)),o.changed.forEach(b=>this._pushMultiColumnViewable(f,b)),r({viewableItems:_,changed:f})}else r(o)}}render(){var r=this.props,o=r.numColumns,u=r.columnWrapperStyle,f=r.removeClippedSubviews,_=r.strictMode,b=_===void 0?!1:_,T=ys(r,Y5),a=b?this._memoizedRenderer:this._renderer;return ve.createElement(Ps,Ci({},T,{getItem:this._getItem,getItemCount:this._getItemCount,keyExtractor:this._keyExtractor,ref:this._captureRef,viewabilityConfigCallbackPairs:this._virtualizedListPairs,removeClippedSubviews:J5(f)},a(this.props.ListItemComponent,this.props.renderItem,u,o,this.props.extraData)))}}var tj=en.create({row:{flexDirection:"row"}}),rj=[];function gM(t){return rj[t-1]}var nj=/^data:/;class hs{static has(r){var o=hs._entries,u=nj.test(r);return u||!!o[r]}static add(r){var o=hs._entries,u=Date.now();o[r]?(o[r].lastUsedTimestamp=u,o[r].refCount+=1):o[r]={lastUsedTimestamp:u,refCount:1}}static remove(r){var o=hs._entries;o[r]&&(o[r].refCount-=1),hs._cleanUpIfNeeded()}static _cleanUpIfNeeded(){var r=hs._entries,o=Object.keys(r);if(o.length+1>hs._maximumEntries){var u,f;o.forEach(_=>{var b=r[_];(!f||b.lastUsedTimestamp<f.lastUsedTimestamp)&&b.refCount===0&&(u=_,f=b)}),u&&delete r[u]}}}hs._maximumEntries=256;hs._entries={};var Sx=0,fg={},Xo={abort(t){var r=fg[""+t];r&&(r.onerror=null,r.onload=null,r=null,delete fg[""+t])},getSize(t,r,o){var u=!1,f=setInterval(b,16),_=Xo.load(t,b,T);function b(){var a=fg[""+_];if(a){var I=a.naturalHeight,D=a.naturalWidth;I&&D&&(r(D,I),u=!0)}u&&(Xo.abort(_),clearInterval(f))}function T(){typeof o=="function"&&o(),Xo.abort(_),clearInterval(f)}},has(t){return hs.has(t)},load(t,r,o){Sx+=1;var u=new window.Image;return u.onerror=o,u.onload=f=>{var _=()=>r({nativeEvent:f});typeof u.decode=="function"?u.decode().then(_,_):setTimeout(_,0)},u.src=t,fg[""+Sx]=u,Sx},prefetch(t){return new Promise((r,o)=>{Xo.load(t,()=>{hs.add(t),hs.remove(t),r()},o)})},queryCache(t){var r={};return t.forEach(o=>{hs.has(o)&&(r[o]="disk/memory")}),Promise.resolve(r)}};class Nf{static get(){return Vu.get("window").scale}static getFontScale(){return Vu.get("window").fontScale||Nf.get()}static getPixelSizeForLayoutSize(r){return Math.round(r*Nf.get())}static roundToNearestPixel(r){var o=Nf.get();return Math.round(r*o)/o}}var ij=["aria-label","accessibilityLabel","blurRadius","defaultSource","draggable","onError","onLayout","onLoad","onLoadEnd","onLoadStart","pointerEvents","source","style"],sj="ERRORED",Tx="LOADED",bC="LOADING",oj="IDLE",aj=0,lj=/^(data:image\/svg\+xml;utf8,)(.*)/;function uj(t,r){return t&&r!=null?ve.createElement("svg",{style:{position:"absolute",height:0,visibility:"hidden",width:0}},ve.createElement("defs",null,ve.createElement("filter",{id:"tint-"+r,suppressHydrationWarning:!0},ve.createElement("feFlood",{floodColor:""+t,key:t}),ve.createElement("feComposite",{in2:"SourceAlpha",operator:"in"})))):null}function cj(t,r,o,u){var f=en.flatten(t),_=f.filter,b=f.resizeMode,T=f.shadowOffset,a=f.tintColor;f.resizeMode,f.tintColor;var I=[],D=null;if(_&&I.push(_),r&&I.push("blur("+r+"px)"),T){var j=ZA(f);j&&I.push("drop-shadow("+j+")")}return(u||a)&&o!=null&&I.push("url(#tint-"+o+")"),I.length>0&&(D=I.join(" ")),[b,D,a]}function hj(t){if(typeof t=="number"){var r=gM(t),o=r.height,u=r.width;return{height:o,width:u}}else if(t!=null&&!Array.isArray(t)&&typeof t=="object"){var f=t.height,_=t.width;return{height:f,width:_}}}function Ex(t){var r=null;if(typeof t=="number"){var o=gM(t);if(o==null)throw new Error('Image: asset with ID "'+t+'" could not be found. Please check the image source or packager.');var u=o.scales[0];if(o.scales.length>1){var f=Nf.get();u=o.scales.reduce((D,j)=>Math.abs(j-f)<Math.abs(D-f)?j:D)}var _=u!==1?"@"+u+"x":"";r=o?o.httpServerLocation+"/"+o.name+_+"."+o.type:""}else typeof t=="string"?r=t:t&&typeof t.uri=="string"&&(r=t.uri);if(r){var b=r.match(lj);if(b){var T=b[1],a=b[2],I=encodeURIComponent(a);return""+T+I}}return r}var _M=ve.forwardRef((t,r)=>{var o=t["aria-label"],u=t.accessibilityLabel,f=t.blurRadius,_=t.defaultSource,b=t.draggable,T=t.onError,a=t.onLayout,I=t.onLoad,D=t.onLoadEnd,j=t.onLoadStart,V=t.pointerEvents,q=t.source,se=t.style,pe=ys(t,ij),be=o||u,te=ve.useState(()=>{var dr=Ex(q);if(dr!=null){var Nr=Xo.has(dr);if(Nr)return Tx}return oj}),X=te[0],ie=te[1],Se=ve.useState({}),Ce=Se[0],Le=Se[1],Ne=ve.useContext(h_),qe=ve.useRef(null),it=ve.useRef(aj++),Ae=ve.useRef(null),Tt=X===Tx||X===bC&&_==null,$t=cj(se,f,it.current,t.tintColor),pt=$t[0],Kt=$t[1],Dr=$t[2],Sr=t.resizeMode||pt||"cover",xn=t.tintColor||Dr,lt=Tt?q:_,st=Ex(lt),kt=hj(lt),It=st?'url("'+st+'")':null,Bt=Yt(),tn=st?N_("img",{alt:be||"",style:xf.accessibilityImage$raw,draggable:b||!1,ref:qe,src:st}):null;function Yt(){if(qe.current!=null&&(Sr==="center"||Sr==="repeat")){var dr=qe.current,Nr=dr.naturalHeight,Kn=dr.naturalWidth,Yn=Ce.height,_i=Ce.width;if(Nr&&Kn&&Yn&&_i){var Lt=Math.min(1,_i/Kn,Yn/Nr),yi=Math.ceil(Lt*Kn),qr=Math.ceil(Lt*Nr);return yi+"px "+qr+"px"}}}function Kr(dr){if(Sr==="center"||Sr==="repeat"||a){var Nr=dr.nativeEvent.layout;a&&a(dr),Le(Nr)}}var jr=Ex(q);return ve.useEffect(()=>{dr(),jr!=null&&(ie(bC),j&&j(),Ae.current=Xo.load(jr,function(Kn){ie(Tx),I&&I(Kn),D&&D()},function(){ie(sj),T&&T({nativeEvent:{error:"Failed to load resource "+jr}}),D&&D()}));function dr(){Ae.current!=null&&(Xo.abort(Ae.current),Ae.current=null)}return dr},[jr,Ae,ie,T,I,D,j]),ve.createElement(Rt,Ci({},pe,{"aria-label":be,onLayout:Kr,pointerEvents:V,ref:r,style:[xf.root,Ne&&xf.inline,kt,se,xf.undo,{boxShadow:null}]}),ve.createElement(Rt,{style:[xf.image,dj[Sr],{backgroundImage:It,filter:Kt},Bt!=null&&{backgroundSize:Bt}],suppressHydrationWarning:!0}),tn,uj(xn,it.current))});_M.displayName="Image";var wp=_M;wp.getSize=function(t,r,o){Xo.getSize(t,r,o)};wp.prefetch=function(t){return Xo.prefetch(t)};wp.queryCache=function(t){return Xo.queryCache(t)};var xf=en.create({root:{flexBasis:"auto",overflow:"hidden",zIndex:0},inline:{display:"inline-flex"},undo:{blurRadius:null,shadowColor:null,shadowOpacity:null,shadowOffset:null,shadowRadius:null,tintColor:null,overlayColor:null,resizeMode:null},image:er(er({},en.absoluteFillObject),{},{backgroundColor:"transparent",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundSize:"cover",height:"100%",width:"100%",zIndex:-1}),accessibilityImage$raw:er(er({},en.absoluteFillObject),{},{height:"100%",opacity:0,width:"100%",zIndex:-1})}),dj=en.create({center:{backgroundSize:"auto"},contain:{backgroundSize:"contain"},cover:{backgroundSize:"cover"},none:{backgroundPosition:"0",backgroundSize:"auto"},repeat:{backgroundPosition:"0",backgroundRepeat:"repeat",backgroundSize:"auto"},stretch:{backgroundSize:"100% 100%"}}),fj=["hrefAttrs","numberOfLines","onClick","onLayout","onPress","onMoveShouldSetResponder","onMoveShouldSetResponderCapture","onResponderEnd","onResponderGrant","onResponderMove","onResponderReject","onResponderRelease","onResponderStart","onResponderTerminate","onResponderTerminationRequest","onScrollShouldSetResponder","onScrollShouldSetResponderCapture","onSelectionChangeShouldSetResponder","onSelectionChangeShouldSetResponderCapture","onStartShouldSetResponder","onStartShouldSetResponderCapture","selectable"],pj=Object.assign({},mb,gb,_b,yb,vb,xb,bb,wb,{href:!0,lang:!0,pointerEvents:!0}),mj=t=>Sb(t,pj),wn=ve.forwardRef((t,r)=>{var o=t.hrefAttrs,u=t.numberOfLines,f=t.onClick,_=t.onLayout,b=t.onPress,T=t.onMoveShouldSetResponder,a=t.onMoveShouldSetResponderCapture,I=t.onResponderEnd,D=t.onResponderGrant,j=t.onResponderMove,V=t.onResponderReject,q=t.onResponderRelease,se=t.onResponderStart,pe=t.onResponderTerminate,be=t.onResponderTerminationRequest,te=t.onScrollShouldSetResponder,X=t.onScrollShouldSetResponderCapture,ie=t.onSelectionChangeShouldSetResponder,Se=t.onSelectionChangeShouldSetResponderCapture,Ce=t.onStartShouldSetResponder,Le=t.onStartShouldSetResponderCapture,Ne=t.selectable,qe=ys(t,fj),it=ve.useContext(h_),Ae=ve.useRef(null),Tt=pb(),$t=Tt.direction;Tb(Ae,_),kb(Ae,{onMoveShouldSetResponder:T,onMoveShouldSetResponderCapture:a,onResponderEnd:I,onResponderGrant:D,onResponderMove:j,onResponderReject:V,onResponderRelease:q,onResponderStart:se,onResponderTerminate:pe,onResponderTerminationRequest:be,onScrollShouldSetResponder:te,onScrollShouldSetResponderCapture:X,onSelectionChangeShouldSetResponder:ie,onSelectionChangeShouldSetResponderCapture:Se,onStartShouldSetResponder:Ce,onStartShouldSetResponderCapture:Le});var pt=ve.useCallback(Kr=>{f!=null?f(Kr):b!=null&&(Kr.stopPropagation(),b(Kr))},[f,b]),Kt=it?"span":"div",Dr=t.lang!=null?j_(t.lang):null,Sr=t.dir||Dr,xn=Sr||$t,lt=mj(qe);if(lt.dir=Sr,it||(lt.dir=Sr??"auto"),(f||b)&&(lt.onClick=pt),lt.style=[u!=null&&u>1&&{WebkitLineClamp:u},it===!0?Pu.textHasAncestor$raw:Pu.text$raw,u===1&&Pu.textOneLine,u!=null&&u>1&&Pu.textMultiLine,t.style,Ne===!0&&Pu.selectable,Ne===!1&&Pu.notSelectable,b&&Pu.pressable],t.href!=null&&(Kt="a",o!=null)){var st=o.download,kt=o.rel,It=o.target;st!=null&&(lt.download=st),kt!=null&&(lt.rel=kt),typeof It=="string"&&(lt.target=It.charAt(0)!=="_"?"_"+It:It)}var Bt=Eb(lt),tn=bp(Ae,Bt,r);lt.ref=tn;var Yt=N_(Kt,lt,{writingDirection:xn});return it?Yt:ve.createElement(h_.Provider,{value:!0},Yt)});wn.displayName="Text";var wC={backgroundColor:"transparent",border:"0 solid black",boxSizing:"border-box",color:"black",display:"inline",font:"14px System",listStyle:"none",margin:0,padding:0,position:"relative",textAlign:"start",textDecoration:"none",whiteSpace:"pre-wrap",wordWrap:"break-word"},Pu=en.create({text$raw:wC,textHasAncestor$raw:er(er({},wC),{},{color:"inherit",font:"inherit",textAlign:"inherit",whiteSpace:"inherit"}),textOneLine:{maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",wordWrap:"normal"},textMultiLine:{display:"-webkit-box",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",WebkitBoxOrient:"vertical"},notSelectable:{userSelect:"none"},selectable:{userSelect:"text"},pressable:{cursor:"pointer"}}),gj=["animating","color","hidesWhenStopped","size","style"],SC=t=>ve.createElement("circle",{cx:"16",cy:"16",fill:"none",r:"14",strokeWidth:"4",style:t}),__=ve.forwardRef((t,r)=>{var o=t.animating,u=o===void 0?!0:o,f=t.color,_=f===void 0?"#1976D2":f,b=t.hidesWhenStopped,T=b===void 0?!0:b,a=t.size,I=a===void 0?"small":a,D=t.style,j=ys(t,gj),V=ve.createElement("svg",{height:"100%",viewBox:"0 0 32 32",width:"100%"},SC({stroke:_,opacity:.2}),SC({stroke:_,strokeDasharray:80,strokeDashoffset:60}));return ve.createElement(Rt,Ci({},j,{"aria-valuemax":1,"aria-valuemin":0,ref:r,role:"progressbar",style:[pg.container,D]}),ve.createElement(Rt,{children:V,style:[typeof I=="number"?{height:I,width:I}:_j[I],pg.animation,!u&&pg.animationPause,!u&&T&&pg.hidesWhenStopped]}))});__.displayName="ActivityIndicator";var pg=en.create({container:{alignItems:"center",justifyContent:"center"},hidesWhenStopped:{visibility:"hidden"},animation:{animationDuration:"0.75s",animationKeyframes:[{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}],animationTimingFunction:"linear",animationIterationCount:"infinite"},animationPause:{animationPlayState:"paused"}}),_j=en.create({small:{width:20,height:20},large:{width:36,height:36}}),TC="DELAY",ho="ERROR",EC="LONG_PRESS_DETECTED",Si="NOT_RESPONDER",Rh="RESPONDER_ACTIVE_LONG_PRESS_START",$_="RESPONDER_ACTIVE_PRESS_START",Q0="RESPONDER_INACTIVE_PRESS_START",yj="RESPONDER_GRANT",Dg="RESPONDER_RELEASE",yM="RESPONDER_TERMINATED",CC=Object.freeze({NOT_RESPONDER:{DELAY:ho,RESPONDER_GRANT:Q0,RESPONDER_RELEASE:ho,RESPONDER_TERMINATED:ho,LONG_PRESS_DETECTED:ho},RESPONDER_INACTIVE_PRESS_START:{DELAY:$_,RESPONDER_GRANT:ho,RESPONDER_RELEASE:Si,RESPONDER_TERMINATED:Si,LONG_PRESS_DETECTED:ho},RESPONDER_ACTIVE_PRESS_START:{DELAY:ho,RESPONDER_GRANT:ho,RESPONDER_RELEASE:Si,RESPONDER_TERMINATED:Si,LONG_PRESS_DETECTED:Rh},RESPONDER_ACTIVE_LONG_PRESS_START:{DELAY:ho,RESPONDER_GRANT:ho,RESPONDER_RELEASE:Si,RESPONDER_TERMINATED:Si,LONG_PRESS_DETECTED:Rh},ERROR:{DELAY:Si,RESPONDER_GRANT:Q0,RESPONDER_RELEASE:Si,RESPONDER_TERMINATED:Si,LONG_PRESS_DETECTED:Si}}),vM=t=>t.getAttribute("role"),e1=t=>t.tagName.toLowerCase(),kC=t=>t===$_||t===Rh,Og=t=>vM(t)==="button",IC=t=>t===Q0||t===$_||t===Rh,vj=t=>t===yM||t===Dg,AC=t=>{var r=t.key,o=t.target,u=r===" "||r==="Spacebar",f=e1(o)==="button"||Og(o);return r==="Enter"||u&&f},xj=450,bj=50;class wj{constructor(r){this._eventHandlers=null,this._isPointerTouch=!1,this._longPressDelayTimeout=null,this._longPressDispatched=!1,this._pressDelayTimeout=null,this._pressOutDelayTimeout=null,this._touchState=Si,this._responderElement=null,this.configure(r)}configure(r){this._config=r}reset(){this._cancelLongPressDelayTimeout(),this._cancelPressDelayTimeout(),this._cancelPressOutDelayTimeout()}getEventHandlers(){return this._eventHandlers==null&&(this._eventHandlers=this._createEventHandlers()),this._eventHandlers}_createEventHandlers(){var r=(f,_)=>{f.persist(),this._cancelPressOutDelayTimeout(),this._longPressDispatched=!1,this._selectionTerminated=!1,this._touchState=Si,this._isPointerTouch=f.nativeEvent.type==="touchstart",this._receiveSignal(yj,f);var b=Cx(this._config.delayPressStart,0,bj);_!==!1&&b>0?this._pressDelayTimeout=setTimeout(()=>{this._receiveSignal(TC,f)},b):this._receiveSignal(TC,f);var T=Cx(this._config.delayLongPress,10,xj);this._longPressDelayTimeout=setTimeout(()=>{this._handleLongPress(f)},T+b)},o=f=>{this._receiveSignal(Dg,f)},u=f=>{var _=this._config.onPress,b=f.target;if(this._touchState!==Si&&AC(f)){o(f),document.removeEventListener("keyup",u);var T=b.getAttribute("role"),a=e1(b),I=T==="link"||a==="a"||a==="button"||a==="input"||a==="select"||a==="textarea",D=this._responderElement===b;_!=null&&!I&&D&&_(f),this._responderElement=null}};return{onStartShouldSetResponder:f=>{var _=this._config.disabled;return _&&Og(f.currentTarget)&&f.stopPropagation(),_==null?!0:!_},onKeyDown:f=>{var _=this._config.disabled,b=f.key,T=f.target;if(!_&&AC(f)){this._touchState===Si&&(r(f,!1),this._responderElement=T,document.addEventListener("keyup",u));var a=b===" "||b==="Spacebar",I=vM(T),D=I==="button"||I==="menuitem";a&&D&&e1(T)!=="button"&&f.preventDefault(),f.stopPropagation()}},onResponderGrant:f=>r(f),onResponderMove:f=>{this._config.onPressMove!=null&&this._config.onPressMove(f);var _=MC(f);if(this._touchActivatePosition!=null){var b=this._touchActivatePosition.pageX-_.pageX,T=this._touchActivatePosition.pageY-_.pageY;Math.hypot(b,T)>10&&this._cancelLongPressDelayTimeout()}},onResponderRelease:f=>o(f),onResponderTerminate:f=>{f.nativeEvent.type==="selectionchange"&&(this._selectionTerminated=!0),this._receiveSignal(yM,f)},onResponderTerminationRequest:f=>{var _=this._config,b=_.cancelable,T=_.disabled,a=_.onLongPress;return!T&&a!=null&&this._isPointerTouch&&f.nativeEvent.type==="contextmenu"?!1:b??!0},onClick:f=>{var _=this._config,b=_.disabled,T=_.onPress;b?Og(f.currentTarget)&&f.stopPropagation():(f.stopPropagation(),this._longPressDispatched||this._selectionTerminated?f.preventDefault():T!=null&&f.altKey===!1&&T(f))},onContextMenu:f=>{var _=this._config,b=_.disabled,T=_.onLongPress;b?Og(f.currentTarget)&&f.stopPropagation():T!=null&&this._isPointerTouch&&!f.defaultPrevented&&(f.preventDefault(),f.stopPropagation())}}}_receiveSignal(r,o){var u=this._touchState,f=null;CC[u]!=null&&(f=CC[u][r]),!(this._touchState===Si&&r===Dg)&&(f==null||f===ho?console.error("PressResponder: Invalid signal "+r+" for state "+u+" on responder"):u!==f&&(this._performTransitionSideEffects(u,f,r,o),this._touchState=f))}_performTransitionSideEffects(r,o,u,f){if(vj(u)&&(setTimeout(()=>{this._isPointerTouch=!1},0),this._touchActivatePosition=null,this._cancelLongPressDelayTimeout()),IC(r)&&u===EC){var _=this._config.onLongPress;_!=null&&f.nativeEvent.key==null&&(_(f),this._longPressDispatched=!0)}var b=kC(r),T=kC(o);if(!b&&T?this._activate(f):b&&!T&&this._deactivate(f),IC(r)&&u===Dg){var a=this._config,I=a.onLongPress,D=a.onPress;if(D!=null){var j=I!=null&&r===Rh;j||!T&&!b&&(this._activate(f),this._deactivate(f))}}this._cancelPressDelayTimeout()}_activate(r){var o=this._config,u=o.onPressChange,f=o.onPressStart,_=MC(r);this._touchActivatePosition={pageX:_.pageX,pageY:_.pageY},f!=null&&f(r),u!=null&&u(!0)}_deactivate(r){var o=this._config,u=o.onPressChange,f=o.onPressEnd;function _(){f!=null&&f(r),u!=null&&u(!1)}var b=Cx(this._config.delayPressEnd);b>0?this._pressOutDelayTimeout=setTimeout(()=>{_()},b):_()}_handleLongPress(r){(this._touchState===$_||this._touchState===Rh)&&this._receiveSignal(EC,r)}_cancelLongPressDelayTimeout(){this._longPressDelayTimeout!=null&&(clearTimeout(this._longPressDelayTimeout),this._longPressDelayTimeout=null)}_cancelPressDelayTimeout(){this._pressDelayTimeout!=null&&(clearTimeout(this._pressDelayTimeout),this._pressDelayTimeout=null)}_cancelPressOutDelayTimeout(){this._pressOutDelayTimeout!=null&&(clearTimeout(this._pressOutDelayTimeout),this._pressOutDelayTimeout=null)}}function Cx(t,r,o){return r===void 0&&(r=0),o===void 0&&(o=0),Math.max(r,t??o)}function MC(t){var r=t.nativeEvent,o=r.changedTouches,u=r.touches;return u!=null&&u.length>0?u[0]:o!=null&&o.length>0?o[0]:t.nativeEvent}function Sj(t,r){var o=ve.useRef(null);o.current==null&&(o.current=new wj(r));var u=o.current;return ve.useEffect(()=>{u.configure(r)},[r,u]),ve.useEffect(()=>()=>{u.reset()},[u]),ve.useDebugValue(r),u.getEventHandlers()}var Tj=["activeOpacity","delayPressIn","delayPressOut","delayLongPress","disabled","focusable","onLongPress","onPress","onPressIn","onPressOut","rejectResponderTermination","style"];function Ej(t,r){var o=t.activeOpacity,u=t.delayPressIn,f=t.delayPressOut,_=t.delayLongPress,b=t.disabled,T=t.focusable,a=t.onLongPress,I=t.onPress,D=t.onPressIn,j=t.onPressOut,V=t.rejectResponderTermination,q=t.style,se=ys(t,Tj),pe=ve.useRef(null),be=bp(r,pe),te=ve.useState("0s"),X=te[0],ie=te[1],Se=ve.useState(null),Ce=Se[0],Le=Se[1],Ne=ve.useCallback(($t,pt)=>{Le($t),ie(pt?pt/1e3+"s":"0s")},[Le,ie]),qe=ve.useCallback($t=>{Ne(o??.2,$t)},[o,Ne]),it=ve.useCallback($t=>{Ne(null,$t)},[Ne]),Ae=ve.useMemo(()=>({cancelable:!V,disabled:b,delayLongPress:_,delayPressStart:u,delayPressEnd:f,onLongPress:a,onPress:I,onPressStart($t){var pt=$t.dispatchConfig!=null?$t.dispatchConfig.registrationName==="onResponderGrant":$t.type==="keydown";qe(pt?0:150),D!=null&&D($t)},onPressEnd($t){it(250),j!=null&&j($t)}}),[_,u,f,b,a,I,D,j,V,qe,it]),Tt=Sj(pe,Ae);return ve.createElement(Rt,Ci({},se,Tt,{accessibilityDisabled:b,focusable:!b&&T!==!1,pointerEvents:b?"box-none":void 0,ref:be,style:[PC.root,!b&&PC.actionable,q,Ce!=null&&{opacity:Ce},{transitionDuration:X}]}))}var PC=en.create({root:{transitionProperty:"opacity",transitionDuration:"0.15s",userSelect:"none"},actionable:{cursor:"pointer",touchAction:"manipulation"}}),Zi=ve.memo(ve.forwardRef(Ej));Zi.displayName="TouchableOpacity";var Cj=["children","style","imageStyle","imageRef"],kj={},xM=ve.forwardRef((t,r)=>{var o=t.children,u=t.style,f=u===void 0?kj:u,_=t.imageStyle,b=t.imageRef,T=ys(t,Cj),a=en.flatten(f),I=a.height,D=a.width;return ve.createElement(Rt,{ref:r,style:f},ve.createElement(wp,Ci({},T,{ref:b,style:[{width:D,height:I,zIndex:-1},en.absoluteFill,_]})),o)});xM.displayName="ImageBackground";var Ij=(t,r)=>{var o=t.selectionEnd,u=t.selectionStart,f=r.start,_=r.end;return f!==u||_!==o},RC=(t,r)=>{if(Ij(t,r)){var o=r.start,u=r.end;try{t.setSelectionRange(o,u||o)}catch{}}},Aj=Object.assign({},mb,gb,_b,yb,vb,xb,bb,wb,{autoCapitalize:!0,autoComplete:!0,autoCorrect:!0,autoFocus:!0,defaultValue:!0,disabled:!0,lang:!0,maxLength:!0,onChange:!0,onScroll:!0,placeholder:!0,pointerEvents:!0,readOnly:!0,rows:!0,spellCheck:!0,value:!0,type:!0}),Mj=t=>Sb(t,Aj);function Pj(t){return t.isComposing||t.keyCode===229}var kx=null,Hu=ve.forwardRef((t,r)=>{var o=t.autoCapitalize,u=o===void 0?"sentences":o,f=t.autoComplete,_=t.autoCompleteType,b=t.autoCorrect,T=b===void 0?!0:b,a=t.blurOnSubmit,I=t.caretHidden,D=t.clearTextOnFocus,j=t.dir,V=t.editable,q=t.enterKeyHint,se=t.inputMode,pe=t.keyboardType,be=t.multiline,te=be===void 0?!1:be,X=t.numberOfLines,ie=t.onBlur,Se=t.onChange,Ce=t.onChangeText,Le=t.onContentSizeChange,Ne=t.onFocus,qe=t.onKeyPress,it=t.onLayout,Ae=t.onMoveShouldSetResponder,Tt=t.onMoveShouldSetResponderCapture,$t=t.onResponderEnd,pt=t.onResponderGrant,Kt=t.onResponderMove,Dr=t.onResponderReject,Sr=t.onResponderRelease,xn=t.onResponderStart,lt=t.onResponderTerminate,st=t.onResponderTerminationRequest,kt=t.onScrollShouldSetResponder,It=t.onScrollShouldSetResponderCapture,Bt=t.onSelectionChange,tn=t.onSelectionChangeShouldSetResponder,Yt=t.onSelectionChangeShouldSetResponderCapture,Kr=t.onStartShouldSetResponder,jr=t.onStartShouldSetResponderCapture,dr=t.onSubmitEditing,Nr=t.placeholderTextColor,Kn=t.readOnly,Yn=Kn===void 0?!1:Kn,_i=t.returnKeyType,Lt=t.rows,yi=t.secureTextEntry,qr=yi===void 0?!1:yi,Ji=t.selection,fr=t.selectTextOnFocus,jn=t.showSoftInputOnFocus,vs=t.spellCheck,Ur,rn;if(se!=null)rn=se,se==="email"?Ur="email":se==="tel"?Ur="tel":se==="search"?Ur="search":se==="url"?Ur="url":Ur="text";else if(pe!=null)switch(pe){case"email-address":Ur="email";break;case"number-pad":case"numeric":rn="numeric";break;case"decimal-pad":rn="decimal";break;case"phone-pad":Ur="tel";break;case"search":case"web-search":Ur="search";break;case"url":Ur="url";break;default:Ur="text"}qr&&(Ur="password");var ii=ve.useRef({height:null,width:null}),Pn=ve.useRef(null),Qi=ve.useRef(null),si=ve.useRef(!1);ve.useEffect(()=>{Pn.current&&Qi.current&&RC(Pn.current,Qi.current),si.current=qr},[qr]);var Ai=ve.useCallback(U=>{if(te&&Le&&U!=null){var re=U.scrollHeight,ce=U.scrollWidth;(re!==ii.current.height||ce!==ii.current.width)&&(ii.current.height=re,ii.current.width=ce,Le({nativeEvent:{contentSize:{height:ii.current.height,width:ii.current.width}}}))}},[te,Le]),Ns=ve.useMemo(()=>U=>{U!=null&&(U.clear=function(){U!=null&&(U.value="")},U.isFocused=function(){return U!=null&&Ta.currentlyFocusedField()===U},Ai(U))},[Ai]);function xo(U){Ta._currentlyFocusedNode=null,ie&&(U.nativeEvent.text=U.target.value,ie(U))}function Rn(U){var re=U.target,ce=re.value;U.nativeEvent.text=ce,Ai(re),Se&&Se(U),Ce&&Ce(ce)}function Mi(U){var re=U.target;Ne&&(U.nativeEvent.text=re.value,Ne(U)),re!=null&&(Ta._currentlyFocusedNode=re,D&&(re.value=""),fr&&(kx!=null&&clearTimeout(kx),kx=setTimeout(()=>{re!=null&&document.activeElement===re&&re.select()},0)))}function xs(U){var re=U.target;U.stopPropagation();var ce=!te,_e=a??ce,Te=U.nativeEvent,Ee=Pj(Te);qe&&qe(U),U.key==="Enter"&&!U.shiftKey&&!Ee&&!U.isDefaultPrevented()&&((a||!te)&&dr&&(U.preventDefault(),Te.text=U.target.value,dr(U)),_e&&re!=null&&setTimeout(()=>re.blur(),0))}function es(U){try{var re=U.target,ce=re.selectionStart,_e=re.selectionEnd,Te={start:ce,end:_e};Bt&&(U.nativeEvent.selection=Te,U.nativeEvent.text=U.target.value,Bt(U)),si.current===qr&&(Qi.current=Te)}catch{}}W0(()=>{var U=Pn.current;U!=null&&Ji!=null&&RC(U,Ji),document.activeElement===U&&(Ta._currentlyFocusedNode=U)},[Pn,Ji]);var ts=te?"textarea":"input";Tb(Pn,it),kb(Pn,{onMoveShouldSetResponder:Ae,onMoveShouldSetResponderCapture:Tt,onResponderEnd:$t,onResponderGrant:pt,onResponderMove:Kt,onResponderReject:Dr,onResponderRelease:Sr,onResponderStart:xn,onResponderTerminate:lt,onResponderTerminationRequest:st,onScrollShouldSetResponder:kt,onScrollShouldSetResponderCapture:It,onSelectionChangeShouldSetResponder:tn,onSelectionChangeShouldSetResponderCapture:Yt,onStartShouldSetResponder:Kr,onStartShouldSetResponderCapture:jr});var Us=pb(),Pi=Us.direction,cr=Mj(t);cr.autoCapitalize=u,cr.autoComplete=f||_||"on",cr.autoCorrect=T?"on":"off",cr.dir=j!==void 0?j:"auto",cr.enterKeyHint=q||_i,cr.inputMode=rn,cr.onBlur=xo,cr.onChange=Rn,cr.onFocus=Mi,cr.onKeyDown=xs,cr.onSelect=es,cr.readOnly=Yn===!0||V===!1,cr.rows=te?Lt??X:1,cr.spellCheck=vs??T,cr.style=[{"--placeholderTextColor":Nr},Ix.textinput$raw,Ix.placeholder,t.style,I&&Ix.caretHidden],cr.type=te?void 0:Ur,cr.virtualkeyboardpolicy=jn===!1?"manual":"auto";var Ri=Eb(cr),rs=bp(Pn,Ri,Ns,r);cr.ref=rs;var ns=t.lang!=null?j_(t.lang):null,bo=t.dir||ns,ae=bo||Pi,$=N_(ts,cr,{writingDirection:ae});return $});Hu.displayName="TextInput";Hu.State=Ta;var Ix=en.create({textinput$raw:{MozAppearance:"textfield",WebkitAppearance:"none",backgroundColor:"transparent",border:"0 solid black",borderRadius:0,boxSizing:"border-box",font:"14px System",margin:0,padding:0,resize:"none"},placeholder:{placeholderTextColor:"var(--placeholderTextColor)"},caretHidden:{caretColor:"transparent"}});function Ib(){var t=ve.useState(()=>Vu.get("window")),r=t[0],o=t[1];return ve.useEffect(()=>{function u(f){var _=f.window;_!=null&&o(_)}return Vu.addEventListener("change",u),o(Vu.get("window")),()=>{Vu.removeEventListener("change",u)}},[]),r}const Rj="modulepreload",Lj=function(t){return"/"+t},LC={},Lh=function(r,o,u){let f=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const b=document.querySelector("meta[property=csp-nonce]"),T=(b==null?void 0:b.nonce)||(b==null?void 0:b.getAttribute("nonce"));f=Promise.allSettled(o.map(a=>{if(a=Lj(a),a in LC)return;LC[a]=!0;const I=a.endsWith(".css"),D=I?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${D}`))return;const j=document.createElement("link");if(j.rel=I?"stylesheet":Rj,I||(j.as="script"),j.crossOrigin="",j.href=a,T&&j.setAttribute("nonce",T),document.head.appendChild(j),I)return new Promise((V,q)=>{j.addEventListener("load",V),j.addEventListener("error",()=>q(new Error(`Unable to preload CSS for ${a}`)))})}))}function _(b){const T=new Event("vite:preloadError",{cancelable:!0});if(T.payload=b,window.dispatchEvent(T),!T.defaultPrevented)throw b}return f.then(b=>{for(const T of b||[])T.status==="rejected"&&_(T.reason);return r().catch(_)})},zj=t=>{let r;return t?r=t:typeof fetch>"u"?r=(...o)=>Lh(async()=>{const{default:u}=await Promise.resolve().then(()=>Nh);return{default:u}},void 0).then(({default:u})=>u(...o)):r=fetch,(...o)=>r(...o)};class Ab extends Error{constructor(r,o="FunctionsError",u){super(r),this.name=o,this.context=u}}class Dj extends Ab{constructor(r){super("Failed to send a request to the Edge Function","FunctionsFetchError",r)}}class Oj extends Ab{constructor(r){super("Relay Error invoking the Edge Function","FunctionsRelayError",r)}}class Bj extends Ab{constructor(r){super("Edge Function returned a non-2xx status code","FunctionsHttpError",r)}}var t1;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(t1||(t1={}));var Fj=function(t,r,o,u){function f(_){return _ instanceof o?_:new o(function(b){b(_)})}return new(o||(o=Promise))(function(_,b){function T(D){try{I(u.next(D))}catch(j){b(j)}}function a(D){try{I(u.throw(D))}catch(j){b(j)}}function I(D){D.done?_(D.value):f(D.value).then(T,a)}I((u=u.apply(t,r||[])).next())})};class jj{constructor(r,{headers:o={},customFetch:u,region:f=t1.Any}={}){this.url=r,this.headers=o,this.region=f,this.fetch=zj(u)}setAuth(r){this.headers.Authorization=`Bearer ${r}`}invoke(r,o={}){var u;return Fj(this,void 0,void 0,function*(){try{const{headers:f,method:_,body:b}=o;let T={},{region:a}=o;a||(a=this.region),a&&a!=="any"&&(T["x-region"]=a);let I;b&&(f&&!Object.prototype.hasOwnProperty.call(f,"Content-Type")||!f)&&(typeof Blob<"u"&&b instanceof Blob||b instanceof ArrayBuffer?(T["Content-Type"]="application/octet-stream",I=b):typeof b=="string"?(T["Content-Type"]="text/plain",I=b):typeof FormData<"u"&&b instanceof FormData?I=b:(T["Content-Type"]="application/json",I=JSON.stringify(b)));const D=yield this.fetch(`${this.url}/${r}`,{method:_||"POST",headers:Object.assign(Object.assign(Object.assign({},T),this.headers),f),body:I}).catch(se=>{throw new Dj(se)}),j=D.headers.get("x-relay-error");if(j&&j==="true")throw new Oj(D);if(!D.ok)throw new Bj(D);let V=((u=D.headers.get("Content-Type"))!==null&&u!==void 0?u:"text/plain").split(";")[0].trim(),q;return V==="application/json"?q=yield D.json():V==="application/octet-stream"?q=yield D.blob():V==="text/event-stream"?q=D:V==="multipart/form-data"?q=yield D.formData():q=yield D.text(),{data:q,error:null}}catch(f){return{data:null,error:f}}})}}var qi={},Mb={},G_={},Sp={},W_={},q_={},Nj=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},zh=Nj();const Uj=zh.fetch,bM=zh.fetch.bind(zh),wM=zh.Headers,Vj=zh.Request,$j=zh.Response,Nh=Object.freeze(Object.defineProperty({__proto__:null,Headers:wM,Request:Vj,Response:$j,default:bM,fetch:Uj},Symbol.toStringTag,{value:"Module"})),Gj=l1(Nh);var H_={};Object.defineProperty(H_,"__esModule",{value:!0});let Wj=class extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}};H_.default=Wj;var SM=ps&&ps.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(q_,"__esModule",{value:!0});const qj=SM(Gj),Hj=SM(H_);let Zj=class{constructor(r){this.shouldThrowOnError=!1,this.method=r.method,this.url=r.url,this.headers=r.headers,this.schema=r.schema,this.body=r.body,this.shouldThrowOnError=r.shouldThrowOnError,this.signal=r.signal,this.isMaybeSingle=r.isMaybeSingle,r.fetch?this.fetch=r.fetch:typeof fetch>"u"?this.fetch=qj.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(r,o){return this.headers=Object.assign({},this.headers),this.headers[r]=o,this}then(r,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const u=this.fetch;let f=u(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async _=>{var b,T,a;let I=null,D=null,j=null,V=_.status,q=_.statusText;if(_.ok){if(this.method!=="HEAD"){const te=await _.text();te===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?D=te:D=JSON.parse(te))}const pe=(b=this.headers.Prefer)===null||b===void 0?void 0:b.match(/count=(exact|planned|estimated)/),be=(T=_.headers.get("content-range"))===null||T===void 0?void 0:T.split("/");pe&&be&&be.length>1&&(j=parseInt(be[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(D)&&(D.length>1?(I={code:"PGRST116",details:`Results contain ${D.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},D=null,j=null,V=406,q="Not Acceptable"):D.length===1?D=D[0]:D=null)}else{const pe=await _.text();try{I=JSON.parse(pe),Array.isArray(I)&&_.status===404&&(D=[],I=null,V=200,q="OK")}catch{_.status===404&&pe===""?(V=204,q="No Content"):I={message:pe}}if(I&&this.isMaybeSingle&&(!((a=I==null?void 0:I.details)===null||a===void 0)&&a.includes("0 rows"))&&(I=null,V=200,q="OK"),I&&this.shouldThrowOnError)throw new Hj.default(I)}return{error:I,data:D,count:j,status:V,statusText:q}});return this.shouldThrowOnError||(f=f.catch(_=>{var b,T,a;return{error:{message:`${(b=_==null?void 0:_.name)!==null&&b!==void 0?b:"FetchError"}: ${_==null?void 0:_.message}`,details:`${(T=_==null?void 0:_.stack)!==null&&T!==void 0?T:""}`,hint:"",code:`${(a=_==null?void 0:_.code)!==null&&a!==void 0?a:""}`},data:null,count:null,status:0,statusText:""}})),f.then(r,o)}};q_.default=Zj;var Xj=ps&&ps.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(W_,"__esModule",{value:!0});const Kj=Xj(q_);let Yj=class extends Kj.default{select(r){let o=!1;const u=(r??"*").split("").map(f=>/\s/.test(f)&&!o?"":(f==='"'&&(o=!o),f)).join("");return this.url.searchParams.set("select",u),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(r,{ascending:o=!0,nullsFirst:u,foreignTable:f,referencedTable:_=f}={}){const b=_?`${_}.order`:"order",T=this.url.searchParams.get(b);return this.url.searchParams.set(b,`${T?`${T},`:""}${r}.${o?"asc":"desc"}${u===void 0?"":u?".nullsfirst":".nullslast"}`),this}limit(r,{foreignTable:o,referencedTable:u=o}={}){const f=typeof u>"u"?"limit":`${u}.limit`;return this.url.searchParams.set(f,`${r}`),this}range(r,o,{foreignTable:u,referencedTable:f=u}={}){const _=typeof f>"u"?"offset":`${f}.offset`,b=typeof f>"u"?"limit":`${f}.limit`;return this.url.searchParams.set(_,`${r}`),this.url.searchParams.set(b,`${o-r+1}`),this}abortSignal(r){return this.signal=r,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:r=!1,verbose:o=!1,settings:u=!1,buffers:f=!1,wal:_=!1,format:b="text"}={}){var T;const a=[r?"analyze":null,o?"verbose":null,u?"settings":null,f?"buffers":null,_?"wal":null].filter(Boolean).join("|"),I=(T=this.headers.Accept)!==null&&T!==void 0?T:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${b}; for="${I}"; options=${a};`,b==="json"?this:this}rollback(){var r;return((r=this.headers.Prefer)!==null&&r!==void 0?r:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};W_.default=Yj;var Jj=ps&&ps.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Sp,"__esModule",{value:!0});const Qj=Jj(W_);let e6=class extends Qj.default{eq(r,o){return this.url.searchParams.append(r,`eq.${o}`),this}neq(r,o){return this.url.searchParams.append(r,`neq.${o}`),this}gt(r,o){return this.url.searchParams.append(r,`gt.${o}`),this}gte(r,o){return this.url.searchParams.append(r,`gte.${o}`),this}lt(r,o){return this.url.searchParams.append(r,`lt.${o}`),this}lte(r,o){return this.url.searchParams.append(r,`lte.${o}`),this}like(r,o){return this.url.searchParams.append(r,`like.${o}`),this}likeAllOf(r,o){return this.url.searchParams.append(r,`like(all).{${o.join(",")}}`),this}likeAnyOf(r,o){return this.url.searchParams.append(r,`like(any).{${o.join(",")}}`),this}ilike(r,o){return this.url.searchParams.append(r,`ilike.${o}`),this}ilikeAllOf(r,o){return this.url.searchParams.append(r,`ilike(all).{${o.join(",")}}`),this}ilikeAnyOf(r,o){return this.url.searchParams.append(r,`ilike(any).{${o.join(",")}}`),this}is(r,o){return this.url.searchParams.append(r,`is.${o}`),this}in(r,o){const u=Array.from(new Set(o)).map(f=>typeof f=="string"&&new RegExp("[,()]").test(f)?`"${f}"`:`${f}`).join(",");return this.url.searchParams.append(r,`in.(${u})`),this}contains(r,o){return typeof o=="string"?this.url.searchParams.append(r,`cs.${o}`):Array.isArray(o)?this.url.searchParams.append(r,`cs.{${o.join(",")}}`):this.url.searchParams.append(r,`cs.${JSON.stringify(o)}`),this}containedBy(r,o){return typeof o=="string"?this.url.searchParams.append(r,`cd.${o}`):Array.isArray(o)?this.url.searchParams.append(r,`cd.{${o.join(",")}}`):this.url.searchParams.append(r,`cd.${JSON.stringify(o)}`),this}rangeGt(r,o){return this.url.searchParams.append(r,`sr.${o}`),this}rangeGte(r,o){return this.url.searchParams.append(r,`nxl.${o}`),this}rangeLt(r,o){return this.url.searchParams.append(r,`sl.${o}`),this}rangeLte(r,o){return this.url.searchParams.append(r,`nxr.${o}`),this}rangeAdjacent(r,o){return this.url.searchParams.append(r,`adj.${o}`),this}overlaps(r,o){return typeof o=="string"?this.url.searchParams.append(r,`ov.${o}`):this.url.searchParams.append(r,`ov.{${o.join(",")}}`),this}textSearch(r,o,{config:u,type:f}={}){let _="";f==="plain"?_="pl":f==="phrase"?_="ph":f==="websearch"&&(_="w");const b=u===void 0?"":`(${u})`;return this.url.searchParams.append(r,`${_}fts${b}.${o}`),this}match(r){return Object.entries(r).forEach(([o,u])=>{this.url.searchParams.append(o,`eq.${u}`)}),this}not(r,o,u){return this.url.searchParams.append(r,`not.${o}.${u}`),this}or(r,{foreignTable:o,referencedTable:u=o}={}){const f=u?`${u}.or`:"or";return this.url.searchParams.append(f,`(${r})`),this}filter(r,o,u){return this.url.searchParams.append(r,`${o}.${u}`),this}};Sp.default=e6;var t6=ps&&ps.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(G_,"__esModule",{value:!0});const bf=t6(Sp);let r6=class{constructor(r,{headers:o={},schema:u,fetch:f}){this.url=r,this.headers=o,this.schema=u,this.fetch=f}select(r,{head:o=!1,count:u}={}){const f=o?"HEAD":"GET";let _=!1;const b=(r??"*").split("").map(T=>/\s/.test(T)&&!_?"":(T==='"'&&(_=!_),T)).join("");return this.url.searchParams.set("select",b),u&&(this.headers.Prefer=`count=${u}`),new bf.default({method:f,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(r,{count:o,defaultToNull:u=!0}={}){const f="POST",_=[];if(this.headers.Prefer&&_.push(this.headers.Prefer),o&&_.push(`count=${o}`),u||_.push("missing=default"),this.headers.Prefer=_.join(","),Array.isArray(r)){const b=r.reduce((T,a)=>T.concat(Object.keys(a)),[]);if(b.length>0){const T=[...new Set(b)].map(a=>`"${a}"`);this.url.searchParams.set("columns",T.join(","))}}return new bf.default({method:f,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}upsert(r,{onConflict:o,ignoreDuplicates:u=!1,count:f,defaultToNull:_=!0}={}){const b="POST",T=[`resolution=${u?"ignore":"merge"}-duplicates`];if(o!==void 0&&this.url.searchParams.set("on_conflict",o),this.headers.Prefer&&T.push(this.headers.Prefer),f&&T.push(`count=${f}`),_||T.push("missing=default"),this.headers.Prefer=T.join(","),Array.isArray(r)){const a=r.reduce((I,D)=>I.concat(Object.keys(D)),[]);if(a.length>0){const I=[...new Set(a)].map(D=>`"${D}"`);this.url.searchParams.set("columns",I.join(","))}}return new bf.default({method:b,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}update(r,{count:o}={}){const u="PATCH",f=[];return this.headers.Prefer&&f.push(this.headers.Prefer),o&&f.push(`count=${o}`),this.headers.Prefer=f.join(","),new bf.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}delete({count:r}={}){const o="DELETE",u=[];return r&&u.push(`count=${r}`),this.headers.Prefer&&u.unshift(this.headers.Prefer),this.headers.Prefer=u.join(","),new bf.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};G_.default=r6;var Z_={},X_={};Object.defineProperty(X_,"__esModule",{value:!0});X_.version=void 0;X_.version="0.0.0-automated";Object.defineProperty(Z_,"__esModule",{value:!0});Z_.DEFAULT_HEADERS=void 0;const n6=X_;Z_.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${n6.version}`};var TM=ps&&ps.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Mb,"__esModule",{value:!0});const i6=TM(G_),s6=TM(Sp),o6=Z_;let a6=class EM{constructor(r,{headers:o={},schema:u,fetch:f}={}){this.url=r,this.headers=Object.assign(Object.assign({},o6.DEFAULT_HEADERS),o),this.schemaName=u,this.fetch=f}from(r){const o=new URL(`${this.url}/${r}`);return new i6.default(o,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(r){return new EM(this.url,{headers:this.headers,schema:r,fetch:this.fetch})}rpc(r,o={},{head:u=!1,get:f=!1,count:_}={}){let b;const T=new URL(`${this.url}/rpc/${r}`);let a;u||f?(b=u?"HEAD":"GET",Object.entries(o).filter(([D,j])=>j!==void 0).map(([D,j])=>[D,Array.isArray(j)?`{${j.join(",")}}`:`${j}`]).forEach(([D,j])=>{T.searchParams.append(D,j)})):(b="POST",a=o);const I=Object.assign({},this.headers);return _&&(I.Prefer=`count=${_}`),new s6.default({method:b,url:T,headers:I,schema:this.schemaName,body:a,fetch:this.fetch,allowEmpty:!1})}};Mb.default=a6;var Uh=ps&&ps.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(qi,"__esModule",{value:!0});qi.PostgrestError=qi.PostgrestBuilder=qi.PostgrestTransformBuilder=qi.PostgrestFilterBuilder=qi.PostgrestQueryBuilder=qi.PostgrestClient=void 0;const CM=Uh(Mb);qi.PostgrestClient=CM.default;const kM=Uh(G_);qi.PostgrestQueryBuilder=kM.default;const IM=Uh(Sp);qi.PostgrestFilterBuilder=IM.default;const AM=Uh(W_);qi.PostgrestTransformBuilder=AM.default;const MM=Uh(q_);qi.PostgrestBuilder=MM.default;const PM=Uh(H_);qi.PostgrestError=PM.default;var l6=qi.default={PostgrestClient:CM.default,PostgrestQueryBuilder:kM.default,PostgrestFilterBuilder:IM.default,PostgrestTransformBuilder:AM.default,PostgrestBuilder:MM.default,PostgrestError:PM.default};const{PostgrestClient:u6,PostgrestQueryBuilder:lU,PostgrestFilterBuilder:uU,PostgrestTransformBuilder:cU,PostgrestBuilder:hU,PostgrestError:dU}=l6,c6="2.11.2",h6={"X-Client-Info":`realtime-js/${c6}`},d6="1.0.0",RM=1e4,f6=1e3;var Th;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(Th||(Th={}));var us;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(us||(us={}));var mo;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(mo||(mo={}));var r1;(function(t){t.websocket="websocket"})(r1||(r1={}));var Ou;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(Ou||(Ou={}));class p6{constructor(){this.HEADER_LENGTH=1}decode(r,o){return r.constructor===ArrayBuffer?o(this._binaryDecode(r)):o(typeof r=="string"?JSON.parse(r):{})}_binaryDecode(r){const o=new DataView(r),u=new TextDecoder;return this._decodeBroadcast(r,o,u)}_decodeBroadcast(r,o,u){const f=o.getUint8(1),_=o.getUint8(2);let b=this.HEADER_LENGTH+2;const T=u.decode(r.slice(b,b+f));b=b+f;const a=u.decode(r.slice(b,b+_));b=b+_;const I=JSON.parse(u.decode(r.slice(b,r.byteLength)));return{ref:null,topic:T,event:a,payload:I}}}class LM{constructor(r,o){this.callback=r,this.timerCalc=o,this.timer=void 0,this.tries=0,this.callback=r,this.timerCalc=o}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Gr;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(Gr||(Gr={}));const zC=(t,r,o={})=>{var u;const f=(u=o.skipTypes)!==null&&u!==void 0?u:[];return Object.keys(r).reduce((_,b)=>(_[b]=m6(b,t,r,f),_),{})},m6=(t,r,o,u)=>{const f=r.find(T=>T.name===t),_=f==null?void 0:f.type,b=o[t];return _&&!u.includes(_)?zM(_,b):n1(b)},zM=(t,r)=>{if(t.charAt(0)==="_"){const o=t.slice(1,t.length);return v6(r,o)}switch(t){case Gr.bool:return g6(r);case Gr.float4:case Gr.float8:case Gr.int2:case Gr.int4:case Gr.int8:case Gr.numeric:case Gr.oid:return _6(r);case Gr.json:case Gr.jsonb:return y6(r);case Gr.timestamp:return x6(r);case Gr.abstime:case Gr.date:case Gr.daterange:case Gr.int4range:case Gr.int8range:case Gr.money:case Gr.reltime:case Gr.text:case Gr.time:case Gr.timestamptz:case Gr.timetz:case Gr.tsrange:case Gr.tstzrange:return n1(r);default:return n1(r)}},n1=t=>t,g6=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},_6=t=>{if(typeof t=="string"){const r=parseFloat(t);if(!Number.isNaN(r))return r}return t},y6=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(r){return console.log(`JSON parse error: ${r}`),t}return t},v6=(t,r)=>{if(typeof t!="string")return t;const o=t.length-1,u=t[o];if(t[0]==="{"&&u==="}"){let _;const b=t.slice(1,o);try{_=JSON.parse("["+b+"]")}catch{_=b?b.split(","):[]}return _.map(T=>zM(r,T))}return t},x6=t=>typeof t=="string"?t.replace(" ","T"):t,DM=t=>{let r=t;return r=r.replace(/^ws/i,"http"),r=r.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),r.replace(/\/+$/,"")};class Ax{constructor(r,o,u={},f=RM){this.channel=r,this.event=o,this.payload=u,this.timeout=f,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(r){this.timeout=r,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(r){this.payload=Object.assign(Object.assign({},this.payload),r)}receive(r,o){var u;return this._hasReceived(r)&&o((u=this.receivedResp)===null||u===void 0?void 0:u.response),this.recHooks.push({status:r,callback:o}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const r=o=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=o,this._matchReceive(o)};this.channel._on(this.refEvent,{},r),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(r,o){this.refEvent&&this.channel._trigger(this.refEvent,{status:r,response:o})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:r,response:o}){this.recHooks.filter(u=>u.status===r).forEach(u=>u.callback(o))}_hasReceived(r){return this.receivedResp&&this.receivedResp.status===r}}var DC;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(DC||(DC={}));class Uf{constructor(r,o){this.channel=r,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const u=(o==null?void 0:o.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(u.state,{},f=>{const{onJoin:_,onLeave:b,onSync:T}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Uf.syncState(this.state,f,_,b),this.pendingDiffs.forEach(a=>{this.state=Uf.syncDiff(this.state,a,_,b)}),this.pendingDiffs=[],T()}),this.channel._on(u.diff,{},f=>{const{onJoin:_,onLeave:b,onSync:T}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(f):(this.state=Uf.syncDiff(this.state,f,_,b),T())}),this.onJoin((f,_,b)=>{this.channel._trigger("presence",{event:"join",key:f,currentPresences:_,newPresences:b})}),this.onLeave((f,_,b)=>{this.channel._trigger("presence",{event:"leave",key:f,currentPresences:_,leftPresences:b})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(r,o,u,f){const _=this.cloneDeep(r),b=this.transformState(o),T={},a={};return this.map(_,(I,D)=>{b[I]||(a[I]=D)}),this.map(b,(I,D)=>{const j=_[I];if(j){const V=D.map(be=>be.presence_ref),q=j.map(be=>be.presence_ref),se=D.filter(be=>q.indexOf(be.presence_ref)<0),pe=j.filter(be=>V.indexOf(be.presence_ref)<0);se.length>0&&(T[I]=se),pe.length>0&&(a[I]=pe)}else T[I]=D}),this.syncDiff(_,{joins:T,leaves:a},u,f)}static syncDiff(r,o,u,f){const{joins:_,leaves:b}={joins:this.transformState(o.joins),leaves:this.transformState(o.leaves)};return u||(u=()=>{}),f||(f=()=>{}),this.map(_,(T,a)=>{var I;const D=(I=r[T])!==null&&I!==void 0?I:[];if(r[T]=this.cloneDeep(a),D.length>0){const j=r[T].map(q=>q.presence_ref),V=D.filter(q=>j.indexOf(q.presence_ref)<0);r[T].unshift(...V)}u(T,D,a)}),this.map(b,(T,a)=>{let I=r[T];if(!I)return;const D=a.map(j=>j.presence_ref);I=I.filter(j=>D.indexOf(j.presence_ref)<0),r[T]=I,f(T,I,a),I.length===0&&delete r[T]}),r}static map(r,o){return Object.getOwnPropertyNames(r).map(u=>o(u,r[u]))}static transformState(r){return r=this.cloneDeep(r),Object.getOwnPropertyNames(r).reduce((o,u)=>{const f=r[u];return"metas"in f?o[u]=f.metas.map(_=>(_.presence_ref=_.phx_ref,delete _.phx_ref,delete _.phx_ref_prev,_)):o[u]=f,o},{})}static cloneDeep(r){return JSON.parse(JSON.stringify(r))}onJoin(r){this.caller.onJoin=r}onLeave(r){this.caller.onLeave=r}onSync(r){this.caller.onSync=r}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var OC;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(OC||(OC={}));var BC;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(BC||(BC={}));var xa;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(xa||(xa={}));class Pb{constructor(r,o={config:{}},u){this.topic=r,this.params=o,this.socket=u,this.bindings={},this.state=us.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=r.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},o.config),this.timeout=this.socket.timeout,this.joinPush=new Ax(this,mo.join,this.params,this.timeout),this.rejoinTimer=new LM(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=us.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(f=>f.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=us.closed,this.socket._remove(this)}),this._onError(f=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,f),this.state=us.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=us.errored,this.rejoinTimer.scheduleTimeout())}),this._on(mo.reply,{},(f,_)=>{this._trigger(this._replyEventName(_),f)}),this.presence=new Uf(this),this.broadcastEndpointURL=DM(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(r,o=this.timeout){var u,f;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:_,presence:b,private:T}}=this.params;this._onError(D=>r==null?void 0:r(xa.CHANNEL_ERROR,D)),this._onClose(()=>r==null?void 0:r(xa.CLOSED));const a={},I={broadcast:_,presence:b,postgres_changes:(f=(u=this.bindings.postgres_changes)===null||u===void 0?void 0:u.map(D=>D.filter))!==null&&f!==void 0?f:[],private:T};this.socket.accessTokenValue&&(a.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:I},a)),this.joinedOnce=!0,this._rejoin(o),this.joinPush.receive("ok",async({postgres_changes:D})=>{var j;if(this.socket.setAuth(),D===void 0){r==null||r(xa.SUBSCRIBED);return}else{const V=this.bindings.postgres_changes,q=(j=V==null?void 0:V.length)!==null&&j!==void 0?j:0,se=[];for(let pe=0;pe<q;pe++){const be=V[pe],{filter:{event:te,schema:X,table:ie,filter:Se}}=be,Ce=D&&D[pe];if(Ce&&Ce.event===te&&Ce.schema===X&&Ce.table===ie&&Ce.filter===Se)se.push(Object.assign(Object.assign({},be),{id:Ce.id}));else{this.unsubscribe(),r==null||r(xa.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=se,r&&r(xa.SUBSCRIBED);return}}).receive("error",D=>{r==null||r(xa.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(D).join(", ")||"error")))}).receive("timeout",()=>{r==null||r(xa.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(r,o={}){return await this.send({type:"presence",event:"track",payload:r},o.timeout||this.timeout)}async untrack(r={}){return await this.send({type:"presence",event:"untrack"},r)}on(r,o,u){return this._on(r,o,u)}async send(r,o={}){var u,f;if(!this._canPush()&&r.type==="broadcast"){const{event:_,payload:b}=r,a={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:_,payload:b,private:this.private}]})};try{const I=await this._fetchWithTimeout(this.broadcastEndpointURL,a,(u=o.timeout)!==null&&u!==void 0?u:this.timeout);return await((f=I.body)===null||f===void 0?void 0:f.cancel()),I.ok?"ok":"error"}catch(I){return I.name==="AbortError"?"timed out":"error"}}else return new Promise(_=>{var b,T,a;const I=this._push(r.type,r,o.timeout||this.timeout);r.type==="broadcast"&&!(!((a=(T=(b=this.params)===null||b===void 0?void 0:b.config)===null||T===void 0?void 0:T.broadcast)===null||a===void 0)&&a.ack)&&_("ok"),I.receive("ok",()=>_("ok")),I.receive("error",()=>_("error")),I.receive("timeout",()=>_("timed out"))})}updateJoinPayload(r){this.joinPush.updatePayload(r)}unsubscribe(r=this.timeout){this.state=us.leaving;const o=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(mo.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(u=>{const f=new Ax(this,mo.leave,{},r);f.receive("ok",()=>{o(),u("ok")}).receive("timeout",()=>{o(),u("timed out")}).receive("error",()=>{u("error")}),f.send(),this._canPush()||f.trigger("ok",{})})}async _fetchWithTimeout(r,o,u){const f=new AbortController,_=setTimeout(()=>f.abort(),u),b=await this.socket.fetch(r,Object.assign(Object.assign({},o),{signal:f.signal}));return clearTimeout(_),b}_push(r,o,u=this.timeout){if(!this.joinedOnce)throw`tried to push '${r}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let f=new Ax(this,r,o,u);return this._canPush()?f.send():(f.startTimeout(),this.pushBuffer.push(f)),f}_onMessage(r,o,u){return o}_isMember(r){return this.topic===r}_joinRef(){return this.joinPush.ref}_trigger(r,o,u){var f,_;const b=r.toLocaleLowerCase(),{close:T,error:a,leave:I,join:D}=mo;if(u&&[T,a,I,D].indexOf(b)>=0&&u!==this._joinRef())return;let V=this._onMessage(b,o,u);if(o&&!V)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(b)?(f=this.bindings.postgres_changes)===null||f===void 0||f.filter(q=>{var se,pe,be;return((se=q.filter)===null||se===void 0?void 0:se.event)==="*"||((be=(pe=q.filter)===null||pe===void 0?void 0:pe.event)===null||be===void 0?void 0:be.toLocaleLowerCase())===b}).map(q=>q.callback(V,u)):(_=this.bindings[b])===null||_===void 0||_.filter(q=>{var se,pe,be,te,X,ie;if(["broadcast","presence","postgres_changes"].includes(b))if("id"in q){const Se=q.id,Ce=(se=q.filter)===null||se===void 0?void 0:se.event;return Se&&((pe=o.ids)===null||pe===void 0?void 0:pe.includes(Se))&&(Ce==="*"||(Ce==null?void 0:Ce.toLocaleLowerCase())===((be=o.data)===null||be===void 0?void 0:be.type.toLocaleLowerCase()))}else{const Se=(X=(te=q==null?void 0:q.filter)===null||te===void 0?void 0:te.event)===null||X===void 0?void 0:X.toLocaleLowerCase();return Se==="*"||Se===((ie=o==null?void 0:o.event)===null||ie===void 0?void 0:ie.toLocaleLowerCase())}else return q.type.toLocaleLowerCase()===b}).map(q=>{if(typeof V=="object"&&"ids"in V){const se=V.data,{schema:pe,table:be,commit_timestamp:te,type:X,errors:ie}=se;V=Object.assign(Object.assign({},{schema:pe,table:be,commit_timestamp:te,eventType:X,new:{},old:{},errors:ie}),this._getPayloadRecords(se))}q.callback(V,u)})}_isClosed(){return this.state===us.closed}_isJoined(){return this.state===us.joined}_isJoining(){return this.state===us.joining}_isLeaving(){return this.state===us.leaving}_replyEventName(r){return`chan_reply_${r}`}_on(r,o,u){const f=r.toLocaleLowerCase(),_={type:f,filter:o,callback:u};return this.bindings[f]?this.bindings[f].push(_):this.bindings[f]=[_],this}_off(r,o){const u=r.toLocaleLowerCase();return this.bindings[u]=this.bindings[u].filter(f=>{var _;return!(((_=f.type)===null||_===void 0?void 0:_.toLocaleLowerCase())===u&&Pb.isEqual(f.filter,o))}),this}static isEqual(r,o){if(Object.keys(r).length!==Object.keys(o).length)return!1;for(const u in r)if(r[u]!==o[u])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(r){this._on(mo.close,{},r)}_onError(r){this._on(mo.error,{},o=>r(o))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(r=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=us.joining,this.joinPush.resend(r))}_getPayloadRecords(r){const o={new:{},old:{}};return(r.type==="INSERT"||r.type==="UPDATE")&&(o.new=zC(r.columns,r.record)),(r.type==="UPDATE"||r.type==="DELETE")&&(o.old=zC(r.columns,r.old_record)),o}}const b6=()=>{},w6=typeof WebSocket<"u",S6=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class T6{constructor(r,o){var u;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=h6,this.params={},this.timeout=RM,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=b6,this.conn=null,this.sendBuffer=[],this.serializer=new p6,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=_=>{let b;return _?b=_:typeof fetch>"u"?b=(...T)=>Lh(async()=>{const{default:a}=await Promise.resolve().then(()=>Nh);return{default:a}},void 0).then(({default:a})=>a(...T)):b=fetch,(...T)=>b(...T)},this.endPoint=`${r}/${r1.websocket}`,this.httpEndpoint=DM(r),o!=null&&o.transport?this.transport=o.transport:this.transport=null,o!=null&&o.params&&(this.params=o.params),o!=null&&o.headers&&(this.headers=Object.assign(Object.assign({},this.headers),o.headers)),o!=null&&o.timeout&&(this.timeout=o.timeout),o!=null&&o.logger&&(this.logger=o.logger),o!=null&&o.heartbeatIntervalMs&&(this.heartbeatIntervalMs=o.heartbeatIntervalMs);const f=(u=o==null?void 0:o.params)===null||u===void 0?void 0:u.apikey;if(f&&(this.accessTokenValue=f,this.apiKey=f),this.reconnectAfterMs=o!=null&&o.reconnectAfterMs?o.reconnectAfterMs:_=>[1e3,2e3,5e3,1e4][_-1]||1e4,this.encode=o!=null&&o.encode?o.encode:(_,b)=>b(JSON.stringify(_)),this.decode=o!=null&&o.decode?o.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new LM(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(o==null?void 0:o.fetch),o!=null&&o.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(o==null?void 0:o.worker)||!1,this.workerUrl=o==null?void 0:o.workerUrl}this.accessToken=(o==null?void 0:o.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(w6){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new E6(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),Lh(async()=>{const{default:r}=await import("./browser-CS5A96Q6.js").then(o=>o.b);return{default:r}},[]).then(({default:r})=>{this.conn=new r(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:d6}))}disconnect(r,o){this.conn&&(this.conn.onclose=function(){},r?this.conn.close(r,o??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(r){const o=await r.unsubscribe();return this.channels.length===0&&this.disconnect(),o}async removeAllChannels(){const r=await Promise.all(this.channels.map(o=>o.unsubscribe()));return this.disconnect(),r}log(r,o,u){this.logger(r,o,u)}connectionState(){switch(this.conn&&this.conn.readyState){case Th.connecting:return Ou.Connecting;case Th.open:return Ou.Open;case Th.closing:return Ou.Closing;default:return Ou.Closed}}isConnected(){return this.connectionState()===Ou.Open}channel(r,o={config:{}}){const u=new Pb(`realtime:${r}`,o,this);return this.channels.push(u),u}push(r){const{topic:o,event:u,payload:f,ref:_}=r,b=()=>{this.encode(r,T=>{var a;(a=this.conn)===null||a===void 0||a.send(T)})};this.log("push",`${o} ${u} (${_})`,f),this.isConnected()?b():this.sendBuffer.push(b)}async setAuth(r=null){let o=r||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(o){let u=null;try{u=JSON.parse(atob(o.split(".")[1]))}catch{}if(u&&u.exp&&!(Math.floor(Date.now()/1e3)-u.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${u.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${u.exp}`);this.accessTokenValue=o,this.channels.forEach(f=>{o&&f.updateJoinPayload({access_token:o}),f.joinedOnce&&f._isJoined()&&f._push(mo.access_token,{access_token:o})})}}async sendHeartbeat(){var r;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(r=this.conn)===null||r===void 0||r.close(f6,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(r=>r()),this.sendBuffer=[])}_makeRef(){let r=this.ref+1;return r===this.ref?this.ref=0:this.ref=r,this.ref.toString()}_leaveOpenTopic(r){let o=this.channels.find(u=>u.topic===r&&(u._isJoined()||u._isJoining()));o&&(this.log("transport",`leaving duplicate topic "${r}"`),o.unsubscribe())}_remove(r){this.channels=this.channels.filter(o=>o._joinRef()!==r._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=r=>this._onConnError(r),this.conn.onmessage=r=>this._onConnMessage(r),this.conn.onclose=r=>this._onConnClose(r))}_onConnMessage(r){this.decode(r.data,o=>{let{topic:u,event:f,payload:_,ref:b}=o;b&&b===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${_.status||""} ${u} ${f} ${b&&"("+b+")"||""}`,_),this.channels.filter(T=>T._isMember(u)).forEach(T=>T._trigger(f,_,b)),this.stateChangeCallbacks.message.forEach(T=>T(o))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const r=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(r),this.workerRef.onerror=o=>{this.log("worker","worker error",o.message),this.workerRef.terminate()},this.workerRef.onmessage=o=>{o.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(r=>r())}_onConnClose(r){this.log("transport","close",r),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(o=>o(r))}_onConnError(r){this.log("transport",r.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(o=>o(r))}_triggerChanError(){this.channels.forEach(r=>r._trigger(mo.error))}_appendParams(r,o){if(Object.keys(o).length===0)return r;const u=r.match(/\?/)?"&":"?",f=new URLSearchParams(o);return`${r}${u}${f}`}_workerObjectUrl(r){let o;if(r)o=r;else{const u=new Blob([S6],{type:"application/javascript"});o=URL.createObjectURL(u)}return o}}class E6{constructor(r,o,u){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=Th.connecting,this.send=()=>{},this.url=null,this.url=r,this.close=u.close}}class Rb extends Error{constructor(r){super(r),this.__isStorageError=!0,this.name="StorageError"}}function Hn(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class C6 extends Rb{constructor(r,o){super(r),this.name="StorageApiError",this.status=o}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class i1 extends Rb{constructor(r,o){super(r),this.name="StorageUnknownError",this.originalError=o}}var k6=function(t,r,o,u){function f(_){return _ instanceof o?_:new o(function(b){b(_)})}return new(o||(o=Promise))(function(_,b){function T(D){try{I(u.next(D))}catch(j){b(j)}}function a(D){try{I(u.throw(D))}catch(j){b(j)}}function I(D){D.done?_(D.value):f(D.value).then(T,a)}I((u=u.apply(t,r||[])).next())})};const OM=t=>{let r;return t?r=t:typeof fetch>"u"?r=(...o)=>Lh(async()=>{const{default:u}=await Promise.resolve().then(()=>Nh);return{default:u}},void 0).then(({default:u})=>u(...o)):r=fetch,(...o)=>r(...o)},I6=()=>k6(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Lh(()=>Promise.resolve().then(()=>Nh),void 0)).Response:Response}),s1=t=>{if(Array.isArray(t))return t.map(o=>s1(o));if(typeof t=="function"||t!==Object(t))return t;const r={};return Object.entries(t).forEach(([o,u])=>{const f=o.replace(/([-_][a-z])/gi,_=>_.toUpperCase().replace(/[-_]/g,""));r[f]=s1(u)}),r};var rc=function(t,r,o,u){function f(_){return _ instanceof o?_:new o(function(b){b(_)})}return new(o||(o=Promise))(function(_,b){function T(D){try{I(u.next(D))}catch(j){b(j)}}function a(D){try{I(u.throw(D))}catch(j){b(j)}}function I(D){D.done?_(D.value):f(D.value).then(T,a)}I((u=u.apply(t,r||[])).next())})};const Mx=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),A6=(t,r,o)=>rc(void 0,void 0,void 0,function*(){const u=yield I6();t instanceof u&&!(o!=null&&o.noResolveJson)?t.json().then(f=>{r(new C6(Mx(f),t.status||500))}).catch(f=>{r(new i1(Mx(f),f))}):r(new i1(Mx(t),t))}),M6=(t,r,o,u)=>{const f={method:t,headers:(r==null?void 0:r.headers)||{}};return t==="GET"?f:(f.headers=Object.assign({"Content-Type":"application/json"},r==null?void 0:r.headers),u&&(f.body=JSON.stringify(u)),Object.assign(Object.assign({},f),o))};function Tp(t,r,o,u,f,_){return rc(this,void 0,void 0,function*(){return new Promise((b,T)=>{t(o,M6(r,u,f,_)).then(a=>{if(!a.ok)throw a;return u!=null&&u.noResolveJson?a:a.json()}).then(a=>b(a)).catch(a=>A6(a,T,u))})})}function y_(t,r,o,u){return rc(this,void 0,void 0,function*(){return Tp(t,"GET",r,o,u)})}function Sl(t,r,o,u,f){return rc(this,void 0,void 0,function*(){return Tp(t,"POST",r,u,f,o)})}function P6(t,r,o,u,f){return rc(this,void 0,void 0,function*(){return Tp(t,"PUT",r,u,f,o)})}function R6(t,r,o,u){return rc(this,void 0,void 0,function*(){return Tp(t,"HEAD",r,Object.assign(Object.assign({},o),{noResolveJson:!0}),u)})}function BM(t,r,o,u,f){return rc(this,void 0,void 0,function*(){return Tp(t,"DELETE",r,u,f,o)})}var Gi=function(t,r,o,u){function f(_){return _ instanceof o?_:new o(function(b){b(_)})}return new(o||(o=Promise))(function(_,b){function T(D){try{I(u.next(D))}catch(j){b(j)}}function a(D){try{I(u.throw(D))}catch(j){b(j)}}function I(D){D.done?_(D.value):f(D.value).then(T,a)}I((u=u.apply(t,r||[])).next())})};const L6={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},FC={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class z6{constructor(r,o={},u,f){this.url=r,this.headers=o,this.bucketId=u,this.fetch=OM(f)}uploadOrUpdate(r,o,u,f){return Gi(this,void 0,void 0,function*(){try{let _;const b=Object.assign(Object.assign({},FC),f);let T=Object.assign(Object.assign({},this.headers),r==="POST"&&{"x-upsert":String(b.upsert)});const a=b.metadata;typeof Blob<"u"&&u instanceof Blob?(_=new FormData,_.append("cacheControl",b.cacheControl),a&&_.append("metadata",this.encodeMetadata(a)),_.append("",u)):typeof FormData<"u"&&u instanceof FormData?(_=u,_.append("cacheControl",b.cacheControl),a&&_.append("metadata",this.encodeMetadata(a))):(_=u,T["cache-control"]=`max-age=${b.cacheControl}`,T["content-type"]=b.contentType,a&&(T["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),f!=null&&f.headers&&(T=Object.assign(Object.assign({},T),f.headers));const I=this._removeEmptyFolders(o),D=this._getFinalPath(I),j=yield this.fetch(`${this.url}/object/${D}`,Object.assign({method:r,body:_,headers:T},b!=null&&b.duplex?{duplex:b.duplex}:{})),V=yield j.json();return j.ok?{data:{path:I,id:V.Id,fullPath:V.Key},error:null}:{data:null,error:V}}catch(_){if(Hn(_))return{data:null,error:_};throw _}})}upload(r,o,u){return Gi(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",r,o,u)})}uploadToSignedUrl(r,o,u,f){return Gi(this,void 0,void 0,function*(){const _=this._removeEmptyFolders(r),b=this._getFinalPath(_),T=new URL(this.url+`/object/upload/sign/${b}`);T.searchParams.set("token",o);try{let a;const I=Object.assign({upsert:FC.upsert},f),D=Object.assign(Object.assign({},this.headers),{"x-upsert":String(I.upsert)});typeof Blob<"u"&&u instanceof Blob?(a=new FormData,a.append("cacheControl",I.cacheControl),a.append("",u)):typeof FormData<"u"&&u instanceof FormData?(a=u,a.append("cacheControl",I.cacheControl)):(a=u,D["cache-control"]=`max-age=${I.cacheControl}`,D["content-type"]=I.contentType);const j=yield this.fetch(T.toString(),{method:"PUT",body:a,headers:D}),V=yield j.json();return j.ok?{data:{path:_,fullPath:V.Key},error:null}:{data:null,error:V}}catch(a){if(Hn(a))return{data:null,error:a};throw a}})}createSignedUploadUrl(r,o){return Gi(this,void 0,void 0,function*(){try{let u=this._getFinalPath(r);const f=Object.assign({},this.headers);o!=null&&o.upsert&&(f["x-upsert"]="true");const _=yield Sl(this.fetch,`${this.url}/object/upload/sign/${u}`,{},{headers:f}),b=new URL(this.url+_.url),T=b.searchParams.get("token");if(!T)throw new Rb("No token returned by API");return{data:{signedUrl:b.toString(),path:r,token:T},error:null}}catch(u){if(Hn(u))return{data:null,error:u};throw u}})}update(r,o,u){return Gi(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",r,o,u)})}move(r,o,u){return Gi(this,void 0,void 0,function*(){try{return{data:yield Sl(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:r,destinationKey:o,destinationBucket:u==null?void 0:u.destinationBucket},{headers:this.headers}),error:null}}catch(f){if(Hn(f))return{data:null,error:f};throw f}})}copy(r,o,u){return Gi(this,void 0,void 0,function*(){try{return{data:{path:(yield Sl(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:r,destinationKey:o,destinationBucket:u==null?void 0:u.destinationBucket},{headers:this.headers})).Key},error:null}}catch(f){if(Hn(f))return{data:null,error:f};throw f}})}createSignedUrl(r,o,u){return Gi(this,void 0,void 0,function*(){try{let f=this._getFinalPath(r),_=yield Sl(this.fetch,`${this.url}/object/sign/${f}`,Object.assign({expiresIn:o},u!=null&&u.transform?{transform:u.transform}:{}),{headers:this.headers});const b=u!=null&&u.download?`&download=${u.download===!0?"":u.download}`:"";return _={signedUrl:encodeURI(`${this.url}${_.signedURL}${b}`)},{data:_,error:null}}catch(f){if(Hn(f))return{data:null,error:f};throw f}})}createSignedUrls(r,o,u){return Gi(this,void 0,void 0,function*(){try{const f=yield Sl(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:o,paths:r},{headers:this.headers}),_=u!=null&&u.download?`&download=${u.download===!0?"":u.download}`:"";return{data:f.map(b=>Object.assign(Object.assign({},b),{signedUrl:b.signedURL?encodeURI(`${this.url}${b.signedURL}${_}`):null})),error:null}}catch(f){if(Hn(f))return{data:null,error:f};throw f}})}download(r,o){return Gi(this,void 0,void 0,function*(){const f=typeof(o==null?void 0:o.transform)<"u"?"render/image/authenticated":"object",_=this.transformOptsToQueryString((o==null?void 0:o.transform)||{}),b=_?`?${_}`:"";try{const T=this._getFinalPath(r);return{data:yield(yield y_(this.fetch,`${this.url}/${f}/${T}${b}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(T){if(Hn(T))return{data:null,error:T};throw T}})}info(r){return Gi(this,void 0,void 0,function*(){const o=this._getFinalPath(r);try{const u=yield y_(this.fetch,`${this.url}/object/info/${o}`,{headers:this.headers});return{data:s1(u),error:null}}catch(u){if(Hn(u))return{data:null,error:u};throw u}})}exists(r){return Gi(this,void 0,void 0,function*(){const o=this._getFinalPath(r);try{return yield R6(this.fetch,`${this.url}/object/${o}`,{headers:this.headers}),{data:!0,error:null}}catch(u){if(Hn(u)&&u instanceof i1){const f=u.originalError;if([400,404].includes(f==null?void 0:f.status))return{data:!1,error:u}}throw u}})}getPublicUrl(r,o){const u=this._getFinalPath(r),f=[],_=o!=null&&o.download?`download=${o.download===!0?"":o.download}`:"";_!==""&&f.push(_);const T=typeof(o==null?void 0:o.transform)<"u"?"render/image":"object",a=this.transformOptsToQueryString((o==null?void 0:o.transform)||{});a!==""&&f.push(a);let I=f.join("&");return I!==""&&(I=`?${I}`),{data:{publicUrl:encodeURI(`${this.url}/${T}/public/${u}${I}`)}}}remove(r){return Gi(this,void 0,void 0,function*(){try{return{data:yield BM(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:r},{headers:this.headers}),error:null}}catch(o){if(Hn(o))return{data:null,error:o};throw o}})}list(r,o,u){return Gi(this,void 0,void 0,function*(){try{const f=Object.assign(Object.assign(Object.assign({},L6),o),{prefix:r||""});return{data:yield Sl(this.fetch,`${this.url}/object/list/${this.bucketId}`,f,{headers:this.headers},u),error:null}}catch(f){if(Hn(f))return{data:null,error:f};throw f}})}encodeMetadata(r){return JSON.stringify(r)}toBase64(r){return typeof Buffer<"u"?Buffer.from(r).toString("base64"):btoa(r)}_getFinalPath(r){return`${this.bucketId}/${r}`}_removeEmptyFolders(r){return r.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(r){const o=[];return r.width&&o.push(`width=${r.width}`),r.height&&o.push(`height=${r.height}`),r.resize&&o.push(`resize=${r.resize}`),r.format&&o.push(`format=${r.format}`),r.quality&&o.push(`quality=${r.quality}`),o.join("&")}}const D6="2.7.1",O6={"X-Client-Info":`storage-js/${D6}`};var th=function(t,r,o,u){function f(_){return _ instanceof o?_:new o(function(b){b(_)})}return new(o||(o=Promise))(function(_,b){function T(D){try{I(u.next(D))}catch(j){b(j)}}function a(D){try{I(u.throw(D))}catch(j){b(j)}}function I(D){D.done?_(D.value):f(D.value).then(T,a)}I((u=u.apply(t,r||[])).next())})};class B6{constructor(r,o={},u){this.url=r,this.headers=Object.assign(Object.assign({},O6),o),this.fetch=OM(u)}listBuckets(){return th(this,void 0,void 0,function*(){try{return{data:yield y_(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(r){if(Hn(r))return{data:null,error:r};throw r}})}getBucket(r){return th(this,void 0,void 0,function*(){try{return{data:yield y_(this.fetch,`${this.url}/bucket/${r}`,{headers:this.headers}),error:null}}catch(o){if(Hn(o))return{data:null,error:o};throw o}})}createBucket(r,o={public:!1}){return th(this,void 0,void 0,function*(){try{return{data:yield Sl(this.fetch,`${this.url}/bucket`,{id:r,name:r,public:o.public,file_size_limit:o.fileSizeLimit,allowed_mime_types:o.allowedMimeTypes},{headers:this.headers}),error:null}}catch(u){if(Hn(u))return{data:null,error:u};throw u}})}updateBucket(r,o){return th(this,void 0,void 0,function*(){try{return{data:yield P6(this.fetch,`${this.url}/bucket/${r}`,{id:r,name:r,public:o.public,file_size_limit:o.fileSizeLimit,allowed_mime_types:o.allowedMimeTypes},{headers:this.headers}),error:null}}catch(u){if(Hn(u))return{data:null,error:u};throw u}})}emptyBucket(r){return th(this,void 0,void 0,function*(){try{return{data:yield Sl(this.fetch,`${this.url}/bucket/${r}/empty`,{},{headers:this.headers}),error:null}}catch(o){if(Hn(o))return{data:null,error:o};throw o}})}deleteBucket(r){return th(this,void 0,void 0,function*(){try{return{data:yield BM(this.fetch,`${this.url}/bucket/${r}`,{},{headers:this.headers}),error:null}}catch(o){if(Hn(o))return{data:null,error:o};throw o}})}}class F6 extends B6{constructor(r,o={},u){super(r,o,u)}from(r){return new z6(this.url,this.headers,r,this.fetch)}}const j6="2.47.12";let kf="";typeof Deno<"u"?kf="deno":typeof document<"u"?kf="web":typeof navigator<"u"&&navigator.product==="ReactNative"?kf="react-native":kf="node";const N6={"X-Client-Info":`supabase-js-${kf}/${j6}`},U6={headers:N6},V6={schema:"public"},$6={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},G6={};var W6=function(t,r,o,u){function f(_){return _ instanceof o?_:new o(function(b){b(_)})}return new(o||(o=Promise))(function(_,b){function T(D){try{I(u.next(D))}catch(j){b(j)}}function a(D){try{I(u.throw(D))}catch(j){b(j)}}function I(D){D.done?_(D.value):f(D.value).then(T,a)}I((u=u.apply(t,r||[])).next())})};const q6=t=>{let r;return t?r=t:typeof fetch>"u"?r=bM:r=fetch,(...o)=>r(...o)},H6=()=>typeof Headers>"u"?wM:Headers,Z6=(t,r,o)=>{const u=q6(o),f=H6();return(_,b)=>W6(void 0,void 0,void 0,function*(){var T;const a=(T=yield r())!==null&&T!==void 0?T:t;let I=new f(b==null?void 0:b.headers);return I.has("apikey")||I.set("apikey",t),I.has("Authorization")||I.set("Authorization",`Bearer ${a}`),u(_,Object.assign(Object.assign({},b),{headers:I}))})};var X6=function(t,r,o,u){function f(_){return _ instanceof o?_:new o(function(b){b(_)})}return new(o||(o=Promise))(function(_,b){function T(D){try{I(u.next(D))}catch(j){b(j)}}function a(D){try{I(u.throw(D))}catch(j){b(j)}}function I(D){D.done?_(D.value):f(D.value).then(T,a)}I((u=u.apply(t,r||[])).next())})};function K6(t){return t.replace(/\/$/,"")}function Y6(t,r){const{db:o,auth:u,realtime:f,global:_}=t,{db:b,auth:T,realtime:a,global:I}=r,D={db:Object.assign(Object.assign({},b),o),auth:Object.assign(Object.assign({},T),u),realtime:Object.assign(Object.assign({},a),f),global:Object.assign(Object.assign({},I),_),accessToken:()=>X6(this,void 0,void 0,function*(){return""})};return t.accessToken?D.accessToken=t.accessToken:delete D.accessToken,D}const FM="2.67.3",J6="http://localhost:9999",Q6="supabase.auth.token",eN={"X-Client-Info":`gotrue-js/${FM}`},jC=10,o1="X-Supabase-Api-Version",jM={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function tN(t){return Math.round(Date.now()/1e3)+t}function rN(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const r=Math.random()*16|0;return(t=="x"?r:r&3|8).toString(16)})}const Go=()=>typeof window<"u"&&typeof document<"u",Ru={tested:!1,writable:!1},Vf=()=>{if(!Go())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ru.tested)return Ru.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Ru.tested=!0,Ru.writable=!0}catch{Ru.tested=!0,Ru.writable=!1}return Ru.writable};function nN(t){const r={},o=new URL(t);if(o.hash&&o.hash[0]==="#")try{new URLSearchParams(o.hash.substring(1)).forEach((f,_)=>{r[_]=f})}catch{}return o.searchParams.forEach((u,f)=>{r[f]=u}),r}const NM=t=>{let r;return t?r=t:typeof fetch>"u"?r=(...o)=>Lh(async()=>{const{default:u}=await Promise.resolve().then(()=>Nh);return{default:u}},void 0).then(({default:u})=>u(...o)):r=fetch,(...o)=>r(...o)},iN=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",UM=async(t,r,o)=>{await t.setItem(r,JSON.stringify(o))},mg=async(t,r)=>{const o=await t.getItem(r);if(!o)return null;try{return JSON.parse(o)}catch{return o}},gg=async(t,r)=>{await t.removeItem(r)};function sN(t){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let o="",u,f,_,b,T,a,I,D=0;for(t=t.replace("-","+").replace("_","/");D<t.length;)b=r.indexOf(t.charAt(D++)),T=r.indexOf(t.charAt(D++)),a=r.indexOf(t.charAt(D++)),I=r.indexOf(t.charAt(D++)),u=b<<2|T>>4,f=(T&15)<<4|a>>2,_=(a&3)<<6|I,o=o+String.fromCharCode(u),a!=64&&f!=0&&(o=o+String.fromCharCode(f)),I!=64&&_!=0&&(o=o+String.fromCharCode(_));return o}class K_{constructor(){this.promise=new K_.promiseConstructor((r,o)=>{this.resolve=r,this.reject=o})}}K_.promiseConstructor=Promise;function NC(t){const r=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,o=t.split(".");if(o.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!r.test(o[1]))throw new Error("JWT is not valid: payload is not in base64url format");const u=o[1];return JSON.parse(sN(u))}async function oN(t){return await new Promise(r=>{setTimeout(()=>r(null),t)})}function aN(t,r){return new Promise((u,f)=>{(async()=>{for(let _=0;_<1/0;_++)try{const b=await t(_);if(!r(_,null,b)){u(b);return}}catch(b){if(!r(_,b)){f(b);return}}})()})}function lN(t){return("0"+t.toString(16)).substr(-2)}function uN(){const r=new Uint32Array(56);if(typeof crypto>"u"){const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",u=o.length;let f="";for(let _=0;_<56;_++)f+=o.charAt(Math.floor(Math.random()*u));return f}return crypto.getRandomValues(r),Array.from(r,lN).join("")}async function cN(t){const o=new TextEncoder().encode(t),u=await crypto.subtle.digest("SHA-256",o),f=new Uint8Array(u);return Array.from(f).map(_=>String.fromCharCode(_)).join("")}function hN(t){return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function dN(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const o=await cN(t);return hN(o)}async function rh(t,r,o=!1){const u=uN();let f=u;o&&(f+="/PASSWORD_RECOVERY"),await UM(t,`${r}-code-verifier`,f);const _=await dN(u);return[_,u===_?"plain":"s256"]}const fN=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function pN(t){const r=t.headers.get(o1);if(!r||!r.match(fN))return null;try{return new Date(`${r}T00:00:00.0Z`)}catch{return null}}class Lb extends Error{constructor(r,o,u){super(r),this.__isAuthError=!0,this.name="AuthError",this.status=o,this.code=u}}function Jt(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class mN extends Lb{constructor(r,o,u){super(r,o,u),this.name="AuthApiError",this.status=o,this.code=u}}function gN(t){return Jt(t)&&t.name==="AuthApiError"}class VM extends Lb{constructor(r,o){super(r),this.name="AuthUnknownError",this.originalError=o}}class nc extends Lb{constructor(r,o,u,f){super(r,u,f),this.name=o,this.status=u}}class _l extends nc{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function _N(t){return Jt(t)&&t.name==="AuthSessionMissingError"}class Px extends nc{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class _g extends nc{constructor(r){super(r,"AuthInvalidCredentialsError",400,void 0)}}class yg extends nc{constructor(r,o=null){super(r,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=o}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function yN(t){return Jt(t)&&t.name==="AuthImplicitGrantRedirectError"}class UC extends nc{constructor(r,o=null){super(r,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=o}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class a1 extends nc{constructor(r,o){super(r,"AuthRetryableFetchError",o,void 0)}}function Rx(t){return Jt(t)&&t.name==="AuthRetryableFetchError"}class VC extends nc{constructor(r,o,u){super(r,"AuthWeakPasswordError",o,"weak_password"),this.reasons=u}}var vN=function(t,r){var o={};for(var u in t)Object.prototype.hasOwnProperty.call(t,u)&&r.indexOf(u)<0&&(o[u]=t[u]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,u=Object.getOwnPropertySymbols(t);f<u.length;f++)r.indexOf(u[f])<0&&Object.prototype.propertyIsEnumerable.call(t,u[f])&&(o[u[f]]=t[u[f]]);return o};const Du=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),xN=[502,503,504];async function $C(t){var r;if(!iN(t))throw new a1(Du(t),0);if(xN.includes(t.status))throw new a1(Du(t),t.status);let o;try{o=await t.json()}catch(_){throw new VM(Du(_),_)}let u;const f=pN(t);if(f&&f.getTime()>=jM["2024-01-01"].timestamp&&typeof o=="object"&&o&&typeof o.code=="string"?u=o.code:typeof o=="object"&&o&&typeof o.error_code=="string"&&(u=o.error_code),u){if(u==="weak_password")throw new VC(Du(o),t.status,((r=o.weak_password)===null||r===void 0?void 0:r.reasons)||[]);if(u==="session_not_found")throw new _l}else if(typeof o=="object"&&o&&typeof o.weak_password=="object"&&o.weak_password&&Array.isArray(o.weak_password.reasons)&&o.weak_password.reasons.length&&o.weak_password.reasons.reduce((_,b)=>_&&typeof b=="string",!0))throw new VC(Du(o),t.status,o.weak_password.reasons);throw new mN(Du(o),t.status||500,u)}const bN=(t,r,o,u)=>{const f={method:t,headers:(r==null?void 0:r.headers)||{}};return t==="GET"?f:(f.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},r==null?void 0:r.headers),f.body=JSON.stringify(u),Object.assign(Object.assign({},f),o))};async function ur(t,r,o,u){var f;const _=Object.assign({},u==null?void 0:u.headers);_[o1]||(_[o1]=jM["2024-01-01"].name),u!=null&&u.jwt&&(_.Authorization=`Bearer ${u.jwt}`);const b=(f=u==null?void 0:u.query)!==null&&f!==void 0?f:{};u!=null&&u.redirectTo&&(b.redirect_to=u.redirectTo);const T=Object.keys(b).length?"?"+new URLSearchParams(b).toString():"",a=await wN(t,r,o+T,{headers:_,noResolveJson:u==null?void 0:u.noResolveJson},{},u==null?void 0:u.body);return u!=null&&u.xform?u==null?void 0:u.xform(a):{data:Object.assign({},a),error:null}}async function wN(t,r,o,u,f,_){const b=bN(r,u,f,_);let T;try{T=await t(o,Object.assign({},b))}catch(a){throw console.error(a),new a1(Du(a),0)}if(T.ok||await $C(T),u!=null&&u.noResolveJson)return T;try{return await T.json()}catch(a){await $C(a)}}function yl(t){var r;let o=null;CN(t)&&(o=Object.assign({},t),t.expires_at||(o.expires_at=tN(t.expires_in)));const u=(r=t.user)!==null&&r!==void 0?r:t;return{data:{session:o,user:u},error:null}}function GC(t){const r=yl(t);return!r.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((o,u)=>o&&typeof u=="string",!0)&&(r.data.weak_password=t.weak_password),r}function Cl(t){var r;return{data:{user:(r=t.user)!==null&&r!==void 0?r:t},error:null}}function SN(t){return{data:t,error:null}}function TN(t){const{action_link:r,email_otp:o,hashed_token:u,redirect_to:f,verification_type:_}=t,b=vN(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),T={action_link:r,email_otp:o,hashed_token:u,redirect_to:f,verification_type:_},a=Object.assign({},b);return{data:{properties:T,user:a},error:null}}function EN(t){return t}function CN(t){return t.access_token&&t.refresh_token&&t.expires_in}var kN=function(t,r){var o={};for(var u in t)Object.prototype.hasOwnProperty.call(t,u)&&r.indexOf(u)<0&&(o[u]=t[u]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,u=Object.getOwnPropertySymbols(t);f<u.length;f++)r.indexOf(u[f])<0&&Object.prototype.propertyIsEnumerable.call(t,u[f])&&(o[u[f]]=t[u[f]]);return o};class IN{constructor({url:r="",headers:o={},fetch:u}){this.url=r,this.headers=o,this.fetch=NM(u),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(r,o="global"){try{return await ur(this.fetch,"POST",`${this.url}/logout?scope=${o}`,{headers:this.headers,jwt:r,noResolveJson:!0}),{data:null,error:null}}catch(u){if(Jt(u))return{data:null,error:u};throw u}}async inviteUserByEmail(r,o={}){try{return await ur(this.fetch,"POST",`${this.url}/invite`,{body:{email:r,data:o.data},headers:this.headers,redirectTo:o.redirectTo,xform:Cl})}catch(u){if(Jt(u))return{data:{user:null},error:u};throw u}}async generateLink(r){try{const{options:o}=r,u=kN(r,["options"]),f=Object.assign(Object.assign({},u),o);return"newEmail"in u&&(f.new_email=u==null?void 0:u.newEmail,delete f.newEmail),await ur(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:f,headers:this.headers,xform:TN,redirectTo:o==null?void 0:o.redirectTo})}catch(o){if(Jt(o))return{data:{properties:null,user:null},error:o};throw o}}async createUser(r){try{return await ur(this.fetch,"POST",`${this.url}/admin/users`,{body:r,headers:this.headers,xform:Cl})}catch(o){if(Jt(o))return{data:{user:null},error:o};throw o}}async listUsers(r){var o,u,f,_,b,T,a;try{const I={nextPage:null,lastPage:0,total:0},D=await ur(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(u=(o=r==null?void 0:r.page)===null||o===void 0?void 0:o.toString())!==null&&u!==void 0?u:"",per_page:(_=(f=r==null?void 0:r.perPage)===null||f===void 0?void 0:f.toString())!==null&&_!==void 0?_:""},xform:EN});if(D.error)throw D.error;const j=await D.json(),V=(b=D.headers.get("x-total-count"))!==null&&b!==void 0?b:0,q=(a=(T=D.headers.get("link"))===null||T===void 0?void 0:T.split(","))!==null&&a!==void 0?a:[];return q.length>0&&(q.forEach(se=>{const pe=parseInt(se.split(";")[0].split("=")[1].substring(0,1)),be=JSON.parse(se.split(";")[1].split("=")[1]);I[`${be}Page`]=pe}),I.total=parseInt(V)),{data:Object.assign(Object.assign({},j),I),error:null}}catch(I){if(Jt(I))return{data:{users:[]},error:I};throw I}}async getUserById(r){try{return await ur(this.fetch,"GET",`${this.url}/admin/users/${r}`,{headers:this.headers,xform:Cl})}catch(o){if(Jt(o))return{data:{user:null},error:o};throw o}}async updateUserById(r,o){try{return await ur(this.fetch,"PUT",`${this.url}/admin/users/${r}`,{body:o,headers:this.headers,xform:Cl})}catch(u){if(Jt(u))return{data:{user:null},error:u};throw u}}async deleteUser(r,o=!1){try{return await ur(this.fetch,"DELETE",`${this.url}/admin/users/${r}`,{headers:this.headers,body:{should_soft_delete:o},xform:Cl})}catch(u){if(Jt(u))return{data:{user:null},error:u};throw u}}async _listFactors(r){try{const{data:o,error:u}=await ur(this.fetch,"GET",`${this.url}/admin/users/${r.userId}/factors`,{headers:this.headers,xform:f=>({data:{factors:f},error:null})});return{data:o,error:u}}catch(o){if(Jt(o))return{data:null,error:o};throw o}}async _deleteFactor(r){try{return{data:await ur(this.fetch,"DELETE",`${this.url}/admin/users/${r.userId}/factors/${r.id}`,{headers:this.headers}),error:null}}catch(o){if(Jt(o))return{data:null,error:o};throw o}}}const AN={getItem:t=>Vf()?globalThis.localStorage.getItem(t):null,setItem:(t,r)=>{Vf()&&globalThis.localStorage.setItem(t,r)},removeItem:t=>{Vf()&&globalThis.localStorage.removeItem(t)}};function WC(t={}){return{getItem:r=>t[r]||null,setItem:(r,o)=>{t[r]=o},removeItem:r=>{delete t[r]}}}function MN(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const nh={debug:!!(globalThis&&Vf()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class $M extends Error{constructor(r){super(r),this.isAcquireTimeout=!0}}class PN extends $M{}async function RN(t,r,o){nh.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,r);const u=new globalThis.AbortController;return r>0&&setTimeout(()=>{u.abort(),nh.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},r),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,r===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:u.signal},async f=>{if(f){nh.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,f.name);try{return await o()}finally{nh.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,f.name)}}else{if(r===0)throw nh.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new PN(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(nh.debug)try{const _=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(_,null,"  "))}catch(_){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",_)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await o()}}))}MN();const LN={url:J6,storageKey:Q6,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:eN,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},wf=30*1e3,qC=3;async function HC(t,r,o){return await o()}class dp{constructor(r){var o,u;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=dp.nextInstanceID,dp.nextInstanceID+=1,this.instanceID>0&&Go()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const f=Object.assign(Object.assign({},LN),r);if(this.logDebugMessages=!!f.debug,typeof f.debug=="function"&&(this.logger=f.debug),this.persistSession=f.persistSession,this.storageKey=f.storageKey,this.autoRefreshToken=f.autoRefreshToken,this.admin=new IN({url:f.url,headers:f.headers,fetch:f.fetch}),this.url=f.url,this.headers=f.headers,this.fetch=NM(f.fetch),this.lock=f.lock||HC,this.detectSessionInUrl=f.detectSessionInUrl,this.flowType=f.flowType,this.hasCustomAuthorizationHeader=f.hasCustomAuthorizationHeader,f.lock?this.lock=f.lock:Go()&&(!((o=globalThis==null?void 0:globalThis.navigator)===null||o===void 0)&&o.locks)?this.lock=RN:this.lock=HC,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?f.storage?this.storage=f.storage:Vf()?this.storage=AN:(this.memoryStorage={},this.storage=WC(this.memoryStorage)):(this.memoryStorage={},this.storage=WC(this.memoryStorage)),Go()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(_){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",_)}(u=this.broadcastChannel)===null||u===void 0||u.addEventListener("message",async _=>{this._debug("received broadcast notification from other tab or client",_),await this._notifyAllSubscribers(_.data.event,_.data.session,!1)})}this.initialize()}_debug(...r){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${FM}) ${new Date().toISOString()}`,...r),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var r;try{const o=nN(window.location.href);let u="none";if(this._isImplicitGrantCallback(o)?u="implicit":await this._isPKCECallback(o)&&(u="pkce"),Go()&&this.detectSessionInUrl&&u!=="none"){const{data:f,error:_}=await this._getSessionFromURL(o,u);if(_){if(this._debug("#_initialize()","error detecting session from URL",_),yN(_)){const a=(r=_.details)===null||r===void 0?void 0:r.code;if(a==="identity_already_exists"||a==="identity_not_found"||a==="single_identity_not_deletable")return{error:_}}return await this._removeSession(),{error:_}}const{session:b,redirectType:T}=f;return this._debug("#_initialize()","detected session in URL",b,"redirect type",T),await this._saveSession(b),setTimeout(async()=>{T==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",b):await this._notifyAllSubscribers("SIGNED_IN",b)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(o){return Jt(o)?{error:o}:{error:new VM("Unexpected error during initialization",o)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(r){var o,u,f;try{const _=await ur(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(u=(o=r==null?void 0:r.options)===null||o===void 0?void 0:o.data)!==null&&u!==void 0?u:{},gotrue_meta_security:{captcha_token:(f=r==null?void 0:r.options)===null||f===void 0?void 0:f.captchaToken}},xform:yl}),{data:b,error:T}=_;if(T||!b)return{data:{user:null,session:null},error:T};const a=b.session,I=b.user;return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:I,session:a},error:null}}catch(_){if(Jt(_))return{data:{user:null,session:null},error:_};throw _}}async signUp(r){var o,u,f;try{let _;if("email"in r){const{email:D,password:j,options:V}=r;let q=null,se=null;this.flowType==="pkce"&&([q,se]=await rh(this.storage,this.storageKey)),_=await ur(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:V==null?void 0:V.emailRedirectTo,body:{email:D,password:j,data:(o=V==null?void 0:V.data)!==null&&o!==void 0?o:{},gotrue_meta_security:{captcha_token:V==null?void 0:V.captchaToken},code_challenge:q,code_challenge_method:se},xform:yl})}else if("phone"in r){const{phone:D,password:j,options:V}=r;_=await ur(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:D,password:j,data:(u=V==null?void 0:V.data)!==null&&u!==void 0?u:{},channel:(f=V==null?void 0:V.channel)!==null&&f!==void 0?f:"sms",gotrue_meta_security:{captcha_token:V==null?void 0:V.captchaToken}},xform:yl})}else throw new _g("You must provide either an email or phone number and a password");const{data:b,error:T}=_;if(T||!b)return{data:{user:null,session:null},error:T};const a=b.session,I=b.user;return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:I,session:a},error:null}}catch(_){if(Jt(_))return{data:{user:null,session:null},error:_};throw _}}async signInWithPassword(r){try{let o;if("email"in r){const{email:_,password:b,options:T}=r;o=await ur(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:_,password:b,gotrue_meta_security:{captcha_token:T==null?void 0:T.captchaToken}},xform:GC})}else if("phone"in r){const{phone:_,password:b,options:T}=r;o=await ur(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:_,password:b,gotrue_meta_security:{captcha_token:T==null?void 0:T.captchaToken}},xform:GC})}else throw new _g("You must provide either an email or phone number and a password");const{data:u,error:f}=o;return f?{data:{user:null,session:null},error:f}:!u||!u.session||!u.user?{data:{user:null,session:null},error:new Px}:(u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),{data:Object.assign({user:u.user,session:u.session},u.weak_password?{weakPassword:u.weak_password}:null),error:f})}catch(o){if(Jt(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithOAuth(r){var o,u,f,_;return await this._handleProviderSignIn(r.provider,{redirectTo:(o=r.options)===null||o===void 0?void 0:o.redirectTo,scopes:(u=r.options)===null||u===void 0?void 0:u.scopes,queryParams:(f=r.options)===null||f===void 0?void 0:f.queryParams,skipBrowserRedirect:(_=r.options)===null||_===void 0?void 0:_.skipBrowserRedirect})}async exchangeCodeForSession(r){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(r))}async _exchangeCodeForSession(r){const o=await mg(this.storage,`${this.storageKey}-code-verifier`),[u,f]=(o??"").split("/");try{const{data:_,error:b}=await ur(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:r,code_verifier:u},xform:yl});if(await gg(this.storage,`${this.storageKey}-code-verifier`),b)throw b;return!_||!_.session||!_.user?{data:{user:null,session:null,redirectType:null},error:new Px}:(_.session&&(await this._saveSession(_.session),await this._notifyAllSubscribers("SIGNED_IN",_.session)),{data:Object.assign(Object.assign({},_),{redirectType:f??null}),error:b})}catch(_){if(Jt(_))return{data:{user:null,session:null,redirectType:null},error:_};throw _}}async signInWithIdToken(r){try{const{options:o,provider:u,token:f,access_token:_,nonce:b}=r,T=await ur(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:u,id_token:f,access_token:_,nonce:b,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:yl}),{data:a,error:I}=T;return I?{data:{user:null,session:null},error:I}:!a||!a.session||!a.user?{data:{user:null,session:null},error:new Px}:(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:I})}catch(o){if(Jt(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithOtp(r){var o,u,f,_,b;try{if("email"in r){const{email:T,options:a}=r;let I=null,D=null;this.flowType==="pkce"&&([I,D]=await rh(this.storage,this.storageKey));const{error:j}=await ur(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:T,data:(o=a==null?void 0:a.data)!==null&&o!==void 0?o:{},create_user:(u=a==null?void 0:a.shouldCreateUser)!==null&&u!==void 0?u:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken},code_challenge:I,code_challenge_method:D},redirectTo:a==null?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:j}}if("phone"in r){const{phone:T,options:a}=r,{data:I,error:D}=await ur(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:T,data:(f=a==null?void 0:a.data)!==null&&f!==void 0?f:{},create_user:(_=a==null?void 0:a.shouldCreateUser)!==null&&_!==void 0?_:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken},channel:(b=a==null?void 0:a.channel)!==null&&b!==void 0?b:"sms"}});return{data:{user:null,session:null,messageId:I==null?void 0:I.message_id},error:D}}throw new _g("You must provide either an email or phone number.")}catch(T){if(Jt(T))return{data:{user:null,session:null},error:T};throw T}}async verifyOtp(r){var o,u;try{let f,_;"options"in r&&(f=(o=r.options)===null||o===void 0?void 0:o.redirectTo,_=(u=r.options)===null||u===void 0?void 0:u.captchaToken);const{data:b,error:T}=await ur(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},r),{gotrue_meta_security:{captcha_token:_}}),redirectTo:f,xform:yl});if(T)throw T;if(!b)throw new Error("An error occurred on token verification.");const a=b.session,I=b.user;return a!=null&&a.access_token&&(await this._saveSession(a),await this._notifyAllSubscribers(r.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",a)),{data:{user:I,session:a},error:null}}catch(f){if(Jt(f))return{data:{user:null,session:null},error:f};throw f}}async signInWithSSO(r){var o,u,f;try{let _=null,b=null;return this.flowType==="pkce"&&([_,b]=await rh(this.storage,this.storageKey)),await ur(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in r?{provider_id:r.providerId}:null),"domain"in r?{domain:r.domain}:null),{redirect_to:(u=(o=r.options)===null||o===void 0?void 0:o.redirectTo)!==null&&u!==void 0?u:void 0}),!((f=r==null?void 0:r.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:r.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:_,code_challenge_method:b}),headers:this.headers,xform:SN})}catch(_){if(Jt(_))return{data:null,error:_};throw _}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async r=>{const{data:{session:o},error:u}=r;if(u)throw u;if(!o)throw new _l;const{error:f}=await ur(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:o.access_token});return{data:{user:null,session:null},error:f}})}catch(r){if(Jt(r))return{data:{user:null,session:null},error:r};throw r}}async resend(r){try{const o=`${this.url}/resend`;if("email"in r){const{email:u,type:f,options:_}=r,{error:b}=await ur(this.fetch,"POST",o,{headers:this.headers,body:{email:u,type:f,gotrue_meta_security:{captcha_token:_==null?void 0:_.captchaToken}},redirectTo:_==null?void 0:_.emailRedirectTo});return{data:{user:null,session:null},error:b}}else if("phone"in r){const{phone:u,type:f,options:_}=r,{data:b,error:T}=await ur(this.fetch,"POST",o,{headers:this.headers,body:{phone:u,type:f,gotrue_meta_security:{captcha_token:_==null?void 0:_.captchaToken}}});return{data:{user:null,session:null,messageId:b==null?void 0:b.message_id},error:T}}throw new _g("You must provide either an email or phone number and a type")}catch(o){if(Jt(o))return{data:{user:null,session:null},error:o};throw o}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async o=>o))}async _acquireLock(r,o){this._debug("#_acquireLock","begin",r);try{if(this.lockAcquired){const u=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),f=(async()=>(await u,await o()))();return this.pendingInLock.push((async()=>{try{await f}catch{}})()),f}return await this.lock(`lock:${this.storageKey}`,r,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const u=o();for(this.pendingInLock.push((async()=>{try{await u}catch{}})()),await u;this.pendingInLock.length;){const f=[...this.pendingInLock];await Promise.all(f),this.pendingInLock.splice(0,f.length)}return await u}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(r){this._debug("#_useSession","begin");try{const o=await this.__loadSession();return await r(o)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let r=null;const o=await mg(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",o),o!==null&&(this._isValidSession(o)?r=o:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!r)return{data:{session:null},error:null};const u=r.expires_at?r.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${u?"":" not"} expired`,"expires_at",r.expires_at),!u){if(this.storage.isServer){let b=this.suppressGetSessionWarning;r=new Proxy(r,{get:(a,I,D)=>(!b&&I==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),b=!0,this.suppressGetSessionWarning=!0),Reflect.get(a,I,D))})}return{data:{session:r},error:null}}const{session:f,error:_}=await this._callRefreshToken(r.refresh_token);return _?{data:{session:null},error:_}:{data:{session:f},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(r){return r?await this._getUser(r):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(r){try{return r?await ur(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:r,xform:Cl}):await this._useSession(async o=>{var u,f,_;const{data:b,error:T}=o;if(T)throw T;return!(!((u=b.session)===null||u===void 0)&&u.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new _l}:await ur(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(_=(f=b.session)===null||f===void 0?void 0:f.access_token)!==null&&_!==void 0?_:void 0,xform:Cl})})}catch(o){if(Jt(o))return _N(o)&&(await this._removeSession(),await gg(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:o};throw o}}async updateUser(r,o={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(r,o))}async _updateUser(r,o={}){try{return await this._useSession(async u=>{const{data:f,error:_}=u;if(_)throw _;if(!f.session)throw new _l;const b=f.session;let T=null,a=null;this.flowType==="pkce"&&r.email!=null&&([T,a]=await rh(this.storage,this.storageKey));const{data:I,error:D}=await ur(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:o==null?void 0:o.emailRedirectTo,body:Object.assign(Object.assign({},r),{code_challenge:T,code_challenge_method:a}),jwt:b.access_token,xform:Cl});if(D)throw D;return b.user=I.user,await this._saveSession(b),await this._notifyAllSubscribers("USER_UPDATED",b),{data:{user:b.user},error:null}})}catch(u){if(Jt(u))return{data:{user:null},error:u};throw u}}_decodeJWT(r){return NC(r)}async setSession(r){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(r))}async _setSession(r){try{if(!r.access_token||!r.refresh_token)throw new _l;const o=Date.now()/1e3;let u=o,f=!0,_=null;const b=NC(r.access_token);if(b.exp&&(u=b.exp,f=u<=o),f){const{session:T,error:a}=await this._callRefreshToken(r.refresh_token);if(a)return{data:{user:null,session:null},error:a};if(!T)return{data:{user:null,session:null},error:null};_=T}else{const{data:T,error:a}=await this._getUser(r.access_token);if(a)throw a;_={access_token:r.access_token,refresh_token:r.refresh_token,user:T.user,token_type:"bearer",expires_in:u-o,expires_at:u},await this._saveSession(_),await this._notifyAllSubscribers("SIGNED_IN",_)}return{data:{user:_.user,session:_},error:null}}catch(o){if(Jt(o))return{data:{session:null,user:null},error:o};throw o}}async refreshSession(r){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(r))}async _refreshSession(r){try{return await this._useSession(async o=>{var u;if(!r){const{data:b,error:T}=o;if(T)throw T;r=(u=b.session)!==null&&u!==void 0?u:void 0}if(!(r!=null&&r.refresh_token))throw new _l;const{session:f,error:_}=await this._callRefreshToken(r.refresh_token);return _?{data:{user:null,session:null},error:_}:f?{data:{user:f.user,session:f},error:null}:{data:{user:null,session:null},error:null}})}catch(o){if(Jt(o))return{data:{user:null,session:null},error:o};throw o}}async _getSessionFromURL(r,o){try{if(!Go())throw new yg("No browser detected.");if(r.error||r.error_description||r.error_code)throw new yg(r.error_description||"Error in URL with unspecified error_description",{error:r.error||"unspecified_error",code:r.error_code||"unspecified_code"});switch(o){case"implicit":if(this.flowType==="pkce")throw new UC("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new yg("Not a valid implicit grant flow url.");break;default:}if(o==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!r.code)throw new UC("No code detected.");const{data:X,error:ie}=await this._exchangeCodeForSession(r.code);if(ie)throw ie;const Se=new URL(window.location.href);return Se.searchParams.delete("code"),window.history.replaceState(window.history.state,"",Se.toString()),{data:{session:X.session,redirectType:null},error:null}}const{provider_token:u,provider_refresh_token:f,access_token:_,refresh_token:b,expires_in:T,expires_at:a,token_type:I}=r;if(!_||!T||!b||!I)throw new yg("No session defined in URL");const D=Math.round(Date.now()/1e3),j=parseInt(T);let V=D+j;a&&(V=parseInt(a));const q=V-D;q*1e3<=wf&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${q}s, should have been closer to ${j}s`);const se=V-j;D-se>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",se,V,D):D-se<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",se,V,D);const{data:pe,error:be}=await this._getUser(_);if(be)throw be;const te={provider_token:u,provider_refresh_token:f,access_token:_,expires_in:j,expires_at:V,refresh_token:b,token_type:I,user:pe.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:te,redirectType:r.type},error:null}}catch(u){if(Jt(u))return{data:{session:null,redirectType:null},error:u};throw u}}_isImplicitGrantCallback(r){return!!(r.access_token||r.error_description)}async _isPKCECallback(r){const o=await mg(this.storage,`${this.storageKey}-code-verifier`);return!!(r.code&&o)}async signOut(r={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(r))}async _signOut({scope:r}={scope:"global"}){return await this._useSession(async o=>{var u;const{data:f,error:_}=o;if(_)return{error:_};const b=(u=f.session)===null||u===void 0?void 0:u.access_token;if(b){const{error:T}=await this.admin.signOut(b,r);if(T&&!(gN(T)&&(T.status===404||T.status===401||T.status===403)))return{error:T}}return r!=="others"&&(await this._removeSession(),await gg(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(r){const o=rN(),u={id:o,callback:r,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",o),this.stateChangeEmitters.delete(o)}};return this._debug("#onAuthStateChange()","registered callback with id",o),this.stateChangeEmitters.set(o,u),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(o)})))(),{data:{subscription:u}}}async _emitInitialSession(r){return await this._useSession(async o=>{var u,f;try{const{data:{session:_},error:b}=o;if(b)throw b;await((u=this.stateChangeEmitters.get(r))===null||u===void 0?void 0:u.callback("INITIAL_SESSION",_)),this._debug("INITIAL_SESSION","callback id",r,"session",_)}catch(_){await((f=this.stateChangeEmitters.get(r))===null||f===void 0?void 0:f.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",r,"error",_),console.error(_)}})}async resetPasswordForEmail(r,o={}){let u=null,f=null;this.flowType==="pkce"&&([u,f]=await rh(this.storage,this.storageKey,!0));try{return await ur(this.fetch,"POST",`${this.url}/recover`,{body:{email:r,code_challenge:u,code_challenge_method:f,gotrue_meta_security:{captcha_token:o.captchaToken}},headers:this.headers,redirectTo:o.redirectTo})}catch(_){if(Jt(_))return{data:null,error:_};throw _}}async getUserIdentities(){var r;try{const{data:o,error:u}=await this.getUser();if(u)throw u;return{data:{identities:(r=o.user.identities)!==null&&r!==void 0?r:[]},error:null}}catch(o){if(Jt(o))return{data:null,error:o};throw o}}async linkIdentity(r){var o;try{const{data:u,error:f}=await this._useSession(async _=>{var b,T,a,I,D;const{data:j,error:V}=_;if(V)throw V;const q=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,r.provider,{redirectTo:(b=r.options)===null||b===void 0?void 0:b.redirectTo,scopes:(T=r.options)===null||T===void 0?void 0:T.scopes,queryParams:(a=r.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:!0});return await ur(this.fetch,"GET",q,{headers:this.headers,jwt:(D=(I=j.session)===null||I===void 0?void 0:I.access_token)!==null&&D!==void 0?D:void 0})});if(f)throw f;return Go()&&!(!((o=r.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(u==null?void 0:u.url),{data:{provider:r.provider,url:u==null?void 0:u.url},error:null}}catch(u){if(Jt(u))return{data:{provider:r.provider,url:null},error:u};throw u}}async unlinkIdentity(r){try{return await this._useSession(async o=>{var u,f;const{data:_,error:b}=o;if(b)throw b;return await ur(this.fetch,"DELETE",`${this.url}/user/identities/${r.identity_id}`,{headers:this.headers,jwt:(f=(u=_.session)===null||u===void 0?void 0:u.access_token)!==null&&f!==void 0?f:void 0})})}catch(o){if(Jt(o))return{data:null,error:o};throw o}}async _refreshAccessToken(r){const o=`#_refreshAccessToken(${r.substring(0,5)}...)`;this._debug(o,"begin");try{const u=Date.now();return await aN(async f=>(f>0&&await oN(200*Math.pow(2,f-1)),this._debug(o,"refreshing attempt",f),await ur(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:r},headers:this.headers,xform:yl})),(f,_)=>{const b=200*Math.pow(2,f);return _&&Rx(_)&&Date.now()+b-u<wf})}catch(u){if(this._debug(o,"error",u),Jt(u))return{data:{session:null,user:null},error:u};throw u}finally{this._debug(o,"end")}}_isValidSession(r){return typeof r=="object"&&r!==null&&"access_token"in r&&"refresh_token"in r&&"expires_at"in r}async _handleProviderSignIn(r,o){const u=await this._getUrlForProvider(`${this.url}/authorize`,r,{redirectTo:o.redirectTo,scopes:o.scopes,queryParams:o.queryParams});return this._debug("#_handleProviderSignIn()","provider",r,"options",o,"url",u),Go()&&!o.skipBrowserRedirect&&window.location.assign(u),{data:{provider:r,url:u},error:null}}async _recoverAndRefresh(){var r;const o="#_recoverAndRefresh()";this._debug(o,"begin");try{const u=await mg(this.storage,this.storageKey);if(this._debug(o,"session from storage",u),!this._isValidSession(u)){this._debug(o,"session is not valid"),u!==null&&await this._removeSession();return}const f=Math.round(Date.now()/1e3),_=((r=u.expires_at)!==null&&r!==void 0?r:1/0)<f+jC;if(this._debug(o,`session has${_?"":" not"} expired with margin of ${jC}s`),_){if(this.autoRefreshToken&&u.refresh_token){const{error:b}=await this._callRefreshToken(u.refresh_token);b&&(console.error(b),Rx(b)||(this._debug(o,"refresh failed with a non-retryable error, removing the session",b),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",u)}catch(u){this._debug(o,"error",u),console.error(u);return}finally{this._debug(o,"end")}}async _callRefreshToken(r){var o,u;if(!r)throw new _l;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const f=`#_callRefreshToken(${r.substring(0,5)}...)`;this._debug(f,"begin");try{this.refreshingDeferred=new K_;const{data:_,error:b}=await this._refreshAccessToken(r);if(b)throw b;if(!_.session)throw new _l;await this._saveSession(_.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",_.session);const T={session:_.session,error:null};return this.refreshingDeferred.resolve(T),T}catch(_){if(this._debug(f,"error",_),Jt(_)){const b={session:null,error:_};return Rx(_)||await this._removeSession(),(o=this.refreshingDeferred)===null||o===void 0||o.resolve(b),b}throw(u=this.refreshingDeferred)===null||u===void 0||u.reject(_),_}finally{this.refreshingDeferred=null,this._debug(f,"end")}}async _notifyAllSubscribers(r,o,u=!0){const f=`#_notifyAllSubscribers(${r})`;this._debug(f,"begin",o,`broadcast = ${u}`);try{this.broadcastChannel&&u&&this.broadcastChannel.postMessage({event:r,session:o});const _=[],b=Array.from(this.stateChangeEmitters.values()).map(async T=>{try{await T.callback(r,o)}catch(a){_.push(a)}});if(await Promise.all(b),_.length>0){for(let T=0;T<_.length;T+=1)console.error(_[T]);throw _[0]}}finally{this._debug(f,"end")}}async _saveSession(r){this._debug("#_saveSession()",r),this.suppressGetSessionWarning=!0,await UM(this.storage,this.storageKey,r)}async _removeSession(){this._debug("#_removeSession()"),await gg(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const r=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{r&&Go()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",r)}catch(o){console.error("removing visibilitychange callback failed",o)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const r=setInterval(()=>this._autoRefreshTokenTick(),wf);this.autoRefreshTicker=r,r&&typeof r=="object"&&typeof r.unref=="function"?r.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(r),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const r=this.autoRefreshTicker;this.autoRefreshTicker=null,r&&clearInterval(r)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const r=Date.now();try{return await this._useSession(async o=>{const{data:{session:u}}=o;if(!u||!u.refresh_token||!u.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const f=Math.floor((u.expires_at*1e3-r)/wf);this._debug("#_autoRefreshTokenTick()",`access token expires in ${f} ticks, a tick lasts ${wf}ms, refresh threshold is ${qC} ticks`),f<=qC&&await this._callRefreshToken(u.refresh_token)})}catch(o){console.error("Auto refresh tick failed with error. This is likely a transient error.",o)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(r){if(r.isAcquireTimeout||r instanceof $M)this._debug("auto refresh token tick lock not available");else throw r}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Go()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(r){console.error("_handleVisibilityChange",r)}}async _onVisibilityChanged(r){const o=`#_onVisibilityChanged(${r})`;this._debug(o,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),r||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(o,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(r,o,u){const f=[`provider=${encodeURIComponent(o)}`];if(u!=null&&u.redirectTo&&f.push(`redirect_to=${encodeURIComponent(u.redirectTo)}`),u!=null&&u.scopes&&f.push(`scopes=${encodeURIComponent(u.scopes)}`),this.flowType==="pkce"){const[_,b]=await rh(this.storage,this.storageKey),T=new URLSearchParams({code_challenge:`${encodeURIComponent(_)}`,code_challenge_method:`${encodeURIComponent(b)}`});f.push(T.toString())}if(u!=null&&u.queryParams){const _=new URLSearchParams(u.queryParams);f.push(_.toString())}return u!=null&&u.skipBrowserRedirect&&f.push(`skip_http_redirect=${u.skipBrowserRedirect}`),`${r}?${f.join("&")}`}async _unenroll(r){try{return await this._useSession(async o=>{var u;const{data:f,error:_}=o;return _?{data:null,error:_}:await ur(this.fetch,"DELETE",`${this.url}/factors/${r.factorId}`,{headers:this.headers,jwt:(u=f==null?void 0:f.session)===null||u===void 0?void 0:u.access_token})})}catch(o){if(Jt(o))return{data:null,error:o};throw o}}async _enroll(r){try{return await this._useSession(async o=>{var u,f;const{data:_,error:b}=o;if(b)return{data:null,error:b};const T=Object.assign({friendly_name:r.friendlyName,factor_type:r.factorType},r.factorType==="phone"?{phone:r.phone}:{issuer:r.issuer}),{data:a,error:I}=await ur(this.fetch,"POST",`${this.url}/factors`,{body:T,headers:this.headers,jwt:(u=_==null?void 0:_.session)===null||u===void 0?void 0:u.access_token});return I?{data:null,error:I}:(r.factorType==="totp"&&(!((f=a==null?void 0:a.totp)===null||f===void 0)&&f.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})})}catch(o){if(Jt(o))return{data:null,error:o};throw o}}async _verify(r){return this._acquireLock(-1,async()=>{try{return await this._useSession(async o=>{var u;const{data:f,error:_}=o;if(_)return{data:null,error:_};const{data:b,error:T}=await ur(this.fetch,"POST",`${this.url}/factors/${r.factorId}/verify`,{body:{code:r.code,challenge_id:r.challengeId},headers:this.headers,jwt:(u=f==null?void 0:f.session)===null||u===void 0?void 0:u.access_token});return T?{data:null,error:T}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+b.expires_in},b)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",b),{data:b,error:T})})}catch(o){if(Jt(o))return{data:null,error:o};throw o}})}async _challenge(r){return this._acquireLock(-1,async()=>{try{return await this._useSession(async o=>{var u;const{data:f,error:_}=o;return _?{data:null,error:_}:await ur(this.fetch,"POST",`${this.url}/factors/${r.factorId}/challenge`,{body:{channel:r.channel},headers:this.headers,jwt:(u=f==null?void 0:f.session)===null||u===void 0?void 0:u.access_token})})}catch(o){if(Jt(o))return{data:null,error:o};throw o}})}async _challengeAndVerify(r){const{data:o,error:u}=await this._challenge({factorId:r.factorId});return u?{data:null,error:u}:await this._verify({factorId:r.factorId,challengeId:o.id,code:r.code})}async _listFactors(){const{data:{user:r},error:o}=await this.getUser();if(o)return{data:null,error:o};const u=(r==null?void 0:r.factors)||[],f=u.filter(b=>b.factor_type==="totp"&&b.status==="verified"),_=u.filter(b=>b.factor_type==="phone"&&b.status==="verified");return{data:{all:u,totp:f,phone:_},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async r=>{var o,u;const{data:{session:f},error:_}=r;if(_)return{data:null,error:_};if(!f)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const b=this._decodeJWT(f.access_token);let T=null;b.aal&&(T=b.aal);let a=T;((u=(o=f.user.factors)===null||o===void 0?void 0:o.filter(j=>j.status==="verified"))!==null&&u!==void 0?u:[]).length>0&&(a="aal2");const D=b.amr||[];return{data:{currentLevel:T,nextLevel:a,currentAuthenticationMethods:D},error:null}}))}}dp.nextInstanceID=0;const zN=dp;class DN extends zN{constructor(r){super(r)}}var ON=function(t,r,o,u){function f(_){return _ instanceof o?_:new o(function(b){b(_)})}return new(o||(o=Promise))(function(_,b){function T(D){try{I(u.next(D))}catch(j){b(j)}}function a(D){try{I(u.throw(D))}catch(j){b(j)}}function I(D){D.done?_(D.value):f(D.value).then(T,a)}I((u=u.apply(t,r||[])).next())})};class BN{constructor(r,o,u){var f,_,b;if(this.supabaseUrl=r,this.supabaseKey=o,!r)throw new Error("supabaseUrl is required.");if(!o)throw new Error("supabaseKey is required.");const T=K6(r);this.realtimeUrl=`${T}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${T}/auth/v1`,this.storageUrl=`${T}/storage/v1`,this.functionsUrl=`${T}/functions/v1`;const a=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,I={db:V6,realtime:G6,auth:Object.assign(Object.assign({},$6),{storageKey:a}),global:U6},D=Y6(u??{},I);this.storageKey=(f=D.auth.storageKey)!==null&&f!==void 0?f:"",this.headers=(_=D.global.headers)!==null&&_!==void 0?_:{},D.accessToken?(this.accessToken=D.accessToken,this.auth=new Proxy({},{get:(j,V)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(V)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((b=D.auth)!==null&&b!==void 0?b:{},this.headers,D.global.fetch),this.fetch=Z6(o,this._getAccessToken.bind(this),D.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},D.realtime)),this.rest=new u6(`${T}/rest/v1`,{headers:this.headers,schema:D.db.schema,fetch:this.fetch}),D.accessToken||this._listenForAuthEvents()}get functions(){return new jj(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new F6(this.storageUrl,this.headers,this.fetch)}from(r){return this.rest.from(r)}schema(r){return this.rest.schema(r)}rpc(r,o={},u={}){return this.rest.rpc(r,o,u)}channel(r,o={config:{}}){return this.realtime.channel(r,o)}getChannels(){return this.realtime.getChannels()}removeChannel(r){return this.realtime.removeChannel(r)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var r,o;return ON(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:u}=yield this.auth.getSession();return(o=(r=u.session)===null||r===void 0?void 0:r.access_token)!==null&&o!==void 0?o:null})}_initSupabaseAuthClient({autoRefreshToken:r,persistSession:o,detectSessionInUrl:u,storage:f,storageKey:_,flowType:b,lock:T,debug:a},I,D){var j;const V={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new DN({url:this.authUrl,headers:Object.assign(Object.assign({},V),I),storageKey:_,autoRefreshToken:r,persistSession:o,detectSessionInUrl:u,storage:f,flowType:b,lock:T,debug:a,fetch:D,hasCustomAuthorizationHeader:(j="Authorization"in this.headers)!==null&&j!==void 0?j:!1})}_initRealtimeClient(r){return new T6(this.realtimeUrl,Object.assign(Object.assign({},r),{params:Object.assign({apikey:this.supabaseKey},r==null?void 0:r.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((o,u)=>{this._handleTokenChanged(o,"CLIENT",u==null?void 0:u.access_token)})}_handleTokenChanged(r,o,u){(r==="TOKEN_REFRESHED"||r==="SIGNED_IN")&&this.changedAccessToken!==u?this.changedAccessToken=u:r==="SIGNED_OUT"&&(this.realtime.setAuth(),o=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const FN=(t,r,o)=>new BN(t,r,o),jN="https://rjtmenhcjsfyukepisku.supabase.co",NN="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJqdG1lbmhjanNmeXVrZXBpc2t1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzY2OTUxMDUsImV4cCI6MjA1MjI3MTEwNX0.eALrbDoSC-tNI_a75GT-mKwaCFR9fI3houAkOYGGzPk",Ml=FN(jN,NN),GM=ve.createContext(void 0);function UN({children:t}){const[r,o]=ve.useState(null);ve.useEffect(()=>{Ml.auth.getSession().then(({data:{session:b}})=>{o(b)});const{data:{subscription:_}}=Ml.auth.onAuthStateChange((b,T)=>{o(T)});return()=>_.unsubscribe()},[]);const u=async(_,b)=>{const{error:T}=await Ml.auth.signInWithPassword({email:_,password:b});if(T)throw T},f=async()=>{const{error:_}=await Ml.auth.signOut();if(_)throw _};return nt.jsx(GM.Provider,{value:{session:r,signIn:u,signOut:f},children:t})}function WM(){const t=ve.useContext(GM);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t}const qM=ve.createContext(void 0);function VN({children:t}){const[r,o]=ve.useState(()=>{const f=localStorage.getItem("theme");return f||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")});ve.useEffect(()=>{localStorage.setItem("theme",r),document.body.className=r},[r]);const u=()=>{o(f=>f==="light"?"dark":"light")};return nt.jsx(qM.Provider,{value:{theme:r,toggleTheme:u},children:t})}function Y_(){const t=ve.useContext(qM);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t}var HM={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},ZC=Sn.createContext&&Sn.createContext(HM),jl=function(){return jl=Object.assign||function(t){for(var r,o=1,u=arguments.length;o<u;o++){r=arguments[o];for(var f in r)Object.prototype.hasOwnProperty.call(r,f)&&(t[f]=r[f])}return t},jl.apply(this,arguments)},$N=function(t,r){var o={};for(var u in t)Object.prototype.hasOwnProperty.call(t,u)&&r.indexOf(u)<0&&(o[u]=t[u]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,u=Object.getOwnPropertySymbols(t);f<u.length;f++)r.indexOf(u[f])<0&&Object.prototype.propertyIsEnumerable.call(t,u[f])&&(o[u[f]]=t[u[f]]);return o};function ZM(t){return t&&t.map(function(r,o){return Sn.createElement(r.tag,jl({key:o},r.attr),ZM(r.child))})}function zb(t){return function(r){return Sn.createElement(GN,jl({attr:jl({},t.attr)},r),ZM(t.child))}}function GN(t){var r=function(o){var u=t.attr,f=t.size,_=t.title,b=$N(t,["attr","size","title"]),T=f||o.size||"1em",a;return o.className&&(a=o.className),t.className&&(a=(a?a+" ":"")+t.className),Sn.createElement("svg",jl({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},o.attr,u,b,{className:a,style:jl(jl({color:t.color||o.color},o.style),t.style),height:T,width:T,xmlns:"http://www.w3.org/2000/svg"}),_&&Sn.createElement("title",null,_),t.children)};return ZC!==void 0?Sn.createElement(ZC.Consumer,null,function(o){return r(o)}):r(HM)}function J_(t){return zb({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"}}]})(t)}function Q_(t){return zb({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"5"}},{tag:"line",attr:{x1:"12",y1:"1",x2:"12",y2:"3"}},{tag:"line",attr:{x1:"12",y1:"21",x2:"12",y2:"23"}},{tag:"line",attr:{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}},{tag:"line",attr:{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}},{tag:"line",attr:{x1:"1",y1:"12",x2:"3",y2:"12"}},{tag:"line",attr:{x1:"21",y1:"12",x2:"23",y2:"12"}},{tag:"line",attr:{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}},{tag:"line",attr:{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"}}]})(t)}const WN="https://static.wixstatic.com/media/0cc329_0d3cd276e35f472296929bc8f561526c~mv2.png",qN="https://static.wixstatic.com/media/0cc329_259a6118ee914ed7a5dee69a9e3ef525~mv2.jpeg";function HN(){const t=Ib(),[r,o]=ve.useState(""),[u,f]=ve.useState(""),[_,b]=ve.useState(!1),[T,a]=ve.useState(""),{signIn:I}=WM(),D=xp(),{theme:j,toggleTheme:V}=Y_(),q=j==="dark",se=ve.useRef(null),pe=async()=>{if(!r||!u){a("Please fill in all fields");return}try{a(""),b(!0),await I(r,u),D("/routes")}catch(ie){console.error("Login error:",ie),a("Invalid credentials. Please try again.")}finally{b(!1)}},be=(ie,Se)=>{var Ce;ie.key==="Enter"&&(ie.preventDefault(),Se==="email"?(Ce=se.current)==null||Ce.focus():pe())},X=(ie=>en.create({backgroundImage:{flex:1,width:"100%",height:"100vh"},container:{flex:1,justifyContent:"center",alignItems:"center",padding:ie.width<768?16:20,backgroundColor:"rgba(0, 0, 0, 0.3)"},containerDark:{backgroundColor:"rgba(0, 0, 0, 0.5)"},formContainer:{width:"100%",maxWidth:ie.width<768?"100%":400,position:"relative"},themeToggle:{position:"absolute",top:ie.width<768?-40:-50,right:0,padding:8,borderRadius:50,backgroundColor:"transparent",zIndex:1},form:{padding:ie.width<768?16:20,borderRadius:16,overflow:"hidden"},glassEffect:{backgroundColor:"rgba(255, 255, 255, 0.2)",backdropFilter:"blur(16px)",WebkitBackdropFilter:"blur(16px)",boxShadow:"0 4px 30px rgba(0, 0, 0, 0.1)",border:"1px solid rgba(255, 255, 255, 0.3)"},formDark:{backgroundColor:"rgba(0, 0, 0, 0.2)",border:"1px solid rgba(255, 255, 255, 0.1)"},logoContainer:{alignItems:"center",marginBottom:ie.width<768?16:20},logoWrapper:{position:"relative",flexDirection:"row",alignItems:"center",width:"100%",justifyContent:"center"},logo:{width:ie.width<768?150:200,height:ie.width<768?40:50},errorText:{color:"#ff4444",marginBottom:10,textAlign:"center",fontSize:ie.width<768?14:16},input:{height:ie.width<768?44:48,borderWidth:1,borderColor:"rgba(255, 255, 255, 0.3)",borderRadius:8,marginBottom:12,paddingHorizontal:12,backgroundColor:"rgba(255, 255, 255, 0.9)",color:"#333",fontSize:ie.width<768?14:16,width:"100%"},inputDark:{backgroundColor:"rgba(0, 0, 0, 0.3)",borderColor:"rgba(255, 255, 255, 0.1)",color:"#fff"},button:{backgroundColor:"#0066cc",padding:ie.width<768?10:12,borderRadius:8,alignItems:"center",marginTop:8,backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)"},buttonDisabled:{opacity:.7},buttonText:{color:"white",fontSize:ie.width<768?14:16,fontWeight:"bold"},links:{marginTop:ie.width<768?16:20,flexDirection:ie.width<768?"column":"row",justifyContent:"center",alignItems:"center",gap:ie.width<768?8:0},link:{color:"#fff",fontSize:ie.width<768?12:14,textShadow:"0 1px 3px rgba(0,0,0,0.3)",textAlign:"center"},linkDark:{color:"#fff"},linkSeparator:{marginHorizontal:8,color:"#fff",display:ie.width<768?"none":"flex"}}))(t);return nt.jsx(xM,{source:{uri:qN},style:X.backgroundImage,resizeMode:"cover",children:nt.jsx(Rt,{style:[X.container,q&&X.containerDark],children:nt.jsxs(Rt,{style:X.formContainer,children:[nt.jsx(Zi,{style:X.themeToggle,onPress:V,children:q?nt.jsx(Q_,{size:16,color:"#fff"}):nt.jsx(J_,{size:16,color:"#000"})}),nt.jsxs(Rt,{style:[X.form,q&&X.formDark,X.glassEffect],children:[nt.jsx(Rt,{style:X.logoContainer,children:nt.jsx(Rt,{style:X.logoWrapper,children:nt.jsx(wp,{source:{uri:WN},style:X.logo,resizeMode:"contain"})})}),T?nt.jsx(wn,{style:X.errorText,children:T}):null,nt.jsx(Hu,{style:[X.input,q&&X.inputDark],placeholder:"Email",placeholderTextColor:q?"#999":"#666",value:r,onChangeText:ie=>{o(ie),a("")},onKeyPress:ie=>be(ie,"email"),autoCapitalize:"none",keyboardType:"email-address",returnKeyType:"next",blurOnSubmit:!1}),nt.jsx(Hu,{ref:se,style:[X.input,q&&X.inputDark],placeholder:"Password",placeholderTextColor:q?"#999":"#666",value:u,onChangeText:ie=>{f(ie),a("")},onKeyPress:ie=>be(ie,"password"),secureTextEntry:!0,returnKeyType:"go",onSubmitEditing:pe}),nt.jsx(Zi,{style:[X.button,_&&X.buttonDisabled],onPress:pe,disabled:_,children:nt.jsx(wn,{style:X.buttonText,children:_?"Signing in...":"Sign In"})}),nt.jsxs(Rt,{style:X.links,children:[nt.jsx(Zi,{onPress:()=>D("/register"),children:nt.jsx(wn,{style:[X.link,q&&X.linkDark],children:"Create Account"})}),nt.jsx(wn,{style:X.linkSeparator,children:"•"}),nt.jsx(Zi,{children:nt.jsx(wn,{style:[X.link,q&&X.linkDark],children:"Forgot Password?"})})]})]})]})})})}function ZN(){const[t,r]=ve.useState(""),[o,u]=ve.useState(""),[f,_]=ve.useState(""),[b,T]=ve.useState(!1),a=xp(),{theme:I,toggleTheme:D}=Y_(),j=ve.useRef(null),V=ve.useRef(null),q=I==="dark",se=async()=>{if(!o||!f||!t){alert("Please fill in all fields");return}try{T(!0);const{error:te}=await Ml.auth.signUp({email:o,password:f,options:{data:{name:t}}});if(te)throw te;alert("Registration successful! Please check your email to verify your account."),a("/login")}catch{alert("Error during registration")}finally{T(!1)}},pe=(te,X)=>{var ie,Se;te.key==="Enter"&&(te.preventDefault(),X==="name"?(ie=j.current)==null||ie.focus():X==="email"?(Se=V.current)==null||Se.focus():se())},be=XN();return nt.jsx(Rt,{style:be.container,children:nt.jsxs(Rt,{style:be.formContainer,children:[nt.jsx(Zi,{style:be.themeToggle,onPress:D,children:q?nt.jsx(Q_,{size:24,color:"#fff"}):nt.jsx(J_,{size:24,color:"#000"})}),nt.jsxs(Rt,{style:be.form,children:[nt.jsx(wn,{style:be.title,children:"Create Account"}),nt.jsx(Hu,{style:be.input,placeholder:"Name",placeholderTextColor:q?"#999":"#666",value:t,onChangeText:r,onKeyPress:te=>pe(te,"name"),returnKeyType:"next",blurOnSubmit:!1}),nt.jsx(Hu,{ref:j,style:be.input,placeholder:"Email",placeholderTextColor:q?"#999":"#666",value:o,onChangeText:u,onKeyPress:te=>pe(te,"email"),autoCapitalize:"none",keyboardType:"email-address",returnKeyType:"next",blurOnSubmit:!1}),nt.jsx(Hu,{ref:V,style:be.input,placeholder:"Password",placeholderTextColor:q?"#999":"#666",value:f,onChangeText:_,onKeyPress:te=>pe(te,"password"),secureTextEntry:!0,returnKeyType:"go",onSubmitEditing:se}),nt.jsx(Zi,{style:[be.button,b&&be.buttonDisabled],onPress:se,disabled:b,children:nt.jsx(wn,{style:be.buttonText,children:b?"Creating Account...":"Register"})}),nt.jsx(Rt,{style:be.links,children:nt.jsx(Zi,{onPress:()=>a("/login"),children:nt.jsx(wn,{style:be.link,children:"Already have an account? Sign In"})})})]})]})})}const XN=t=>en.create({});function XM(t){return zb({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M416 320h-96c-17.6 0-32-14.4-32-32s14.4-32 32-32h96s96-107 96-160-43-96-96-96-96 43-96 96c0 25.5 22.2 63.4 45.3 96H320c-52.9 0-96 43.1-96 96s43.1 96 96 96h96c17.6 0 32 14.4 32 32s-14.4 32-32 32H185.5c-16 24.8-33.8 47.7-47.3 64H416c52.9 0 96-43.1 96-96s-43.1-96-96-96zm0-256c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32zM96 256c-53 0-96 43-96 96s96 160 96 160 96-107 96-160-43-96-96-96zm0 128c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"}}]})(t)}function KN(){const t=Ib(),r=xp(),[o,u]=ve.useState([]),[f,_]=ve.useState(!0),{theme:b,toggleTheme:T}=Y_(),a=b==="dark";ve.useEffect(()=>{(async()=>{try{const{data:se,error:pe}=await Ml.from("route_stretches").select(`
            *,
            waypoints (*)
          `).order("sequence");if(pe)throw pe;se&&u(se)}catch(se){console.error("Erro ao buscar rotas:",se)}finally{_(!1)}})()},[]);const I=q=>{switch(q){case"completed":return"#4CAF50";case"in_progress":return"#0066cc";default:return a?"#666":"#9E9E9E"}},D=q=>{switch(q){case"completed":return"Concluído";case"in_progress":return"Em curso";default:return"Não Iniciado"}},j=q=>{const se=o.findIndex(pe=>pe.id===q.id);return se===0?!0:o[se-1].status==="completed"},V=en.create({container:{flex:1,backgroundColor:"#f5f5f5",minHeight:"100vh"},containerDark:{backgroundColor:"#1a1a1a"},loadingContainer:{justifyContent:"center",alignItems:"center"},header:{backgroundColor:"white",padding:t.width<768?16:20,borderBottomWidth:1,borderBottomColor:"#eee"},headerDark:{backgroundColor:"#2d2d2d",borderBottomColor:"#444"},titleRow:{flexDirection:"row",alignItems:"center",justifyContent:"space-between"},titleGroup:{flexDirection:"row",alignItems:"center",gap:t.width<768?8:12},headerRight:{flexDirection:"row",alignItems:"center",gap:t.width<768?12:16},title:{fontSize:t.width<768?24:28,fontWeight:"bold",color:"#333",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif'},titleDark:{color:"#fff"},date:{fontSize:t.width<768?16:20,color:"#666"},dateDark:{color:"#999"},themeToggle:{padding:t.width<768?6:8,borderRadius:50},listContent:{padding:t.width<768?16:20},routeItem:{backgroundColor:"white",borderRadius:12,marginBottom:16,overflow:"hidden",shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.1,shadowRadius:4},routeItemDark:{backgroundColor:"#2d2d2d"},routeItemDisabled:{opacity:.5},routeContent:{padding:t.width<768?12:16},routeHeader:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:t.width<768?8:12,flexWrap:"wrap",gap:8},routeName:{fontSize:t.width<768?16:18,fontWeight:"600",color:"#333"},routeNameDark:{color:"#fff"},statusBadge:{paddingHorizontal:t.width<768?10:12,paddingVertical:t.width<768?4:6,borderRadius:20},statusText:{color:"white",fontSize:t.width<768?12:14,fontWeight:"600"},routeFooter:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginTop:t.width<768?6:8},waypointsInfo:{fontSize:t.width<768?12:14,color:"#666"},waypointsInfoDark:{color:"#999"}});return f?nt.jsx(Rt,{style:[V.container,V.loadingContainer,a&&V.containerDark],children:nt.jsx(__,{size:"large",color:a?"#66b3ff":"#0066cc"})}):nt.jsxs(Rt,{style:[V.container,a&&V.containerDark],children:[nt.jsx(Rt,{style:[V.header,a&&V.headerDark],children:nt.jsxs(Rt,{style:V.titleRow,children:[nt.jsxs(Rt,{style:V.titleGroup,children:[nt.jsx(XM,{size:t.width<768?20:24,color:a?"#66b3ff":"#0066cc"}),nt.jsx(wn,{style:[V.title,a&&V.titleDark],children:"Rota"})]}),nt.jsxs(Rt,{style:V.headerRight,children:[nt.jsx(wn,{style:[V.date,a&&V.dateDark],children:new Date().toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit"})}),nt.jsx(Zi,{style:V.themeToggle,onPress:T,children:a?nt.jsx(Q_,{size:t.width<768?14:16,color:"#fff"}):nt.jsx(J_,{size:t.width<768?14:16,color:"#000"})})]})]})}),nt.jsx(ej,{data:o,contentContainerStyle:V.listContent,keyExtractor:q=>q.id,renderItem:({item:q})=>nt.jsx(Zi,{style:[V.routeItem,a&&V.routeItemDark,!j(q)&&q.status==="not_started"&&V.routeItemDisabled],onPress:()=>r(`/route/${q.id}`),disabled:!j(q)&&q.status==="not_started",children:nt.jsxs(Rt,{style:V.routeContent,children:[nt.jsxs(Rt,{style:V.routeHeader,children:[nt.jsx(wn,{style:[V.routeName,a&&V.routeNameDark],children:q.name}),nt.jsx(Rt,{style:[V.statusBadge,{backgroundColor:I(q.status)}],children:nt.jsx(wn,{style:V.statusText,children:D(q.status)})})]}),nt.jsx(Rt,{style:V.routeFooter,children:nt.jsxs(wn,{style:[V.waypointsInfo,a&&V.waypointsInfoDark],children:[q.waypoints.length," pontos de passagem"]})})]})})})]})}const YN=[{lat:-23.5614,lng:-46.6565,description:"Av. Paulista, 1578"},{lat:-23.5575,lng:-46.6608,description:"Rua Augusta, 2026"},{lat:-23.562,lng:-46.6695,description:"Rua Oscar Freire, 725"},{lat:-23.5868,lng:-46.6847,description:"Av. Brigadeiro Faria Lima, 2232"},{lat:-23.5656,lng:-46.6907,description:"Rua dos Pinheiros, 1037"},{lat:-23.5738,lng:-46.6825,description:"Av. Rebouças, 3970"},{lat:-23.5553,lng:-46.6858,description:"Rua Teodoro Sampaio, 1020"},{lat:-23.5714,lng:-46.676,description:"Av. Europa, 538"},{lat:-23.5849,lng:-46.68,description:"Rua Joaquim Floriano, 466"},{lat:-23.5762,lng:-46.6686,description:"Av. São Gabriel, 301"},{lat:-23.5587,lng:-46.6628,description:"Rua Haddock Lobo, 1738"},{lat:-23.5676,lng:-46.6567,description:"Av. Nove de Julho, 3186"},{lat:-23.5563,lng:-46.6622,description:"Rua Bela Cintra, 2016"},{lat:-23.5912,lng:-46.6668,description:"Av. República do Líbano, 1485"},{lat:-23.567,lng:-46.6545,description:"Rua Pamplona, 1704"},{lat:-23.5774,lng:-46.666,description:"Av. Brasil, 1436"},{lat:-23.553,lng:-46.6623,description:"Rua da Consolação, 3068"},{lat:-23.5812,lng:-46.6757,description:"Av. Cidade Jardim, 350"},{lat:-23.5704,lng:-46.6667,description:"Rua Estados Unidos, 1258"},{lat:-23.5487,lng:-46.6583,description:"Av. Angélica, 2565"},{lat:-23.5645,lng:-46.666,description:"Rua Padre João Manuel, 758"},{lat:-23.5955,lng:-46.676,description:"Av. Hélio Pellegrino, 200"},{lat:-23.585,lng:-46.6767,description:"Rua Tabapuã, 1010"},{lat:-23.5912,lng:-46.68,description:"Av. Juscelino Kubitschek, 1830"}],XC=Array.from({length:4},(t,r)=>({id:`${r+1}`,name:`Route ${r+1}`,sequence:r+1,status:"not_started",waypoints:YN.slice(r*6,(r+1)*6).map((o,u)=>({id:`${r*6+u+1}`,sequence:u+1,latitude:o.lat,longitude:o.lng,description:o.description}))}));var KM={exports:{}};(function(t,r){var o={};(function(u,f){t.exports=f()})(ps,function(){var u,f,_;function b(a,I){if(!u)u=I;else if(!f)f=I;else{var D="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+u+")(sharedChunk); ("+f+")(sharedChunk); self.onerror = null;",j={};u(j),_=I(j),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(_.workerUrl=window.URL.createObjectURL(new Blob([D],{type:"text/javascript"})))}}b(["exports"],function(a){var I=typeof self<"u"?self:{},D="2.15.0";let j;const V={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(j==null){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{j=o.API_URL_REGEX!=null?new RegExp(o.API_URL_REGEX):n}catch{j=n}}return j},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!V.API_URL)return null;try{const n=new URL(V.API_URL);return n.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":n.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},q={supported:!1,testSupport:function(n){!be&&pe&&(te?X(n):se=n)}};let se,pe,be=!1,te=!1;function X(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,pe),n.isContextLost())return;q.supported=!0}catch{}n.deleteTexture(e),be=!0}I.document&&(pe=I.document.createElement("img"),pe.onload=function(){se&&X(se),se=null,te=!0},pe.onerror=function(){be=!0,se=null},pe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ie="01";function Se(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ce=Le;function Le(n,e,i,l){this.cx=3*n,this.bx=3*(i-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(l-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=e,this.p2x=i,this.p2y=l}Le.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,e){if(e===void 0&&(e=1e-6),n<0)return 0;if(n>1)return 1;for(var i=n,l=0;l<8;l++){var h=this.sampleCurveX(i)-n;if(Math.abs(h)<e)return i;var p=this.sampleCurveDerivativeX(i);if(Math.abs(p)<1e-6)break;i-=h/p}var g=0,v=1;for(i=n,l=0;l<20&&(h=this.sampleCurveX(i),!(Math.abs(h-n)<e));l++)n>h?g=i:v=i,i=.5*(v-g)+g;return i},solve:function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))}};var Ne=Se(Ce),qe=it;function it(n,e){this.x=n,this.y=e}it.prototype={clone:function(){return new it(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,e){return this.clone()._rotateAround(n,e)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult:function(n){var e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var e=Math.cos(n),i=Math.sin(n),l=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=l,this},_rotateAround:function(n,e){var i=Math.cos(n),l=Math.sin(n),h=e.y+l*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-l*(this.y-e.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},it.convert=function(n){return n instanceof it?n:Array.isArray(n)?new it(n[0],n[1]):n};var Ae=Se(qe);const Tt=Math.PI/180,$t=180/Math.PI;function pt(n){return n*Tt}function Kt(n){return n*$t}const Dr=[[0,0],[1,0],[1,1],[0,1]];function Sr(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function xn(n,e,i,l){const h=new Ne(n,e,i,l);return function(p){return h.solve(p)}}const lt=xn(.25,.1,.25,1);function st(n,e,i){return Math.min(i,Math.max(e,n))}function kt(n,e,i){return(i=st((i-n)/(e-n),0,1))*i*(3-2*i)}function It(n,e,i){const l=i-e,h=((n-e)%l+l)%l+e;return h===e?i:h}function Bt(n,e,i){if(!n.length)return i(null,[]);let l=n.length;const h=new Array(n.length);let p=null;n.forEach((g,v)=>{e(g,(w,S)=>{w&&(p=w),h[v]=S,--l==0&&i(p,h)})})}function tn(n){const e=[];for(const i in n)e.push(n[i]);return e}function Yt(n,...e){for(const i of e)for(const l in i)n[l]=i[l];return n}let Kr=1;function jr(){return Kr++}function dr(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function Nr(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Kn(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function Yn(n,e){n.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function _i(n,e){return n.indexOf(e,n.length-e.length)!==-1}function Lt(n,e,i){const l={};for(const h in n)l[h]=e.call(this,n[h],h,n);return l}function yi(n,e,i){const l={};for(const h in n)e.call(i||this,n[h],h,n)&&(l[h]=n[h]);return l}function qr(n){return Array.isArray(n)?n.map(qr):typeof n=="object"&&n?Lt(n,qr):n}const Ji={};function fr(n){Ji[n]||(typeof console<"u"&&console.warn(n),Ji[n]=!0)}function jn(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function vs(n){let e=0;for(let i,l,h=0,p=n.length,g=p-1;h<p;g=h++)i=n[h],l=n[g],e+=(l.x-i.x)*(i.y+l.y);return e}function Ur(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function rn(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,l,h,p)=>{const g=h||p;return e[l]=!g||g.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let ii=null;function Pn(n){if(ii==null){const e=n.navigator?n.navigator.userAgent:null;ii=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return ii}function Qi(n){try{const e=I[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function si(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}const Ai="mapbox-tiles";let Ns=500,xo=50,Rn,Mi;function xs(){try{return I.caches}catch{}}function es(){xs()&&!Rn&&(Rn=I.caches.open(Ai))}function ts(n){const e=n.indexOf("?");if(e<0)return n;const i=function(h){const p=h.indexOf("?");return p>0?h.slice(p+1).split("&"):[]}(n),l=i.filter(h=>{const p=h.split("=");return p[0]==="language"||p[0]==="worldview"});return l.length?`${n.slice(0,e)}?${l.join("&")}`:n.slice(0,e)}let Us=1/0;const Pi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Pi);class cr extends Error{constructor(e,i,l){i===401&&Te(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ri=Ur()?()=>self.worker&&self.worker.referrer:()=>(I.location.protocol==="blob:"?I.parent:I).location.href,rs=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(Ri())&&!/^\w+:/.test(i))){if(I.fetch&&I.Request&&I.AbortController&&I.Request.prototype.hasOwnProperty("signal"))return function(l,h){const p=new I.AbortController,g=new I.Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:Ri(),referrerPolicy:l.referrerPolicy,signal:p.signal});let v=!1,w=!1;const S=(k=g.url).indexOf("sku=")>0&&Te(k);var k;l.type==="json"&&g.headers.set("Accept","application/json");const M=(z,O,N)=>{if(w)return;if(z&&z.message!=="SecurityError"&&fr(z.toString()),O&&N)return P(O);const W=Date.now();I.fetch(g).then(Q=>{if(Q.ok){const ue=S?Q.clone():null;return P(Q,ue,W)}return h(new cr(Q.statusText,Q.status,l.url))}).catch(Q=>{Q.name!=="AbortError"&&h(new Error(`${Q.message} ${l.url}`))})},P=(z,O,N)=>{(l.type==="arrayBuffer"?z.arrayBuffer():l.type==="json"?z.json():z.text()).then(W=>{w||(O&&N&&function(Q,ue,ee){if(es(),!Rn)return;const le={status:ue.status,statusText:ue.statusText,headers:new I.Headers};ue.headers.forEach((Re,Ie)=>le.headers.set(Ie,Re));const de=rn(ue.headers.get("Cache-Control")||"");if(de["no-store"])return;de["max-age"]&&le.headers.set("Expires",new Date(ee+1e3*de["max-age"]).toUTCString());const he=le.headers.get("Expires");he&&(new Date(he).getTime()-ee<42e4||function(Re,Ie){if(Mi===void 0)try{new Response(new ReadableStream),Mi=!0}catch{Mi=!1}Mi?Ie(Re.body):Re.blob().then(Ie)}(ue,Re=>{const Ie=new I.Response(Re,le);es(),Rn&&Rn.then(je=>je.put(ts(Q.url),Ie)).catch(je=>fr(je.message))}))}(g,O,N),v=!0,h(null,W,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch(W=>{w||h(new Error(W.message))})};return S?function(z,O){if(es(),!Rn)return O(null);const N=ts(z.url);Rn.then(W=>{W.match(N).then(Q=>{const ue=function(ee){if(!ee)return!1;const le=new Date(ee.headers.get("Expires")||0),de=rn(ee.headers.get("Cache-Control")||"");return le>Date.now()&&!de["no-cache"]}(Q);W.delete(N),ue&&W.put(N,Q.clone()),O(null,Q,ue)}).catch(O)}).catch(O)}(g,M):M(null,null),{cancel:()=>{w=!0,v||p.abort()}}}(n,e);if(Ur()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return function(l,h){const p=new I.XMLHttpRequest;p.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const g in l.headers)p.setRequestHeader(g,l.headers[g]);return l.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=l.credentials==="include",p.onerror=()=>{h(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let g=p.response;if(l.type==="json")try{g=JSON.parse(p.response)}catch(v){return h(v)}h(null,g,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else h(new cr(p.statusText,p.status,l.url))},p.send(l.body),{cancel:()=>p.abort()}}(n,e)},ns=function(n,e){return rs(Yt(n,{type:"arrayBuffer"}),e)};function bo(n){const e=I.document.createElement("a");return e.href=n,e.protocol===I.document.location.protocol&&e.host===I.document.location.host}const ae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let $,U;$=[],U=0;const re=function(n,e){if(q.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),U>=V.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return $.push(p),p}U++;let i=!1;const l=()=>{if(!i)for(i=!0,U--;$.length&&U<V.MAX_PARALLEL_IMAGE_REQUESTS;){const p=$.shift(),{requestParameters:g,callback:v,cancelled:w}=p;w||(p.cancel=re(g,v).cancel)}},h=ns(n,(p,g,v,w)=>{l(),p?e(p):g&&(I.createImageBitmap?function(S,k){const M=new I.Blob([new Uint8Array(S)],{type:"image/png"});I.createImageBitmap(M).then(P=>{k(null,P)}).catch(P=>{k(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(S,k)=>e(S,k,v,w)):function(S,k){const M=new I.Image,P=I.URL;M.onload=()=>{k(null,M),P.revokeObjectURL(M.src),M.onload=null,I.requestAnimationFrame(()=>{M.src=ae})},M.onerror=()=>k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const z=new I.Blob([new Uint8Array(S)],{type:"image/png"});M.src=S.byteLength?P.createObjectURL(z):ae}(g,(S,k)=>e(S,k,v,w)))});return{cancel:()=>{h.cancel(),l()}}},ce="NO_ACCESS_TOKEN";function _e(n){return n.indexOf("mapbox:")===0}function Te(n){return V.API_URL_REGEX.test(n)}function Ee(n){return V.API_CDN_URL_REGEX.test(n)}function ye(n){return V.API_STYLE_REGEX.test(n)&&!ze(n)}function ze(n){return V.API_SPRITE_REGEX.test(n)}const et=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ot(n){const e=n.match(et);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Ye(n){const e=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${e}`}const Mt="mapbox.eventData";function Nt(n){if(!n)return null;const e=n.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(I.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Pt{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=Nt(V.ACCESS_TOKEN);let l="";return l=i&&i.u?I.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(h,p)=>String.fromCharCode(+("0x"+p)))):V.ACCESS_TOKEN||"",e?`${Mt}.${e}:${l}`:`${Mt}:${l}`}fetchEventData(){const e=Qi("localStorage"),i=this.getStorageKey(),l=this.getStorageKey("uuid");if(e)try{const h=I.localStorage.getItem(i);h&&(this.eventData=JSON.parse(h));const p=I.localStorage.getItem(l);p&&(this.anonId=p)}catch{fr("Unable to read from LocalStorage")}}saveEventData(){const e=Qi("localStorage"),i=this.getStorageKey(),l=this.getStorageKey("uuid");if(e)try{I.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&I.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{fr("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,l,h){if(!V.EVENTS_URL)return;const p=ot(V.EVENTS_URL);p.params.push(`access_token=${h||V.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(e).toISOString()},v=i?Yt(g,i):g,w={url:Ye(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};this.pendingRequest=function(S,k){return rs(Yt(S,{method:"POST"}),k)}(w,S=>{this.pendingRequest=null,l(S),this.saveEventData(),this.processRequests(h)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const Ut=new class extends Pt{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,e){V.EVENTS_URL&&V.ACCESS_TOKEN&&Array.isArray(n)&&n.some(i=>_e(i)||Te(i))&&this.queueRequest(Date.now(),e)}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Nt(V.ACCESS_TOKEN),i=e?e.u:V.ACCESS_TOKEN;let l=i!==this.eventData.tokenU;Kn(this.anonId)||(this.anonId=dr(),l=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),g=new Date(h),v=(h-this.eventData.lastSuccess)/864e5;l=l||v>=1||v<-1||p.getDate()!==g.getDate()}else l=!0;l?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:D,skuId:ie,"enabled.telemetry":!1,userId:this.anonId},p=>{p||(this.eventData.lastSuccess=h,this.eventData.tokenU=i)},n):this.processRequests()}},Xt=Ut.postTurnstileEvent.bind(Ut),pr=new class extends Pt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,e,i,l){this.skuToken=e,this.errorCb=l,V.EVENTS_URL&&(i||V.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error(ce)))}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Kn(this.anonId)||(this.anonId=dr()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:D,skuId:ie,skuToken:this.skuToken,userId:this.anonId},l=>{l?this.errorCb(l):e&&(this.success[e]=!0)},n))}},Rr=pr.postMapLoadEvent.bind(pr),bn=new class extends Pt{constructor(){super("gljs.performance")}postPerformanceEvent(n,e){V.EVENTS_URL&&(n||V.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},n)}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:i}=this.queue.shift(),l=function(h){const p=I.performance.getEntriesByType("resource"),g=I.performance.getEntriesByType("mark"),v=function(P){const z={};if(P){for(const O in P)if(O!=="other")for(const N of P[O]){const W=`${O}ResolveRangeMin`,Q=`${O}ResolveRangeMax`,ue=`${O}RequestCount`,ee=`${O}RequestCachedCount`;z[W]=Math.min(z[W]||1/0,N.startTime),z[Q]=Math.max(z[Q]||-1/0,N.responseEnd);const le=de=>{z[de]===void 0&&(z[de]=0),++z[de]};N.transferSize!==void 0&&N.transferSize===0&&le(ee),le(ue)}}return z}(function(P,z){const O={};if(P)for(const N of P){const W=z(N);O[W]===void 0&&(O[W]=[]),O[W].push(N)}return O}(p,ic)),w=I.devicePixelRatio,S=I.navigator.connection||I.navigator.mozConnection||I.navigator.webkitConnection,k={counters:[],metadata:[],attributes:[]},M=(P,z,O)=>{O!=null&&P.push({name:z,value:O.toString()})};for(const P in v)M(k.counters,P,v[P]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(M(k.counters,"interactionRangeMin",h.interactionRange[0]),M(k.counters,"interactionRangeMax",h.interactionRange[1])),g)for(const P of Object.keys(Vs)){const z=Vs[P],O=g.find(N=>N.name===z);O&&M(k.counters,z,O.startTime)}return M(k.counters,"visibilityHidden",h.visibilityHidden),M(k.attributes,"style",function(P){if(P)for(const z of P){const O=z.name.split("?")[0];if(ye(O)){const N=O.split("/").slice(-2);if(N.length===2)return`mapbox://styles/${N[0]}/${N[1]}`}}}(p)),M(k.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),M(k.attributes,"fogEnabled",h.fogEnabled?"true":"false"),M(k.attributes,"projection",h.projection),M(k.attributes,"zoom",h.zoom),M(k.metadata,"devicePixelRatio",w),M(k.metadata,"connectionEffectiveType",S?S.effectiveType:void 0),M(k.metadata,"navigatorUserAgent",I.navigator.userAgent),M(k.metadata,"screenWidth",I.screen.width),M(k.metadata,"screenHeight",I.screen.height),M(k.metadata,"windowWidth",I.innerWidth),M(k.metadata,"windowHeight",I.innerHeight),M(k.metadata,"mapWidth",h.width/w),M(k.metadata,"mapHeight",h.height/w),M(k.metadata,"webglRenderer",h.renderer),M(k.metadata,"webglVendor",h.vendor),M(k.metadata,"sdkVersion",D),M(k.metadata,"sdkIdentifier","mapbox-gl-js"),k}(i);for(const h of l.metadata);for(const h of l.counters);for(const h of l.attributes);this.postEvent(e,l,()=>{},n)}},Yr=bn.postPerformanceEvent.bind(bn),vi=new class extends Pt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,e,i,l){if(!V.API_URL||!V.SESSION_PATH)return;const h=ot(V.API_URL+V.SESSION_PATH);h.params.push(`sku=${e||""}`),h.params.push(`access_token=${l||V.ACCESS_TOKEN||""}`);const p={url:Ye(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(g,v){return rs(Yt(g,{method:"GET"}),v)}(p,g=>{this.pendingRequest=null,i(g),this.saveEventData(),this.processRequests(l)})}getSessionAPI(n,e,i,l){this.skuToken=e,this.errorCb=l,V.SESSION_PATH&&V.API_URL&&(i||V.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error(ce)))}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,l=>{l?this.errorCb(l):e&&(this.success[e]=!0)},n)}},gn=vi.getSessionAPI.bind(vi),nn=new Set,Vs={create:"create",load:"load",fullLoad:"fullLoad"},bt={mark(n){I.performance.mark(n)},measure(n,e,i){I.performance.measure(n,e,i)}};function ic(n){const e=n.name.split("?")[0];return Ee(e)&&e.includes("mapbox-gl.js")?"javascript":Ee(e)&&e.includes("mapbox-gl.css")?"css":function(i){return V.API_FONTS_REGEX.test(i)}(e)?"fontRange":ze(e)?"sprite":ye(e)?"style":function(i){return V.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}const Wt=I.performance;function Ra(n){const e=n?n.url.toString():void 0;return Wt.getEntriesByName(e)}let wo,La,Jo,xi;const Li={now:()=>Jo!==void 0?Jo:I.performance.now(),setNow(n){Jo=n},restoreNow(){Jo=void 0},frame(n){const e=I.requestAnimationFrame(n);return{cancel:()=>I.cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:i,height:l}=n;xi||(xi=I.document.createElement("canvas"));const h=xi.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(i>xi.width||l>xi.height)&&(xi.width=i,xi.height=l),h.clearRect(-e,-e,i+2*e,l+2*e),h.drawImage(n,0,0,i,l),h.getImageData(-e,-e,i+2*e,l+2*e)},resolveURL:n=>(wo||(wo=I.document.createElement("a")),wo.href=n,wo.href),get devicePixelRatio(){return I.devicePixelRatio},get prefersReducedMotion(){return!!I.matchMedia&&(La==null&&(La=I.matchMedia("(prefers-reduced-motion: reduce)")),La.matches)}};function za(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function Da(n,e,i){if(i&&i[n]){const l=i[n].indexOf(e);l!==-1&&i[n].splice(l,1)}}class bs{constructor(e,i={}){Yt(this,i),this.type=e}}class zi extends bs{constructor(e,i={}){super("error",Yt({error:e},i))}}class So{on(e,i){return this._listeners=this._listeners||{},za(e,i,this._listeners),this}off(e,i){return Da(e,i,this._listeners),Da(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},za(e,i,this._oneTimeListeners),this):new Promise(l=>this.once(e,l))}fire(e,i){typeof e=="string"&&(e=new bs(e,i||{}));const l=e.type;if(this.listens(l)){e.target=this;const h=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const v of h)v.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const v of p)Da(l,v,this._oneTimeListeners),v.call(this,e);const g=this._eventedParent;g&&(Yt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof zi&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var Be=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Di(n,...e){for(const i of e)for(const l in i)n[l]=i[l];return n}function Vr(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function sn(n){if(Array.isArray(n))return n.map(sn);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=sn(n[i]);return e}return Vr(n)}class ql extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var bi=ql;class Oa{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[l,h]of i)this.bindings[l]=h}concat(e){return new Oa(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Hl=Oa;const $s={kind:"null"},ct={kind:"number"},qt={kind:"string"},Vt={kind:"boolean"},Nn={kind:"color"},oi={kind:"object"},Gt={kind:"value"},Un={kind:"collator"},To={kind:"formatted"},ws={kind:"resolvedImage"};function Jn(n,e){return{kind:"array",itemType:n,N:e}}function Tr(n){if(n.kind==="array"){const e=Tr(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const Zl=[$s,ct,qt,Vt,Nn,To,oi,Jn(Gt),ws];function Oi(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Oi(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of Zl)if(!Oi(i,e))return null}}return`Expected ${Tr(n)} but found ${Tr(e)} instead.`}function Eo(n,e){return e.some(i=>i.kind===n.kind)}function Co(n,e){return e.some(i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n)}var Ba,Xl={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ko(n){return(n=Math.round(n))<0?0:n>255?255:n}function Io(n){return ko(n[n.length-1]==="%"?parseFloat(n)/100*255:parseInt(n))}function Qo(n){return(e=n[n.length-1]==="%"?parseFloat(n)/100:parseFloat(n))<0?0:e>1?1:e;var e}function Gs(n,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?n+(e-n)*i*6:2*i<1?e:3*i<2?n+(e-n)*(2/3-i)*6:n}try{Ba={}.parseCSSColor=function(n){var e,i=n.replace(/ /g,"").toLowerCase();if(i in Xl)return Xl[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=i.indexOf("("),h=i.indexOf(")");if(l!==-1&&h+1===i.length){var p=i.substr(0,l),g=i.substr(l+1,h-(l+1)).split(","),v=1;switch(p){case"rgba":if(g.length!==4)return null;v=Qo(g.pop());case"rgb":return g.length!==3?null:[Io(g[0]),Io(g[1]),Io(g[2]),v];case"hsla":if(g.length!==4)return null;v=Qo(g.pop());case"hsl":if(g.length!==3)return null;var w=(parseFloat(g[0])%360+360)%360/360,S=Qo(g[1]),k=Qo(g[2]),M=k<=.5?k*(S+1):k+S-k*S,P=2*k-M;return[ko(255*Gs(P,M,w+1/3)),ko(255*Gs(P,M,w)),ko(255*Gs(P,M,w-1/3)),v];default:return null}}return null}}catch{}class Ln{constructor(e,i,l,h=1){this.r=e,this.g=i,this.b=l,this.a=h}static parse(e){if(!e)return;if(e instanceof Ln)return e;if(typeof e!="string")return;const i=Ba(e);return i?new Ln(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,l,h]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(l)},${h})`}toArray(){const{r:e,g:i,b:l,a:h}=this;return h===0?[0,0,0,0]:[255*e/h,255*i/h,255*l/h,h]}toArray01(){const{r:e,g:i,b:l,a:h}=this;return h===0?[0,0,0,0]:[e/h,i/h,l/h,h]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:l,a:h}=this;return[e,i,l,h]}}Ln.black=new Ln(0,0,0,1),Ln.white=new Ln(1,1,1,1),Ln.transparent=new Ln(0,0,0,0),Ln.red=new Ln(1,0,0,1),Ln.blue=new Ln(0,0,1,1);var Or=Ln;class Fa{constructor(e,i,l){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ea{constructor(e,i,l,h,p){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=l,this.fontStack=h,this.textColor=p}}class Vn{constructor(e){this.sections=e}static fromString(e){return new Vn([new ea(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Vn?e:Vn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const l={};i.fontStack&&(l["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(l["font-scale"]=i.scale),i.textColor&&(l["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(l)}return e}}class Qn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Qn({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Kl(n,e,i,l){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[n,e,i,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[n,e,i,l]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ao(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Or||n instanceof Fa||n instanceof Vn||n instanceof Qn)return!0;if(Array.isArray(n)){for(const e of n)if(!Ao(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!Ao(n[e]))return!1;return!0}return!1}function Lr(n){if(n===null)return $s;if(typeof n=="string")return qt;if(typeof n=="boolean")return Vt;if(typeof n=="number")return ct;if(n instanceof Or)return Nn;if(n instanceof Fa)return Un;if(n instanceof Vn)return To;if(n instanceof Qn)return ws;if(Array.isArray(n)){const e=n.length;let i;for(const l of n){const h=Lr(l);if(i){if(i===h)continue;i=Gt;break}i=h}return Jn(i||Gt,e)}return oi}function Mo(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Or||n instanceof Vn||n instanceof Qn?n.toString():JSON.stringify(n)}class Vh{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ao(e[1]))return i.error("invalid value");const l=e[1];let h=Lr(l);const p=i.expectedType;return h.kind!=="array"||h.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(h=p),new Vh(h,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Or?["rgba"].concat(this.value.toArray()):this.value instanceof Vn?this.value.serialize():this.value}}var ta=Vh,zn=class{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}};const $h={string:qt,number:ct,boolean:Vt,object:oi};class Gh{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let l,h=1;const p=e[0];if(p==="array"){let v,w;if(e.length>2){const S=e[1];if(typeof S!="string"||!(S in $h)||S==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);v=$h[S],h++}else v=Gt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);w=e[2],h++}l=Jn(v,w)}else l=$h[p];const g=[];for(;h<e.length;h++){const v=i.parse(e[h],h,Gt);if(!v)return null;g.push(v)}return new Gh(l,g)}evaluate(e){for(let i=0;i<this.args.length;i++){const l=this.args[i].evaluate(e);if(!Oi(this.type,Lr(l)))return l;if(i===this.args.length-1)throw new zn(`Expected value to be of type ${Tr(this.type)}, but found ${Tr(Lr(l))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const l=e.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){i.push(l.kind);const h=e.N;(typeof h=="number"||this.args.length>1)&&i.push(h)}}return i.concat(this.args.map(l=>l.serialize()))}}var Ws=Gh;class Po{constructor(e){this.type=To,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return i.error("First argument must be an image or text section.");const h=[];let p=!1;for(let g=1;g<=e.length-1;++g){const v=e[g];if(p&&typeof v=="object"&&!Array.isArray(v)){p=!1;let w=null;if(v["font-scale"]&&(w=i.parse(v["font-scale"],1,ct),!w))return null;let S=null;if(v["text-font"]&&(S=i.parse(v["text-font"],1,Jn(qt)),!S))return null;let k=null;if(v["text-color"]&&(k=i.parse(v["text-color"],1,Nn),!k))return null;const M=h[h.length-1];M.scale=w,M.font=S,M.textColor=k}else{const w=i.parse(e[g],1,Gt);if(!w)return null;const S=w.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:w,scale:null,font:null,textColor:null})}}return new Po(h)}evaluate(e){return new Vn(this.sections.map(i=>{const l=i.content.evaluate(e);return Lr(l)===ws?new ea("",l,null,null,null):new ea(Mo(l),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const l={};i.scale&&(l["font-scale"]=i.scale.serialize()),i.font&&(l["text-font"]=i.font.serialize()),i.textColor&&(l["text-color"]=i.textColor.serialize()),e.push(l)}return e}}class sc{constructor(e){this.type=ws,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const l=i.parse(e[1],1,qt);return l?new sc(l):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),l=Qn.fromString(i);return l&&e.availableImages&&(l.available=e.availableImages.indexOf(i)>-1),l}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ey={"to-boolean":Vt,"to-color":Nn,"to-number":ct,"to-string":qt};class Wh{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const l=e[0];if((l==="to-boolean"||l==="to-string")&&e.length!==2)return i.error("Expected one argument.");const h=ey[l],p=[];for(let g=1;g<e.length;g++){const v=i.parse(e[g],g,Gt);if(!v)return null;p.push(v)}return new Wh(h,p)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,l;for(const h of this.args){if(i=h.evaluate(e),l=null,i instanceof Or)return i;if(typeof i=="string"){const p=e.parseColor(i);if(p)return p}else if(Array.isArray(i)&&(l=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Kl(i[0],i[1],i[2],i[3]),!l))return new Or(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new zn(l||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const l of this.args){if(i=l.evaluate(e),i===null)return 0;const h=Number(i);if(!isNaN(h))return h}throw new zn(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Vn.fromString(Mo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Qn.fromString(Mo(this.args[0].evaluate(e))):Mo(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Po([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new sc(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var ja=Wh;const Ss=["Unknown","Point","LineString","Polygon"];var qh=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ss[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:l}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-n[0])+this.featureDistanceData.bearing[1]*(l*e-n[1])}return 0}parseColor(n){let e=this._parseColorCache[n];return e||(e=this._parseColorCache[n]=Or.parse(n)),e}};class ra{constructor(e,i,l,h){this.name=e,this.type=i,this._evaluate=l,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const l=e[0],h=ra.definitions[l];if(!h)return i.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=g.filter(([S])=>!Array.isArray(S)||S.length===e.length-1);let w=null;for(const[S,k]of v){w=new Jh(i.registry,i.path,null,i.scope);const M=[];let P=!1;for(let z=1;z<e.length;z++){const O=e[z],N=Array.isArray(S)?S[z-1]:S.type,W=w.parse(O,1+M.length,N);if(!W){P=!0;break}M.push(W)}if(!P)if(Array.isArray(S)&&S.length!==M.length)w.error(`Expected ${S.length} arguments, but found ${M.length} instead.`);else{for(let z=0;z<M.length;z++){const O=Array.isArray(S)?S[z]:S.type,N=M[z];w.concat(z+1).checkSubtype(O,N.type)}if(w.errors.length===0)return new ra(l,p,k,M)}}if(v.length===1)i.errors.push(...w.errors);else{const S=(v.length?v:g).map(([M])=>{return P=M,Array.isArray(P)?`(${P.map(Tr).join(", ")})`:`(${Tr(P.type)}...)`;var P}).join(" | "),k=[];for(let M=1;M<e.length;M++){const P=i.parse(e[M],1+k.length);if(!P)return null;k.push(Tr(P.type))}i.error(`Expected arguments of type ${S}, but found (${k.join(", ")}) instead.`)}return null}static register(e,i){ra.definitions=i;for(const l in i)e[l]=ra}}var qs=ra;class Yl{constructor(e,i,l){this.type=Un,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return i.error("Collator options argument must be an object.");const h=i.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,Vt);if(!h)return null;const p=i.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,Vt);if(!p)return null;let g=null;return l.locale&&(g=i.parse(l.locale,1,qt),!g)?null:new Yl(h,p,g)}evaluate(e){return new Fa(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Hs=8192;function oc(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Na(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function Jl(n,e){const i=(180+n[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(i*h*Hs),Math.round(l*h*Hs)]}function Ep(n,e,i){const l=n[0]-e[0],h=n[1]-e[1],p=n[0]-i[0],g=n[1]-i[1];return l*g-p*h==0&&l*p<=0&&h*g<=0}function ac(n,e){let i=!1;for(let g=0,v=e.length;g<v;g++){const w=e[g];for(let S=0,k=w.length;S<k-1;S++){if(Ep(n,w[S],w[S+1]))return!1;(h=w[S])[1]>(l=n)[1]!=(p=w[S+1])[1]>l[1]&&l[0]<(p[0]-h[0])*(l[1]-h[1])/(p[1]-h[1])+h[0]&&(i=!i)}}var l,h,p;return i}function Hh(n,e){for(let i=0;i<e.length;i++)if(ac(n,e[i]))return!0;return!1}function Zh(n,e,i,l){const h=l[0]-i[0],p=l[1]-i[1],g=(n[0]-i[0])*p-h*(n[1]-i[1]),v=(e[0]-i[0])*p-h*(e[1]-i[1]);return g>0&&v<0||g<0&&v>0}function Ua(n,e,i){for(const S of i)for(let k=0;k<S.length-1;++k)if((v=[(g=S[k+1])[0]-(p=S[k])[0],g[1]-p[1]])[0]*(w=[(h=e)[0]-(l=n)[0],h[1]-l[1]])[1]-v[1]*w[0]!=0&&Zh(l,h,p,g)&&Zh(p,g,l,h))return!0;var l,h,p,g,v,w;return!1}function ar(n,e){for(let i=0;i<n.length;++i)if(!ac(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(Ua(n[i],n[i+1],e))return!1;return!0}function ty(n,e){for(let i=0;i<e.length;i++)if(ar(n,e[i]))return!0;return!1}function Xh(n,e,i){const l=[];for(let h=0;h<n.length;h++){const p=[];for(let g=0;g<n[h].length;g++){const v=Jl(n[h][g],i);oc(e,v),p.push(v)}l.push(p)}return l}function Cp(n,e,i){const l=[];for(let h=0;h<n.length;h++){const p=Xh(n[h],e,i);l.push(p)}return l}function Kh(n,e,i,l){if(n[0]<i[0]||n[0]>i[2]){const h=.5*l;let p=n[0]-i[0]>h?-l:i[0]-n[0]>h?l:0;p===0&&(p=n[0]-i[2]>h?-l:i[2]-n[0]>h?l:0),n[0]+=p}oc(e,n)}function kp(n,e,i,l){const h=Math.pow(2,l.z)*Hs,p=[l.x*Hs,l.y*Hs],g=[];if(!n)return g;for(const v of n)for(const w of v){const S=[w.x+p[0],w.y+p[1]];Kh(S,e,i,h),g.push(S)}return g}function Yh(n,e,i,l){const h=Math.pow(2,l.z)*Hs,p=[l.x*Hs,l.y*Hs],g=[];if(!n)return g;for(const w of n){const S=[];for(const k of w){const M=[k.x+p[0],k.y+p[1]];oc(e,M),S.push(M)}g.push(S)}if(e[2]-e[0]<=h/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const w of g)for(const S of w)Kh(S,e,i,h)}var v;return g}class Va{constructor(e,i){this.type=Vt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ao(e[1])){const l=e[1];if(l.type==="FeatureCollection")for(let h=0;h<l.features.length;++h){const p=l.features[h].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Va(l,l.features[h].geometry)}else if(l.type==="Feature"){const h=l.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Va(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Va(l,l)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,l){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(l.type==="Polygon"){const v=Xh(l.coordinates,p,g),w=kp(i.geometry(),h,p,g);if(!Na(h,p))return!1;for(const S of w)if(!ac(S,v))return!1}if(l.type==="MultiPolygon"){const v=Cp(l.coordinates,p,g),w=kp(i.geometry(),h,p,g);if(!Na(h,p))return!1;for(const S of w)if(!Hh(S,v))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,l){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(l.type==="Polygon"){const v=Xh(l.coordinates,p,g),w=Yh(i.geometry(),h,p,g);if(!Na(h,p))return!1;for(const S of w)if(!ar(S,v))return!1}if(l.type==="MultiPolygon"){const v=Cp(l.coordinates,p,g),w=Yh(i.geometry(),h,p,g);if(!Na(h,p))return!1;for(const S of w)if(!ty(S,v))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var lc=Va;function $a(n){if(n instanceof qs&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof lc)return!1;let e=!0;return n.eachChild(i=>{e&&!$a(i)&&(e=!1)}),e}function Zs(n){if(n instanceof qs&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(i=>{e&&!Zs(i)&&(e=!1)}),e}function na(n,e){if(n instanceof qs&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(l=>{i&&!na(l,e)&&(i=!1)}),i}class uc{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const l=e[1];return i.scope.has(l)?new uc(l,i.scope.get(l)):i.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Ip=uc;class Ql{constructor(e,i=[],l,h=new Hl,p=[]){this.registry=e,this.path=i,this.key=i.map(g=>`[${g}]`).join(""),this.scope=h,this.errors=p,this.expectedType=l}parse(e,i,l,h,p={}){return i?this.concat(i,l,h)._parse(e,p):this._parse(e,p)}_parse(e,i){function l(h,p,g){return g==="assert"?new Ws(p,[h]):g==="coerce"?new ja(p,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[h];if(p){let g=p.parse(e,this);if(!g)return null;if(this.expectedType){const v=this.expectedType,w=g.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||w.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(v,w))return null}else g=l(g,v,i.typeAnnotation||"coerce");else g=l(g,v,i.typeAnnotation||"assert")}if(!(g instanceof ta)&&g.type.kind!=="resolvedImage"&&Qh(g)){const v=new qh;try{g=new ta(g.type,g.evaluate(v))}catch(w){return this.error(w.message),null}}return g}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,l){const h=typeof e=="number"?this.path.concat(e):this.path,p=l?this.scope.concat(l):this.scope;return new Ql(this.registry,h,i||null,p,this.errors)}error(e,...i){const l=`${this.key}${i.map(h=>`[${h}]`).join("")}`;this.errors.push(new bi(l,e))}checkSubtype(e,i){const l=Oi(e,i);return l&&this.error(l),l}}var Jh=Ql;function Qh(n){if(n instanceof Ip)return Qh(n.boundExpression);if(n instanceof qs&&n.name==="error"||n instanceof Yl||n instanceof lc)return!1;const e=n instanceof ja||n instanceof Ws;let i=!0;return n.eachChild(l=>{i=e?i&&Qh(l):i&&l instanceof ta}),!!i&&$a(n)&&na(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function cc(n,e){const i=n.length-1;let l,h,p=0,g=i,v=0;for(;p<=g;)if(v=Math.floor((p+g)/2),l=n[v],h=n[v+1],l<=e){if(v===i||e<h)return v;p=v+1}else{if(!(l>e))throw new zn("Input is not a number.");g=v-1}return 0}class hc{constructor(e,i,l){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[h,p]of l)this.labels.push(h),this.outputs.push(p)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const l=i.parse(e[1],1,ct);if(!l)return null;const h=[];let p=null;i.expectedType&&i.expectedType.kind!=="value"&&(p=i.expectedType);for(let g=1;g<e.length;g+=2){const v=g===1?-1/0:e[g],w=e[g+1],S=g,k=g+1;if(typeof v!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(h.length&&h[h.length-1][0]>=v)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const M=i.parse(w,k,p);if(!M)return null;p=p||M.type,h.push([v,M])}return new hc(p,l,h)}evaluate(e){const i=this.labels,l=this.outputs;if(i.length===1)return l[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return l[0].evaluate(e);const p=i.length;return h>=i[p-1]?l[p-1].evaluate(e):l[cc(i,h)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var ed=hc;function tr(n,e,i){return n*(1-i)+e*i}var eu=Object.freeze({__proto__:null,array:function(n,e,i){return n.map((l,h)=>tr(l,e[h],i))},color:function(n,e,i){return new Or(tr(n.r,e.r,i),tr(n.g,e.g,i),tr(n.b,e.b,i),tr(n.a,e.a,i))},number:tr});const Ap=.95047,td=1.08883,Mp=4/29,ia=6/29,rd=3*ia*ia,ry=ia*ia*ia,ny=Math.PI/180,iy=180/Math.PI;function nd(n){return n>ry?Math.pow(n,1/3):n/rd+Mp}function id(n){return n>ia?n*n*n:rd*(n-Mp)}function sd(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function dc(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Pp(n){const e=dc(n.r),i=dc(n.g),l=dc(n.b),h=nd((.4124564*e+.3575761*i+.1804375*l)/Ap),p=nd((.2126729*e+.7151522*i+.072175*l)/1);return{l:116*p-16,a:500*(h-p),b:200*(p-nd((.0193339*e+.119192*i+.9503041*l)/td)),alpha:n.a}}function Rp(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,l=isNaN(n.b)?e:e-n.b/200;return e=1*id(e),i=Ap*id(i),l=td*id(l),new Or(sd(3.2404542*i-1.5371385*e-.4985314*l),sd(-.969266*i+1.8760108*e+.041556*l),sd(.0556434*i-.2040259*e+1.0572252*l),n.alpha)}function sy(n,e,i){const l=e-n;return n+i*(l>180||l<-180?l-360*Math.round(l/360):l)}const tu={forward:Pp,reverse:Rp,interpolate:function(n,e,i){return{l:tr(n.l,e.l,i),a:tr(n.a,e.a,i),b:tr(n.b,e.b,i),alpha:tr(n.alpha,e.alpha,i)}}},Ga={forward:function(n){const{l:e,a:i,b:l}=Pp(n),h=Math.atan2(l,i)*iy;return{h:h<0?h+360:h,c:Math.sqrt(i*i+l*l),l:e,alpha:n.a}},reverse:function(n){const e=n.h*ny,i=n.c;return Rp({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:sy(n.h,e.h,i),c:tr(n.c,e.c,i),l:tr(n.l,e.l,i),alpha:tr(n.alpha,e.alpha,i)}}};var od=Object.freeze({__proto__:null,hcl:Ga,lab:tu});class ru{constructor(e,i,l,h,p){this.type=e,this.operator=i,this.interpolation=l,this.input=h,this.labels=[],this.outputs=[];for(const[g,v]of p)this.labels.push(g),this.outputs.push(v)}static interpolationFactor(e,i,l,h){let p=0;if(e.name==="exponential")p=ad(i,e.base,l,h);else if(e.name==="linear")p=ad(i,1,l,h);else if(e.name==="cubic-bezier"){const g=e.controlPoints;p=new Ne(g[0],g[1],g[2],g[3]).solve(ad(i,1,l,h))}return p}static parse(e,i){let[l,h,p,...g]=e;if(!Array.isArray(h)||h.length===0)return i.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const S=h[1];if(typeof S!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:S}}else{if(h[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const S=h.slice(1);if(S.length!==4||S.some(k=>typeof k!="number"||k<0||k>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:S}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(p=i.parse(p,2,ct),!p)return null;const v=[];let w=null;l==="interpolate-hcl"||l==="interpolate-lab"?w=Nn:i.expectedType&&i.expectedType.kind!=="value"&&(w=i.expectedType);for(let S=0;S<g.length;S+=2){const k=g[S],M=g[S+1],P=S+3,z=S+4;if(typeof k!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(v.length&&v[v.length-1][0]>=k)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const O=i.parse(M,z,w);if(!O)return null;w=w||O.type,v.push([k,O])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new ru(w,l,h,p,v):i.error(`Type ${Tr(w)} is not interpolatable.`)}evaluate(e){const i=this.labels,l=this.outputs;if(i.length===1)return l[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return l[0].evaluate(e);const p=i.length;if(h>=i[p-1])return l[p-1].evaluate(e);const g=cc(i,h),v=ru.interpolationFactor(this.interpolation,h,i[g],i[g+1]),w=l[g].evaluate(e),S=l[g+1].evaluate(e);return this.operator==="interpolate"?eu[this.type.kind.toLowerCase()](w,S,v):this.operator==="interpolate-hcl"?Ga.reverse(Ga.interpolate(Ga.forward(w),Ga.forward(S),v)):tu.reverse(tu.interpolate(tu.forward(w),tu.forward(S),v))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)i.push(this.labels[l],this.outputs[l].serialize());return i}}function ad(n,e,i,l){const h=l-i,p=n-i;return h===0?0:e===1?p/h:(Math.pow(e,p)-1)/(Math.pow(e,h)-1)}var Ts=ru;class fc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let l=null;const h=i.expectedType;h&&h.kind!=="value"&&(l=h);const p=[];for(const v of e.slice(1)){const w=i.parse(v,1+p.length,l,void 0,{typeAnnotation:"omit"});if(!w)return null;l=l||w.type,p.push(w)}const g=h&&p.some(v=>Oi(h,v.type));return new fc(g?Gt:l,p)}evaluate(e){let i,l=null,h=0;for(const p of this.args){if(h++,l=p.evaluate(e),l&&l instanceof Qn&&!l.available&&(i||(i=l),l=null,h===this.args.length))return i;if(l!==null)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var ld=fc;class pc{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let p=1;p<e.length-1;p+=2){const g=e[p];if(typeof g!="string")return i.error(`Expected string, but found ${typeof g} instead.`,p);if(/[^a-zA-Z0-9_]/.test(g))return i.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=i.parse(e[p+1],p+1);if(!v)return null;l.push([g,v])}const h=i.parse(e[e.length-1],e.length-1,i.expectedType,l);return h?new pc(l,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,l]of this.bindings)e.push(i,l.serialize());return e.push(this.result.serialize()),e}}var Lp=pc;class ud{constructor(e,i,l){this.type=e,this.index=i,this.input=l}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,ct),h=i.parse(e[2],2,Jn(i.expectedType||Gt));return l&&h?new ud(h.type.itemType,l,h):null}evaluate(e){const i=this.index.evaluate(e),l=this.input.evaluate(e);if(i<0)throw new zn(`Array index out of bounds: ${i} < 0.`);if(i>=l.length)throw new zn(`Array index out of bounds: ${i} > ${l.length-1}.`);if(i!==Math.floor(i))throw new zn(`Array index must be an integer, but found ${i} instead.`);return l[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var oy=ud;class cd{constructor(e,i){this.type=Vt,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Gt),h=i.parse(e[2],2,Gt);return l&&h?Eo(l.type,[Vt,qt,ct,$s,Gt])?new cd(l,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Tr(l.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(l==null)return!1;if(!Co(i,["boolean","string","number","null"]))throw new zn(`Expected first argument to be of type boolean, string, number or null, but found ${Tr(Lr(i))} instead.`);if(!Co(l,["string","array"]))throw new zn(`Expected second argument to be of type array or string, but found ${Tr(Lr(l))} instead.`);return l.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var mc=cd;class nu{constructor(e,i,l){this.type=ct,this.needle=e,this.haystack=i,this.fromIndex=l}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Gt),h=i.parse(e[2],2,Gt);if(!l||!h)return null;if(!Eo(l.type,[Vt,qt,ct,$s,Gt]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Tr(l.type)} instead`);if(e.length===4){const p=i.parse(e[3],3,ct);return p?new nu(l,h,p):null}return new nu(l,h)}evaluate(e){const i=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!Co(i,["boolean","string","number","null"]))throw new zn(`Expected first argument to be of type boolean, string, number or null, but found ${Tr(Lr(i))} instead.`);if(!Co(l,["string","array"]))throw new zn(`Expected second argument to be of type array or string, but found ${Tr(Lr(l))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return l.indexOf(i,h)}return l.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var zp=nu;class hd{constructor(e,i,l,h,p,g){this.inputType=e,this.type=i,this.input=l,this.cases=h,this.outputs=p,this.otherwise=g}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let l,h;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);const p={},g=[];for(let S=2;S<e.length-1;S+=2){let k=e[S];const M=e[S+1];Array.isArray(k)||(k=[k]);const P=i.concat(S);if(k.length===0)return P.error("Expected at least one branch label.");for(const O of k){if(typeof O!="number"&&typeof O!="string")return P.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return P.error("Numeric branch labels must be integer values.");if(l){if(P.checkSubtype(l,Lr(O)))return null}else l=Lr(O);if(p[String(O)]!==void 0)return P.error("Branch labels must be unique.");p[String(O)]=g.length}const z=i.parse(M,S,h);if(!z)return null;h=h||z.type,g.push(z)}const v=i.parse(e[1],1,Gt);if(!v)return null;const w=i.parse(e[e.length-1],e.length-1,h);return w?v.type.kind!=="value"&&i.concat(1).checkSubtype(l,v.type)?null:new hd(l,h,v,p,g,w):null}evaluate(e){const i=this.input.evaluate(e);return(Lr(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),l=[],h={};for(const g of i){const v=h[this.cases[g]];v===void 0?(h[this.cases[g]]=l.length,l.push([this.cases[g],[g]])):l[v][1].push(g)}const p=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,v]of l)e.push(v.length===1?p(v[0]):v.map(p)),e.push(this.outputs[g].serialize());return e.push(this.otherwise.serialize()),e}}var ay=hd;class dd{constructor(e,i,l){this.type=e,this.branches=i,this.otherwise=l}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let l;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);const h=[];for(let g=1;g<e.length-1;g+=2){const v=i.parse(e[g],g,Vt);if(!v)return null;const w=i.parse(e[g+1],g+1,l);if(!w)return null;h.push([v,w]),l=l||w.type}const p=i.parse(e[e.length-1],e.length-1,l);return p?new dd(l,h,p):null}evaluate(e){for(const[i,l]of this.branches)if(i.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,l]of this.branches)e(i),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Dp=dd;class iu{constructor(e,i,l,h){this.type=e,this.input=i,this.beginIndex=l,this.endIndex=h}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Gt),h=i.parse(e[2],2,ct);if(!l||!h)return null;if(!Eo(l.type,[Jn(Gt),qt,Gt]))return i.error(`Expected first argument to be of type array or string, but found ${Tr(l.type)} instead`);if(e.length===4){const p=i.parse(e[3],3,ct);return p?new iu(l.type,l,h,p):null}return new iu(l.type,l,h)}evaluate(e){const i=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!Co(i,["string","array"]))throw new zn(`Expected first argument to be of type array or string, but found ${Tr(Lr(i))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return i.slice(l,h)}return i.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Op=iu;function gc(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Bp(n,e,i,l){return l.compare(e,i)===0}function Wa(n,e,i){const l=n!=="=="&&n!=="!=";return class YM{constructor(p,g,v){this.type=Vt,this.lhs=p,this.rhs=g,this.collator=v,this.hasUntypedArgument=p.type.kind==="value"||g.type.kind==="value"}static parse(p,g){if(p.length!==3&&p.length!==4)return g.error("Expected two or three arguments.");const v=p[0];let w=g.parse(p[1],1,Gt);if(!w)return null;if(!gc(v,w.type))return g.concat(1).error(`"${v}" comparisons are not supported for type '${Tr(w.type)}'.`);let S=g.parse(p[2],2,Gt);if(!S)return null;if(!gc(v,S.type))return g.concat(2).error(`"${v}" comparisons are not supported for type '${Tr(S.type)}'.`);if(w.type.kind!==S.type.kind&&w.type.kind!=="value"&&S.type.kind!=="value")return g.error(`Cannot compare types '${Tr(w.type)}' and '${Tr(S.type)}'.`);l&&(w.type.kind==="value"&&S.type.kind!=="value"?w=new Ws(S.type,[w]):w.type.kind!=="value"&&S.type.kind==="value"&&(S=new Ws(w.type,[S])));let k=null;if(p.length===4){if(w.type.kind!=="string"&&S.type.kind!=="string"&&w.type.kind!=="value"&&S.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(k=g.parse(p[3],3,Un),!k)return null}return new YM(w,S,k)}evaluate(p){const g=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(l&&this.hasUntypedArgument){const w=Lr(g),S=Lr(v);if(w.kind!==S.kind||w.kind!=="string"&&w.kind!=="number")throw new zn(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${w.kind}, ${S.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const w=Lr(g),S=Lr(v);if(w.kind!=="string"||S.kind!=="string")return e(p,g,v)}return this.collator?i(p,g,v,this.collator.evaluate(p)):e(p,g,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[n];return this.eachChild(g=>{p.push(g.serialize())}),p}}}const ly=Wa("==",function(n,e,i){return e===i},Bp),uy=Wa("!=",function(n,e,i){return e!==i},function(n,e,i,l){return!Bp(0,e,i,l)}),cy=Wa("<",function(n,e,i){return e<i},function(n,e,i,l){return l.compare(e,i)<0}),hy=Wa(">",function(n,e,i){return e>i},function(n,e,i,l){return l.compare(e,i)>0}),dy=Wa("<=",function(n,e,i){return e<=i},function(n,e,i,l){return l.compare(e,i)<=0}),Fp=Wa(">=",function(n,e,i){return e>=i},function(n,e,i,l){return l.compare(e,i)>=0});class _c{constructor(e,i,l,h,p,g){this.type=qt,this.number=e,this.locale=i,this.currency=l,this.unit=h,this.minFractionDigits=p,this.maxFractionDigits=g}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const l=i.parse(e[1],1,ct);if(!l)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let p=null;if(h.locale&&(p=i.parse(h.locale,1,qt),!p))return null;let g=null;if(h.currency&&(g=i.parse(h.currency,1,qt),!g))return null;let v=null;if(h.unit&&(v=i.parse(h.unit,1,qt),!v))return null;let w=null;if(h["min-fraction-digits"]&&(w=i.parse(h["min-fraction-digits"],1,ct),!w))return null;let S=null;return h["max-fraction-digits"]&&(S=i.parse(h["max-fraction-digits"],1,ct),!S)?null:new _c(l,p,g,v,w,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class qa{constructor(e){this.type=ct,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=i.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Tr(l.type)} instead.`):new qa(l):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new zn(`Expected value to be of type string or array, but found ${Tr(Lr(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const jp={"==":ly,"!=":uy,">":hy,"<":cy,">=":Fp,"<=":dy,array:Ws,at:oy,boolean:Ws,case:Dp,coalesce:ld,collator:Yl,format:Po,image:sc,in:mc,"index-of":zp,interpolate:Ts,"interpolate-hcl":Ts,"interpolate-lab":Ts,length:qa,let:Lp,literal:ta,match:ay,number:Ws,"number-format":_c,object:Ws,slice:Op,step:ed,string:Ws,"to-boolean":ja,"to-color":ja,"to-number":ja,"to-string":ja,var:Ip,within:lc};function Np(n,[e,i,l,h]){e=e.evaluate(n),i=i.evaluate(n),l=l.evaluate(n);const p=h?h.evaluate(n):1,g=Kl(e,i,l,p);if(g)throw new zn(g);return new Or(e/255*p,i/255*p,l/255*p,p)}function Xs(n,e){return n in e}function yc(n,e){const i=e[n];return i===void 0?null:i}function Bi(n){return{type:n}}qs.register(jp,{error:[{kind:"error"},[qt],(n,[e])=>{throw new zn(e.evaluate(n))}],typeof:[qt,[Gt],(n,[e])=>Tr(Lr(e.evaluate(n)))],"to-rgba":[Jn(ct,4),[Nn],(n,[e])=>e.evaluate(n).toArray()],rgb:[Nn,[ct,ct,ct],Np],rgba:[Nn,[ct,ct,ct,ct],Np],has:{type:Vt,overloads:[[[qt],(n,[e])=>Xs(e.evaluate(n),n.properties())],[[qt,oi],(n,[e,i])=>Xs(e.evaluate(n),i.evaluate(n))]]},get:{type:Gt,overloads:[[[qt],(n,[e])=>yc(e.evaluate(n),n.properties())],[[qt,oi],(n,[e,i])=>yc(e.evaluate(n),i.evaluate(n))]]},"feature-state":[Gt,[qt],(n,[e])=>yc(e.evaluate(n),n.featureState||{})],properties:[oi,[],n=>n.properties()],"geometry-type":[qt,[],n=>n.geometryType()],id:[Gt,[],n=>n.id()],zoom:[ct,[],n=>n.globals.zoom],pitch:[ct,[],n=>n.globals.pitch||0],"distance-from-center":[ct,[],n=>n.distanceFromCenter()],"heatmap-density":[ct,[],n=>n.globals.heatmapDensity||0],"line-progress":[ct,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[ct,[],n=>n.globals.skyRadialProgress||0],accumulated:[Gt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[ct,Bi(ct),(n,e)=>{let i=0;for(const l of e)i+=l.evaluate(n);return i}],"*":[ct,Bi(ct),(n,e)=>{let i=1;for(const l of e)i*=l.evaluate(n);return i}],"-":{type:ct,overloads:[[[ct,ct],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[ct],(n,[e])=>-e.evaluate(n)]]},"/":[ct,[ct,ct],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[ct,[ct,ct],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[ct,[],()=>Math.LN2],pi:[ct,[],()=>Math.PI],e:[ct,[],()=>Math.E],"^":[ct,[ct,ct],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[ct,[ct],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[ct,[ct],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[ct,[ct],(n,[e])=>Math.log(e.evaluate(n))],log2:[ct,[ct],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[ct,[ct],(n,[e])=>Math.sin(e.evaluate(n))],cos:[ct,[ct],(n,[e])=>Math.cos(e.evaluate(n))],tan:[ct,[ct],(n,[e])=>Math.tan(e.evaluate(n))],asin:[ct,[ct],(n,[e])=>Math.asin(e.evaluate(n))],acos:[ct,[ct],(n,[e])=>Math.acos(e.evaluate(n))],atan:[ct,[ct],(n,[e])=>Math.atan(e.evaluate(n))],min:[ct,Bi(ct),(n,e)=>Math.min(...e.map(i=>i.evaluate(n)))],max:[ct,Bi(ct),(n,e)=>Math.max(...e.map(i=>i.evaluate(n)))],abs:[ct,[ct],(n,[e])=>Math.abs(e.evaluate(n))],round:[ct,[ct],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[ct,[ct],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[ct,[ct],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Vt,[qt,Gt],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[Vt,[Gt],(n,[e])=>n.id()===e.value],"filter-type-==":[Vt,[qt],(n,[e])=>n.geometryType()===e.value],"filter-<":[Vt,[qt,Gt],(n,[e,i])=>{const l=n.properties()[e.value],h=i.value;return typeof l==typeof h&&l<h}],"filter-id-<":[Vt,[Gt],(n,[e])=>{const i=n.id(),l=e.value;return typeof i==typeof l&&i<l}],"filter->":[Vt,[qt,Gt],(n,[e,i])=>{const l=n.properties()[e.value],h=i.value;return typeof l==typeof h&&l>h}],"filter-id->":[Vt,[Gt],(n,[e])=>{const i=n.id(),l=e.value;return typeof i==typeof l&&i>l}],"filter-<=":[Vt,[qt,Gt],(n,[e,i])=>{const l=n.properties()[e.value],h=i.value;return typeof l==typeof h&&l<=h}],"filter-id-<=":[Vt,[Gt],(n,[e])=>{const i=n.id(),l=e.value;return typeof i==typeof l&&i<=l}],"filter->=":[Vt,[qt,Gt],(n,[e,i])=>{const l=n.properties()[e.value],h=i.value;return typeof l==typeof h&&l>=h}],"filter-id->=":[Vt,[Gt],(n,[e])=>{const i=n.id(),l=e.value;return typeof i==typeof l&&i>=l}],"filter-has":[Vt,[Gt],(n,[e])=>e.value in n.properties()],"filter-has-id":[Vt,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Vt,[Jn(qt)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Vt,[Jn(Gt)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Vt,[qt,Jn(Gt)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Vt,[qt,Jn(Gt)],(n,[e,i])=>function(l,h,p,g){for(;p<=g;){const v=p+g>>1;if(h[v]===l)return!0;h[v]>l?g=v-1:p=v+1}return!1}(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Vt,overloads:[[[Vt,Vt],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[Bi(Vt),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Vt,overloads:[[[Vt,Vt],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[Bi(Vt),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[Vt,[Vt],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Vt,[qt],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[qt,[qt],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[qt,[qt],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[qt,Bi(Gt),(n,e)=>e.map(i=>Mo(i.evaluate(n))).join("")],"resolved-locale":[qt,[Un],(n,[e])=>e.evaluate(n).resolvedLocale()]});var su=jp;function Up(n){return{result:"success",value:n}}function sa(n){return{result:"error",value:n}}function Ha(n){return n["property-type"]==="data-driven"}function vc(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function xc(n){return!!n.expression&&n.expression.interpolated}function rr(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function ou(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Vp(n){return n}function bc(n,e){const i=e.type==="color",l=n.stops&&typeof n.stops[0][0]=="object",h=l||!(l||n.property!==void 0),p=n.type||(xc(e)?"exponential":"interval");if(i&&((n=Di({},n)).stops&&(n.stops=n.stops.map(S=>[S[0],Or.parse(S[1])])),n.default=Or.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!od[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let g,v,w;if(p==="exponential")g=Ks;else if(p==="interval")g=wc;else if(p==="categorical"){g=$p,v=Object.create(null);for(const S of n.stops)v[S[0]]=S[1];w=typeof n.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);g=Gp}if(l){const S={},k=[];for(let z=0;z<n.stops.length;z++){const O=n.stops[z],N=O[0].zoom;S[N]===void 0&&(S[N]={zoom:N,type:n.type,property:n.property,default:n.default,stops:[]},k.push(N)),S[N].stops.push([O[0].value,O[1]])}const M=[];for(const z of k)M.push([S[z].zoom,bc(S[z],e)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:Ts.interpolationFactor.bind(void 0,P),zoomStops:M.map(z=>z[0]),evaluate:({zoom:z},O)=>Ks({stops:M,base:n.base},e,z).evaluate(z,O)}}if(h){const S=p==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:Ts.interpolationFactor.bind(void 0,S),zoomStops:n.stops.map(k=>k[0]),evaluate:({zoom:k})=>g(n,e,k,v,w)}}return{kind:"source",evaluate(S,k){const M=k&&k.properties?k.properties[n.property]:void 0;return M===void 0?Za(n.default,e.default):g(n,e,M,v,w)}}}function Za(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function $p(n,e,i,l,h){return Za(typeof i===h?l[i]:void 0,n.default,e.default)}function wc(n,e,i){if(rr(i)!=="number")return Za(n.default,e.default);const l=n.stops.length;if(l===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[l-1][0])return n.stops[l-1][1];const h=cc(n.stops.map(p=>p[0]),i);return n.stops[h][1]}function Ks(n,e,i){const l=n.base!==void 0?n.base:1;if(rr(i)!=="number")return Za(n.default,e.default);const h=n.stops.length;if(h===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[h-1][0])return n.stops[h-1][1];const p=cc(n.stops.map(k=>k[0]),i),g=function(k,M,P,z){const O=z-P,N=k-P;return O===0?0:M===1?N/O:(Math.pow(M,N)-1)/(Math.pow(M,O)-1)}(i,l,n.stops[p][0],n.stops[p+1][0]),v=n.stops[p][1],w=n.stops[p+1][1];let S=eu[e.type]||Vp;if(n.colorSpace&&n.colorSpace!=="rgb"){const k=od[n.colorSpace];S=(M,P)=>k.reverse(k.interpolate(k.forward(M),k.forward(P),g))}return typeof v.evaluate=="function"?{evaluate(...k){const M=v.evaluate.apply(void 0,k),P=w.evaluate.apply(void 0,k);if(M!==void 0&&P!==void 0)return S(M,P,g)}}:S(v,w,g)}function Gp(n,e,i){return e.type==="color"?i=Or.parse(i):e.type==="formatted"?i=Vn.fromString(i.toString()):e.type==="resolvedImage"?i=Qn.fromString(i.toString()):rr(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Za(i,n.default,e.default)}class Sc{constructor(e,i){this.expression=e,this._warningHistory={},this._evaluator=new qh,this._defaultValue=i?function(l){return l.type==="color"&&(ou(l.default)||Array.isArray(l.default))?new Or(0,0,0,0):l.type==="color"?Or.parse(l.default)||null:l.default===void 0?null:l.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,l,h,p,g,v,w){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=l,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,l,h,p,g,v,w){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=l||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new zn(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function Xa(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in su}function Ka(n,e){const i=new Jh(su,[],e?function(h){const p={color:Nn,string:qt,number:ct,enum:qt,boolean:Vt,formatted:To,resolvedImage:ws};return h.type==="array"?Jn(p[h.value]||Gt,h.length):p[h.type]}(e):void 0),l=i.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?Up(new Sc(l,e)):sa(i.errors)}class fd{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!Zs(i.expression)}evaluateWithoutErrorHandling(e,i,l,h,p,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,l,h,p,g)}evaluate(e,i,l,h,p,g){return this._styleExpression.evaluate(e,i,l,h,p,g)}}class au{constructor(e,i,l,h){this.kind=e,this.zoomStops=l,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Zs(i.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,i,l,h,p,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,l,h,p,g)}evaluate(e,i,l,h,p,g){return this._styleExpression.evaluate(e,i,l,h,p,g)}interpolationFactor(e,i,l){return this.interpolationType?Ts.interpolationFactor(this.interpolationType,e,i,l):0}}function lu(n,e){if((n=Ka(n,e)).result==="error")return n;const i=n.value.expression,l=$a(i);if(!l&&!Ha(e))return sa([new bi("","data expressions not supported")]);const h=na(i,["zoom","pitch","distance-from-center"]);if(!h&&!vc(e))return sa([new bi("","zoom expressions not supported")]);const p=Ec(i);return p||h?p instanceof bi?sa([p]):p instanceof Ts&&!xc(e)?sa([new bi("",'"interpolate" expressions cannot be used with this property')]):Up(p?new au(l?"camera":"composite",n.value,p.labels,p instanceof Ts?p.interpolation:void 0):new fd(l?"constant":"source",n.value)):sa([new bi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Tc{constructor(e,i){this._parameters=e,this._specification=i,Di(this,bc(this._parameters,this._specification))}static deserialize(e){return new Tc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ec(n){let e=null;if(n instanceof Lp)e=Ec(n.result);else if(n instanceof ld){for(const i of n.args)if(e=Ec(i),e)break}else(n instanceof ed||n instanceof Ts)&&n.input instanceof qs&&n.input.name==="zoom"&&(e=n);return e instanceof bi||n.eachChild(i=>{const l=Ec(i);l instanceof bi?e=l:!e&&l?e=new bi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&l&&e!==l&&(e=new bi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class ft{constructor(e,i,l,h){this.message=(e?`${e}: `:"")+l,h&&(this.identifier=h),i!=null&&i.__line__&&(this.line=i.__line__)}}function is(n){const e=n.key,i=n.value,l=n.valueSpec||{},h=n.objectElementValidators||{},p=n.style,g=n.styleSpec;let v=[];const w=rr(i);if(w!=="object")return[new ft(e,i,`object expected, ${w} found`)];for(const S in i){const k=S.split(".")[0];let M;h[k]?M=h[k]:l[k]?M=$n:h["*"]?M=h["*"]:l["*"]&&(M=$n),M?v=v.concat(M({key:(e&&`${e}.`)+S,value:i[S],valueSpec:l[k]||l["*"],style:p,styleSpec:g,object:i,objectKey:S},i)):v.push(new ft(e,i[S],`unknown property "${S}"`))}for(const S in l)h[S]||l[S].required&&l[S].default===void 0&&i[S]===void 0&&v.push(new ft(e,i,`missing required property "${S}"`));return v}function Wp(n){const e=n.value,i=n.valueSpec,l=n.style,h=n.styleSpec,p=n.key,g=n.arrayElementValidator||$n;if(rr(e)!=="array")return[new ft(p,e,`array expected, ${rr(e)} found`)];if(i.length&&e.length!==i.length)return[new ft(p,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new ft(p,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let v={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};h.$version<7&&(v.function=i.function),rr(i.value)==="object"&&(v=i.value);let w=[];for(let S=0;S<e.length;S++)w=w.concat(g({array:e,arrayIndex:S,value:e[S],valueSpec:v,style:l,styleSpec:h,key:`${p}[${S}]`}));return w}function uu(n){const e=n.key,i=n.value,l=n.valueSpec;let h=rr(i);if(h==="number"&&i!=i&&(h="NaN"),h!=="number")return[new ft(e,i,`number expected, ${h} found`)];if("minimum"in l){let p=l.minimum;if(rr(l.minimum)==="array"&&(p=l.minimum[n.arrayIndex]),i<p)return[new ft(e,i,`${i} is less than the minimum value ${p}`)]}if("maximum"in l){let p=l.maximum;if(rr(l.maximum)==="array"&&(p=l.maximum[n.arrayIndex]),i>p)return[new ft(e,i,`${i} is greater than the maximum value ${p}`)]}return[]}function cu(n){const e=n.valueSpec,i=Vr(n.value.type);let l,h,p,g={};const v=i!=="categorical"&&n.value.property===void 0,w=!v,S=rr(n.value.stops)==="array"&&rr(n.value.stops[0])==="array"&&rr(n.value.stops[0][0])==="object",k=is({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(z){if(i==="identity")return[new ft(z.key,z.value,'identity function may not have a "stops" property')];let O=[];const N=z.value;return O=O.concat(Wp({key:z.key,value:N,valueSpec:z.valueSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:M})),rr(N)==="array"&&N.length===0&&O.push(new ft(z.key,N,"array must have at least one stop")),O},default:function(z){return $n({key:z.key,value:z.value,valueSpec:e,style:z.style,styleSpec:z.styleSpec})}}});return i==="identity"&&v&&k.push(new ft(n.key,n.value,'missing required property "property"')),i==="identity"||n.value.stops||k.push(new ft(n.key,n.value,'missing required property "stops"')),i==="exponential"&&n.valueSpec.expression&&!xc(n.valueSpec)&&k.push(new ft(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(w&&!Ha(n.valueSpec)?k.push(new ft(n.key,n.value,"property functions not supported")):v&&!vc(n.valueSpec)&&k.push(new ft(n.key,n.value,"zoom functions not supported"))),i!=="categorical"&&!S||n.value.property!==void 0||k.push(new ft(n.key,n.value,'"property" property is required')),k;function M(z){let O=[];const N=z.value,W=z.key;if(rr(N)!=="array")return[new ft(W,N,`array expected, ${rr(N)} found`)];if(N.length!==2)return[new ft(W,N,`array length 2 expected, length ${N.length} found`)];if(S){if(rr(N[0])!=="object")return[new ft(W,N,`object expected, ${rr(N[0])} found`)];if(N[0].zoom===void 0)return[new ft(W,N,"object stop key must have zoom")];if(N[0].value===void 0)return[new ft(W,N,"object stop key must have value")];const Q=Vr(N[0].zoom);if(typeof Q!="number")return[new ft(W,N[0].zoom,"stop zoom values must be numbers")];if(p&&p>Q)return[new ft(W,N[0].zoom,"stop zoom values must appear in ascending order")];Q!==p&&(p=Q,h=void 0,g={}),O=O.concat(is({key:`${W}[0]`,value:N[0],valueSpec:{zoom:{}},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:uu,value:P}}))}else O=O.concat(P({key:`${W}[0]`,value:N[0],valueSpec:{},style:z.style,styleSpec:z.styleSpec},N));return Xa(sn(N[1]))?O.concat([new ft(`${W}[1]`,N[1],"expressions are not allowed in function stops.")]):O.concat($n({key:`${W}[1]`,value:N[1],valueSpec:e,style:z.style,styleSpec:z.styleSpec}))}function P(z,O){const N=rr(z.value),W=Vr(z.value),Q=z.value!==null?z.value:O;if(l){if(N!==l)return[new ft(z.key,Q,`${N} stop domain type must match previous stop domain type ${l}`)]}else l=N;if(N!=="number"&&N!=="string"&&N!=="boolean"&&typeof W!="number"&&typeof W!="string"&&typeof W!="boolean")return[new ft(z.key,Q,"stop domain value must be a number, string, or boolean")];if(N!=="number"&&i!=="categorical"){let ue=`number expected, ${N} found`;return Ha(e)&&i===void 0&&(ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ft(z.key,Q,ue)]}return i!=="categorical"||N!=="number"||typeof W=="number"&&isFinite(W)&&Math.floor(W)===W?i!=="categorical"&&N==="number"&&typeof W=="number"&&typeof h=="number"&&h!==void 0&&W<h?[new ft(z.key,Q,"stop domain values must appear in ascending order")]:(h=W,i==="categorical"&&W in g?[new ft(z.key,Q,"stop domain values must be unique")]:(g[W]=!0,[])):[new ft(z.key,Q,`integer expected, found ${String(W)}`)]}}function En(n){const e=(n.expressionContext==="property"?lu:Ka)(sn(n.value),n.valueSpec);if(e.result==="error")return e.value.map(l=>new ft(`${n.key}${l.key}`,n.value,l.message));const i=e.value.expression||e.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!i.outputDefined())return[new ft(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Zs(i))return[new ft(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter")return hu(i,n);if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!na(i,["zoom","feature-state"]))return[new ft(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!$a(i))return[new ft(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function hu(n,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const h of e.valueSpec.expression.parameters)i.delete(h);if(i.size===0)return[];const l=[];return n instanceof qs&&i.has(n.name)?[new ft(e.key,e.value,`["${n.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(n.eachChild(h=>{l.push(...hu(h,e))}),l)}function Cc(n){const e=n.key,i=n.value,l=n.valueSpec,h=[];return Array.isArray(l.values)?l.values.indexOf(Vr(i))===-1&&h.push(new ft(e,i,`expected one of [${l.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(l.values).indexOf(Vr(i))===-1&&h.push(new ft(e,i,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(i)} found`)),h}function pd(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!pd(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function kc(n,e="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};pd(n)||(n=Ja(n));const i=n;let l=!0;try{l=function(S){if(!Ya(S))return S;let k=sn(S);return Ic(k),k=qp(k),k}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const h=Be[`filter_${e}`],p=Ka(l,h);let g=null;if(p.result==="error")throw new Error(p.value.map(S=>`${S.key}: ${S.message}`).join(", "));g=(S,k,M)=>p.value.evaluate(S,k,{},M);let v=null,w=null;if(l!==i){const S=Ka(i,h);if(S.result==="error")throw new Error(S.value.map(k=>`${k.key}: ${k.message}`).join(", "));v=(k,M,P,z,O)=>S.value.evaluate(k,M,{},P,void 0,void 0,z,O),w=!$a(S.value.expression)}return{filter:g,dynamicFilter:v||void 0,needGeometry:Hp(l),needFeature:!!w}}function qp(n){if(!Array.isArray(n))return n;const e=function(i){if(md.has(i[0])){for(let l=1;l<i.length;l++)if(Ya(i[l]))return!0}return i}(n);return e===!0?e:e.map(i=>qp(i))}function Ic(n){let e=!1;const i=[];if(n[0]==="case"){for(let l=1;l<n.length-1;l+=2)e=e||Ya(n[l]),i.push(n[l+1]);i.push(n[n.length-1])}else if(n[0]==="match"){e=e||Ya(n[1]);for(let l=2;l<n.length-1;l+=2)i.push(n[l+1]);i.push(n[n.length-1])}else if(n[0]==="step"){e=e||Ya(n[1]);for(let l=1;l<n.length-1;l+=2)i.push(n[l+1])}e&&(n.length=0,n.push("any",...i));for(let l=1;l<n.length;l++)Ic(n[l])}function Ya(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<n.length;i++)if(Ya(n[i]))return!0;return!1}const md=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function fy(n,e){return n<e?-1:n>e?1:0}function Hp(n){if(!Array.isArray(n))return!1;if(n[0]==="within")return!0;for(let e=1;e<n.length;e++)if(Hp(n[e]))return!0;return!1}function Ja(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?gd(n[1],n[2],"=="):e==="!="?Ac(gd(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?gd(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(Ja))):e==="all"?["all"].concat(n.slice(1).map(Ja)):e==="none"?["all"].concat(n.slice(1).map(Ja).map(Ac)):e==="in"?_d(n[1],n.slice(2)):e==="!in"?Ac(_d(n[1],n.slice(2))):e==="has"?yd(n[1]):e==="!has"?Ac(yd(n[1])):e!=="within"||n;var i}function gd(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function _d(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",n,["literal",e.sort(fy)]]:["filter-in-small",n,["literal",e]]}}function yd(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Ac(n){return["!",n]}function du(n){return pd(sn(n.value))?En(Di({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${n.layerType||"fill"}`]})):fu(n)}function fu(n){const e=n.value,i=n.key;if(rr(e)!=="array")return[new ft(i,e,`array expected, ${rr(e)} found`)];const l=n.styleSpec;let h,p=[];if(e.length<1)return[new ft(i,e,"filter array must have at least 1 element")];switch(p=p.concat(Cc({key:`${i}[0]`,value:e[0],valueSpec:l.filter_operator,style:n.style,styleSpec:n.styleSpec})),Vr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Vr(e[1])==="$type"&&p.push(new ft(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&p.push(new ft(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=rr(e[1]),h!=="string"&&p.push(new ft(`${i}[1]`,e[1],`string expected, ${h} found`)));for(let g=2;g<e.length;g++)h=rr(e[g]),Vr(e[1])==="$type"?p=p.concat(Cc({key:`${i}[${g}]`,value:e[g],valueSpec:l.geometry_type,style:n.style,styleSpec:n.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&p.push(new ft(`${i}[${g}]`,e[g],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)p=p.concat(fu({key:`${i}[${g}]`,value:e[g],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":h=rr(e[1]),e.length!==2?p.push(new ft(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="string"&&p.push(new ft(`${i}[1]`,e[1],`string expected, ${h} found`));break;case"within":h=rr(e[1]),e.length!==2?p.push(new ft(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="object"&&p.push(new ft(`${i}[1]`,e[1],`object expected, ${h} found`))}return p}function vd(n,e){const i=n.key,l=n.style,h=n.styleSpec,p=n.value,g=n.objectKey,v=h[`${e}_${n.layerType}`];if(!v)return[];const w=g.match(/^(.*)-transition$/);if(e==="paint"&&w&&v[w[1]]&&v[w[1]].transition)return $n({key:i,value:p,valueSpec:h.transition,style:l,styleSpec:h});const S=n.valueSpec||v[g];if(!S)return[new ft(i,p,`unknown property "${g}"`)];let k;if(rr(p)==="string"&&Ha(S)&&!S.tokens&&(k=/^{([^}]+)}$/.exec(p))){const P=`\`{ "type": "identity", "property": ${k?JSON.stringify(k[1]):'"_"'} }\``;return[new ft(i,p,`"${g}" does not support interpolation syntax
Use an identity property function instead: ${P}.`)]}const M=[];return n.layerType==="symbol"&&(g==="text-field"&&l&&!l.glyphs&&M.push(new ft(i,p,'use of "text-field" requires a style "glyphs" property')),g==="text-font"&&ou(sn(p))&&Vr(p.type)==="identity"&&M.push(new ft(i,p,'"text-font" does not support identity functions'))),M.concat($n({key:n.key,value:p,valueSpec:S,style:l,styleSpec:h,expressionContext:"property",propertyType:e,propertyKey:g}))}function Zp(n){return vd(n,"paint")}function xd(n){return vd(n,"layout")}function Xp(n){let e=[];const i=n.value,l=n.key,h=n.style,p=n.styleSpec;i.type||i.ref||e.push(new ft(l,i,'either "type" or "ref" is required'));let g=Vr(i.type);const v=Vr(i.ref);if(i.id){const w=Vr(i.id);for(let S=0;S<n.arrayIndex;S++){const k=h.layers[S];Vr(k.id)===w&&e.push(new ft(l,i.id,`duplicate layer id "${i.id}", previously used at line ${k.id.__line__}`))}}if("ref"in i){let w;["type","source","source-layer","filter","layout"].forEach(S=>{S in i&&e.push(new ft(l,i[S],`"${S}" is prohibited for ref layers`))}),h.layers.forEach(S=>{Vr(S.id)===v&&(w=S)}),w?w.ref?e.push(new ft(l,i.ref,"ref cannot reference another ref layer")):g=Vr(w.type):typeof v=="string"&&e.push(new ft(l,i.ref,`ref layer "${v}" not found`))}else if(g!=="background"&&g!=="sky")if(i.source){const w=h.sources&&h.sources[i.source],S=w&&Vr(w.type);w?S==="vector"&&g==="raster"?e.push(new ft(l,i.source,`layer "${i.id}" requires a raster source`)):S==="raster"&&g!=="raster"?e.push(new ft(l,i.source,`layer "${i.id}" requires a vector source`)):S!=="vector"||i["source-layer"]?S==="raster-dem"&&g!=="hillshade"?e.push(new ft(l,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||S==="geojson"&&w.lineMetrics||e.push(new ft(l,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ft(l,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new ft(l,i.source,`source "${i.source}" not found`))}else e.push(new ft(l,i,'missing required property "source"'));return e=e.concat(is({key:l,value:i,valueSpec:p.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>$n({key:`${l}.type`,value:i.type,valueSpec:p.layer.type,style:n.style,styleSpec:n.styleSpec,object:i,objectKey:"type"}),filter:w=>du(Di({layerType:g},w)),layout:w=>is({layer:i,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":S=>xd(Di({layerType:g},S))}}),paint:w=>is({layer:i,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":S=>Zp(Di({layerType:g},S))}})}})),e}function Ro(n){const e=n.value,i=n.key,l=rr(e);return l!=="string"?[new ft(i,e,`string expected, ${l} found`)]:[]}const Kp={promoteId:function({key:n,value:e}){if(rr(e)==="string")return Ro({key:n,value:e});{const i=[];for(const l in e)i.push(...Ro({key:`${n}.${l}`,value:e[l]}));return i}}};function Yp(n){const e=n.value,i=n.key,l=n.styleSpec,h=n.style;if(!e.type)return[new ft(i,e,'"type" is required')];const p=Vr(e.type);let g;switch(p){case"vector":case"raster":case"raster-dem":return g=is({key:i,value:e,valueSpec:l[`source_${p.replace("-","_")}`],style:n.style,styleSpec:l,objectElementValidators:Kp}),g;case"geojson":if(g=is({key:i,value:e,valueSpec:l.source_geojson,style:h,styleSpec:l,objectElementValidators:Kp}),e.cluster)for(const v in e.clusterProperties){const[w,S]=e.clusterProperties[v],k=typeof w=="string"?[w,["accumulated"],["get",v]]:w;g.push(...En({key:`${i}.${v}.map`,value:S,expressionContext:"cluster-map"})),g.push(...En({key:`${i}.${v}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return g;case"video":return is({key:i,value:e,valueSpec:l.source_video,style:h,styleSpec:l});case"image":return is({key:i,value:e,valueSpec:l.source_image,style:h,styleSpec:l});case"canvas":return[new ft(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Cc({key:`${i}.type`,value:e.type,valueSpec:{values:py(l)},style:h,styleSpec:l})}}function py(n){return n.source.reduce((e,i)=>{const l=n[i];return l.type.type==="enum"&&(e=e.concat(Object.keys(l.type.values))),e},[])}function Jp(n){const e=n.value,i=n.styleSpec,l=i.light,h=n.style;let p=[];const g=rr(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new ft("light",e,`object expected, ${g} found`)]),p;for(const v in e){const w=v.match(/^(.*)-transition$/);p=p.concat(w&&l[w[1]]&&l[w[1]].transition?$n({key:v,value:e[v],valueSpec:i.transition,style:h,styleSpec:i}):l[v]?$n({key:v,value:e[v],valueSpec:l[v],style:h,styleSpec:i}):[new ft(v,e[v],`unknown property "${v}"`)])}return p}function bd(n){const e=n.value,i=n.key,l=n.style,h=n.styleSpec,p=h.terrain;let g=[];const v=rr(e);if(e===void 0)return g;if(v!=="object")return g=g.concat([new ft("terrain",e,`object expected, ${v} found`)]),g;for(const w in e){const S=w.match(/^(.*)-transition$/);g=g.concat(S&&p[S[1]]&&p[S[1]].transition?$n({key:w,value:e[w],valueSpec:h.transition,style:l,styleSpec:h}):p[w]?$n({key:w,value:e[w],valueSpec:p[w],style:l,styleSpec:h}):[new ft(w,e[w],`unknown property "${w}"`)])}if(e.source){const w=l.sources&&l.sources[e.source],S=w&&Vr(w.type);w?S!=="raster-dem"&&g.push(new ft(i,e.source,`terrain cannot be used with a source of type ${String(S)}, it only be used with a "raster-dem" source type`)):g.push(new ft(i,e.source,`source "${e.source}" not found`))}else g.push(new ft(i,e,'terrain is missing required property "source"'));return g}function Qp(n){const e=n.value,i=n.style,l=n.styleSpec,h=l.fog;let p=[];const g=rr(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new ft("fog",e,`object expected, ${g} found`)]),p;for(const v in e){const w=v.match(/^(.*)-transition$/);p=p.concat(w&&h[w[1]]&&h[w[1]].transition?$n({key:v,value:e[v],valueSpec:l.transition,style:i,styleSpec:l}):h[v]?$n({key:v,value:e[v],valueSpec:h[v],style:i,styleSpec:l}):[new ft(v,e[v],`unknown property "${v}"`)])}return p}const em={"*":()=>[],array:Wp,boolean:function(n){const e=n.value,i=n.key,l=rr(e);return l!=="boolean"?[new ft(i,e,`boolean expected, ${l} found`)]:[]},number:uu,color:function(n){const e=n.key,i=n.value,l=rr(i);return l!=="string"?[new ft(e,i,`color expected, ${l} found`)]:Ba(i)===null?[new ft(e,i,`color expected, "${i}" found`)]:[]},enum:Cc,filter:du,function:cu,layer:Xp,object:is,source:Yp,light:Jp,terrain:bd,fog:Qp,string:Ro,formatted:function(n){return Ro(n).length===0?[]:En(n)},resolvedImage:function(n){return Ro(n).length===0?[]:En(n)},projection:function(n){const e=n.value,i=n.styleSpec,l=i.projection,h=n.style;let p=[];const g=rr(e);if(g==="object")for(const v in e)p=p.concat($n({key:v,value:e[v],valueSpec:l[v],style:h,styleSpec:i}));else g!=="string"&&(p=p.concat([new ft("projection",e,`object or string expected, ${g} found`)]));return p}};function $n(n){const e=n.value,i=n.valueSpec,l=n.styleSpec;return i.expression&&ou(Vr(e))?cu(n):i.expression&&Xa(sn(e))?En(n):i.type&&em[i.type]?em[i.type](n):is(Di({},n,{valueSpec:i.type?l[i.type]:i}))}function my(n){const e=n.value,i=n.key,l=Ro(n);return l.length||(e.indexOf("{fontstack}")===-1&&l.push(new ft(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&l.push(new ft(i,e,'"glyphs" url must include a "{range}" token'))),l}function tm(n,e=Be){return Fi($n({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,objectElementValidators:{glyphs:my,"*":()=>[]}}))}const gy=n=>Fi(Zp(n)),_y=n=>Fi(xd(n));function Fi(n){return n.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function rm(n,e){let i=!1;if(e&&e.length)for(const l of e)n.fire(new zi(new Error(l.message))),i=!0;return i}var yy=Es,ss=3;function Es(n,e,i){var l=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var h=new Int32Array(this.arrayBuffer);n=h[0],this.d=(e=h[1])+2*(i=h[2]);for(var p=0;p<this.d*this.d;p++){var g=h[ss+p],v=h[ss+p+1];l.push(g===v?null:h.subarray(g,v))}var w=h[ss+l.length+1];this.keys=h.subarray(h[ss+l.length],w),this.bboxes=h.subarray(w),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var S=0;S<this.d*this.d;S++)l.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=n,this.padding=i,this.scale=e/n,this.uid=0;var k=i/e*n;this.min=-k,this.max=n+k}Es.prototype.insert=function(n,e,i,l,h){this._forEachCell(e,i,l,h,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(l),this.bboxes.push(h)},Es.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Es.prototype._insertCell=function(n,e,i,l,h,p){this.cells[h].push(p)},Es.prototype.query=function(n,e,i,l,h){var p=this.min,g=this.max;if(n<=p&&e<=p&&g<=i&&g<=l&&!h)return Array.prototype.slice.call(this.keys);var v=[];return this._forEachCell(n,e,i,l,this._queryCell,v,{},h),v},Es.prototype._queryCell=function(n,e,i,l,h,p,g,v){var w=this.cells[h];if(w!==null)for(var S=this.keys,k=this.bboxes,M=0;M<w.length;M++){var P=w[M];if(g[P]===void 0){var z=4*P;(v?v(k[z+0],k[z+1],k[z+2],k[z+3]):n<=k[z+2]&&e<=k[z+3]&&i>=k[z+0]&&l>=k[z+1])?(g[P]=!0,p.push(S[P])):g[P]=!1}}},Es.prototype._forEachCell=function(n,e,i,l,h,p,g,v){for(var w=this._convertToCellCoord(n),S=this._convertToCellCoord(e),k=this._convertToCellCoord(i),M=this._convertToCellCoord(l),P=w;P<=k;P++)for(var z=S;z<=M;z++){var O=this.d*z+P;if((!v||v(this._convertFromCellCoord(P),this._convertFromCellCoord(z),this._convertFromCellCoord(P+1),this._convertFromCellCoord(z+1)))&&h.call(this,n,e,i,l,O,p,g,v))return}},Es.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},Es.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},Es.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,e=ss+this.cells.length+1+1,i=0,l=0;l<this.cells.length;l++)i+=this.cells[l].length;var h=new Int32Array(e+i+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var p=e,g=0;g<n.length;g++){var v=n[g];h[ss+g]=p,h.set(v,p),p+=v.length}return h[ss+n.length]=p,h.set(this.keys,p),h[ss+n.length+1]=p+=this.keys.length,h.set(this.bboxes,p),p+=this.bboxes.length,h.buffer};var oa=Se(yy);const Mc={};function mt(n,e,i={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writeable:!1}),Mc[e]={klass:n,omit:i.omit||[]}}mt(Object,"Object"),oa.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.push(i),{buffer:i}},oa.deserialize=function(n){return new oa(n.buffer)},Object.defineProperty(oa,"name",{value:"Grid"}),mt(oa,"Grid"),mt(Or,"Color"),mt(Error,"Error"),mt(cr,"AJAXError"),mt(Qn,"ResolvedImage"),mt(Tc,"StylePropertyFunction"),mt(Sc,"StyleExpression",{omit:["_evaluator"]}),mt(au,"ZoomDependentExpression"),mt(fd,"ZoomConstantExpression"),mt(qs,"CompoundExpression",{omit:["_evaluate"]});for(const n in su)Mc[su[n]._classRegistryKey]||mt(su[n],`Expression${n}`);function wd(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Sd(n){return I.ImageBitmap&&n instanceof I.ImageBitmap}function Qa(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(wd(n)||Sd(n))return e&&e.push(n),n;if(ArrayBuffer.isView(n)){const i=n;return e&&e.push(i.buffer),i}if(n instanceof I.ImageData)return e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const l of n)i.push(Qa(l,e));return i}if(typeof n=="object"){const i=n.constructor,l=i._classRegistryKey;if(!l)throw new Error(`can't serialize object of unregistered class ${l}`);const h=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const p in n)n.hasOwnProperty(p)&&(Mc[l].omit.indexOf(p)>=0||(h[p]=Qa(n[p],e)));n instanceof Error&&(h.message=n.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(h.$name=l),h}throw new Error("can't serialize object of type "+typeof n)}function aa(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||wd(n)||Sd(n)||ArrayBuffer.isView(n)||n instanceof I.ImageData)return n;if(Array.isArray(n))return n.map(aa);if(typeof n=="object"){const e=n.$name||"Object",{klass:i}=Mc[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(n);const l=Object.create(i.prototype);for(const h of Object.keys(n))h!=="$name"&&(l[h]=aa(n[h]));return l}throw new Error("can't deserialize object of type "+typeof n)}const dt={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function Td(n){for(const e of n)if(Ed(e.charCodeAt(0)))return!0;return!1}function vy(n){for(const e of n)if(!nm(e.charCodeAt(0)))return!1;return!0}function nm(n){return!(dt.Arabic(n)||dt["Arabic Supplement"](n)||dt["Arabic Extended-A"](n)||dt["Arabic Presentation Forms-A"](n)||dt["Arabic Presentation Forms-B"](n))}function Ed(n){return!(n!==746&&n!==747&&(n<4352||!(dt["Bopomofo Extended"](n)||dt.Bopomofo(n)||dt["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||dt["CJK Compatibility Ideographs"](n)||dt["CJK Compatibility"](n)||dt["CJK Radicals Supplement"](n)||dt["CJK Strokes"](n)||!(!dt["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||dt["CJK Unified Ideographs Extension A"](n)||dt["CJK Unified Ideographs"](n)||dt["Enclosed CJK Letters and Months"](n)||dt["Hangul Compatibility Jamo"](n)||dt["Hangul Jamo Extended-A"](n)||dt["Hangul Jamo Extended-B"](n)||dt["Hangul Jamo"](n)||dt["Hangul Syllables"](n)||dt.Hiragana(n)||dt["Ideographic Description Characters"](n)||dt.Kanbun(n)||dt["Kangxi Radicals"](n)||dt["Katakana Phonetic Extensions"](n)||dt.Katakana(n)&&n!==12540||!(!dt["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!dt["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||dt["Unified Canadian Aboriginal Syllabics"](n)||dt["Unified Canadian Aboriginal Syllabics Extended"](n)||dt["Vertical Forms"](n)||dt["Yijing Hexagram Symbols"](n)||dt["Yi Syllables"](n)||dt["Yi Radicals"](n))))}function im(n){return!(Ed(n)||function(e){return!!(dt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||dt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||dt["Letterlike Symbols"](e)||dt["Number Forms"](e)||dt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||dt["Control Pictures"](e)&&e!==9251||dt["Optical Character Recognition"](e)||dt["Enclosed Alphanumerics"](e)||dt["Geometric Shapes"](e)||dt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||dt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||dt["CJK Symbols and Punctuation"](e)||dt.Katakana(e)||dt["Private Use Area"](e)||dt["CJK Compatibility Forms"](e)||dt["Small Form Variants"](e)||dt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}function sm(n){return n>=1424&&n<=2303||dt["Arabic Presentation Forms-A"](n)||dt["Arabic Presentation Forms-B"](n)}function xy(n,e){return!(!e&&sm(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||dt.Khmer(n))}function by(n){for(const e of n)if(sm(e.charCodeAt(0)))return!0;return!1}const Cd="deferred",kd="loading",Id="loaded";let el=null,d="unavailable",s=null;const c=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(d="error"),el&&el(n)};function m(){y.fire(new bs("pluginStateChange",{pluginStatus:d,pluginURL:s}))}const y=new So,x=function(){return d},E=function(){if(d!==Cd||!s)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");d=kd,m(),s&&ns({url:s},n=>{n?c(n):(d=Id,m())})},C={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>d===Id||C.applyArabicShaping!=null,isLoading:()=>d===kd,setState(n){d=n.pluginStatus,s=n.pluginURL},isParsed:()=>C.applyArabicShaping!=null&&C.processBidirectionalText!=null&&C.processStyledBidirectionalText!=null,getPluginURL:()=>s};class A{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,l){for(const h of i)if(!xy(h.charCodeAt(0),l))return!1;return!0}(e,C.isLoaded())}}class L{constructor(e,i){this.property=e,this.value=i,this.expression=function(l,h){if(ou(l))return new Tc(l,h);if(Xa(l)){const p=lu(l,h);if(p.result==="error")throw new Error(p.value.map(g=>`${g.key}: ${g.message}`).join(", "));return p.value}{let p=l;return typeof l=="string"&&h.type==="color"&&(p=Or.parse(l)),{kind:"constant",evaluate:()=>p}}}(i===void 0?e.specification.default:i,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,l){return this.property.possiblyEvaluate(this,e,i,l)}}class R{constructor(e){this.property=e,this.value=new L(e,void 0)}transitioned(e,i){return new G(this.property,this.value,i,Yt({},e.transition,this.transition),e.now)}untransitioned(){return new G(this.property,this.value,null,{},0)}}class B{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return qr(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new R(this._values[e].property)),this._values[e].value=new L(this._values[e].property,i===null?void 0:qr(i))}getTransition(e){return qr(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new R(this._values[e].property)),this._values[e].transition=qr(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const l=this.getValue(i);l!==void 0&&(e[i]=l);const h=this.getTransition(i);h!==void 0&&(e[`${i}-transition`]=h)}return e}transitioned(e,i){const l=new Z(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].transitioned(e,i._values[h]);return l}untransitioned(){const e=new Z(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class G{constructor(e,i,l,h,p){const g=h.delay||0,v=h.duration||0;p=p||0,this.property=e,this.value=i,this.begin=p+g,this.end=this.begin+v,e.specification.transition&&(h.delay||h.duration)&&(this.prior=l)}possiblyEvaluate(e,i,l){const h=e.now||0,p=this.value.possiblyEvaluate(e,i,l),g=this.prior;if(g){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return g.possiblyEvaluate(e,i,l);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,i,l),p,Sr(v))}}return p}}class Z{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,l){const h=new J(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(e,i,l);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Y{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return qr(this._values[e].value)}setValue(e,i){this._values[e]=new L(this._values[e].property,i===null?void 0:qr(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const l=this.getValue(i);l!==void 0&&(e[i]=l)}return e}possiblyEvaluate(e,i,l){const h=new J(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(e,i,l);return h}}class K{constructor(e,i,l){this.property=e,this.value=i,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,l,h){return this.property.evaluate(this.value,this.parameters,e,i,l,h)}}class J{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class F{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,l){const h=eu[this.specification.type];return h?h(e,i,l):e}}class H{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,l,h){return new K(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},l,h)}:e.expression,i)}interpolate(e,i,l){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new K(this,{kind:"constant",value:void 0},e.parameters);const h=eu[this.specification.type];return h?new K(this,{kind:"constant",value:h(e.value.value,i.value.value,l)},e.parameters):e}evaluate(e,i,l,h,p,g){return e.kind==="constant"?e.value:e.evaluate(i,l,h,p,g)}}class ne{constructor(e){this.specification=e}possiblyEvaluate(e,i,l,h){return!!e.expression.evaluate(i,null,{},l,h)}interpolate(){return!1}}class oe{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new A(0,{});for(const l in e){const h=e[l];h.specification.overridable&&this.overridableProperties.push(l);const p=this.defaultPropertyValues[l]=new L(h,void 0),g=this.defaultTransitionablePropertyValues[l]=new R(h);this.defaultTransitioningPropertyValues[l]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=p.possiblyEvaluate(i)}}}function fe(n,e){return 256*(n=st(Math.floor(n),0,255))+st(Math.floor(e),0,255)}mt(H,"DataDrivenProperty"),mt(F,"DataConstantProperty"),mt(ne,"ColorRampProperty");const ge={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class me{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class we{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function xe(n,e=1){let i=0,l=0;return{members:n.map(h=>{const p=ge[h.type].BYTES_PER_ELEMENT,g=i=Pe(i,Math.max(e,p)),v=h.components||1;return l=Math.max(l,p),i+=p*v,{name:h.name,type:h.type,components:v,offset:g}}),size:Pe(i,Math.max(l,e)),alignment:e}}function Pe(n,e){return Math.ceil(n/e)*e}class Xe extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const h=2*e;return this.int16[h+0]=i,this.int16[h+1]=l,e}}Xe.prototype.bytesPerElement=4,mt(Xe,"StructArrayLayout2i4");class ke extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,l)}emplace(e,i,l,h){const p=3*e;return this.int16[p+0]=i,this.int16[p+1]=l,this.int16[p+2]=h,e}}ke.prototype.bytesPerElement=6,mt(ke,"StructArrayLayout3i6");class Ve extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,l,h)}emplace(e,i,l,h,p){const g=4*e;return this.int16[g+0]=i,this.int16[g+1]=l,this.int16[g+2]=h,this.int16[g+3]=p,e}}Ve.prototype.bytesPerElement=8,mt(Ve,"StructArrayLayout4i8");class De extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,p,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,l,h,p,g,v)}emplace(e,i,l,h,p,g,v,w){const S=6*e,k=12*e,M=3*e;return this.int16[S+0]=i,this.int16[S+1]=l,this.uint8[k+4]=h,this.uint8[k+5]=p,this.uint8[k+6]=g,this.uint8[k+7]=v,this.float32[M+2]=w,e}}De.prototype.bytesPerElement=12,mt(De,"StructArrayLayout2i4ub1f12");class Ze extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,l,h)}emplace(e,i,l,h,p){const g=4*e;return this.float32[g+0]=i,this.float32[g+1]=l,this.float32[g+2]=h,this.float32[g+3]=p,e}}Ze.prototype.bytesPerElement=16,mt(Ze,"StructArrayLayout4f16");class Me extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,l,h,p)}emplace(e,i,l,h,p,g){const v=6*e,w=3*e;return this.uint16[v+0]=i,this.uint16[v+1]=l,this.uint16[v+2]=h,this.uint16[v+3]=p,this.float32[w+2]=g,e}}Me.prototype.bytesPerElement=12,mt(Me,"StructArrayLayout4ui1f12");class Ue extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,l,h)}emplace(e,i,l,h,p){const g=4*e;return this.uint16[g+0]=i,this.uint16[g+1]=l,this.uint16[g+2]=h,this.uint16[g+3]=p,e}}Ue.prototype.bytesPerElement=8,mt(Ue,"StructArrayLayout4ui8");class Je extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,h,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,l,h,p,g)}emplace(e,i,l,h,p,g,v){const w=6*e;return this.int16[w+0]=i,this.int16[w+1]=l,this.int16[w+2]=h,this.int16[w+3]=p,this.int16[w+4]=g,this.int16[w+5]=v,e}}Je.prototype.bytesPerElement=12,mt(Je,"StructArrayLayout6i12");class We extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,h,p,g,v,w,S,k,M,P){const z=this.length;return this.resize(z+1),this.emplace(z,e,i,l,h,p,g,v,w,S,k,M,P)}emplace(e,i,l,h,p,g,v,w,S,k,M,P,z){const O=12*e;return this.int16[O+0]=i,this.int16[O+1]=l,this.int16[O+2]=h,this.int16[O+3]=p,this.uint16[O+4]=g,this.uint16[O+5]=v,this.uint16[O+6]=w,this.uint16[O+7]=S,this.int16[O+8]=k,this.int16[O+9]=M,this.int16[O+10]=P,this.int16[O+11]=z,e}}We.prototype.bytesPerElement=24,mt(We,"StructArrayLayout4i4ui4i24");class Qe extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,l,h,p,g)}emplace(e,i,l,h,p,g,v){const w=10*e,S=5*e;return this.int16[w+0]=i,this.int16[w+1]=l,this.int16[w+2]=h,this.float32[S+2]=p,this.float32[S+3]=g,this.float32[S+4]=v,e}}Qe.prototype.bytesPerElement=20,mt(Qe,"StructArrayLayout3i3f20");class vt extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}vt.prototype.bytesPerElement=4,mt(vt,"StructArrayLayout1ul4");class At extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,h,p,g,v,w,S,k,M,P,z){const O=this.length;return this.resize(O+1),this.emplace(O,e,i,l,h,p,g,v,w,S,k,M,P,z)}emplace(e,i,l,h,p,g,v,w,S,k,M,P,z,O){const N=20*e,W=10*e;return this.int16[N+0]=i,this.int16[N+1]=l,this.int16[N+2]=h,this.int16[N+3]=p,this.int16[N+4]=g,this.float32[W+3]=v,this.float32[W+4]=w,this.float32[W+5]=S,this.float32[W+6]=k,this.int16[N+14]=M,this.uint32[W+8]=P,this.uint16[N+18]=z,this.uint16[N+19]=O,e}}At.prototype.bytesPerElement=40,mt(At,"StructArrayLayout5i4f1i1ul2ui40");class gt extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,h,p,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,l,h,p,g,v)}emplace(e,i,l,h,p,g,v,w){const S=8*e;return this.int16[S+0]=i,this.int16[S+1]=l,this.int16[S+2]=h,this.int16[S+4]=p,this.int16[S+5]=g,this.int16[S+6]=v,this.int16[S+7]=w,e}}gt.prototype.bytesPerElement=16,mt(gt,"StructArrayLayout3i2i2i16");class Et extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,l,h,p)}emplace(e,i,l,h,p,g){const v=4*e,w=8*e;return this.float32[v+0]=i,this.float32[v+1]=l,this.float32[v+2]=h,this.int16[w+6]=p,this.int16[w+7]=g,e}}Et.prototype.bytesPerElement=16,mt(Et,"StructArrayLayout2f1f2i16");class Zt extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,l,h)}emplace(e,i,l,h,p){const g=12*e,v=3*e;return this.uint8[g+0]=i,this.uint8[g+1]=l,this.float32[v+1]=h,this.float32[v+2]=p,e}}Zt.prototype.bytesPerElement=12,mt(Zt,"StructArrayLayout2ub2f12");class Ht extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,l)}emplace(e,i,l,h){const p=3*e;return this.float32[p+0]=i,this.float32[p+1]=l,this.float32[p+2]=h,e}}Ht.prototype.bytesPerElement=12,mt(Ht,"StructArrayLayout3f12");class yt extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,l)}emplace(e,i,l,h){const p=3*e;return this.uint16[p+0]=i,this.uint16[p+1]=l,this.uint16[p+2]=h,e}}yt.prototype.bytesPerElement=6,mt(yt,"StructArrayLayout3ui6");class lr extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,p,g,v,w,S,k,M,P,z,O,N,W,Q,ue,ee,le,de){const he=this.length;return this.resize(he+1),this.emplace(he,e,i,l,h,p,g,v,w,S,k,M,P,z,O,N,W,Q,ue,ee,le,de)}emplace(e,i,l,h,p,g,v,w,S,k,M,P,z,O,N,W,Q,ue,ee,le,de,he){const Re=30*e,Ie=15*e,je=60*e;return this.int16[Re+0]=i,this.int16[Re+1]=l,this.int16[Re+2]=h,this.float32[Ie+2]=p,this.float32[Ie+3]=g,this.uint16[Re+8]=v,this.uint16[Re+9]=w,this.uint32[Ie+5]=S,this.uint32[Ie+6]=k,this.uint32[Ie+7]=M,this.uint16[Re+16]=P,this.uint16[Re+17]=z,this.uint16[Re+18]=O,this.float32[Ie+10]=N,this.float32[Ie+11]=W,this.uint8[je+48]=Q,this.uint8[je+49]=ue,this.uint8[je+50]=ee,this.uint32[Ie+13]=le,this.int16[Re+28]=de,this.uint8[je+58]=he,e}}lr.prototype.bytesPerElement=60,mt(lr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class mr extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,p,g,v,w,S,k,M,P,z,O,N,W,Q,ue,ee,le,de,he,Re,Ie,je,Ke,Oe,Ge,$e,He){const tt=this.length;return this.resize(tt+1),this.emplace(tt,e,i,l,h,p,g,v,w,S,k,M,P,z,O,N,W,Q,ue,ee,le,de,he,Re,Ie,je,Ke,Oe,Ge,$e,He)}emplace(e,i,l,h,p,g,v,w,S,k,M,P,z,O,N,W,Q,ue,ee,le,de,he,Re,Ie,je,Ke,Oe,Ge,$e,He,tt){const Fe=38*e,ut=19*e;return this.int16[Fe+0]=i,this.int16[Fe+1]=l,this.int16[Fe+2]=h,this.float32[ut+2]=p,this.float32[ut+3]=g,this.int16[Fe+8]=v,this.int16[Fe+9]=w,this.int16[Fe+10]=S,this.int16[Fe+11]=k,this.int16[Fe+12]=M,this.int16[Fe+13]=P,this.uint16[Fe+14]=z,this.uint16[Fe+15]=O,this.uint16[Fe+16]=N,this.uint16[Fe+17]=W,this.uint16[Fe+18]=Q,this.uint16[Fe+19]=ue,this.uint16[Fe+20]=ee,this.uint16[Fe+21]=le,this.uint16[Fe+22]=de,this.uint16[Fe+23]=he,this.uint16[Fe+24]=Re,this.uint16[Fe+25]=Ie,this.uint16[Fe+26]=je,this.uint16[Fe+27]=Ke,this.uint16[Fe+28]=Oe,this.uint32[ut+15]=Ge,this.float32[ut+16]=$e,this.float32[ut+17]=He,this.float32[ut+18]=tt,e}}mr.prototype.bytesPerElement=76,mt(mr,"StructArrayLayout3i2f6i15ui1ul3f76");class gr extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}gr.prototype.bytesPerElement=4,mt(gr,"StructArrayLayout1f4");class _r extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,l,h,p)}emplace(e,i,l,h,p,g){const v=5*e;return this.float32[v+0]=i,this.float32[v+1]=l,this.float32[v+2]=h,this.float32[v+3]=p,this.float32[v+4]=g,e}}_r.prototype.bytesPerElement=20,mt(_r,"StructArrayLayout5f20");class Gn extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,l,h)}emplace(e,i,l,h,p){const g=6*e;return this.uint32[3*e+0]=i,this.uint16[g+2]=l,this.uint16[g+3]=h,this.uint16[g+4]=p,e}}Gn.prototype.bytesPerElement=12,mt(Gn,"StructArrayLayout1ul3ui12");class Cn extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const h=2*e;return this.uint16[h+0]=i,this.uint16[h+1]=l,e}}Cn.prototype.bytesPerElement=4,mt(Cn,"StructArrayLayout2ui4");class ji extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}ji.prototype.bytesPerElement=2,mt(ji,"StructArrayLayout1ui2");class Cs extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const h=2*e;return this.float32[h+0]=i,this.float32[h+1]=l,e}}Cs.prototype.bytesPerElement=8,mt(Cs,"StructArrayLayout2f8");class zr extends me{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}zr.prototype.size=40;class yr extends At{get(e){return new zr(this,e)}}mt(yr,"CollisionBoxArray");class ir extends me{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}ir.prototype.size=60;class on extends lr{get(e){return new ir(this,e)}}mt(on,"PlacedSymbolArray");class ei extends me{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ei.prototype.size=76;class Mr extends mr{get(e){return new ei(this,e)}}mt(Mr,"SymbolInstanceArray");class ai extends gr{getoffsetX(e){return this.float32[1*e+0]}}mt(ai,"GlyphOffsetArray");class Pc extends Xe{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}mt(Pc,"SymbolLineVertexArray");class la extends me{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}la.prototype.size=12;class pu extends Gn{get(e){return new la(this,e)}}mt(pu,"FeatureIndexArray");class Ys extends Cn{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}mt(Ys,"FillExtrusionCentroidArray");const Lo=xe([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ua=xe([{name:"a_dash",components:4,type:"Uint16"}]);var Rc={exports:{}},mu={exports:{}};mu.exports=function(n,e){var i,l,h,p,g,v,w,S;for(l=n.length-(i=3&n.length),h=e,g=3432918353,v=461845907,S=0;S<l;)w=255&n.charCodeAt(S)|(255&n.charCodeAt(++S))<<8|(255&n.charCodeAt(++S))<<16|(255&n.charCodeAt(++S))<<24,++S,h=27492+(65535&(p=5*(65535&(h=(h^=w=(65535&(w=(w=(65535&w)*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(w=0,i){case 3:w^=(255&n.charCodeAt(S+2))<<16;case 2:w^=(255&n.charCodeAt(S+1))<<8;case 1:h^=w=(65535&(w=(w=(65535&(w^=255&n.charCodeAt(S)))*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295}return h^=n.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0};var Ad=mu.exports,Db={exports:{}};Db.exports=function(n,e){for(var i,l=n.length,h=e^l,p=0;l>=4;)i=1540483477*(65535&(i=255&n.charCodeAt(p)|(255&n.charCodeAt(++p))<<8|(255&n.charCodeAt(++p))<<16|(255&n.charCodeAt(++p))<<24))+((1540483477*(i>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),l-=4,++p;switch(l){case 3:h^=(255&n.charCodeAt(p+2))<<16;case 2:h^=(255&n.charCodeAt(p+1))<<8;case 1:h=1540483477*(65535&(h^=255&n.charCodeAt(p)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};var Ob=Ad,JM=Db.exports;Rc.exports=Ob,Rc.exports.murmur3=Ob,Rc.exports.murmur2=JM;var wy=Se(Rc.exports);class om{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,l,h){this.ids.push(Bb(e)),this.positions.push(i,l,h)}getPositions(e){const i=Bb(e);let l=0,h=this.ids.length-1;for(;l<h;){const g=l+h>>1;this.ids[g]>=i?h=g:l=g+1}const p=[];for(;this.ids[l]===i;)p.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return p}static serialize(e,i){const l=new Float64Array(e.ids),h=new Uint32Array(e.positions);return Sy(l,h,0,l.length-1),i&&i.push(l.buffer,h.buffer),{ids:l,positions:h}}static deserialize(e){const i=new om;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function Bb(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:wy(String(n))}function Sy(n,e,i,l){for(;i<l;){const h=n[i+l>>1];let p=i-1,g=l+1;for(;;){do p++;while(n[p]<h);do g--;while(n[g]>h);if(p>=g)break;am(n,p,g),am(e,3*p,3*g),am(e,3*p+1,3*g+1),am(e,3*p+2,3*g+2)}g-i<l-g?(Sy(n,e,i,g),i=g+1):(Sy(n,e,g+1,l),l=g)}}function am(n,e,i){const l=n[e];n[e]=n[i],n[i]=l}mt(om,"FeaturePositionMap");class ca{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class lm extends ca{constructor(e){super(e),this.current=0}set(e,i,l){this.fetchUniformLocation(e,i)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class Fb extends ca{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,l){this.fetchUniformLocation(e,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class jb extends ca{constructor(e){super(e),this.current=Or.transparent}set(e,i,l){this.fetchUniformLocation(e,i)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const QM=new Float32Array(16),eP=new Float32Array(9),tP=new Float32Array(4);function Ty(n){return[fe(255*n.r,255*n.g),fe(255*n.b,255*n.a)]}class Md{constructor(e,i,l){this.value=e,this.uniformNames=i.map(h=>`u_${h}`),this.type=l}setUniform(e,i,l,h,p){i.set(e,p,h.constantOr(this.value))}getBinding(e,i){return this.type==="color"?new jb(e):new lm(e)}}class Lc{constructor(e,i){this.uniformNames=i.map(l=>`u_${l}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,l,h,p){const g=p==="u_pattern"||p==="u_dash"?this.pattern:p==="u_pixel_ratio"?this.pixelRatio:null;g&&i.set(e,p,g)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new Fb(e):new lm(e)}}class ha{constructor(e,i,l,h){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=i.map(p=>({name:`a_${p}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,i,l,h,p,g){const v=this.paintVertexArray.length,w=this.expression.evaluate(new A(0),i,{},p,h,g);this.paintVertexArray.resize(e),this._setPaintValue(v,e,w)}updatePaintArray(e,i,l,h,p){const g=this.expression.evaluate({zoom:0},l,h,void 0,p);this._setPaintValue(e,i,g)}_setPaintValue(e,i,l){if(this.type==="color"){const h=Ty(l);for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,h[0],h[1])}else{for(let h=e;h<i;h++)this.paintVertexArray.emplace(h,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Js{constructor(e,i,l,h,p,g){this.expression=e,this.uniformNames=i.map(v=>`u_${v}_t`),this.type=l,this.useIntegerZoom=h,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=i.map(v=>({name:`a_${v}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,i,l,h,p,g){const v=this.expression.evaluate(new A(this.zoom),i,{},p,h,g),w=this.expression.evaluate(new A(this.zoom+1),i,{},p,h,g),S=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(S,e,v,w)}updatePaintArray(e,i,l,h,p){const g=this.expression.evaluate({zoom:this.zoom},l,h,void 0,p),v=this.expression.evaluate({zoom:this.zoom+1},l,h,void 0,p);this._setPaintValue(e,i,g,v)}_setPaintValue(e,i,l,h){if(this.type==="color"){const p=Ty(l),g=Ty(h);for(let v=e;v<i;v++)this.paintVertexArray.emplace(v,p[0],p[1],g[0],g[1])}else{for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,l,h);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,l,h,p){const g=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,v=st(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);i.set(e,p,v)}getBinding(e,i){return new lm(e)}}class tl{constructor(e,i,l,h,p){this.expression=e,this.layerId=p,this.paintVertexAttributes=(l==="array"?ua:Lo).members;for(let g=0;g<i.length;++g);this.paintVertexArray=new h}populatePaintArray(e,i,l){const h=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(h,e,i.patterns&&i.patterns[this.layerId],l)}updatePaintArray(e,i,l,h,p,g){this._setPaintValues(e,i,l.patterns&&l.patterns[this.layerId],g)}_setPaintValues(e,i,l,h){if(!h||!l)return;const p=h[l];if(!p)return;const{tl:g,br:v,pixelRatio:w}=p;for(let S=e;S<i;S++)this.paintVertexArray.emplace(S,g[0],g[1],v[0],v[1],w)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class rl{constructor(e,i,l=()=>!0){this.binders={},this._buffers=[];const h=[];for(const p in e.paint._values){if(!l(p))continue;const g=e.paint.get(p);if(!(g instanceof K&&Ha(g.property.specification)))continue;const v=nP(p,e.type),w=g.value,S=g.property.specification.type,k=!!g.property.useIntegerZoom,M=p==="line-dasharray"||p.endsWith("pattern"),P=p==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(w.kind!=="constant"||P)if(w.kind==="source"||P||M){const z=Nb(p,S,"source");this.binders[p]=M?new tl(w,v,S,z,e.id):new ha(w,v,S,z),h.push(`/a_${p}`)}else{const z=Nb(p,S,"composite");this.binders[p]=new Js(w,v,S,k,i,z),h.push(`/z_${p}`)}else this.binders[p]=M?new Lc(w.value,v):new Md(w.value,v,S),h.push(`/u_${p}`)}this.cacheKey=h.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof ha||i instanceof Js?i.maxValue:0}populatePaintArrays(e,i,l,h,p,g){for(const v in this.binders){const w=this.binders[v];(w instanceof ha||w instanceof Js||w instanceof tl)&&w.populatePaintArray(e,i,l,h,p,g)}}setConstantPatternPositions(e){for(const i in this.binders){const l=this.binders[i];l instanceof Lc&&l.setConstantPatternPositions(e)}}updatePaintArrays(e,i,l,h,p,g){let v=!1;for(const w in e){const S=i.getPositions(w);for(const k of S){const M=l.feature(k.index);for(const P in this.binders){const z=this.binders[P];if((z instanceof ha||z instanceof Js||z instanceof tl)&&z.expression.isStateDependent===!0){const O=h.paint.get(P);z.expression=O.value,z.updatePaintArray(k.start,k.end,M,e[w],p,g),v=!0}}}}return v}defines(){const e=[];for(const i in this.binders){const l=this.binders[i];(l instanceof Md||l instanceof Lc)&&e.push(...l.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const l=this.binders[i];if(l instanceof ha||l instanceof Js||l instanceof tl)for(let h=0;h<l.paintVertexAttributes.length;h++)e.push(l.paintVertexAttributes[h].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const l=this.binders[i];if(l instanceof Md||l instanceof Lc||l instanceof Js)for(const h of l.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof Md||h instanceof Lc||h instanceof Js)for(const p of h.uniformNames)i.push({name:p,property:l,binding:h.getBinding(e,p)})}return i}setUniforms(e,i,l,h,p){for(const{name:g,property:v,binding:w}of l)this.binders[v].setUniform(e,w,p,h.get(v),g)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof ha||i instanceof Js||i instanceof tl)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const l=this.binders[i];(l instanceof ha||l instanceof Js||l instanceof tl)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof ha||i instanceof Js||i instanceof tl)&&i.destroy()}}}class gu{constructor(e,i,l=()=>!0){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new rl(h,i,l);this.needsUpload=!1,this._featureMap=new om,this._bufferOffset=0}populatePaintArrays(e,i,l,h,p,g,v){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,i,h,p,g,v);i.id!==void 0&&this._featureMap.add(i.id,l,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,l,h,p){for(const g of l)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,i,g,h,p)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const rP={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function nP(n,e){return rP[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const iP={"line-pattern":{source:Me,composite:Me},"fill-pattern":{source:Me,composite:Me},"fill-extrusion-pattern":{source:Me,composite:Me},"line-dasharray":{source:Ue,composite:Ue}},sP={color:{source:Cs,composite:Ze},number:{source:gr,composite:Cs}};function Nb(n,e,i){const l=iP[n];return l&&l[i]||sP[e][i]}mt(Md,"ConstantBinder"),mt(Lc,"PatternConstantBinder"),mt(ha,"SourceExpressionBinder"),mt(tl,"PatternCompositeBinder"),mt(Js,"CompositeExpressionBinder"),mt(rl,"ProgramConfiguration",{omit:["_buffers"]}),mt(gu,"ProgramConfigurationSet");const Ub="-transition";class Qs extends So{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new Y(i.layout)),i.paint)){this._transitionablePaint=new B(i.paint);for(const l in e.paint)this.setPaintProperty(l,e.paint[l],{validate:!1});for(const l in e.layout)this.setLayoutProperty(l,e.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new J(i.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,l={}){i!=null&&this._validate(_y,`layers.${this.id}.layout.${e}`,e,i,l)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return _i(e,Ub)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,l={}){if(i!=null&&this._validate(gy,`layers.${this.id}.paint.${e}`,e,i,l))return!1;if(_i(e,Ub))return this._transitionablePaint.setTransition(e.slice(0,-11),i||void 0),!1;{const h=this._transitionablePaint._values[e],p=h.value.isDataDriven(),g=h.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const v=this._transitionablePaint._values[e].value,w=v.isDataDriven(),S=_i(e,"pattern")||e==="line-dasharray";return w||p||S||this._handleOverridablePaintPropertyUpdate(e,g,v)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),yi(e,(i,l)=>!(i===void 0||l==="layout"&&!Object.keys(i).length||l==="paint"&&!Object.keys(i).length))}_validate(e,i,l,h,p={}){return(!p||p.validate!==!1)&&rm(this,e.call(tm,{key:i,layerType:this.type,objectKey:l,value:h,styleSpec:Be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof K&&Ha(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=kc(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const oP=xe([{name:"a_pos",components:2,type:"Int16"}],4),aP=xe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class an{constructor(e=[]){this.segments=e}prepareSegment(e,i,l,h){let p=this.segments[this.segments.length-1];return e>an.MAX_VERTEX_ARRAY_LENGTH&&fr(`Max vertices per segment is ${an.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>an.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h)&&(p={vertexOffset:i.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},h!==void 0&&(p.sortKey=h),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,l,h){return new an([{vertexOffset:e,primitiveOffset:i,vertexLength:l,primitiveLength:h,vaos:{},sortKey:0}])}}an.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,mt(an,"SegmentVector");var St=8192;class nl{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof vr?new vr(e.lng,e.lat):vr.convert(e),this}setSouthWest(e){return this._sw=e instanceof vr?new vr(e.lng,e.lat):vr.convert(e),this}extend(e){const i=this._sw,l=this._ne;let h,p;if(e instanceof vr)h=e,p=e;else{if(!(e instanceof nl))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(nl.convert(e)):this.extend(vr.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(vr.convert(e)):this;if(h=e._sw,p=e._ne,!h||!p)return this}return i||l?(i.lng=Math.min(h.lng,i.lng),i.lat=Math.min(h.lat,i.lat),l.lng=Math.max(p.lng,l.lng),l.lat=Math.max(p.lat,l.lat)):(this._sw=new vr(h.lng,h.lat),this._ne=new vr(p.lng,p.lat)),this}getCenter(){return new vr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new vr(this.getWest(),this.getNorth())}getSouthEast(){return new vr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:l}=vr.convert(e);let h=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(e){return!e||e instanceof nl?e:new nl(e)}}var um=1e-6,Ni=typeof Float32Array<"u"?Float32Array:Array;function Vb(){var n=new Ni(9);return Ni!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function $b(n,e,i){var l=e[0],h=e[1],p=e[2],g=e[3],v=e[4],w=e[5],S=e[6],k=e[7],M=e[8],P=i[0],z=i[1],O=i[2],N=i[3],W=i[4],Q=i[5],ue=i[6],ee=i[7],le=i[8];return n[0]=P*l+z*g+O*S,n[1]=P*h+z*v+O*k,n[2]=P*p+z*w+O*M,n[3]=N*l+W*g+Q*S,n[4]=N*h+W*v+Q*k,n[5]=N*p+W*w+Q*M,n[6]=ue*l+ee*g+le*S,n[7]=ue*h+ee*v+le*k,n[8]=ue*p+ee*w+le*M,n}function eo(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Ey(n,e){var i=e[0],l=e[1],h=e[2],p=e[3],g=e[4],v=e[5],w=e[6],S=e[7],k=e[8],M=e[9],P=e[10],z=e[11],O=e[12],N=e[13],W=e[14],Q=e[15],ue=i*v-l*g,ee=i*w-h*g,le=i*S-p*g,de=l*w-h*v,he=l*S-p*v,Re=h*S-p*w,Ie=k*N-M*O,je=k*W-P*O,Ke=k*Q-z*O,Oe=M*W-P*N,Ge=M*Q-z*N,$e=P*Q-z*W,He=ue*$e-ee*Ge+le*Oe+de*Ke-he*je+Re*Ie;return He?(n[0]=(v*$e-w*Ge+S*Oe)*(He=1/He),n[1]=(h*Ge-l*$e-p*Oe)*He,n[2]=(N*Re-W*he+Q*de)*He,n[3]=(P*he-M*Re-z*de)*He,n[4]=(w*Ke-g*$e-S*je)*He,n[5]=(i*$e-h*Ke+p*je)*He,n[6]=(W*le-O*Re-Q*ee)*He,n[7]=(k*Re-P*le+z*ee)*He,n[8]=(g*Ge-v*Ke+S*Ie)*He,n[9]=(l*Ke-i*Ge-p*Ie)*He,n[10]=(O*he-N*le+Q*ue)*He,n[11]=(M*le-k*he-z*ue)*He,n[12]=(v*je-g*Oe-w*Ie)*He,n[13]=(i*Oe-l*je+h*Ie)*He,n[14]=(N*ee-O*de-W*ue)*He,n[15]=(k*de-M*ee+P*ue)*He,n):null}function _u(n,e,i){var l=e[0],h=e[1],p=e[2],g=e[3],v=e[4],w=e[5],S=e[6],k=e[7],M=e[8],P=e[9],z=e[10],O=e[11],N=e[12],W=e[13],Q=e[14],ue=e[15],ee=i[0],le=i[1],de=i[2],he=i[3];return n[0]=ee*l+le*v+de*M+he*N,n[1]=ee*h+le*w+de*P+he*W,n[2]=ee*p+le*S+de*z+he*Q,n[3]=ee*g+le*k+de*O+he*ue,n[4]=(ee=i[4])*l+(le=i[5])*v+(de=i[6])*M+(he=i[7])*N,n[5]=ee*h+le*w+de*P+he*W,n[6]=ee*p+le*S+de*z+he*Q,n[7]=ee*g+le*k+de*O+he*ue,n[8]=(ee=i[8])*l+(le=i[9])*v+(de=i[10])*M+(he=i[11])*N,n[9]=ee*h+le*w+de*P+he*W,n[10]=ee*p+le*S+de*z+he*Q,n[11]=ee*g+le*k+de*O+he*ue,n[12]=(ee=i[12])*l+(le=i[13])*v+(de=i[14])*M+(he=i[15])*N,n[13]=ee*h+le*w+de*P+he*W,n[14]=ee*p+le*S+de*z+he*Q,n[15]=ee*g+le*k+de*O+he*ue,n}function Pd(n,e,i){var l,h,p,g,v,w,S,k,M,P,z,O,N=i[0],W=i[1],Q=i[2];return e===n?(n[12]=e[0]*N+e[4]*W+e[8]*Q+e[12],n[13]=e[1]*N+e[5]*W+e[9]*Q+e[13],n[14]=e[2]*N+e[6]*W+e[10]*Q+e[14],n[15]=e[3]*N+e[7]*W+e[11]*Q+e[15]):(h=e[1],p=e[2],g=e[3],v=e[4],w=e[5],S=e[6],k=e[7],M=e[8],P=e[9],z=e[10],O=e[11],n[0]=l=e[0],n[1]=h,n[2]=p,n[3]=g,n[4]=v,n[5]=w,n[6]=S,n[7]=k,n[8]=M,n[9]=P,n[10]=z,n[11]=O,n[12]=l*N+v*W+M*Q+e[12],n[13]=h*N+w*W+P*Q+e[13],n[14]=p*N+S*W+z*Q+e[14],n[15]=g*N+k*W+O*Q+e[15]),n}function yu(n,e,i){var l=i[0],h=i[1],p=i[2];return n[0]=e[0]*l,n[1]=e[1]*l,n[2]=e[2]*l,n[3]=e[3]*l,n[4]=e[4]*h,n[5]=e[5]*h,n[6]=e[6]*h,n[7]=e[7]*h,n[8]=e[8]*p,n[9]=e[9]*p,n[10]=e[10]*p,n[11]=e[11]*p,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function Cy(n,e,i){var l=Math.sin(i),h=Math.cos(i),p=e[4],g=e[5],v=e[6],w=e[7],S=e[8],k=e[9],M=e[10],P=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=p*h+S*l,n[5]=g*h+k*l,n[6]=v*h+M*l,n[7]=w*h+P*l,n[8]=S*h-p*l,n[9]=k*h-g*l,n[10]=M*h-v*l,n[11]=P*h-w*l,n}function cm(n,e,i){var l=Math.sin(i),h=Math.cos(i),p=e[0],g=e[1],v=e[2],w=e[3],S=e[8],k=e[9],M=e[10],P=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=p*h-S*l,n[1]=g*h-k*l,n[2]=v*h-M*l,n[3]=w*h-P*l,n[8]=p*l+S*h,n[9]=g*l+k*h,n[10]=v*l+M*h,n[11]=w*l+P*h,n}function Gb(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Wb(n,e,i){var l,h,p,g=i[0],v=i[1],w=i[2],S=Math.hypot(g,v,w);return S<um?null:(g*=S=1/S,v*=S,w*=S,l=Math.sin(e),h=Math.cos(e),n[0]=g*g*(p=1-h)+h,n[1]=v*g*p+w*l,n[2]=w*g*p-v*l,n[3]=0,n[4]=g*v*p-w*l,n[5]=v*v*p+h,n[6]=w*v*p+g*l,n[7]=0,n[8]=g*w*p+v*l,n[9]=v*w*p-g*l,n[10]=w*w*p+h,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var lP=_u;function ky(){var n=new Ni(3);return Ni!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function qb(n){var e=new Ni(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Rd(n){return Math.hypot(n[0],n[1],n[2])}function zc(n,e,i){var l=new Ni(3);return l[0]=n,l[1]=e,l[2]=i,l}function da(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function Iy(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function Hb(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function Ld(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n}function zd(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n}function os(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function Dd(n,e,i,l){return n[0]=e[0]+i[0]*l,n[1]=e[1]+i[1]*l,n[2]=e[2]+i[2]*l,n}function li(n,e){var i=e[0],l=e[1],h=e[2],p=i*i+l*l+h*h;return p>0&&(p=1/Math.sqrt(p)),n[0]=e[0]*p,n[1]=e[1]*p,n[2]=e[2]*p,n}function ks(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Ay(n,e,i){var l=e[0],h=e[1],p=e[2],g=i[0],v=i[1],w=i[2];return n[0]=h*w-p*v,n[1]=p*g-l*w,n[2]=l*v-h*g,n}function Jr(n,e,i){var l=e[0],h=e[1],p=e[2],g=i[3]*l+i[7]*h+i[11]*p+i[15];return n[0]=(i[0]*l+i[4]*h+i[8]*p+i[12])/(g=g||1),n[1]=(i[1]*l+i[5]*h+i[9]*p+i[13])/g,n[2]=(i[2]*l+i[6]*h+i[10]*p+i[14])/g,n}function Zb(n,e,i){var l=i[0],h=i[1],p=i[2],g=e[0],v=e[1],w=e[2],S=h*w-p*v,k=p*g-l*w,M=l*v-h*g,P=h*M-p*k,z=p*S-l*M,O=l*k-h*S,N=2*i[3];return k*=N,M*=N,z*=2,O*=2,n[0]=g+(S*=N)+(P*=2),n[1]=v+k+z,n[2]=w+M+O,n}var Od,to=Iy,uP=Hb,cP=Rd;function Xb(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n}function Kb(n,e){var i=e[0],l=e[1],h=e[2],p=e[3],g=i*i+l*l+h*h+p*p;return g>0&&(g=1/Math.sqrt(g)),n[0]=i*g,n[1]=l*g,n[2]=h*g,n[3]=p*g,n}function vu(n,e,i){var l=e[0],h=e[1],p=e[2],g=e[3];return n[0]=i[0]*l+i[4]*h+i[8]*p+i[12]*g,n[1]=i[1]*l+i[5]*h+i[9]*p+i[13]*g,n[2]=i[2]*l+i[6]*h+i[10]*p+i[14]*g,n[3]=i[3]*l+i[7]*h+i[11]*p+i[15]*g,n}function Yb(){var n=new Ni(4);return Ni!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Jb(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function Qb(n,e,i){i*=.5;var l=e[0],h=e[1],p=e[2],g=e[3],v=Math.sin(i),w=Math.cos(i);return n[0]=l*w+g*v,n[1]=h*w+p*v,n[2]=p*w-h*v,n[3]=g*w-l*v,n}function ew(n,e,i){i*=.5;var l=e[0],h=e[1],p=e[2],g=e[3],v=Math.sin(i),w=Math.cos(i);return n[0]=l*w-p*v,n[1]=h*w+g*v,n[2]=p*w+l*v,n[3]=g*w-h*v,n}ky(),Od=new Ni(4),Ni!=Float32Array&&(Od[0]=0,Od[1]=0,Od[2]=0,Od[3]=0);var hP=Kb;ky(),zc(1,0,0),zc(0,1,0),Yb(),Yb(),Vb();const dP=xe([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:tw}=dP,rw=xe([{name:"a_pos_3",components:3,type:"Int16"}]);var Bd=xe([{name:"a_pos",type:"Int16",components:2}]);class My{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,l){const h=ks(i,this.dir);if(Math.abs(h)<1e-6)return!1;const p=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/h;return l[0]=this.pos[0]+this.dir[0]*p,l[1]=this.pos[1]+this.dir[1]*p,l[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(e,i,l){if(function(z,O){var N=z[0],W=z[1],Q=z[2],ue=O[0],ee=O[1],le=O[2];return Math.abs(N-ue)<=um*Math.max(1,Math.abs(N),Math.abs(ue))&&Math.abs(W-ee)<=um*Math.max(1,Math.abs(W),Math.abs(ee))&&Math.abs(Q-le)<=um*Math.max(1,Math.abs(Q),Math.abs(le))}(this.pos,e)||i===0)return l[0]=l[1]=l[2]=0,!1;const[h,p,g]=this.dir,v=this.pos[0]-e[0],w=this.pos[1]-e[1],S=this.pos[2]-e[2],k=h*h+p*p+g*g,M=2*(v*h+w*p+S*g),P=M*M-4*k*(v*v+w*w+S*S-i*i);if(P<0){const z=Math.max(-M/2,0),O=v+h*z,N=w+p*z,W=S+g*z,Q=Math.hypot(O,N,W);return l[0]=O*i/Q,l[1]=N*i/Q,l[2]=W*i/Q,!1}{const z=(-M-Math.sqrt(P))/(2*k);if(z<0){const O=Math.hypot(v,w,S);return l[0]=v*i/O,l[1]=w*i/O,l[2]=S*i/O,!1}return l[0]=v+h*z,l[1]=w+p*z,l[2]=S+g*z,!0}}}class Py{constructor(e,i,l,h,p){this.TL=e,this.TR=i,this.BR=l,this.BL=h,this.horizon=p}static fromInvProjectionMatrix(e,i,l){const h=[-1,1,1],p=[1,1,1],g=[1,-1,1],v=[-1,-1,1],w=Jr(h,h,e),S=Jr(p,p,e),k=Jr(g,g,e),M=Jr(v,v,e);return new Py(w,S,k,M,i/l)}}class Ry{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,l,h){const p=Math.pow(2,l),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const S=vu([],w,e),k=1/S[3]/i*p;return function(M,P,z){return M[0]=P[0]*z[0],M[1]=P[1]*z[1],M[2]=P[2]*z[2],M[3]=P[3]*z[3],M}(S,S,[k,k,h?1/S[3]:k,k])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const S=li([],Ay([],to([],g[w[0]],g[w[1]]),to([],g[w[2]],g[w[1]]))),k=-ks(S,g[w[1]]);return S.concat(k)});return new Ry(g,v)}}class ui{static fromPoints(e){const i=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const h of e)Ld(i,i,h),zd(l,l,h);return new ui(i,l)}static applyTransform(e,i){const l=e.getCorners();for(let h=0;h<l.length;++h)Jr(l[h],l[h],i);return ui.fromPoints(l)}constructor(e,i){this.min=e,this.max=i,this.center=os([],da([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],l=qb(this.min),h=qb(this.max);for(let p=0;p<i.length;p++)l[p]=i[p]?this.min[p]:this.center[p],h[p]=i[p]?this.center[p]:this.max[p];return h[2]=this.max[2],new ui(l,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let l=!0;for(let h=0;h<e.planes.length;h++){const p=e.planes[h];let g=0;for(let v=0;v<i.length;v++)g+=ks(p,i[v])+p[3]>=0;if(g===0)return 0;g!==i.length&&(l=!1)}if(l)return 2;for(let h=0;h<3;h++){let p=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let v=0;v<e.points.length;v++){const w=e.points[v][h]-this.min[h];p=Math.min(p,w),g=Math.max(g,w)}if(g<0||p>this.max[h]-this.min[h])return 0}return 1}}const Ly=5,nw=6,zo=St/Math.PI/2,fP=16383,xu=64,Fd=[xu,32,16],Is=-zo,As=zo,pP=[new ui([Is,Is,Is],[As,As,As]),new ui([Is,Is,Is],[0,0,As]),new ui([0,Is,Is],[As,0,As]),new ui([Is,0,Is],[0,As,As]),new ui([0,0,Is],[As,As,As])];function hm(n){return n*zo/Ud}function iw(n,e,i,l=!0){const h=os([],n._camera.position,n.worldSize),p=[e,i,1,1];vu(p,p,n.pixelMatrixInverse),Xb(p,p,1/p[3]);const g=li([],to([],p,h)),v=n.globeMatrix,w=[v[12],v[13],v[14]],S=to([],w,h),k=Rd(S),M=li([],S),P=n.worldSize/(2*Math.PI),z=ks(M,g),O=Math.asin(P/k);if(O<Math.acos(z)){if(!l)return null;const Ke=[],Oe=[];os(Ke,g,k/z),li(Oe,to(Oe,Ke,S)),li(g,da(g,S,os(g,Oe,Math.tan(O)*k)))}const N=[];new My(h,g).closestPointOnSphere(w,P,N);const W=li([],si(v,0)),Q=li([],si(v,1)),ue=li([],si(v,2)),ee=ks(W,N),le=ks(Q,N),de=ks(ue,N),he=Kt(Math.asin(-le/P));let Re=Kt(Math.atan2(ee,de));Re=n.center.lng+function(Ke,Oe){const Ge=(Oe-Ke+180)%360-180;return Ge<-180?Ge+360:Ge}(n.center.lng,Re);const Ie=Oo(Re),je=st(Bo(he),0,1);return new Fc(Ie,je)}class mP{constructor(e,i,l){this.a=to([],e,l),this.b=to([],i,l),this.center=l;const h=li([],this.a),p=li([],this.b);this.angle=Math.acos(ks(h,p))}}function zy(n,e){if(n.angle===0)return null;let i;return i=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:function(l,h,p,g){const v=Math.sin(p);return l*(Math.sin((1-g)*p)/v)+h*(Math.sin(g*p)/v)}(n.a[e],n.b[e],n.angle,st(i,0,1))+n.center[e]}function Do(n){if(n.z<=1)return pP[n.z+2*n.y+n.x];const e=Dy(dm(n));return ui.fromPoints(e)}function bu(n,e,i){return os(n,n,1-i),Dd(n,n,e,i)}function sw(n,e){const i=Bc(e.zoom);if(i===0)return Do(n);const l=dm(n),h=Dy(l),p=Oo(l.getWest())*e.worldSize,g=Oo(l.getEast())*e.worldSize,v=Bo(l.getNorth())*e.worldSize,w=Bo(l.getSouth())*e.worldSize,S=[p,v,0],k=[g,v,0],M=[p,w,0],P=[g,w,0],z=Ey([],e.globeMatrix);return Jr(S,S,z),Jr(k,k,z),Jr(M,M,z),Jr(P,P,z),h[0]=bu(h[0],M,i),h[1]=bu(h[1],P,i),h[2]=bu(h[2],k,i),h[3]=bu(h[3],S,i),ui.fromPoints(h)}function ow(n,e,i){for(const l of n)Jr(l,l,e),os(l,l,i)}function gP(n,e,i){const l=e/n.worldSize,h=n.globeMatrix;if(i.z<=1){const Ie=Do(i).getCorners();return ow(Ie,h,l),ui.fromPoints(Ie)}const p=dm(i),g=Dy(p);ow(g,h,l);const v=Number.MAX_VALUE,w=[-v,-v,-v],S=[v,v,v];if(p.contains(n.center)){for(const Ke of g)Ld(S,S,Ke),zd(w,w,Ke);w[2]=0;const Ie=n.point,je=[Ie.x*l,Ie.y*l,0];return Ld(S,S,je),zd(w,w,je),new ui(S,w)}const k=[h[12]*l,h[13]*l,h[14]*l],M=p.getCenter(),P=st(n.center.lat,-85.051129,no),z=st(M.lat,-85.051129,no),O=Oo(n.center.lng),N=Bo(P);let W=O-Oo(M.lng);const Q=N-Bo(z);W>.5?W-=1:W<-.5&&(W+=1);let ue=0;Math.abs(W)>Math.abs(Q)?ue=W>=0?1:3:(ue=Q>=0?0:2,Dd(k,k,[h[4]*l,h[5]*l,h[6]*l],-Math.sin(pt(Q>=0?p.getSouth():p.getNorth()))*zo));const ee=g[ue],le=g[(ue+1)%4],de=new mP(ee,le,k),he=[zy(de,0)||ee[0],zy(de,1)||ee[1],zy(de,2)||ee[2]],Re=Bc(n.zoom);if(Re>0){const Ie=function({x:Ke,y:Oe,z:Ge},$e,He,tt,Fe){const ut=1/(1<<Ge);let _t=Ke*ut,ht=_t+ut,zt=Oe*ut,rt=zt+ut,xt=0;const Dt=(_t+ht)/2-tt;return Dt>.5?xt=-1:Dt<-.5&&(xt=1),_t=((_t+xt)*$e-(tt*=$e))*He+tt,ht=((ht+xt)*$e-tt)*He+tt,zt=(zt*$e-(Fe*=$e))*He+Fe,rt=(rt*$e-Fe)*He+Fe,[[_t,rt,0],[ht,rt,0],[ht,zt,0],[_t,zt,0]]}(i,e,n._pixelsPerMercatorPixel,O,N);for(let Ke=0;Ke<g.length;Ke++)bu(g[Ke],Ie[Ke],Re);const je=da([],Ie[ue],Ie[(ue+1)%4]);os(je,je,.5),bu(he,je,Re)}for(const Ie of g)Ld(S,S,Ie),zd(w,w,Ie);return S[2]=Math.min(ee[2],le[2]),Ld(S,S,he),zd(w,w,he),new ui(S,w)}function dm({x:n,y:e,z:i}){const l=1/(1<<i),h=new vr(as(n*l),Wn((e+1)*l)),p=new vr(as((n+1)*l),Wn(e*l));return new nl(h,p)}function Dy(n){const e=pt(n.getNorth()),i=pt(n.getSouth()),l=Math.cos(e),h=Math.cos(i),p=Math.sin(e),g=Math.sin(i),v=n.getWest(),w=n.getEast();return[Dc(h,g,v),Dc(h,g,w),Dc(l,p,w),Dc(l,p,v)]}function Dc(n,e,i,l=zo){return i=pt(i),[n*Math.sin(i)*l,-e*l,n*Math.cos(i)*l]}function Oc(n,e,i){return Dc(Math.cos(pt(n)),Math.sin(pt(n)),e,i)}function jd(n,e,i,l){const h=1<<i.z,p=(n/St+i.x)/h;return Oc(Wn((e/St+i.y)/h),as(p),l)}function fm({min:n,max:e}){return fP/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const aw=new Float64Array(16);function Nd(n){const e=fm(n),i=Gb(aw,[e,e,e]);return Pd(i,i,((l=[])[0]=-(h=n.min)[0],l[1]=-h[1],l[2]=-h[2],l));var l,h}function Oy(n){const e=(l=n.min,(i=aw)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=l[0],i[13]=l[1],i[14]=l[2],i[15]=1,i);var i,l;const h=1/fm(n);return yu(e,e,[h,h,h])}function lw(n,e,i,l,h){const p=function(w){const S=St/(2*Math.PI);return w/(2*Math.PI)/S}(i),g=[n,e,-i/(2*Math.PI)],v=eo(new Float64Array(16));return Pd(v,v,g),yu(v,v,[p,p,p]),Cy(v,v,pt(-h)),cm(v,v,pt(-l)),v}function Bc(n){return kt(Ly,nw,n)}function uw(n,e){const i=Oc(e.lat,e.lng),l=function(O){const N=Oc(O._center.lat,O._center.lng);let W=Ay([],zc(0,1,0),N);const Q=Wb([],-O.angle,N);W=Jr(W,W,Q),Wb(Q,-O._pitch,W);const ue=li([],N);return os(ue,ue,hm(O.cameraToCenterDistance/O.pixelsPerMeter)),Jr(ue,ue,Q),da([],N,ue)}(n);return g=(h=Iy([],l,i))[0],v=h[1],w=h[2],S=(p=i)[0],k=p[1],M=p[2],z=(P=Math.sqrt(g*g+v*v+w*w)*Math.sqrt(S*S+k*k+M*M))&&ks(h,p)/P,Math.acos(Math.min(Math.max(z,-1),1));var h,p,g,v,w,S,k,M,P,z}function By(n,e){return uw(n,e)>Math.PI/2*1.01}const cw=pt(85),_P=Math.cos(cw),yP=Math.sin(cw),Ud=63710088e-1,hw=2*Math.PI*Ud;class il{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new il(It(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,l=this.lat*i,h=e.lat*i,p=Math.sin(l)*Math.sin(h)+Math.cos(l)*Math.cos(h)*Math.cos((e.lng-this.lng)*i);return Ud*Math.acos(Math.min(p,1))}toBounds(e=0){const i=360*e/40075017,l=i/Math.cos(Math.PI/180*this.lat);return new nl(new il(this.lng-l,this.lat-i),new il(this.lng+l,this.lat+i))}toEcef(e){const i=hm(e);return Oc(this.lat,this.lng,zo+i)}static convert(e){if(e instanceof il)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new il(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new il(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var vr=il;function Fy(n){return hw*Math.cos(n*Math.PI/180)}function Oo(n){return(180+n)/360}function Bo(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function ro(n,e){return n/Fy(e)}function as(n){return 360*n-180}function Wn(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function dw(n,e){return n*Fy(Wn(e))}const no=85.051129;function fw(n){return 1/Math.cos(n*Math.PI/180)}class Fc{constructor(e,i,l=0){this.x=+e,this.y=+i,this.z=+l}static fromLngLat(e,i=0){const l=vr.convert(e);return new Fc(Oo(l.lng),Bo(l.lat),ro(i,l.lat))}toLngLat(){return new vr(as(this.x),Wn(this.y))}toAltitude(){return dw(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/hw*fw(Wn(this.y))}}function jy(n,e,i,l,h,p,g,v,w){const S=(e+l)/2,k=(i+h)/2,M=new Ae(S,k);v(M),function(P,z,O,N,W,Q){const ue=O-W,ee=N-Q;return Math.abs((N-z)*ue-(O-P)*ee)/Math.hypot(ue,ee)}(M.x,M.y,p.x,p.y,g.x,g.y)>=w?(jy(n,e,i,S,k,p,M,v,w),jy(n,S,k,l,h,M,g,v,w)):n.push(g)}function pw(n,e,i){let l=n[0],h=l.x,p=l.y;e(l);const g=[l];for(let v=1;v<n.length;v++){const w=n[v],{x:S,y:k}=w;e(w),jy(g,h,p,S,k,l,w,e,i),h=S,p=k,l=w}return g}function Ny(n,e,i,l){if(l(e,i)){const h=e.add(i)._mult(.5);Ny(n,e,h,l),Ny(n,h,i,l)}else n.push(i)}function vP(n,e){let i=n[0];const l=[i];for(let h=1;h<n.length;h++){const p=n[h];Ny(l,i,p,e),i=p}return l}const Uy=Math.pow(2,14)-1,mw=-Uy-1;function xP(n,e){const i=Math.round(n.x*e),l=Math.round(n.y*e);return n.x=st(i,mw,Uy),n.y=st(l,mw,Uy),(i<n.x||i>n.x+1||l<n.y||l>n.y+1)&&fr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function fa(n,e,i){const l=n.loadGeometry(),h=n.extent,p=St/h;if(e&&i&&i.projection.isReprojectedInTileSpace){const g=1<<e.z,{scale:v,x:w,y:S,projection:k}=i,M=P=>{const z=as((e.x+P.x/h)/g),O=Wn((e.y+P.y/h)/g),N=k.project(z,O);P.x=(N.x*v-w)*h,P.y=(N.y*v-S)*h};for(let P=0;P<l.length;P++)if(n.type!==1)l[P]=pw(l[P],M,1);else{const z=[];for(const O of l[P])O.x<0||O.x>=h||O.y<0||O.y>=h||(M(O),z.push(O));l[P]=z}}for(const g of l)for(const v of g)xP(v,p);return l}function wu(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?fa(n):[]}}function pm(n,e,i,l,h){n.emplaceBack(2*e+(l+1)/2,2*i+(h+1)/2)}function mm(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Vy{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Xe,this.indexArray=new yt,this.segments=new an,this.programConfigurations=new gu(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,l,h){const p=this.layers[0],g=[];let v=null;p.type==="circle"&&(v=p.layout.get("circle-sort-key"));for(const{feature:S,id:k,index:M,sourceLayerIndex:P}of e){const z=this.layers[0]._featureFilter.needGeometry,O=wu(S,z);if(!this.layers[0]._featureFilter.filter(new A(this.zoom),O,l))continue;const N=v?v.evaluate(O,{},l):void 0,W={id:k,properties:S.properties,type:S.type,sourceLayerIndex:P,index:M,geometry:z?O.geometry:fa(S,l,h),patterns:{},sortKey:N};g.push(W)}v&&g.sort((S,k)=>S.sortKey-k.sortKey);let w=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new Je,w=h.projection);for(const S of g){const{geometry:k,index:M,sourceLayerIndex:P}=S,z=e[M].feature;this.addFeature(S,k,M,i.availableImages,l,w),i.featureIndex.insert(z,k,M,P,this.index)}}update(e,i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,l,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,oP.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,aP.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,l,h,p,g){for(const v of i)for(const w of v){const S=w.x,k=w.y;if(S<0||S>=St||k<0||k>=St)continue;if(g){const z=g.projectTilePoint(S,k,p),O=g.upVector(p,S,k),N=this.globeExtVertexArray;mm(N,z,O),mm(N,z,O),mm(N,z,O),mm(N,z,O)}const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=M.vertexLength;pm(this.layoutVertexArray,S,k,-1,-1),pm(this.layoutVertexArray,S,k,1,-1),pm(this.layoutVertexArray,S,k,1,1),pm(this.layoutVertexArray,S,k,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+2,P+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},h,p)}}function gw(n,e){for(let i=0;i<n.length;i++)if(Su(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Su(n,e[i]))return!0;return!!$y(n,e)}function bP(n,e,i){return!!Su(n,e)||!!Gy(e,n,i)}function _w(n,e){if(n.length===1)return vw(e,n[0]);for(let i=0;i<e.length;i++){const l=e[i];for(let h=0;h<l.length;h++)if(Su(n,l[h]))return!0}for(let i=0;i<n.length;i++)if(vw(e,n[i]))return!0;for(let i=0;i<e.length;i++)if($y(n,e[i]))return!0;return!1}function wP(n,e,i){if(n.length>1){if($y(n,e))return!0;for(let l=0;l<e.length;l++)if(Gy(e[l],n,i))return!0}for(let l=0;l<n.length;l++)if(Gy(n[l],e,i))return!0;return!1}function $y(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const l=n[i],h=n[i+1];for(let p=0;p<e.length-1;p++)if(SP(l,h,e[p],e[p+1]))return!0}return!1}function SP(n,e,i,l){return jn(n,i,l)!==jn(e,i,l)&&jn(n,e,i)!==jn(n,e,l)}function Gy(n,e,i){const l=i*i;if(e.length===1)return n.distSqr(e[0])<l;for(let h=1;h<e.length;h++)if(yw(n,e[h-1],e[h])<l)return!0;return!1}function yw(n,e,i){const l=e.distSqr(i);if(l===0)return n.distSqr(e);const h=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/l;return n.distSqr(h<0?e:h>1?i:i.sub(e)._mult(h)._add(e))}function vw(n,e){let i,l,h,p=!1;for(let g=0;g<n.length;g++){i=n[g];for(let v=0,w=i.length-1;v<i.length;w=v++)l=i[v],h=i[w],l.y>e.y!=h.y>e.y&&e.x<(h.x-l.x)*(e.y-l.y)/(h.y-l.y)+l.x&&(p=!p)}return p}function Su(n,e){let i=!1;for(let l=0,h=n.length-1;l<n.length;h=l++){const p=n[l],g=n[h];p.y>e.y!=g.y>e.y&&e.x<(g.x-p.x)*(e.y-p.y)/(g.y-p.y)+p.x&&(i=!i)}return i}function xw(n,e,i,l,h){for(const g of n)if(e<=g.x&&i<=g.y&&l>=g.x&&h>=g.y)return!0;const p=[new Ae(e,i),new Ae(e,h),new Ae(l,h),new Ae(l,i)];if(n.length>2){for(const g of p)if(Su(n,g))return!0}for(let g=0;g<n.length-1;g++)if(TP(n[g],n[g+1],p))return!0;return!1}function TP(n,e,i){const l=i[0],h=i[2];if(n.x<l.x&&e.x<l.x||n.x>h.x&&e.x>h.x||n.y<l.y&&e.y<l.y||n.y>h.y&&e.y>h.y)return!1;const p=jn(n,e,i[0]);return p!==jn(n,e,i[1])||p!==jn(n,e,i[2])||p!==jn(n,e,i[3])}function jc(n,e,i){const l=e.paint.get(n).value;return l.kind==="constant"?l.value:i.programConfigurations.get(e.id).getMaxValue(n)}function gm(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function bw(n,e,i,l,h){if(!e[0]&&!e[1])return n;const p=Ae.convert(e)._mult(h);i==="viewport"&&p._rotate(-l);const g=[];for(let v=0;v<n.length;v++)g.push(n[v].sub(p));return g}function ww(n,e,i,l){const h=Ae.convert(n)._mult(l);return e==="viewport"&&h._rotate(-i),h}mt(Vy,"CircleBucket",{omit:["layers"]});const EP=new oe({"circle-sort-key":new H(Be.layout_circle["circle-sort-key"])});var CP={paint:new oe({"circle-radius":new H(Be.paint_circle["circle-radius"]),"circle-color":new H(Be.paint_circle["circle-color"]),"circle-blur":new H(Be.paint_circle["circle-blur"]),"circle-opacity":new H(Be.paint_circle["circle-opacity"]),"circle-translate":new F(Be.paint_circle["circle-translate"]),"circle-translate-anchor":new F(Be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new F(Be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new F(Be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new H(Be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new H(Be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new H(Be.paint_circle["circle-stroke-opacity"])}),layout:EP};function Sw(n,e,i,l,h,p,g,v,w){if(p&&n.queryGeometry.isAboveHorizon)return!1;p&&(w*=n.pixelToTileUnitsFactor);const S=n.tileID.canonical,k=i.projection.upVectorScale(S,i.center.lat,i.worldSize).metersToTile;for(const M of e)for(const P of M){const z=P.add(v),O=h&&i.elevation?i.elevation.exaggeration()*h.getElevationAt(z.x,z.y,!0):0,N=i.projection.projectTilePoint(z.x,z.y,S);if(O>0){const ee=i.projection.upVector(S,z.x,z.y);N.x+=ee[0]*k*O,N.y+=ee[1]*k*O,N.z+=ee[2]*k*O}const W=p?z:kP(N.x,N.y,N.z,l),Q=p?n.tilespaceRays.map(ee=>AP(ee,O)):n.queryGeometry.screenGeometry,ue=vu([],[N.x,N.y,N.z,1],l);if(!g&&p?w*=ue[3]/i.cameraToCenterDistance:g&&!p&&(w*=i.cameraToCenterDistance/ue[3]),p){const ee=Wn((P.y/St+S.y)/(1<<S.z));w/=i.projection.pixelsPerMeter(ee,1)/ro(1,ee)}if(bP(Q,W,w))return!0}return!1}function kP(n,e,i,l){const h=vu([],[n,e,i,1],l);return new Ae(h[0]/h[3],h[1]/h[3])}const Tw=zc(0,0,0),IP=zc(0,0,1);function AP(n,e){const i=ky();return Tw[2]=e,n.intersectsPlane(Tw,IP,i),new Ae(i[0],i[1])}class Ew extends Vy{}function Cw(n,{width:e,height:i},l,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*i*l)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*i*l);return n.width=e,n.height=i,n.data=h,n}function kw(n,e,i){const{width:l,height:h}=e;l===n.width&&h===n.height||(Wy(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,l),height:Math.min(n.height,h)},i),n.width=l,n.height=h,n.data=e.data)}function Wy(n,e,i,l,h,p){if(h.width===0||h.height===0)return e;if(h.width>n.width||h.height>n.height||i.x>n.width-h.width||i.y>n.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||l.x>e.width-h.width||l.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const g=n.data,v=e.data;for(let w=0;w<h.height;w++){const S=((i.y+w)*n.width+i.x)*p,k=((l.y+w)*e.width+l.x)*p;for(let M=0;M<h.width*p;M++)v[k+M]=g[S+M]}return e}mt(Ew,"HeatmapBucket",{omit:["layers"]});class pa{constructor(e,i){Cw(this,e,1,i)}resize(e){kw(this,new pa(e),1)}clone(){return new pa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,l,h,p){Wy(e,i,l,h,p,1)}}class Ui{constructor(e,i){Cw(this,e,4,i)}resize(e){kw(this,new Ui(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ui({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,l,h,p){Wy(e,i,l,h,p,4)}}mt(pa,"AlphaImage"),mt(Ui,"RGBAImage");var MP={paint:new oe({"heatmap-radius":new H(Be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new H(Be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new F(Be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ne(Be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new F(Be.paint_heatmap["heatmap-opacity"])})};function qy(n){const e={},i=n.resolution||256,l=n.clips?n.clips.length:1,h=n.image||new Ui({width:i,height:l}),p=(g,v,w)=>{e[n.evaluationKey]=w;const S=n.expression.evaluate(e);h.data[g+v+0]=Math.floor(255*S.r/S.a),h.data[g+v+1]=Math.floor(255*S.g/S.a),h.data[g+v+2]=Math.floor(255*S.b/S.a),h.data[g+v+3]=Math.floor(255*S.a)};if(n.clips)for(let g=0,v=0;g<l;++g,v+=4*i)for(let w=0,S=0;w<i;w++,S+=4){const k=w/(i-1),{start:M,end:P}=n.clips[g];p(v,S,M*(1-k)+P*k)}else for(let g=0,v=0;g<i;g++,v+=4)p(0,v,g/(i-1));return h}var PP={paint:new oe({"hillshade-illumination-direction":new F(Be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new F(Be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new F(Be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new F(Be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new F(Be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new F(Be.paint_hillshade["hillshade-accent-color"])})};const RP=xe([{name:"a_pos",components:2,type:"Int16"}],4),{members:LP}=RP;var Hy={exports:{}};function _m(n,e,i){i=i||2;var l,h,p,g,v,w,S,k=e&&e.length,M=k?e[0]*i:n.length,P=Iw(n,0,M,i,!0),z=[];if(!P||P.next===P.prev)return z;if(k&&(P=function(N,W,Q,ue){var ee,le,de,he=[];for(ee=0,le=W.length;ee<le;ee++)(de=Iw(N,W[ee]*ue,ee<le-1?W[ee+1]*ue:N.length,ue,!1))===de.next&&(de.steiner=!0),he.push(UP(de));for(he.sort(FP),ee=0;ee<he.length;ee++)Q=jP(he[ee],Q);return Q}(n,e,P,i)),n.length>80*i){l=p=n[0],h=g=n[1];for(var O=i;O<M;O+=i)(v=n[O])<l&&(l=v),(w=n[O+1])<h&&(h=w),v>p&&(p=v),w>g&&(g=w);S=(S=Math.max(p-l,g-h))!==0?32767/S:0}return Vd(P,z,i,l,h,S,0),z}function Iw(n,e,i,l,h){var p,g;if(h===Ky(n,e,i,l)>0)for(p=e;p<i;p+=l)g=Pw(p,n[p],n[p+1],g);else for(p=i-l;p>=e;p-=l)g=Pw(p,n[p],n[p+1],g);return g&&ym(g,g.next)&&(Gd(g),g=g.next),g}function Tu(n,e){if(!n)return n;e||(e=n);var i,l=n;do if(i=!1,l.steiner||!ym(l,l.next)&&ln(l.prev,l,l.next)!==0)l=l.next;else{if(Gd(l),(l=e=l.prev)===l.next)break;i=!0}while(i||l!==e);return e}function Vd(n,e,i,l,h,p,g){if(n){!g&&p&&function(k,M,P,z){var O=k;do O.z===0&&(O.z=Zy(O.x,O.y,M,P,z)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next;while(O!==k);O.prevZ.nextZ=null,O.prevZ=null,function(N){var W,Q,ue,ee,le,de,he,Re,Ie=1;do{for(Q=N,N=null,le=null,de=0;Q;){for(de++,ue=Q,he=0,W=0;W<Ie&&(he++,ue=ue.nextZ);W++);for(Re=Ie;he>0||Re>0&&ue;)he!==0&&(Re===0||!ue||Q.z<=ue.z)?(ee=Q,Q=Q.nextZ,he--):(ee=ue,ue=ue.nextZ,Re--),le?le.nextZ=ee:N=ee,ee.prevZ=le,le=ee;Q=ue}le.nextZ=null,Ie*=2}while(de>1)}(O)}(n,l,h,p);for(var v,w,S=n;n.prev!==n.next;)if(v=n.prev,w=n.next,p?DP(n,l,h,p):zP(n))e.push(v.i/i|0),e.push(n.i/i|0),e.push(w.i/i|0),Gd(n),n=w.next,S=w.next;else if((n=w)===S){g?g===1?Vd(n=OP(Tu(n),e,i),e,i,l,h,p,2):g===2&&BP(n,e,i,l,h,p):Vd(Tu(n),e,i,l,h,p,1);break}}}function zP(n){var e=n.prev,i=n,l=n.next;if(ln(e,i,l)>=0)return!1;for(var h=e.x,p=i.x,g=l.x,v=e.y,w=i.y,S=l.y,k=h<p?h<g?h:g:p<g?p:g,M=v<w?v<S?v:S:w<S?w:S,P=h>p?h>g?h:g:p>g?p:g,z=v>w?v>S?v:S:w>S?w:S,O=l.next;O!==e;){if(O.x>=k&&O.x<=P&&O.y>=M&&O.y<=z&&Nc(h,v,p,w,g,S,O.x,O.y)&&ln(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function DP(n,e,i,l){var h=n.prev,p=n,g=n.next;if(ln(h,p,g)>=0)return!1;for(var v=h.x,w=p.x,S=g.x,k=h.y,M=p.y,P=g.y,z=v<w?v<S?v:S:w<S?w:S,O=k<M?k<P?k:P:M<P?M:P,N=v>w?v>S?v:S:w>S?w:S,W=k>M?k>P?k:P:M>P?M:P,Q=Zy(z,O,e,i,l),ue=Zy(N,W,e,i,l),ee=n.prevZ,le=n.nextZ;ee&&ee.z>=Q&&le&&le.z<=ue;){if(ee.x>=z&&ee.x<=N&&ee.y>=O&&ee.y<=W&&ee!==h&&ee!==g&&Nc(v,k,w,M,S,P,ee.x,ee.y)&&ln(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,le.x>=z&&le.x<=N&&le.y>=O&&le.y<=W&&le!==h&&le!==g&&Nc(v,k,w,M,S,P,le.x,le.y)&&ln(le.prev,le,le.next)>=0))return!1;le=le.nextZ}for(;ee&&ee.z>=Q;){if(ee.x>=z&&ee.x<=N&&ee.y>=O&&ee.y<=W&&ee!==h&&ee!==g&&Nc(v,k,w,M,S,P,ee.x,ee.y)&&ln(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;le&&le.z<=ue;){if(le.x>=z&&le.x<=N&&le.y>=O&&le.y<=W&&le!==h&&le!==g&&Nc(v,k,w,M,S,P,le.x,le.y)&&ln(le.prev,le,le.next)>=0)return!1;le=le.nextZ}return!0}function OP(n,e,i){var l=n;do{var h=l.prev,p=l.next.next;!ym(h,p)&&Aw(h,l,l.next,p)&&$d(h,p)&&$d(p,h)&&(e.push(h.i/i|0),e.push(l.i/i|0),e.push(p.i/i|0),Gd(l),Gd(l.next),l=n=p),l=l.next}while(l!==n);return Tu(l)}function BP(n,e,i,l,h,p){var g=n;do{for(var v=g.next.next;v!==g.prev;){if(g.i!==v.i&&VP(g,v)){var w=Mw(g,v);return g=Tu(g,g.next),w=Tu(w,w.next),Vd(g,e,i,l,h,p,0),void Vd(w,e,i,l,h,p,0)}v=v.next}g=g.next}while(g!==n)}function FP(n,e){return n.x-e.x}function jP(n,e){var i=function(h,p){var g,v=p,w=h.x,S=h.y,k=-1/0;do{if(S<=v.y&&S>=v.next.y&&v.next.y!==v.y){var M=v.x+(S-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(M<=w&&M>k&&(k=M,g=v.x<v.next.x?v:v.next,M===w))return g}v=v.next}while(v!==p);if(!g)return null;var P,z=g,O=g.x,N=g.y,W=1/0;v=g;do w>=v.x&&v.x>=O&&w!==v.x&&Nc(S<N?w:k,S,O,N,S<N?k:w,S,v.x,v.y)&&(P=Math.abs(S-v.y)/(w-v.x),$d(v,h)&&(P<W||P===W&&(v.x>g.x||v.x===g.x&&NP(g,v)))&&(g=v,W=P)),v=v.next;while(v!==z);return g}(n,e);if(!i)return e;var l=Mw(i,n);return Tu(l,l.next),Tu(i,i.next)}function NP(n,e){return ln(n.prev,n,e.prev)<0&&ln(e.next,n,n.next)<0}function Zy(n,e,i,l,h){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function UP(n){var e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function Nc(n,e,i,l,h,p,g,v){return(h-g)*(e-v)>=(n-g)*(p-v)&&(n-g)*(l-v)>=(i-g)*(e-v)&&(i-g)*(p-v)>=(h-g)*(l-v)}function VP(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(i,l){var h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==l.i&&h.next.i!==l.i&&Aw(h,h.next,i,l))return!0;h=h.next}while(h!==i);return!1}(n,e)&&($d(n,e)&&$d(e,n)&&function(i,l){var h=i,p=!1,g=(i.x+l.x)/2,v=(i.y+l.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&g<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(p=!p),h=h.next;while(h!==i);return p}(n,e)&&(ln(n.prev,n,e.prev)||ln(n,e.prev,e))||ym(n,e)&&ln(n.prev,n,n.next)>0&&ln(e.prev,e,e.next)>0)}function ln(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function ym(n,e){return n.x===e.x&&n.y===e.y}function Aw(n,e,i,l){var h=xm(ln(n,e,i)),p=xm(ln(n,e,l)),g=xm(ln(i,l,n)),v=xm(ln(i,l,e));return h!==p&&g!==v||!(h!==0||!vm(n,i,e))||!(p!==0||!vm(n,l,e))||!(g!==0||!vm(i,n,l))||!(v!==0||!vm(i,e,l))}function vm(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function xm(n){return n>0?1:n<0?-1:0}function $d(n,e){return ln(n.prev,n,n.next)<0?ln(n,e,n.next)>=0&&ln(n,n.prev,e)>=0:ln(n,e,n.prev)<0||ln(n,n.next,e)<0}function Mw(n,e){var i=new Xy(n.i,n.x,n.y),l=new Xy(e.i,e.x,e.y),h=n.next,p=e.prev;return n.next=e,e.prev=n,i.next=h,h.prev=i,l.next=i,i.prev=l,p.next=l,l.prev=p,l}function Pw(n,e,i,l){var h=new Xy(n,e,i);return l?(h.next=l.next,h.prev=l,l.next.prev=h,l.next=h):(h.prev=h,h.next=h),h}function Gd(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Xy(n,e,i){this.i=n,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ky(n,e,i,l){for(var h=0,p=e,g=i-l;p<i;p+=l)h+=(n[g]-n[p])*(n[p+1]+n[g+1]),g=p;return h}Hy.exports=_m,Hy.exports.default=_m,_m.deviation=function(n,e,i,l){var h=e&&e.length,p=Math.abs(Ky(n,0,h?e[0]*i:n.length,i));if(h)for(var g=0,v=e.length;g<v;g++)p-=Math.abs(Ky(n,e[g]*i,g<v-1?e[g+1]*i:n.length,i));var w=0;for(g=0;g<l.length;g+=3){var S=l[g]*i,k=l[g+1]*i,M=l[g+2]*i;w+=Math.abs((n[S]-n[M])*(n[k+1]-n[S+1])-(n[S]-n[k])*(n[M+1]-n[S+1]))}return p===0&&w===0?0:Math.abs((w-p)/p)},_m.flatten=function(n){for(var e=n[0][0].length,i={vertices:[],holes:[],dimensions:e},l=0,h=0;h<n.length;h++){for(var p=0;p<n[h].length;p++)for(var g=0;g<e;g++)i.vertices.push(n[h][p][g]);h>0&&i.holes.push(l+=n[h-1].length)}return i};var Yy=Se(Hy.exports);function $P(n,e,i,l,h){Rw(n,e,i,l||n.length-1,h)}function Rw(n,e,i,l,h){for(;l>i;){if(l-i>600){var p=l-i+1,g=e-i+1,v=Math.log(p),w=.5*Math.exp(2*v/3),S=.5*Math.sqrt(v*w*(p-w)/p)*(g-p/2<0?-1:1);Rw(n,e,Math.max(i,Math.floor(e-g*w/p+S)),Math.min(l,Math.floor(e+(p-g)*w/p+S)),h)}var k=n[e],M=i,P=l;for(Wd(n,i,e),h(n[l],k)>0&&Wd(n,i,l);M<P;){for(Wd(n,M,P),M++,P--;h(n[M],k)<0;)M++;for(;h(n[P],k)>0;)P--}h(n[i],k)===0?Wd(n,i,P):Wd(n,++P,l),P<=e&&(i=P+1),e<=P&&(l=P-1)}}function Wd(n,e,i){var l=n[e];n[e]=n[i],n[i]=l}function Jy(n,e){const i=n.length;if(i<=1)return[n];const l=[];let h,p;for(let g=0;g<i;g++){const v=vs(n[g]);v!==0&&(n[g].area=Math.abs(v),p===void 0&&(p=v<0),p===v<0?(h&&l.push(h),h=[n[g]]):h.push(n[g]))}if(h&&l.push(h),e>1)for(let g=0;g<l.length;g++)l[g].length<=e||($P(l[g],e,1,l[g].length-1,GP),l[g]=l[g].slice(0,e));return l}function GP(n,e){return e.area-n.area}function Qy(n,e,i){const l=i.patternDependencies;let h=!1;for(const p of e){const g=p.paint.get(`${n}-pattern`);g.isConstant()||(h=!0);const v=g.constantOr(null);v&&(h=!0,l[v]=!0)}return h}function ev(n,e,i,l,h){const p=h.patternDependencies;for(const g of e){const v=g.paint.get(`${n}-pattern`).value;if(v.kind!=="constant"){let w=v.evaluate({zoom:l},i,{},h.availableImages);w=w&&w.name?w.name:w,p[w]=!0,i.patterns[g.id]=w}}return i}class bm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Xe,this.indexArray=new yt,this.indexArray2=new Cn,this.programConfigurations=new gu(e.layers,e.zoom),this.segments=new an,this.segments2=new an,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,l,h){this.hasPattern=Qy("fill",this.layers,i);const p=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:v,id:w,index:S,sourceLayerIndex:k}of e){const M=this.layers[0]._featureFilter.needGeometry,P=wu(v,M);if(!this.layers[0]._featureFilter.filter(new A(this.zoom),P,l))continue;const z=p?p.evaluate(P,{},l,i.availableImages):void 0,O={id:w,properties:v.properties,type:v.type,sourceLayerIndex:k,index:S,geometry:M?P.geometry:fa(v,l,h),patterns:{},sortKey:z};g.push(O)}p&&g.sort((v,w)=>v.sortKey-w.sortKey);for(const v of g){const{geometry:w,index:S,sourceLayerIndex:k}=v;if(this.hasPattern){const M=ev("fill",this.layers,v,this.zoom,i);this.patternFeatures.push(M)}else this.addFeature(v,w,S,l,{},i.availableImages);i.featureIndex.insert(e[S].feature,w,S,k,this.index)}}update(e,i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,l,h)}addFeatures(e,i,l,h,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,l,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,LP),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,l,h,p,g=[]){for(const v of Jy(i,500)){let w=0;for(const O of v)w+=O.length;const S=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),k=S.vertexLength,M=[],P=[];for(const O of v){if(O.length===0)continue;O!==v[0]&&P.push(M.length/2);const N=this.segments2.prepareSegment(O.length,this.layoutVertexArray,this.indexArray2),W=N.vertexLength;this.layoutVertexArray.emplaceBack(O[0].x,O[0].y),this.indexArray2.emplaceBack(W+O.length-1,W),M.push(O[0].x),M.push(O[0].y);for(let Q=1;Q<O.length;Q++)this.layoutVertexArray.emplaceBack(O[Q].x,O[Q].y),this.indexArray2.emplaceBack(W+Q-1,W+Q),M.push(O[Q].x),M.push(O[Q].y);N.vertexLength+=O.length,N.primitiveLength+=O.length}const z=Yy(M,P);for(let O=0;O<z.length;O+=3)this.indexArray.emplaceBack(k+z[O],k+z[O+1],k+z[O+2]);S.vertexLength+=w,S.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,p,g,h)}}mt(bm,"FillBucket",{omit:["layers","patternFeatures"]});const WP=new oe({"fill-sort-key":new H(Be.layout_fill["fill-sort-key"])});var qP={paint:new oe({"fill-antialias":new F(Be.paint_fill["fill-antialias"]),"fill-opacity":new H(Be.paint_fill["fill-opacity"]),"fill-color":new H(Be.paint_fill["fill-color"]),"fill-outline-color":new H(Be.paint_fill["fill-outline-color"]),"fill-translate":new F(Be.paint_fill["fill-translate"]),"fill-translate-anchor":new F(Be.paint_fill["fill-translate-anchor"]),"fill-pattern":new H(Be.paint_fill["fill-pattern"])}),layout:WP};const HP=xe([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),ZP=xe([{name:"a_centroid_pos",components:2,type:"Uint16"}]),XP=xe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:KP}=HP;var wm={},YP=qe,Lw=Uc;function Uc(n,e,i,l,h){this.properties={},this.extent=i,this.type=0,this._pbf=n,this._geometry=-1,this._keys=l,this._values=h,n.readFields(JP,this,e)}function JP(n,e,i){n==1?e.id=i.readVarint():n==2?function(l,h){for(var p=l.readVarint()+l.pos;l.pos<p;){var g=h._keys[l.readVarint()],v=h._values[l.readVarint()];h.properties[g]=v}}(i,e):n==3?e.type=i.readVarint():n==4&&(e._geometry=i.pos)}function QP(n){for(var e,i,l=0,h=0,p=n.length,g=p-1;h<p;g=h++)l+=((i=n[g]).x-(e=n[h]).x)*(e.y+i.y);return l}Uc.types=["Unknown","Point","LineString","Polygon"],Uc.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var e,i=n.readVarint()+n.pos,l=1,h=0,p=0,g=0,v=[];n.pos<i;){if(h<=0){var w=n.readVarint();l=7&w,h=w>>3}if(h--,l===1||l===2)p+=n.readSVarint(),g+=n.readSVarint(),l===1&&(e&&v.push(e),e=[]),e.push(new YP(p,g));else{if(l!==7)throw new Error("unknown command "+l);e&&e.push(e[0].clone())}}return e&&v.push(e),v},Uc.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var e=n.readVarint()+n.pos,i=1,l=0,h=0,p=0,g=1/0,v=-1/0,w=1/0,S=-1/0;n.pos<e;){if(l<=0){var k=n.readVarint();i=7&k,l=k>>3}if(l--,i===1||i===2)(h+=n.readSVarint())<g&&(g=h),h>v&&(v=h),(p+=n.readSVarint())<w&&(w=p),p>S&&(S=p);else if(i!==7)throw new Error("unknown command "+i)}return[g,w,v,S]},Uc.prototype.toGeoJSON=function(n,e,i){var l,h,p=this.extent*Math.pow(2,i),g=this.extent*n,v=this.extent*e,w=this.loadGeometry(),S=Uc.types[this.type];function k(z){for(var O=0;O<z.length;O++){var N=z[O];z[O]=[360*(N.x+g)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(N.y+v)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(l=0;l<w.length;l++)M[l]=w[l][0];k(w=M);break;case 2:for(l=0;l<w.length;l++)k(w[l]);break;case 3:for(w=function(z){var O=z.length;if(O<=1)return[z];for(var N,W,Q=[],ue=0;ue<O;ue++){var ee=QP(z[ue]);ee!==0&&(W===void 0&&(W=ee<0),W===ee<0?(N&&Q.push(N),N=[z[ue]]):N.push(z[ue]))}return N&&Q.push(N),Q}(w),l=0;l<w.length;l++)for(h=0;h<w[l].length;h++)k(w[l][h])}w.length===1?w=w[0]:S="Multi"+S;var P={type:"Feature",geometry:{type:S,coordinates:w},properties:this.properties};return"id"in this&&(P.id=this.id),P};var eR=Lw,zw=Dw;function Dw(n,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(tR,this,e),this.length=this._features.length}function tR(n,e,i){n===15?e.version=i.readVarint():n===1?e.name=i.readString():n===5?e.extent=i.readVarint():n===2?e._features.push(i.pos):n===3?e._keys.push(i.readString()):n===4&&e._values.push(function(l){for(var h=null,p=l.readVarint()+l.pos;l.pos<p;){var g=l.readVarint()>>3;h=g===1?l.readString():g===2?l.readFloat():g===3?l.readDouble():g===4?l.readVarint64():g===5?l.readVarint():g===6?l.readSVarint():g===7?l.readBoolean():null}return h}(i))}Dw.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var e=this._pbf.readVarint()+this._pbf.pos;return new eR(this._pbf,e,this.extent,this._keys,this._values)};var rR=zw;function nR(n,e,i){if(n===3){var l=new rR(i,i.readVarint()+i.pos);l.length&&(e[l.name]=l)}}var tv=wm.VectorTile=function(n,e){this.layers=n.readFields(nR,{},e)},Sm=wm.VectorTileFeature=Lw;function Tm(n,e,i,l){const h=[],p=l===0?(g,v,w,S,k,M)=>{g.push(new Ae(M,w+(M-v)/(S-v)*(k-w)))}:(g,v,w,S,k,M)=>{g.push(new Ae(v+(M-w)/(k-w)*(S-v),M))};for(const g of n){const v=[];for(const w of g){if(w.length<=2)continue;const S=[];for(let P=0;P<w.length-1;P++){const z=w[P].x,O=w[P].y,N=w[P+1].x,W=w[P+1].y,Q=l===0?z:O,ue=l===0?N:W;Q<e?ue>e&&p(S,z,O,N,W,e):Q>i?ue<i&&p(S,z,O,N,W,i):S.push(w[P]),ue<e&&Q>=e&&p(S,z,O,N,W,e),ue>i&&Q<=i&&p(S,z,O,N,W,i)}let k=w[w.length-1];const M=l===0?k.x:k.y;M>=e&&M<=i&&S.push(k),S.length&&(k=S[S.length-1],S[0].x===k.x&&S[0].y===k.y||S.push(S[0]),v.push(S))}v.length&&h.push(v)}return h}wm.VectorTileLayer=zw;const iR=Sm.types,sR=Math.pow(2,13);function qd(n,e,i,l,h,p,g,v){n.emplaceBack((e<<1)+g,(i<<1)+p,(Math.floor(l*sR)<<1)+h,Math.round(v))}function Hd(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Ow{constructor(){this.acc=new Ae(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ae(e.x,e.y),this.max=new Ae(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);const l=this.min,h=this.max;e.x<l.x?l.x=e.x:e.x>h.x&&(h.x=e.x),e.y<l.y?l.y=e.y:e.y>h.y&&(h.y=e.y),((e.x===0||e.x===St)&&e.x===i.x)!=((e.y===0||e.y===St)&&e.y===i.y)&&this.processBorderOverlap(e,i),i.x<0!=e.x<0&&this.addBorderIntersection(0,tr(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>St!=e.x>St&&this.addBorderIntersection(1,tr(i.y,e.y,(St-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,tr(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>St!=e.y>St&&this.addBorderIntersection(3,tr(i.x,e.x,(St-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];i<l[0]&&(l[0]=i),i>l[1]&&(l[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const l=e.x===0?0:1;this.addBorderIntersection(l,i.y),this.addBorderIntersection(l,e.y)}else{const l=e.y===0?2:3;this.addBorderIntersection(l,i.x),this.addBorderIntersection(l,e.x)}}centroid(){const e=this.polyCount.reduce((i,l)=>i+l.edges,0);return e!==0?this.acc.div(e)._round():new Ae(0,0)}span(){return new Ae(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class Zd{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Ve,this.centroidVertexArray=new Ys,this.indexArray=new yt,this.programConfigurations=new gu(e.layers,e.zoom),this.segments=new an,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,l,h){this.features=[],this.hasPattern=Qy("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(p){const g=Math.exp(Math.PI*(1-p.y/(1<<p.z)*2));return 80150034*g/(g*g+1)/St/(1<<p.z)}(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:p,id:g,index:v,sourceLayerIndex:w}of e){const S=this.layers[0]._featureFilter.needGeometry,k=wu(p,S);if(!this.layers[0]._featureFilter.filter(new A(this.zoom),k,l))continue;const M={id:g,sourceLayerIndex:w,index:v,geometry:S?k.geometry:fa(p,l,h),properties:p.properties,type:p.type,patterns:{}},P=this.layoutVertexArray.length;this.hasPattern?this.features.push(ev("fill-extrusion",this.layers,M,this.zoom,i)):this.addFeature(M,M.geometry,v,l,{},i.availableImages,h),i.featureIndex.insert(p,M.geometry,v,w,this.index,P)}this.sortBorders()}addFeatures(e,i,l,h,p){for(const g of this.features){const{geometry:v}=g;this.addFeature(g,v,g.index,i,l,h,p)}this.sortBorders()}update(e,i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,l,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,KP),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,XP.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,ZP.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,l,h,p,g,v){const w=[new Ae(0,0),new Ae(St,St)],S=v.projection,k=S.name==="globe",M=this.enableTerrain&&!k?new Ow:null,P=iR[e.type]==="Polygon";k&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Je);const z=Jy(i,500);for(let Q=z.length-1;Q>=0;Q--){const ue=z[Q];(ue.length===0||(O=ue[0]).every(ee=>ee.x<=0)||O.every(ee=>ee.x>=St)||O.every(ee=>ee.y<=0)||O.every(ee=>ee.y>=St))&&z.splice(Q,1)}var O;let N;if(k)N=$w(z,w,h);else{N=[];for(const Q of z)N.push({polygon:Q,bounds:w})}const W=P?this.edgeRadius:0;for(const{polygon:Q,bounds:ue}of N){let ee=0,le=0;for(const he of Q)P&&!he[0].equals(he[he.length-1])&&he.push(he[0]),le+=P?he.length-1:he.length;const de=this.segments.prepareSegment((P?5:4)*le,this.layoutVertexArray,this.indexArray);if(P){const he=[],Re=[];ee=de.vertexLength;for(const je of Q){let Ke,Oe;je.length&&je!==Q[0]&&Re.push(he.length/2),Ke=je[1].sub(je[0])._perp()._unit();for(let Ge=1;Ge<je.length;Ge++){const $e=je[Ge],He=je[Ge===je.length-1?1:Ge+1];let{x:tt,y:Fe}=$e;if(W){Oe=He.sub($e)._perp()._unit();const ut=Ke.add(Oe)._unit(),_t=W*Math.min(4,1/(Ke.x*ut.x+Ke.y*ut.y));tt+=_t*ut.x,Fe+=_t*ut.y,Ke=Oe}qd(this.layoutVertexArray,tt,Fe,0,0,1,1,0),de.vertexLength++,he.push($e.x,$e.y),k&&Hd(this.layoutVertexExtArray,S.projectTilePoint(tt,Fe,h),S.upVector(h,tt,Fe))}}const Ie=Yy(he,Re);for(let je=0;je<Ie.length;je+=3)this.indexArray.emplaceBack(ee+Ie[je],ee+Ie[je+2],ee+Ie[je+1]),de.primitiveLength++}for(const he of Q){M&&he.length&&M.startRing(he[0]);let Re,Ie,je,Ke=he.length>4&&Nw(he[he.length-2],he[0],he[1]),Oe=W?oR(he[he.length-2],he[0],he[1],W):0;Ie=he[1].sub(he[0])._perp()._unit();let Ge=!0;for(let $e=1,He=0;$e<he.length;$e++){let tt=he[$e-1],Fe=he[$e];const ut=he[$e===he.length-1?1:$e+1];if(M&&P&&M.currentPolyCount.top++,jw(Fe,tt,ue)){W&&(Ie=ut.sub(Fe)._perp()._unit(),Ge=!Ge);continue}M&&M.append(Fe,tt);const _t=Fe.sub(tt)._perp(),ht=_t.x/(Math.abs(_t.x)+Math.abs(_t.y)),zt=_t.y>0?1:0,rt=tt.dist(Fe);if(He+rt>32768&&(He=0),W){je=ut.sub(Fe)._perp()._unit();let Ot=Fw(tt,Fe,ut,Bw(Ie,je),W);isNaN(Ot)&&(Ot=0);const Ct=Fe.sub(tt)._unit();tt=tt.add(Ct.mult(Oe))._round(),Fe=Fe.add(Ct.mult(-Ot))._round(),Oe=Ot,Ie=je}const xt=de.vertexLength,Dt=he.length>4&&Nw(tt,Fe,ut);let nr=Uw(He,Ke,Ge);if(qd(this.layoutVertexArray,tt.x,tt.y,ht,zt,0,0,nr),qd(this.layoutVertexArray,tt.x,tt.y,ht,zt,0,1,nr),He+=rt,nr=Uw(He,Dt,!Ge),Ke=Dt,qd(this.layoutVertexArray,Fe.x,Fe.y,ht,zt,0,0,nr),qd(this.layoutVertexArray,Fe.x,Fe.y,ht,zt,0,1,nr),de.vertexLength+=4,this.indexArray.emplaceBack(xt+0,xt+1,xt+2),this.indexArray.emplaceBack(xt+1,xt+3,xt+2),de.primitiveLength+=2,W){const Ot=ee+($e===1?he.length-2:$e-2),Ct=$e===1?ee:Ot+1;if(this.indexArray.emplaceBack(xt+1,Ot,xt+3),this.indexArray.emplaceBack(Ot,Ct,xt+3),de.primitiveLength+=2,Re===void 0&&(Re=xt),!jw(ut,he[$e],ue)){const Ar=$e===he.length-1?Re:de.vertexLength;this.indexArray.emplaceBack(xt+2,xt+3,Ar),this.indexArray.emplaceBack(xt+3,Ar+1,Ar),this.indexArray.emplaceBack(xt+3,Ct,Ar+1),de.primitiveLength+=3}Ge=!Ge}if(k){const Ot=this.layoutVertexExtArray,Ct=S.projectTilePoint(tt.x,tt.y,h),Ar=S.projectTilePoint(Fe.x,Fe.y,h),Ft=S.upVector(h,tt.x,tt.y),jt=S.upVector(h,Fe.x,Fe.y);Hd(Ot,Ct,Ft),Hd(Ot,Ct,Ft),Hd(Ot,Ar,jt),Hd(Ot,Ar,jt)}}P&&(ee+=he.length-1)}}if(M&&M.polyCount.length>0){if(M.borders){M.vertexArrayOffset=this.centroidVertexArray.length;const Q=M.borders,ue=this.featuresOnBorder.push(M)-1;for(let ee=0;ee<4;ee++)Q[ee][0]!==Number.MAX_VALUE&&this.borders[ee].push(ue)}this.encodeCentroid(M.borders?void 0:M.centroid(),M)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,p,g,h)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,l)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[l].borders[e][0])}encodeCentroid(e,i,l=!0){let h,p;if(e)if(e.y!==0){const v=i.span()._mult(this.tileToMeter);h=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(v.x/10)),p=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(v.y/10))}else h=Math.ceil(7*(e.x+450)),p=0;else h=0,p=+l;let g=l?this.centroidVertexArray.length:i.vertexArrayOffset;for(const v of i.polyCount){l&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*v.edges+v.top);for(let w=0;w<v.top;w++)this.centroidVertexArray.emplace(g++,h,p);for(let w=0;w<2*v.edges;w++)this.centroidVertexArray.emplace(g++,0,p),this.centroidVertexArray.emplace(g++,h,p)}}}function Bw(n,e){const i=n.add(e)._unit();return n.x*i.x+n.y*i.y}function oR(n,e,i,l){const h=e.sub(n)._perp()._unit(),p=i.sub(e)._perp()._unit();return Fw(n,e,i,Bw(h,p),l)}function Fw(n,e,i,l,h){const p=Math.sqrt(1-l*l);return Math.min(n.dist(e)/3,e.dist(i)/3,h*p/l)}function jw(n,e,i){return n.x<i[0].x&&e.x<i[0].x||n.x>i[1].x&&e.x>i[1].x||n.y<i[0].y&&e.y<i[0].y||n.y>i[1].y&&e.y>i[1].y}function Nw(n,e,i){if(n.x<0||n.x>=St||e.x<0||e.x>=St||i.x<0||i.x>=St)return!1;const l=i.sub(e),h=l.perp(),p=n.sub(e);return(l.x*p.x+l.y*p.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(p.x*p.x+p.y*p.y))>-.866&&h.x*p.x+h.y*p.y<0}function Uw(n,e,i){const l=e?2|n:-3&n;return i?1|l:-2&l}function Vw(){const n=Math.PI/32,e=Math.tan(n),i=Ud;return i*Math.sqrt(1+2*e*e)-i}function $w(n,e,i){const l=1<<i.z,h=as(i.x/l),p=as((i.x+1)/l),g=Wn(i.y/l),v=Wn((i.y+1)/l);return function(w,S,k,M,P=0,z){const O=[];if(!w.length||!k||!M)return O;const N=(he,Re)=>{for(const Ie of he)O.push({polygon:Ie,bounds:Re})},W=Math.ceil(Math.log2(k)),Q=Math.ceil(Math.log2(M)),ue=W-Q,ee=[];for(let he=0;he<Math.abs(ue);he++)ee.push(ue>0?0:1);for(let he=0;he<Math.min(W,Q);he++)ee.push(0),ee.push(1);let le=w;if(le=Tm(le,S[0].y-P,S[1].y+P,1),le=Tm(le,S[0].x-P,S[1].x+P,0),!le.length)return O;const de=[];for(ee.length?de.push({polygons:le,bounds:S,depth:0}):N(le,S);de.length;){const he=de.pop(),Re=he.depth,Ie=ee[Re],je=he.bounds[0],Ke=he.bounds[1],Oe=Ie===0?je.x:je.y,Ge=Ie===0?Ke.x:Ke.y,$e=z(Ie,Oe,Ge),He=Tm(he.polygons,Oe-P,$e+P,Ie),tt=Tm(he.polygons,$e-P,Ge+P,Ie);if(He.length){const Fe=[je,new Ae(Ie===0?$e:Ke.x,Ie===1?$e:Ke.y)];ee.length>Re+1?de.push({polygons:He,bounds:Fe,depth:Re+1}):N(He,Fe)}if(tt.length){const Fe=[new Ae(Ie===0?$e:je.x,Ie===1?$e:je.y),Ke];ee.length>Re+1?de.push({polygons:tt,bounds:Fe,depth:Re+1}):N(tt,Fe)}}return O}(n,e,Math.ceil((p-h)/11.25),Math.ceil((g-v)/11.25),1,(w,S,k)=>{if(w===0)return .5*(S+k);{const M=Wn((i.y+S/St)/l);return(Bo(.5*(Wn((i.y+k/St)/l)+M))*l-i.y)*St}})}mt(Zd,"FillExtrusionBucket",{omit:["layers","features"]}),mt(Ow,"PartMetadata");const aR=new oe({"fill-extrusion-edge-radius":new F(Be["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var lR={paint:new oe({"fill-extrusion-opacity":new F(Be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new H(Be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new F(Be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new F(Be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new H(Be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new H(Be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new H(Be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new F(Be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new F(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new F(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new F(Be["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:aR};function Gw(n,e,i){var l=2*Math.PI*6378137/256/Math.pow(2,i);return[n*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}class Em{constructor(e,i,l){this.z=e,this.x=i,this.y=l,this.key=Xd(0,e,e,i,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const l=function(p,g,v){var w=Gw(256*p,256*(g=Math.pow(2,v)-g-1),v),S=Gw(256*(p+1),256*(g+1),v);return w[0]+","+w[1]+","+S[0]+","+S[1]}(this.x,this.y,this.z),h=function(p,g,v){let w,S="";for(let k=p;k>0;k--)w=1<<k-1,S+=(g&w?1:0)+(v&w?2:0);return S}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ww{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Xd(e,i.z,i.z,i.x,i.y)}}class ci{constructor(e,i,l,h,p){this.overscaledZ=e,this.wrap=i,this.canonical=new Em(l,+h,+p),this.key=i===0&&e===l?this.canonical.key:Xd(i,e,l,h,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new ci(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ci(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Xd(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return Xd(this.wrap*+i,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new ci(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,l=2*this.canonical.x,h=2*this.canonical.y;return[new ci(i,this.wrap,i,l,h),new ci(i,this.wrap,i,l+1,h),new ci(i,this.wrap,i,l,h+1),new ci(i,this.wrap,i,l+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ci(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ci(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ww(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Xd(n,e,i,l,h){const p=1<<Math.min(i,22);let g=p*(h%p)+l%p;return n&&i<22&&(g+=p*p*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*g+i)+(e-i)}mt(Em,"CanonicalTileID"),mt(ci,"OverscaledTileID",{omit:["projMatrix"]});class Vc extends Ae{constructor(e,i,l){super(e,i),this.z=l}}function Kd(n,e){return n.x*e.x+n.y*e.y}function qw(n,e){if(n.length===1){let i=0;const l=e[i++];let h;for(;!h||l.equals(h);)if(h=e[i++],!h)return 1/0;for(;i<e.length;i++){const p=e[i],g=n[0],v=h.sub(l),w=p.sub(l),S=g.sub(l),k=Kd(v,v),M=Kd(v,w),P=Kd(w,w),z=Kd(S,v),O=Kd(S,w),N=k*P-M*M,W=(P*z-M*O)/N,Q=(k*O-M*z)/N,ue=l.z*(1-W-Q)+h.z*W+p.z*Q;if(isFinite(ue))return ue}return 1/0}{let i=1/0;for(const l of e)i=Math.min(i,l.z);return i}}function Hw(n,e,i,l,h,p,g,v){const w=g*h.getElevationAt(n,e,!0,!0),S=p[0]!==0,k=S?p[1]===0?g*(p[0]/7-450):g*function(M,P,z){const O=Math.floor(P[0]/8),N=Math.floor(P[1]/8),W=10*(P[0]-8*O),Q=10*(P[1]-8*N),ue=M.getElevationAt(O,N,!0,!0),ee=M.getMeterToDEM(z),le=Math.floor(.5*(W*ee-1)),de=Math.floor(.5*(Q*ee-1)),he=M.tileCoordToPixel(O,N),Re=2*le+1,Ie=2*de+1,je=function(tt,Fe,ut,_t,ht){return[tt.getElevationAtPixel(Fe,ut,!0),tt.getElevationAtPixel(Fe+ht,ut,!0),tt.getElevationAtPixel(Fe,ut+ht,!0),tt.getElevationAtPixel(Fe+_t,ut+ht,!0)]}(M,he.x-le,he.y-de,Re,Ie),Ke=Math.abs(je[0]-je[1]),Oe=Math.abs(je[2]-je[3]),Ge=Math.abs(je[0]-je[2])+Math.abs(je[1]-je[3]),$e=Math.min(.25,.5*ee*(Ke+Oe)/Re),He=Math.min(.25,.5*ee*Ge/Ie);return ue+Math.max($e*W,He*Q)}(h,p,v):w;return{base:w+(i===0)?-1:i,top:S?Math.max(k+l,w+i+2):w+l}}const uR=xe([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:cR}=uR,hR=xe([{name:"a_packed",components:4,type:"Float32"}]),{members:dR}=hR,fR=Sm.types,pR=Math.cos(Math.PI/180*37.5);class Cm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new De,this.layoutVertexArray2=new Ze,this.indexArray=new yt,this.programConfigurations=new gu(e.layers,e.zoom),this.segments=new an,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,l,h){this.hasPattern=Qy("line",this.layers,i);const p=this.layers[0].layout.get("line-sort-key"),g=[];for(const{feature:k,id:M,index:P,sourceLayerIndex:z}of e){const O=this.layers[0]._featureFilter.needGeometry,N=wu(k,O);if(!this.layers[0]._featureFilter.filter(new A(this.zoom),N,l))continue;const W=p?p.evaluate(N,{},l):void 0,Q={id:M,properties:k.properties,type:k.type,sourceLayerIndex:z,index:P,geometry:O?N.geometry:fa(k,l,h),patterns:{},sortKey:W};g.push(Q)}p&&g.sort((k,M)=>k.sortKey-M.sortKey);const{lineAtlas:v,featureIndex:w}=i,S=this.addConstantDashes(v);for(const k of g){const{geometry:M,index:P,sourceLayerIndex:z}=k;if(S&&this.addFeatureDashes(k,v),this.hasPattern){const O=ev("line",this.layers,k,this.zoom,i);this.patternFeatures.push(O)}else this.addFeature(k,M,P,l,v.positions,i.availableImages);w.insert(e[P].feature,M,P,z,this.index)}}addConstantDashes(e){let i=!1;for(const l of this.layers){const h=l.paint.get("line-dasharray").value,p=l.layout.get("line-cap").value;if(h.kind!=="constant"||p.kind!=="constant")i=!0;else{const g=p.value,v=h.value;if(!v)continue;e.addDash(v,g)}}return i}addFeatureDashes(e,i){const l=this.zoom;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,g=h.layout.get("line-cap").value;if(p.kind==="constant"&&g.kind==="constant")continue;let v,w;if(p.kind==="constant"){if(v=p.value,!v)continue}else v=p.evaluate({zoom:l},e);w=g.kind==="constant"?g.value:g.evaluate({zoom:l},e),i.addDash(v,w),e.patterns[h.id]=i.getKey(v,w)}}update(e,i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,l,h)}addFeatures(e,i,l,h,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,l,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,dR)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cR),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,l,h,p,g){const v=this.layers[0].layout,w=v.get("line-join").evaluate(e,{}),S=v.get("line-cap").evaluate(e,{}),k=v.get("line-miter-limit"),M=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const P of i)this.addLine(P,e,w,S,k,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,p,g,h)}addLine(e,i,l,h,p,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Q=0;Q<e.length-1;Q++)this.totalDistance+=e[Q].dist(e[Q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v=fR[i.type]==="Polygon";let w=e.length;for(;w>=2&&e[w-1].equals(e[w-2]);)w--;let S=0;for(;S<w-1&&e[S].equals(e[S+1]);)S++;if(w<(v?3:2))return;l==="bevel"&&(p=1.05);const k=this.overscaling<=16?15*St/(512*this.overscaling):0,M=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let P,z,O,N,W;this.e1=this.e2=-1,v&&(P=e[w-2],W=e[S].sub(P)._unit()._perp());for(let Q=S;Q<w;Q++){if(O=Q===w-1?v?e[S+1]:void 0:e[Q+1],O&&e[Q].equals(O))continue;W&&(N=W),P&&(z=P),P=e[Q],W=O?O.sub(P)._unit()._perp():N,N=N||W;let ue=N.add(W);ue.x===0&&ue.y===0||ue._unit();const ee=N.x*W.x+N.y*W.y,le=ue.x*W.x+ue.y*W.y,de=le!==0?1/le:1/0,he=2*Math.sqrt(2-2*le),Re=le<pR&&z&&O,Ie=N.x*W.y-N.y*W.x>0;if(Re&&Q>S){const Oe=P.dist(z);if(Oe>2*k){const Ge=P.sub(P.sub(z)._mult(k/Oe)._round());this.updateDistance(z,Ge),this.addCurrentVertex(Ge,N,0,0,M),z=Ge}}const je=z&&O;let Ke=je?l:v?"butt":h;if(je&&Ke==="round"&&(de<g?Ke="miter":de<=2&&(Ke="fakeround")),Ke==="miter"&&de>p&&(Ke="bevel"),Ke==="bevel"&&(de>2&&(Ke="flipbevel"),de<p&&(Ke="miter")),z&&this.updateDistance(z,P),Ke==="miter")ue._mult(de),this.addCurrentVertex(P,ue,0,0,M);else if(Ke==="flipbevel"){if(de>100)ue=W.mult(-1);else{const Oe=de*N.add(W).mag()/N.sub(W).mag();ue._perp()._mult(Oe*(Ie?-1:1))}this.addCurrentVertex(P,ue,0,0,M),this.addCurrentVertex(P,ue.mult(-1),0,0,M)}else if(Ke==="bevel"||Ke==="fakeround"){const Oe=-Math.sqrt(de*de-1),Ge=Ie?Oe:0,$e=Ie?0:Oe;if(z&&this.addCurrentVertex(P,N,Ge,$e,M),Ke==="fakeround"){const He=Math.round(180*he/Math.PI/20);for(let tt=1;tt<He;tt++){let Fe=tt/He;if(Fe!==.5){const _t=Fe-.5;Fe+=Fe*_t*(Fe-1)*((1.0904+ee*(ee*(3.55645-1.43519*ee)-3.2452))*_t*_t+(.848013+ee*(.215638*ee-1.06021)))}const ut=W.sub(N)._mult(Fe)._add(N)._unit()._mult(Ie?-1:1);this.addHalfVertex(P,ut.x,ut.y,!1,Ie,0,M)}}O&&this.addCurrentVertex(P,W,-Ge,-$e,M)}else if(Ke==="butt")this.addCurrentVertex(P,ue,0,0,M);else if(Ke==="square"){const Oe=z?1:-1;z||this.addCurrentVertex(P,ue,Oe,Oe,M),this.addCurrentVertex(P,ue,0,0,M),z&&this.addCurrentVertex(P,ue,Oe,Oe,M)}else Ke==="round"&&(z&&(this.addCurrentVertex(P,N,0,0,M),this.addCurrentVertex(P,N,1,1,M,!0)),O&&(this.addCurrentVertex(P,W,-1,-1,M,!0),this.addCurrentVertex(P,W,0,0,M)));if(Re&&Q<w-1){const Oe=P.dist(O);if(Oe>2*k){const Ge=P.add(O.sub(P)._mult(k/Oe)._round());this.updateDistance(P,Ge),this.addCurrentVertex(Ge,W,0,0,M),P=Ge}}}}addCurrentVertex(e,i,l,h,p,g=!1){const v=i.y*h-i.x,w=-i.y-i.x*h;this.addHalfVertex(e,i.x+i.y*l,i.y-i.x*l,g,!1,l,p),this.addHalfVertex(e,v,w,g,!0,-h,p)}addHalfVertex({x:e,y:i},l,h,p,g,v,w){this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(i<<1)+(g?1:0),Math.round(63*l)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const S=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),w.primitiveLength++),g?this.e2=S:this.e1=S}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}mt(Cm,"LineBucket",{omit:["layers","patternFeatures"]});const mR=new oe({"line-cap":new H(Be.layout_line["line-cap"]),"line-join":new H(Be.layout_line["line-join"]),"line-miter-limit":new F(Be.layout_line["line-miter-limit"]),"line-round-limit":new F(Be.layout_line["line-round-limit"]),"line-sort-key":new H(Be.layout_line["line-sort-key"])});var Zw={paint:new oe({"line-opacity":new H(Be.paint_line["line-opacity"]),"line-color":new H(Be.paint_line["line-color"]),"line-translate":new F(Be.paint_line["line-translate"]),"line-translate-anchor":new F(Be.paint_line["line-translate-anchor"]),"line-width":new H(Be.paint_line["line-width"]),"line-gap-width":new H(Be.paint_line["line-gap-width"]),"line-offset":new H(Be.paint_line["line-offset"]),"line-blur":new H(Be.paint_line["line-blur"]),"line-dasharray":new H(Be.paint_line["line-dasharray"]),"line-pattern":new H(Be.paint_line["line-pattern"]),"line-gradient":new ne(Be.paint_line["line-gradient"]),"line-trim-offset":new F(Be.paint_line["line-trim-offset"])}),layout:mR};const Xw=new class extends H{possiblyEvaluate(n,e){return e=new A(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(n,e)}evaluate(n,e,i,l){return e=Yt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(n,e,i,l)}}(Zw.paint.properties["line-width"].specification);function Kw(n,e){return e>0?e+2*n:n}Xw.useIntegerZoom=!0;const gR=xe([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),_R=xe([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),yR=xe([{name:"a_projected_pos",components:4,type:"Float32"}],4);xe([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const vR=xe([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),xR=xe([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);xe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Yw=xe([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),bR=xe([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);xe([{name:"triangle",components:3,type:"Uint16"}]),xe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),xe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),xe([{type:"Float32",name:"offsetX"}]),xe([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Dn=24;const io=128;function rv(n,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new A(n+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:h}=i;let p=0;for(;p<l.length&&l[p]<=n;)p++;p=Math.max(0,p-1);let g=p;for(;g<l.length&&l[g]<n+1;)g++;g=Math.min(l.length-1,g);const v=l[p],w=l[g];return i.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:w,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:w,minSize:i.evaluate(new A(v)),maxSize:i.evaluate(new A(w)),interpolationType:h}}}function km(n,{uSize:e,uSizeT:i},{lowerSize:l,upperSize:h}){return n.kind==="source"?l/io:n.kind==="composite"?tr(l/io,h/io,i):e}function $c(n,e){let i=0,l=0;if(n.kind==="constant")l=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:h,minZoom:p,maxZoom:g}=n,v=h?st(Ts.interpolationFactor(h,e,p,g),0,1):0;n.kind==="camera"?l=tr(n.minSize,n.maxSize,v):i=v}return{uSizeT:i,uSize:l}}var wR=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:io,evaluateSizeForFeature:km,evaluateSizeForZoom:$c,getSizeData:rv});function SR(n,e,i){return n.sections.forEach(l=>{l.text=function(h,p,g){const v=p.layout.get("text-transform").evaluate(g,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),C.applyArabicShaping&&(h=C.applyArabicShaping(h)),h}(l.text,e,i)}),n}const Yd={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function TR(n){return n==="︶"||n==="﹈"||n==="︸"||n==="﹄"||n==="﹂"||n==="︾"||n==="︼"||n==="︺"||n==="︘"||n==="﹀"||n==="︐"||n==="︓"||n==="︔"||n==="｀"||n==="￣"||n==="︑"||n==="︒"}function ER(n){return n==="︵"||n==="﹇"||n==="︷"||n==="﹃"||n==="﹁"||n==="︽"||n==="︻"||n==="︹"||n==="︗"||n==="︿"}var Jw=Er,Qw=function(n,e,i,l,h){var p,g,v=8*h-l-1,w=(1<<v)-1,S=w>>1,k=-7,M=h-1,P=-1,z=n[e+M];for(M+=P,p=z&(1<<-k)-1,z>>=-k,k+=v;k>0;p=256*p+n[e+M],M+=P,k-=8);for(g=p&(1<<-k)-1,p>>=-k,k+=l;k>0;g=256*g+n[e+M],M+=P,k-=8);if(p===0)p=1-S;else{if(p===w)return g?NaN:1/0*(z?-1:1);g+=Math.pow(2,l),p-=S}return(z?-1:1)*g*Math.pow(2,p-l)},eS=function(n,e,i,l,h,p){var g,v,w,S=8*p-h-1,k=(1<<S)-1,M=k>>1,P=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,z=0,O=1,N=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(v=isNaN(e)?1:0,g=k):(g=Math.floor(Math.log(e)/Math.LN2),e*(w=Math.pow(2,-g))<1&&(g--,w*=2),(e+=g+M>=1?P/w:P*Math.pow(2,1-M))*w>=2&&(g++,w/=2),g+M>=k?(v=0,g=k):g+M>=1?(v=(e*w-1)*Math.pow(2,h),g+=M):(v=e*Math.pow(2,M-1)*Math.pow(2,h),g=0));h>=8;n[i+z]=255&v,z+=O,v/=256,h-=8);for(g=g<<h|v,S+=h;S>0;n[i+z]=255&g,z+=O,g/=256,S-=8);n[i+z-O]|=128*N};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Er(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}Er.Varint=0,Er.Fixed64=1,Er.Bytes=2,Er.Fixed32=5;var nv=4294967296,tS=1/nv,rS=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ma(n){return n.type===Er.Bytes?n.readVarint()+n.pos:n.pos+1}function Gc(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function nS(n,e,i){var l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(l);for(var h=i.pos-1;h>=n;h--)i.buf[h+l]=i.buf[h]}function CR(n,e){for(var i=0;i<n.length;i++)e.writeVarint(n[i])}function kR(n,e){for(var i=0;i<n.length;i++)e.writeSVarint(n[i])}function IR(n,e){for(var i=0;i<n.length;i++)e.writeFloat(n[i])}function AR(n,e){for(var i=0;i<n.length;i++)e.writeDouble(n[i])}function MR(n,e){for(var i=0;i<n.length;i++)e.writeBoolean(n[i])}function PR(n,e){for(var i=0;i<n.length;i++)e.writeFixed32(n[i])}function RR(n,e){for(var i=0;i<n.length;i++)e.writeSFixed32(n[i])}function LR(n,e){for(var i=0;i<n.length;i++)e.writeFixed64(n[i])}function zR(n,e){for(var i=0;i<n.length;i++)e.writeSFixed64(n[i])}function Im(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+16777216*n[e+3]}function Wc(n,e,i){n[i]=e,n[i+1]=e>>>8,n[i+2]=e>>>16,n[i+3]=e>>>24}function iS(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}Er.prototype={destroy:function(){this.buf=null},readFields:function(n,e,i){for(i=i||this.length;this.pos<i;){var l=this.readVarint(),h=l>>3,p=this.pos;this.type=7&l,n(h,e,this),this.pos===p&&this.skip(l)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=Im(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=iS(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=Im(this.buf,this.pos)+Im(this.buf,this.pos+4)*nv;return this.pos+=8,n},readSFixed64:function(){var n=Im(this.buf,this.pos)+iS(this.buf,this.pos+4)*nv;return this.pos+=8,n},readFloat:function(){var n=Qw(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=Qw(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e,i,l=this.buf;return e=127&(i=l[this.pos++]),i<128?e:(e|=(127&(i=l[this.pos++]))<<7,i<128?e:(e|=(127&(i=l[this.pos++]))<<14,i<128?e:(e|=(127&(i=l[this.pos++]))<<21,i<128?e:function(h,p,g){var v,w,S=g.buf;if(v=(112&(w=S[g.pos++]))>>4,w<128||(v|=(127&(w=S[g.pos++]))<<3,w<128)||(v|=(127&(w=S[g.pos++]))<<10,w<128)||(v|=(127&(w=S[g.pos++]))<<17,w<128)||(v|=(127&(w=S[g.pos++]))<<24,w<128)||(v|=(1&(w=S[g.pos++]))<<31,w<128))return Gc(h,v,p);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=l[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&rS?function(i,l,h){return rS.decode(i.subarray(l,h))}(this.buf,e,n):function(i,l,h){for(var p="",g=l;g<h;){var v,w,S,k=i[g],M=null,P=k>239?4:k>223?3:k>191?2:1;if(g+P>h)break;P===1?k<128&&(M=k):P===2?(192&(v=i[g+1]))==128&&(M=(31&k)<<6|63&v)<=127&&(M=null):P===3?(w=i[g+2],(192&(v=i[g+1]))==128&&(192&w)==128&&((M=(15&k)<<12|(63&v)<<6|63&w)<=2047||M>=55296&&M<=57343)&&(M=null)):P===4&&(w=i[g+2],S=i[g+3],(192&(v=i[g+1]))==128&&(192&w)==128&&(192&S)==128&&((M=(15&k)<<18|(63&v)<<12|(63&w)<<6|63&S)<=65535||M>=1114112)&&(M=null)),M===null?(M=65533,P=1):M>65535&&(M-=65536,p+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),p+=String.fromCharCode(M),g+=P}return p}(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==Er.Bytes)return n.push(this.readVarint(e));var i=ma(this);for(n=n||[];this.pos<i;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==Er.Bytes)return n.push(this.readSVarint());var e=ma(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==Er.Bytes)return n.push(this.readBoolean());var e=ma(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==Er.Bytes)return n.push(this.readFloat());var e=ma(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==Er.Bytes)return n.push(this.readDouble());var e=ma(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==Er.Bytes)return n.push(this.readFixed32());var e=ma(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==Er.Bytes)return n.push(this.readSFixed32());var e=ma(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==Er.Bytes)return n.push(this.readFixed64());var e=ma(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==Er.Bytes)return n.push(this.readSFixed64());var e=ma(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=7&n;if(e===Er.Varint)for(;this.buf[this.pos++]>127;);else if(e===Er.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Er.Fixed32)this.pos+=4;else{if(e!==Er.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),Wc(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),Wc(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),Wc(this.buf,-1&n,this.pos),Wc(this.buf,Math.floor(n*tS),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),Wc(this.buf,-1&n,this.pos),Wc(this.buf,Math.floor(n*tS),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(e,i){var l,h;if(e>=0?(l=e%4294967296|0,h=e/4294967296|0):(h=~(-e/4294967296),4294967295^(l=~(-e%4294967296))?l=l+1|0:(l=0,h=h+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(p,g,v){v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,v.buf[v.pos]=127&(p>>>=7)}(l,0,i),function(p,g){var v=(7&p)<<4;g.buf[g.pos++]|=v|((p>>>=3)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p)))))}(h,i)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var e=this.pos;this.pos=function(l,h,p){for(var g,v,w=0;w<h.length;w++){if((g=h.charCodeAt(w))>55295&&g<57344){if(!v){g>56319||w+1===h.length?(l[p++]=239,l[p++]=191,l[p++]=189):v=g;continue}if(g<56320){l[p++]=239,l[p++]=191,l[p++]=189,v=g;continue}g=v-55296<<10|g-56320|65536,v=null}else v&&(l[p++]=239,l[p++]=191,l[p++]=189,v=null);g<128?l[p++]=g:(g<2048?l[p++]=g>>6|192:(g<65536?l[p++]=g>>12|224:(l[p++]=g>>18|240,l[p++]=g>>12&63|128),l[p++]=g>>6&63|128),l[p++]=63&g|128)}return p}(this.buf,n,this.pos);var i=this.pos-e;i>=128&&nS(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(n){this.realloc(4),eS(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),eS(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=n[i]},writeRawMessage:function(n,e){this.pos++;var i=this.pos;n(e,this);var l=this.pos-i;l>=128&&nS(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l},writeMessage:function(n,e,i){this.writeTag(n,Er.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,CR,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,kR,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,MR,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,IR,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,AR,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,PR,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,RR,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,LR,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,zR,e)},writeBytesField:function(n,e){this.writeTag(n,Er.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,Er.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,Er.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,Er.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,Er.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,Er.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,Er.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,Er.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,Er.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,Er.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,!!e)}};var Am=Se(Jw);const iv=3;function DR(n,e,i){e.glyphs=[],n===1&&i.readMessage(OR,e)}function OR(n,e,i){if(n===3){const{id:l,bitmap:h,width:p,height:g,left:v,top:w,advance:S}=i.readMessage(BR,{});e.glyphs.push({id:l,bitmap:new pa({width:p+2*iv,height:g+2*iv},h),metrics:{width:p,height:g,left:v,top:w,advance:S}})}else n===4?e.ascender=i.readSVarint():n===5&&(e.descender=i.readSVarint())}function BR(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}const FR=iv;function sv(n){let e=0,i=0;for(const g of n)e+=g.w*g.h,i=Math.max(i,g.w);n.sort((g,v)=>v.h-g.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let h=0,p=0;for(const g of n)for(let v=l.length-1;v>=0;v--){const w=l[v];if(!(g.w>w.w||g.h>w.h)){if(g.x=w.x,g.y=w.y,p=Math.max(p,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===w.w&&g.h===w.h){const S=l.pop();v<l.length&&(l[v]=S)}else g.h===w.h?(w.x+=g.w,w.w-=g.w):g.w===w.w?(w.y+=g.h,w.h-=g.h):(l.push({x:w.x+g.w,y:w.y,w:w.w-g.w,h:g.h}),w.y+=g.h,w.h-=g.h);break}}return{w:h,h:p,fill:e/(h*p)||0}}const wi=1;class ov{constructor(e,{pixelRatio:i,version:l,stretchX:h,stretchY:p,content:g}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=h,this.stretchY=p,this.content=g,this.version=l}get tl(){return[this.paddedRect.x+wi,this.paddedRect.y+wi]}get br(){return[this.paddedRect.x+this.paddedRect.w-wi,this.paddedRect.y+this.paddedRect.h-wi]}get displaySize(){return[(this.paddedRect.w-2*wi)/this.pixelRatio,(this.paddedRect.h-2*wi)/this.pixelRatio]}}class sS{constructor(e,i){const l={},h={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,l,p),this.addImages(i,h,p);const{w:g,h:v}=sv(p),w=new Ui({width:g||1,height:v||1});for(const S in e){const k=e[S],M=l[S].paddedRect;Ui.copy(k.data,w,{x:0,y:0},{x:M.x+wi,y:M.y+wi},k.data)}for(const S in i){const k=i[S],M=h[S].paddedRect,P=M.x+wi,z=M.y+wi,O=k.data.width,N=k.data.height;Ui.copy(k.data,w,{x:0,y:0},{x:P,y:z},k.data),Ui.copy(k.data,w,{x:0,y:N-1},{x:P,y:z-1},{width:O,height:1}),Ui.copy(k.data,w,{x:0,y:0},{x:P,y:z+N},{width:O,height:1}),Ui.copy(k.data,w,{x:O-1,y:0},{x:P-1,y:z},{width:1,height:N}),Ui.copy(k.data,w,{x:0,y:0},{x:P+O,y:z},{width:1,height:N})}this.image=w,this.iconPositions=l,this.patternPositions=h}addImages(e,i,l){for(const h in e){const p=e[h],g={x:0,y:0,w:p.data.width+2*wi,h:p.data.height+2*wi};l.push(g),i[h]=new ov(g,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(l=>e.hasImage(l)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in e.updatedImages)this.patchUpdatedImage(this.iconPositions[l],e.getImage(l),i),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l),i)}patchUpdatedImage(e,i,l){if(!e||!i||e.version===i.version)return;e.version=i.version;const[h,p]=e.tl;l.update(i.data,void 0,{x:h,y:p})}}mt(ov,"ImagePosition"),mt(sS,"ImageAtlas");const ls={horizontal:1,vertical:2,horizontalOnly:3},oS=-17;class Jd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const l=new Jd;return l.scale=e||1,l.fontStack=i,l}static forImage(e){const i=new Jd;return i.imageName=e,i}}class qc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const l=new qc;for(let h=0;h<e.sections.length;h++){const p=e.sections[h];p.image?l.addImageSection(p):l.addTextSection(p,i)}return l}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,l){let h="";for(let p=0;p<i.length;p++){const g=i.charCodeAt(p+1)||null,v=i.charCodeAt(p-1)||null;h+=!l&&(g&&im(g)&&!Yd[i[p+1]]||v&&im(v)&&!Yd[i[p-1]])||!Yd[i[p]]?i[p]:Yd[i[p]]}return h}(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&Mm[this.text.charCodeAt(l)];l++)e++;let i=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&Mm[this.text.charCodeAt(l)];l--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const l=new qc;return l.text=this.text.substring(e,i),l.sectionIndex=this.sectionIndex.slice(e,i),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Jd.forText(e.scale,e.fontStack||i));const l=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(l)}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void fr("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Jd.forImage(i)),this.sectionIndex.push(this.sections.length-1)):fr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function av(n,e,i,l,h,p,g,v,w,S,k,M,P,z,O){const N=qc.fromFeature(n,h);M===ls.vertical&&N.verticalizePunctuation(P);let W=[];const Q=function(he,Re,Ie,je,Ke,Oe){if(!he)return[];const Ge=[],$e=function(ut,_t,ht,zt,rt,xt){let Dt=0;for(let nr=0;nr<ut.length();nr++){const Ot=ut.getSection(nr);Dt+=aS(ut.getCharCode(nr),Ot,zt,rt,_t,xt)}return Dt/Math.max(1,Math.ceil(Dt/ht))}(he,Re,Ie,je,Ke,Oe),He=he.text.indexOf("​")>=0;let tt=0;for(let ut=0;ut<he.length();ut++){const _t=he.getSection(ut),ht=he.getCharCode(ut);if(Mm[ht]||(tt+=aS(ht,_t,je,Ke,Re,Oe)),ut<he.length()-1){const zt=!((Fe=ht)<11904||!(dt["Bopomofo Extended"](Fe)||dt.Bopomofo(Fe)||dt["CJK Compatibility Forms"](Fe)||dt["CJK Compatibility Ideographs"](Fe)||dt["CJK Compatibility"](Fe)||dt["CJK Radicals Supplement"](Fe)||dt["CJK Strokes"](Fe)||dt["CJK Symbols and Punctuation"](Fe)||dt["CJK Unified Ideographs Extension A"](Fe)||dt["CJK Unified Ideographs"](Fe)||dt["Enclosed CJK Letters and Months"](Fe)||dt["Halfwidth and Fullwidth Forms"](Fe)||dt.Hiragana(Fe)||dt["Ideographic Description Characters"](Fe)||dt["Kangxi Radicals"](Fe)||dt["Katakana Phonetic Extensions"](Fe)||dt.Katakana(Fe)||dt["Vertical Forms"](Fe)||dt["Yi Radicals"](Fe)||dt["Yi Syllables"](Fe)));(jR[ht]||zt||_t.imageName)&&Ge.push(uS(ut+1,tt,$e,Ge,NR(ht,he.getCharCode(ut+1),zt&&He),!1))}}var Fe;return cS(uS(he.length(),tt,$e,Ge,0,!0))}(N,S,p,e,l,z),{processBidirectionalText:ue,processStyledBidirectionalText:ee}=C;if(ue&&N.sections.length===1){const he=ue(N.toString(),Q);for(const Re of he){const Ie=new qc;Ie.text=Re,Ie.sections=N.sections;for(let je=0;je<Re.length;je++)Ie.sectionIndex.push(0);W.push(Ie)}}else if(ee){const he=ee(N.text,N.sectionIndex,Q);for(const Re of he){const Ie=new qc;Ie.text=Re[0],Ie.sectionIndex=Re[1],Ie.sections=N.sections,W.push(Ie)}}else W=function(he,Re){const Ie=[],je=he.text;let Ke=0;for(const Oe of Re)Ie.push(he.substring(Ke,Oe)),Ke=Oe;return Ke<je.length&&Ie.push(he.substring(Ke,je.length)),Ie}(N,Q);const le=[],de={positionedLines:le,text:N.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:M,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(he,Re,Ie,je,Ke,Oe,Ge,$e,He,tt,Fe,ut){let _t=0,ht=0,zt=0;const rt=$e==="right"?1:$e==="left"?0:.5;let xt=!1;for(const Ft of Ke){const jt=Ft.getSections();for(const xr of jt){if(xr.imageName)continue;const Cr=Re[xr.fontStack];if(Cr&&(xt=Cr.ascender!==void 0&&Cr.descender!==void 0,!xt))break}if(!xt)break}let Dt=0;for(const Ft of Ke){Ft.trim();const jt=Ft.getMaxScale(),xr=(jt-1)*Dn,Cr={positionedGlyphs:[],lineOffset:0};he.positionedLines[Dt]=Cr;const kr=Cr.positionedGlyphs;let br=0;if(!Ft.length()){ht+=Oe,++Dt;continue}let Br=0,Hr=0;for(let wr=0;wr<Ft.length();wr++){const _n=Ft.getSection(wr),cn=Ft.getSectionIndex(wr),$r=Ft.getCharCode(wr);let sr=_n.scale,hn=null,Ir=null,hi=null,dn=Dn,On=0;const kn=!(He===ls.horizontal||!Fe&&!Ed($r)||Fe&&(Mm[$r]||(nr=$r,dt.Arabic(nr)||dt["Arabic Supplement"](nr)||dt["Arabic Extended-A"](nr)||dt["Arabic Presentation Forms-A"](nr)||dt["Arabic Presentation Forms-B"](nr))));if(_n.imageName){const di=je[_n.imageName];if(!di)continue;hi=_n.imageName,he.iconsInText=he.iconsInText||!0,Ir=di.paddedRect;const In=di.displaySize;sr=sr*Dn/ut,hn={width:In[0],height:In[1],left:wi,top:-3,advance:kn?In[1]:In[0],localGlyph:!1},On=xt?-hn.height*sr:oS+jt*Dn-In[1]*sr,dn=hn.advance;const ao=(kn?In[0]:In[1])*sr-Dn*jt;ao>0&&ao>br&&(br=ao)}else{const di=Ie[_n.fontStack];if(!di)continue;di[$r]&&(Ir=di[$r]);const In=Re[_n.fontStack];if(!In)continue;const ao=In.glyphs[$r];if(!ao)continue;if(hn=ao.metrics,dn=$r!==8203?Dn:0,xt){const Jc=In.ascender!==void 0?Math.abs(In.ascender):0,uf=In.descender!==void 0?Math.abs(In.descender):0,cf=(Jc+uf)*sr;Br<cf&&(Br=cf,Hr=(Jc-uf)/2*sr),On=-Jc*sr}else On=oS+(jt-sr)*Dn}kn?(he.verticalizable=!0,kr.push({glyph:$r,imageName:hi,x:_t,y:ht+On,vertical:kn,scale:sr,localGlyph:hn.localGlyph,fontStack:_n.fontStack,sectionIndex:cn,metrics:hn,rect:Ir}),_t+=dn*sr+tt):(kr.push({glyph:$r,imageName:hi,x:_t,y:ht+On,vertical:kn,scale:sr,localGlyph:hn.localGlyph,fontStack:_n.fontStack,sectionIndex:cn,metrics:hn,rect:Ir}),_t+=hn.advance*sr+tt)}kr.length!==0&&(zt=Math.max(_t-tt,zt),xt?hS(kr,rt,br,Hr,Oe*jt/2):hS(kr,rt,br,0,Oe/2)),_t=0;const un=Oe*jt+br;Cr.lineOffset=Math.max(br,xr),ht+=un,++Dt}var nr;const Ot=ht,{horizontalAlign:Ct,verticalAlign:Ar}=lv(Ge);(function(Ft,jt,xr,Cr,kr,br){const Br=(jt-xr)*kr,Hr=-br*Cr;for(const un of Ft)for(const wr of un.positionedGlyphs)wr.x+=Br,wr.y+=Hr})(he.positionedLines,rt,Ct,Ar,zt,Ot),he.top+=-Ar*Ot,he.bottom=he.top+Ot,he.left+=-Ct*zt,he.right=he.left+zt,he.hasBaseline=xt}(de,e,i,l,W,g,v,w,M,S,P,O),!function(he){for(const Re of he)if(Re.positionedGlyphs.length!==0)return!1;return!0}(le)&&de}const Mm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},jR={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function aS(n,e,i,l,h,p){if(e.imageName){const g=l[e.imageName];return g?g.displaySize[0]*e.scale*Dn/p+h:0}{const g=i[e.fontStack],v=g&&g.glyphs[n];return v?v.metrics.advance*e.scale+h:0}}function lS(n,e,i,l){const h=Math.pow(n-e,2);return l?n<e?h/2:2*h:h+Math.abs(i)*i}function NR(n,e,i){let l=0;return n===10&&(l-=1e4),i&&(l+=150),n!==40&&n!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function uS(n,e,i,l,h,p){let g=null,v=lS(e,i,h,p);for(const w of l){const S=lS(e-w.x,i,h,p)+w.badness;S<=v&&(g=w,v=S)}return{index:n,x:e,priorBreak:g,badness:v}}function cS(n){return n?cS(n.priorBreak).concat(n.index):[]}function lv(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function hS(n,e,i,l,h){if(!(e||i||l||h))return;const p=n.length-1,g=n[p],v=(g.x+g.metrics.advance*g.scale)*e;for(let w=0;w<=p;w++)n[w].x-=v,n[w].y+=i+l+h}function UR(n,e,i){const{horizontalAlign:l,verticalAlign:h}=lv(i),p=e[0]-n.displaySize[0]*l,g=e[1]-n.displaySize[1]*h;return{image:n,top:g,bottom:g+n.displaySize[1],left:p,right:p+n.displaySize[0]}}function dS(n,e,i,l,h,p){const g=n.image;let v;if(g.content){const W=g.content,Q=g.pixelRatio||1;v=[W[0]/Q,W[1]/Q,g.displaySize[0]-W[2]/Q,g.displaySize[1]-W[3]/Q]}const w=e.left*p,S=e.right*p;let k,M,P,z;i==="width"||i==="both"?(z=h[0]+w-l[3],M=h[0]+S+l[1]):(z=h[0]+(w+S-g.displaySize[0])/2,M=z+g.displaySize[0]);const O=e.top*p,N=e.bottom*p;return i==="height"||i==="both"?(k=h[1]+O-l[0],P=h[1]+N+l[2]):(k=h[1]+(O+N-g.displaySize[1])/2,P=k+g.displaySize[1]),{image:g,top:k,right:M,bottom:P,left:z,collisionPadding:v}}class ga extends Ae{constructor(e,i,l,h,p){super(e,i),this.angle=h,this.z=l,p!==void 0&&(this.segment=p)}clone(){return new ga(this.x,this.y,this.z,this.angle,this.segment)}}function fS(n,e,i,l,h){if(e.segment===void 0)return!0;let p=e,g=e.segment+1,v=0;for(;v>-i/2;){if(g--,g<0)return!1;v-=n[g].dist(p),p=n[g]}v+=n[g].dist(n[g+1]),g++;const w=[];let S=0;for(;v<i/2;){const k=n[g],M=n[g+1];if(!M)return!1;let P=n[g-1].angleTo(k)-k.angleTo(M);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:v,angleDelta:P}),S+=P;v-w[0].distance>l;)S-=w.shift().angleDelta;if(S>h)return!1;g++,v+=k.dist(M)}return!0}function pS(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function mS(n,e,i){return n?.6*e*i:0}function gS(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function VR(n,e,i,l,h,p){const g=mS(i,h,p),v=gS(i,l)*p;let w=0;const S=pS(n)/2;for(let k=0;k<n.length-1;k++){const M=n[k],P=n[k+1],z=M.dist(P);if(w+z>S){const O=(S-w)/z,N=tr(M.x,P.x,O),W=tr(M.y,P.y,O),Q=new ga(N,W,0,P.angleTo(M),k);return!g||fS(n,Q,v,g,e)?Q:void 0}w+=z}}function $R(n,e,i,l,h,p,g,v,w){const S=mS(l,p,g),k=gS(l,h),M=k*g,P=n[0].x===0||n[0].x===w||n[0].y===0||n[0].y===w;return e-M<e/4&&(e=M+e/4),_S(n,P?e/2*v%e:(k/2+2*p)*g*v%e,e,S,i,M,P,!1,w)}function _S(n,e,i,l,h,p,g,v,w){const S=p/2,k=pS(n);let M=0,P=e-i,z=[];for(let O=0;O<n.length-1;O++){const N=n[O],W=n[O+1],Q=N.dist(W),ue=W.angleTo(N);for(;P+i<M+Q;){P+=i;const ee=(P-M)/Q,le=tr(N.x,W.x,ee),de=tr(N.y,W.y,ee);if(le>=0&&le<w&&de>=0&&de<w&&P-S>=0&&P+S<=k){const he=new ga(le,de,0,ue,O);he._round(),l&&!fS(n,he,p,l,h)||z.push(he)}}M+=Q}return v||z.length||g||(z=_S(n,M/2,i,l,h,p,g,!0,w)),z}function yS(n,e,i,l,h){const p=[];for(let g=0;g<n.length;g++){const v=n[g];let w;for(let S=0;S<v.length-1;S++){let k=v[S],M=v[S+1];k.x<e&&M.x<e||(k.x<e?k=new Ae(e,k.y+(e-k.x)/(M.x-k.x)*(M.y-k.y))._round():M.x<e&&(M=new Ae(e,k.y+(e-k.x)/(M.x-k.x)*(M.y-k.y))._round()),k.y<i&&M.y<i||(k.y<i?k=new Ae(k.x+(i-k.y)/(M.y-k.y)*(M.x-k.x),i)._round():M.y<i&&(M=new Ae(k.x+(i-k.y)/(M.y-k.y)*(M.x-k.x),i)._round()),k.x>=l&&M.x>=l||(k.x>=l?k=new Ae(l,k.y+(l-k.x)/(M.x-k.x)*(M.y-k.y))._round():M.x>=l&&(M=new Ae(l,k.y+(l-k.x)/(M.x-k.x)*(M.y-k.y))._round()),k.y>=h&&M.y>=h||(k.y>=h?k=new Ae(k.x+(h-k.y)/(M.y-k.y)*(M.x-k.x),h)._round():M.y>=h&&(M=new Ae(k.x+(h-k.y)/(M.y-k.y)*(M.x-k.x),h)._round()),w&&k.equals(w[w.length-1])||(w=[k],p.push(w)),w.push(M)))))}}return p}mt(ga,"Anchor");const Pm=1e20;function vS(n,e,i,l,h,p,g,v,w){for(let S=e;S<e+l;S++)xS(n,i*p+S,p,h,g,v,w);for(let S=i;S<i+h;S++)xS(n,S*p+e,1,l,g,v,w)}function xS(n,e,i,l,h,p,g){p[0]=0,g[0]=-1e20,g[1]=Pm,h[0]=n[e];for(let v=1,w=0,S=0;v<l;v++){h[v]=n[e+v*i];const k=v*v;do{const M=p[w];S=(h[v]-h[M]+k-M*M)/(v-M)/2}while(S<=g[w]&&--w>-1);w++,p[w]=v,g[w]=S,g[w+1]=Pm}for(let v=0,w=0;v<l;v++){for(;g[w+1]<v;)w++;const S=p[w],k=v-S;n[e+v*i]=h[S]+k*k}}const so=2,uv={none:0,ideographs:1,all:2};class Hc{constructor(e,i,l){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=l,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const l=[];for(const h in e)for(const p of e[h])l.push({stack:h,id:p});Bt(l,({stack:h,id:p},g)=>{let v=this.entries[h];v||(v=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=v.glyphs[p];if(w!==void 0)return void g(null,{stack:h,id:p,glyph:w});if(w=this._tinySDF(v,h,p),w)return v.glyphs[p]=w,void g(null,{stack:h,id:p,glyph:w});const S=Math.floor(p/256);if(256*S>65535)return void g(new Error("glyphs > 65535 not supported"));if(v.ranges[S])return void g(null,{stack:h,id:p,glyph:w});let k=v.requests[S];k||(k=v.requests[S]=[],Hc.loadGlyphRange(h,S,this.url,this.requestManager,(M,P)=>{if(P){v.ascender=P.ascender,v.descender=P.descender;for(const z in P.glyphs)this._doesCharSupportLocalGlyph(+z)||(v.glyphs[+z]=P.glyphs[+z]);v.ranges[S]=!0}for(const z of k)z(M,P);delete v.requests[S]})),k.push((M,P)=>{M?g(M):P&&g(null,{stack:h,id:p,glyph:P.glyphs[p]||null})})},(h,p)=>{if(h)i(h);else if(p){const g={};for(const{stack:v,id:w,glyph:S}of p)g[v]===void 0&&(g[v]={}),g[v].glyphs===void 0&&(g[v].glyphs={}),g[v].glyphs[w]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},g[v].ascender=this.entries[v].ascender,g[v].descender=this.entries[v].descender;i(null,g)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==uv.none&&(this.localGlyphMode===uv.all?!!this.localFontFamily:!!this.localFontFamily&&(dt["CJK Unified Ideographs"](e)||dt["Hangul Syllables"](e)||dt.Hiragana(e)||dt.Katakana(e)||dt["CJK Symbols and Punctuation"](e)))}_tinySDF(e,i,l){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let p=e.tinySDF;if(!p){let N="400";/bold/i.test(i)?N="900":/medium/i.test(i)?N="500":/light/i.test(i)&&(N="200"),p=e.tinySDF=new Hc.TinySDF({fontFamily:h,fontWeight:N,fontSize:24*so,buffer:3*so,radius:8*so}),p.fontWeight=N}if(this.localGlyphs[p.fontWeight][l])return this.localGlyphs[p.fontWeight][l];const g=String.fromCharCode(l),{data:v,width:w,height:S,glyphWidth:k,glyphHeight:M,glyphLeft:P,glyphTop:z,glyphAdvance:O}=p.draw(g);return this.localGlyphs[p.fontWeight][l]={id:l,bitmap:new pa({width:w,height:S},v),metrics:{width:k/so,height:M/so,left:P/so,top:z/so-27,advance:O/so,localGlyph:!0}}}}Hc.loadGlyphRange=function(n,e,i,l,h){const p=256*e,g=p+255,v=l.transformRequest(l.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${p}-${g}`),Pi.Glyphs);ns(v,(w,S)=>{if(w)h(w);else if(S){const k={},M=function(P){return new Am(P).readFields(DR,{})}(S);for(const P of M.glyphs)k[P.id]=P;h(null,{glyphs:k,ascender:M.ascender,descender:M.descender})}})},Hc.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:p="normal",fontStyle:g="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=i;const v=this.size=n+4*e,w=this._createCanvas(v),S=this.ctx=w.getContext("2d",{willReadFrequently:!0});S.font=`${g} ${p} ${n}px ${h}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:p}=this.ctx.measureText(n),g=Math.ceil(i),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-h))),w=Math.min(this.size-this.buffer,g+Math.ceil(l)),S=v+2*this.buffer,k=w+2*this.buffer,M=Math.max(S*k,0),P=new Uint8ClampedArray(M),z={data:P,width:S,height:k,glyphWidth:v,glyphHeight:w,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(v===0||w===0)return z;const{ctx:O,buffer:N,gridInner:W,gridOuter:Q}=this;O.clearRect(N,N,v,w),O.fillText(n,N,N+g);const ue=O.getImageData(N,N,v,w);Q.fill(Pm,0,M),W.fill(0,0,M);for(let ee=0;ee<w;ee++)for(let le=0;le<v;le++){const de=ue.data[4*(ee*v+le)+3]/255;if(de===0)continue;const he=(ee+N)*S+le+N;if(de===1)Q[he]=0,W[he]=Pm;else{const Re=.5-de;Q[he]=Re>0?Re*Re:0,W[he]=Re<0?Re*Re:0}}vS(Q,0,0,S,k,S,this.f,this.v,this.z),vS(W,N,N,v,w,S,this.f,this.v,this.z);for(let ee=0;ee<M;ee++){const le=Math.sqrt(Q[ee])-Math.sqrt(W[ee]);P[ee]=Math.round(255-255*(le/this.radius+this.cutoff))}return z}};const Qd=wi;function bS(n,e,i,l){const h=[],p=n.image,g=p.pixelRatio,v=p.paddedRect.w-2*Qd,w=p.paddedRect.h-2*Qd,S=n.right-n.left,k=n.bottom-n.top,M=p.stretchX||[[0,v]],P=p.stretchY||[[0,w]],z=(Oe,Ge)=>Oe+Ge[1]-Ge[0],O=M.reduce(z,0),N=P.reduce(z,0),W=v-O,Q=w-N;let ue=0,ee=O,le=0,de=N,he=0,Re=W,Ie=0,je=Q;if(p.content&&l){const Oe=p.content;ue=Rm(M,0,Oe[0]),le=Rm(P,0,Oe[1]),ee=Rm(M,Oe[0],Oe[2]),de=Rm(P,Oe[1],Oe[3]),he=Oe[0]-ue,Ie=Oe[1]-le,Re=Oe[2]-Oe[0]-ee,je=Oe[3]-Oe[1]-de}const Ke=(Oe,Ge,$e,He)=>{const tt=Lm(Oe.stretch-ue,ee,S,n.left),Fe=zm(Oe.fixed-he,Re,Oe.stretch,O),ut=Lm(Ge.stretch-le,de,k,n.top),_t=zm(Ge.fixed-Ie,je,Ge.stretch,N),ht=Lm($e.stretch-ue,ee,S,n.left),zt=zm($e.fixed-he,Re,$e.stretch,O),rt=Lm(He.stretch-le,de,k,n.top),xt=zm(He.fixed-Ie,je,He.stretch,N),Dt=new Ae(tt,ut),nr=new Ae(ht,ut),Ot=new Ae(ht,rt),Ct=new Ae(tt,rt),Ar=new Ae(Fe/g,_t/g),Ft=new Ae(zt/g,xt/g),jt=e*Math.PI/180;if(jt){const kr=Math.sin(jt),br=Math.cos(jt),Br=[br,-kr,kr,br];Dt._matMult(Br),nr._matMult(Br),Ct._matMult(Br),Ot._matMult(Br)}const xr=Oe.stretch+Oe.fixed,Cr=Ge.stretch+Ge.fixed;return{tl:Dt,tr:nr,bl:Ct,br:Ot,tex:{x:p.paddedRect.x+Qd+xr,y:p.paddedRect.y+Qd+Cr,w:$e.stretch+$e.fixed-xr,h:He.stretch+He.fixed-Cr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ar,pixelOffsetBR:Ft,minFontScaleX:Re/g/S,minFontScaleY:je/g/k,isSDF:i}};if(l&&(p.stretchX||p.stretchY)){const Oe=wS(M,W,O),Ge=wS(P,Q,N);for(let $e=0;$e<Oe.length-1;$e++){const He=Oe[$e],tt=Oe[$e+1];for(let Fe=0;Fe<Ge.length-1;Fe++)h.push(Ke(He,Ge[Fe],tt,Ge[Fe+1]))}}else h.push(Ke({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:w+1}));return h}function Rm(n,e,i){let l=0;for(const h of n)l+=Math.max(e,Math.min(i,h[1]))-Math.max(e,Math.min(i,h[0]));return l}function wS(n,e,i){const l=[{fixed:-1,stretch:0}];for(const[h,p]of n){const g=l[l.length-1];l.push({fixed:h-g.stretch,stretch:g.stretch}),l.push({fixed:h-g.stretch,stretch:g.stretch+(p-h)})}return l.push({fixed:e+Qd,stretch:i}),l}function Lm(n,e,i,l){return n/e*i+l}function zm(n,e,i,l){return n-e*i/l}function GR(n,e,i,l){const h=e+n.positionedLines[l].lineOffset;return l===0?i+h/2:i+(h+(e+n.positionedLines[l-1].lineOffset))/2}class WR{constructor(e=[],i=qR){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:l}=this,h=i[e];for(;e>0;){const p=e-1>>1,g=i[p];if(l(h,g)>=0)break;i[e]=g,e=p}i[e]=h}_down(e){const{data:i,compare:l}=this,h=this.length>>1,p=i[e];for(;e<h;){let g=1+(e<<1),v=i[g];const w=g+1;if(w<this.length&&l(i[w],v)<0&&(g=w,v=i[w]),l(v,p)>=0)break;i[e]=v,e=g}i[e]=p}}function qR(n,e){return n<e?-1:n>e?1:0}function HR(n,e=1,i=!1){let l=1/0,h=1/0,p=-1/0,g=-1/0;const v=n[0];for(let z=0;z<v.length;z++){const O=v[z];(!z||O.x<l)&&(l=O.x),(!z||O.y<h)&&(h=O.y),(!z||O.x>p)&&(p=O.x),(!z||O.y>g)&&(g=O.y)}const w=Math.min(p-l,g-h);let S=w/2;const k=new WR([],ZR);if(w===0)return new Ae(l,h);for(let z=l;z<p;z+=w)for(let O=h;O<g;O+=w)k.push(new Zc(z+S,O+S,S,n));let M=function(z){let O=0,N=0,W=0;const Q=z[0];for(let ue=0,ee=Q.length,le=ee-1;ue<ee;le=ue++){const de=Q[ue],he=Q[le],Re=de.x*he.y-he.x*de.y;N+=(de.x+he.x)*Re,W+=(de.y+he.y)*Re,O+=3*Re}return new Zc(N/O,W/O,0,z)}(n),P=k.length;for(;k.length;){const z=k.pop();(z.d>M.d||!M.d)&&(M=z,i&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,P)),z.max-M.d<=e||(S=z.h/2,k.push(new Zc(z.p.x-S,z.p.y-S,S,n)),k.push(new Zc(z.p.x+S,z.p.y-S,S,n)),k.push(new Zc(z.p.x-S,z.p.y+S,S,n)),k.push(new Zc(z.p.x+S,z.p.y+S,S,n)),P+=4)}return i&&(console.log(`num probes: ${P}`),console.log(`best distance: ${M.d}`)),M.p}function ZR(n,e){return e.max-n.max}class Zc{constructor(e,i,l,h){this.p=new Ae(e,i),this.h=l,this.d=function(p,g){let v=!1,w=1/0;for(let S=0;S<g.length;S++){const k=g[S];for(let M=0,P=k.length,z=P-1;M<P;z=M++){const O=k[M],N=k[z];O.y>p.y!=N.y>p.y&&p.x<(N.x-O.x)*(p.y-O.y)/(N.y-O.y)+O.x&&(v=!v),w=Math.min(w,yw(p,O,N))}}return(v?1:-1)*Math.sqrt(w)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const Xc=7,cv=Number.POSITIVE_INFINITY,XR=Math.sqrt(2);function SS(n,[e,i]){let l=0,h=0;if(i===cv){e<0&&(e=0);const p=e/XR;switch(n){case"top-right":case"top-left":h=p-Xc;break;case"bottom-right":case"bottom-left":h=-p+Xc;break;case"bottom":h=-e+Xc;break;case"top":h=e-Xc}switch(n){case"top-right":case"bottom-right":l=-p;break;case"top-left":case"bottom-left":l=p;break;case"left":l=e;break;case"right":l=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),n){case"top-right":case"top-left":case"top":h=i-Xc;break;case"bottom-right":case"bottom-left":case"bottom":h=-i+Xc}switch(n){case"top-right":case"bottom-right":case"right":l=-e;break;case"top-left":case"bottom-left":case"left":l=e}}return[l,h]}function KR(n,e,i,l,h,p,g,v,w,S){n.createArrays(),n.tilePixelRatio=St/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const k=n.layers[0].layout,M=n.layers[0]._unevaluatedLayout._values,P={};if(n.textSizeData.kind==="composite"){const{minZoom:N,maxZoom:W}=n.textSizeData;P.compositeTextSizes=[M["text-size"].possiblyEvaluate(new A(N),v),M["text-size"].possiblyEvaluate(new A(W),v)]}if(n.iconSizeData.kind==="composite"){const{minZoom:N,maxZoom:W}=n.iconSizeData;P.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new A(N),v),M["icon-size"].possiblyEvaluate(new A(W),v)]}P.layoutTextSize=M["text-size"].possiblyEvaluate(new A(w+1),v),P.layoutIconSize=M["icon-size"].possiblyEvaluate(new A(w+1),v),P.textMaxSize=M["text-size"].possiblyEvaluate(new A(18),v);const z=k.get("text-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",O=k.get("text-size");for(const N of n.features){const W=k.get("text-font").evaluate(N,{},v).join(","),Q=O.evaluate(N,{},v),ue=P.layoutTextSize.evaluate(N,{},v),ee=(P.layoutIconSize.evaluate(N,{},v),{horizontal:{},vertical:void 0}),le=N.text;let de,he=[0,0];if(le){const je=le.toString(),Ke=k.get("text-letter-spacing").evaluate(N,{},v)*Dn,Oe=k.get("text-line-height").evaluate(N,{},v)*Dn,Ge=vy(je)?Ke:0,$e=k.get("text-anchor").evaluate(N,{},v),He=k.get("text-variable-anchor");if(!He){const ht=k.get("text-radial-offset").evaluate(N,{},v);he=ht?SS($e,[ht*Dn,cv]):k.get("text-offset").evaluate(N,{},v).map(zt=>zt*Dn)}let tt=z?"center":k.get("text-justify").evaluate(N,{},v);const Fe=k.get("symbol-placement")==="point",ut=Fe?k.get("text-max-width").evaluate(N,{},v)*Dn:1/0,_t=ht=>{n.allowVerticalPlacement&&Td(je)&&(ee.vertical=av(le,e,i,h,W,ut,Oe,$e,ht,Ge,he,ls.vertical,!0,ue,Q))};if(!z&&He){const ht=tt==="auto"?He.map(rt=>hv(rt)):[tt];let zt=!1;for(let rt=0;rt<ht.length;rt++){const xt=ht[rt];if(!ee.horizontal[xt])if(zt)ee.horizontal[xt]=ee.horizontal[0];else{const Dt=av(le,e,i,h,W,ut,Oe,"center",xt,Ge,he,ls.horizontal,!1,ue,Q);Dt&&(ee.horizontal[xt]=Dt,zt=Dt.positionedLines.length===1)}}_t("left")}else{if(tt==="auto"&&(tt=hv($e)),Fe||k.get("text-writing-mode").indexOf("horizontal")>=0||!Td(je)){const ht=av(le,e,i,h,W,ut,Oe,$e,tt,Ge,he,ls.horizontal,!1,ue,Q);ht&&(ee.horizontal[tt]=ht)}_t(Fe?"left":tt)}}let Re=!1;if(N.icon&&N.icon.name){const je=l[N.icon.name];je&&(de=UR(h[N.icon.name],k.get("icon-offset").evaluate(N,{},v),k.get("icon-anchor").evaluate(N,{},v)),Re=je.sdf,n.sdfIcons===void 0?n.sdfIcons=je.sdf:n.sdfIcons!==je.sdf&&fr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(je.pixelRatio!==n.pixelRatio||k.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0))}const Ie=ES(ee.horizontal)||ee.vertical;n.iconsInText||(n.iconsInText=!!Ie&&Ie.iconsInText),(Ie||de)&&YR(n,N,ee,de,l,P,ue,0,he,Re,g,v,S)}p&&n.generateCollisionDebugBuffers(w,n.collisionBoxArray)}function hv(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function YR(n,e,i,l,h,p,g,v,w,S,k,M,P){let z=p.textMaxSize.evaluate(e,{},M);z===void 0&&(z=g);const O=n.layers[0].layout,N=O.get("icon-offset").evaluate(e,{},M),W=ES(i.horizontal)||i.vertical,Q=P.name==="globe",ue=Dn,ee=g/ue,le=n.tilePixelRatio*z/ue,de=($e=n.overscaling,n.zoom>18&&$e>2&&($e>>=1),Math.max(St/(512*$e),1)*O.get("symbol-spacing")),he=O.get("text-padding")*n.tilePixelRatio,Re=O.get("icon-padding")*n.tilePixelRatio,Ie=pt(O.get("text-max-angle")),je=O.get("text-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",Ke=O.get("icon-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",Oe=O.get("symbol-placement"),Ge=de/2;var $e;const He=O.get("icon-text-fit");let tt;l&&He!=="none"&&(n.allowVerticalPlacement&&i.vertical&&(tt=dS(l,i.vertical,He,O.get("icon-text-fit-padding"),N,ee)),W&&(l=dS(l,W,He,O.get("icon-text-fit-padding"),N,ee)));const Fe=(ut,_t,ht)=>{if(_t.x<0||_t.x>=St||_t.y<0||_t.y>=St)return;let zt=null;if(Q){const{x:rt,y:xt,z:Dt}=P.projectTilePoint(_t.x,_t.y,ht);zt={anchor:new ga(rt,xt,Dt,0,void 0),up:P.upVector(ht,_t.x,_t.y)}}(function(rt,xt,Dt,nr,Ot,Ct,Ar,Ft,jt,xr,Cr,kr,br,Br,Hr,un,wr,_n,cn,$r,sr,hn,Ir,hi,dn){const On=rt.addToLineVertexArray(xt,nr);let kn,di,In,ao,Jc,uf,cf,iT=0,sT=0,oT=0,aT=0,Cv=-1,kv=-1;const Uo={};let lT=wy("");const ku=Dt?Dt.anchor:xt;let Iv=0,Av=0;if(jt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Iv,Av]=jt.layout.get("text-offset").evaluate(sr,{},dn).map(Vi=>Vi*Dn):(Iv=jt.layout.get("text-radial-offset").evaluate(sr,{},dn)*Dn,Av=cv),rt.allowVerticalPlacement&&Ot.vertical){const Vi=Ot.vertical;if(Hr)uf=dv(Vi),Ft&&(cf=dv(Ft));else{const $i=jt.layout.get("text-rotate").evaluate(sr,{},dn)+90;In=Dm(xr,ku,xt,Cr,kr,br,Vi,Br,$i,un),Ft&&(ao=Dm(xr,ku,xt,Cr,kr,br,Ft,_n,$i))}}if(Ct){const Vi=jt.layout.get("icon-rotate").evaluate(sr,{},dn),$i=jt.layout.get("icon-text-fit")!=="none",hf=bS(Ct,Vi,Ir,$i),Pv=Ft?bS(Ft,Vi,Ir,$i):void 0;di=Dm(xr,ku,xt,Cr,kr,br,Ct,_n,Vi),iT=4*hf.length;const uT=rt.iconSizeData;let Iu=null;uT.kind==="source"?(Iu=[io*jt.layout.get("icon-size").evaluate(sr,{},dn)],Iu[0]>sl&&fr(`${rt.layerIds[0]}: Value for "icon-size" is >= ${ef}. Reduce your "icon-size".`)):uT.kind==="composite"&&(Iu=[io*hn.compositeIconSizes[0].evaluate(sr,{},dn),io*hn.compositeIconSizes[1].evaluate(sr,{},dn)],(Iu[0]>sl||Iu[1]>sl)&&fr(`${rt.layerIds[0]}: Value for "icon-size" is >= ${ef}. Reduce your "icon-size".`)),rt.addSymbols(rt.icon,hf,Iu,$r,cn,sr,!1,Dt,xt,On.lineStartIndex,On.lineLength,-1,hi,dn),Cv=rt.icon.placedSymbolArray.length-1,Pv&&(sT=4*Pv.length,rt.addSymbols(rt.icon,Pv,Iu,$r,cn,sr,ls.vertical,Dt,xt,On.lineStartIndex,On.lineLength,-1,hi,dn),kv=rt.icon.placedSymbolArray.length-1)}for(const Vi in Ot.horizontal){const $i=Ot.horizontal[Vi];kn||(lT=wy($i.text),Hr?Jc=dv($i):kn=Dm(xr,ku,xt,Cr,kr,br,$i,Br,jt.layout.get("text-rotate").evaluate(sr,{},dn),un));const hf=$i.positionedLines.length===1;if(oT+=TS(rt,Dt,xt,$i,Ar,jt,Hr,sr,un,On,Ot.vertical?ls.horizontal:ls.horizontalOnly,hf?Object.keys(Ot.horizontal):[Vi],Uo,Cv,hn,hi,dn),hf)break}Ot.vertical&&(aT+=TS(rt,Dt,xt,Ot.vertical,Ar,jt,Hr,sr,un,On,ls.vertical,["vertical"],Uo,kv,hn,hi,dn));let hl=-1;const Mv=(Vi,$i)=>Vi?Math.max(Vi,$i):$i;hl=Mv(Jc,hl),hl=Mv(uf,hl),hl=Mv(cf,hl);const EL=hl>-1?1:0;rt.glyphOffsetArray.length>=al.MAX_GLYPHS&&fr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),sr.sortKey!==void 0&&rt.addToSortKeyRanges(rt.symbolInstances.length,sr.sortKey),rt.symbolInstances.emplaceBack(ku.x,ku.y,ku.z,xt.x,xt.y,Uo.right>=0?Uo.right:-1,Uo.center>=0?Uo.center:-1,Uo.left>=0?Uo.left:-1,Uo.vertical>=0?Uo.vertical:-1,Cv,kv,lT,kn!==void 0?kn:rt.collisionBoxArray.length,kn!==void 0?kn+1:rt.collisionBoxArray.length,In!==void 0?In:rt.collisionBoxArray.length,In!==void 0?In+1:rt.collisionBoxArray.length,di!==void 0?di:rt.collisionBoxArray.length,di!==void 0?di+1:rt.collisionBoxArray.length,ao||rt.collisionBoxArray.length,ao?ao+1:rt.collisionBoxArray.length,Cr,oT,aT,iT,sT,EL,0,Iv,Av,hl)})(n,_t,zt,ut,i,l,h,tt,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,he,je,w,0,Re,Ke,N,e,p,S,k,M)};if(Oe==="line")for(const ut of yS(e.geometry,0,0,St,St)){const _t=$R(ut,de,Ie,i.vertical||W,l,ue,le,n.overscaling,St);for(const ht of _t)W&&JR(n,W.text,Ge,ht)||Fe(ut,ht,M)}else if(Oe==="line-center"){for(const ut of e.geometry)if(ut.length>1){const _t=VR(ut,Ie,i.vertical||W,l,ue,le);_t&&Fe(ut,_t,M)}}else if(e.type==="Polygon")for(const ut of Jy(e.geometry,0)){const _t=HR(ut,16);Fe(ut[0],new ga(_t.x,_t.y,0,0,void 0),M)}else if(e.type==="LineString")for(const ut of e.geometry)Fe(ut,new ga(ut[0].x,ut[0].y,0,0,void 0),M);else if(e.type==="Point")for(const ut of e.geometry)for(const _t of ut)Fe([_t],new ga(_t.x,_t.y,0,0,void 0),M)}const ef=255,sl=ef*io;function TS(n,e,i,l,h,p,g,v,w,S,k,M,P,z,O,N,W){const Q=function(le,de,he,Re,Ie,je,Ke,Oe){const Ge=[];if(de.positionedLines.length===0)return Ge;const $e=Re.layout.get("text-rotate").evaluate(je,{})*Math.PI/180,He=function(ht){const zt=ht[0],rt=ht[1],xt=zt*rt;return xt>0?[zt,-rt]:xt<0?[-zt,rt]:zt===0?[rt,zt]:[rt,-zt]}(he);let tt=Math.abs(de.top-de.bottom);for(const ht of de.positionedLines)tt-=ht.lineOffset;const Fe=de.positionedLines.length,ut=tt/Fe;let _t=de.top-he[1];for(let ht=0;ht<Fe;++ht){const zt=de.positionedLines[ht];_t=GR(de,ut,_t,ht);for(const rt of zt.positionedGlyphs){if(!rt.rect)continue;const xt=rt.rect||{};let Dt=FR+1,nr=!0,Ot=1,Ct=0;if(rt.imageName){const Ir=Ke[rt.imageName];if(!Ir)continue;if(Ir.sdf){fr("SDF images are not supported in formatted text and will be ignored.");continue}nr=!1,Ot=Ir.pixelRatio,Dt=wi/Ot}const Ar=(Ie||Oe)&&rt.vertical,Ft=rt.metrics.advance*rt.scale/2,jt=rt.metrics,xr=rt.rect;if(xr===null)continue;Oe&&de.verticalizable&&(Ct=rt.imageName?Ft-rt.metrics.width*rt.scale/2:0);const Cr=Ie?[rt.x+Ft,rt.y]:[0,0];let kr=[0,0],br=[0,0],Br=!1;Ie||(Ar?(br=[rt.x+Ft+He[0],rt.y+He[1]-Ct],Br=!0):kr=[rt.x+Ft+he[0],rt.y+he[1]-Ct]);const Hr=xr.w*rt.scale/(Ot*(rt.localGlyph?so:1)),un=xr.h*rt.scale/(Ot*(rt.localGlyph?so:1));let wr,_n,cn,$r;if(Ar){const Ir=rt.y-_t,hi=new Ae(-Ft,Ft-Ir),dn=-Math.PI/2,On=new Ae(...br);wr=new Ae(-Ft+kr[0],kr[1]),wr._rotateAround(dn,hi)._add(On),wr.x+=-Ir+Ft,wr.y-=(jt.left-Dt)*rt.scale;const kn=rt.imageName?jt.advance*rt.scale:Dn*rt.scale,di=String.fromCharCode(rt.glyph);TR(di)?wr.x+=(1-Dt)*rt.scale:ER(di)?wr.x+=kn-jt.height*rt.scale+(-Dt-1)*rt.scale:wr.x+=rt.imageName||jt.width+2*Dt===xr.w&&jt.height+2*Dt===xr.h?(kn-un)/2:(kn-(jt.height+2*Dt)*rt.scale)/2,_n=new Ae(wr.x,wr.y-Hr),cn=new Ae(wr.x+un,wr.y),$r=new Ae(wr.x+un,wr.y-Hr)}else{const Ir=(jt.left-Dt)*rt.scale-Ft+kr[0],hi=(-jt.top-Dt)*rt.scale+kr[1],dn=Ir+Hr,On=hi+un;wr=new Ae(Ir,hi),_n=new Ae(dn,hi),cn=new Ae(Ir,On),$r=new Ae(dn,On)}if($e){let Ir;Ir=Ie?new Ae(0,0):Br?new Ae(He[0],He[1]):new Ae(he[0],he[1]),wr._rotateAround($e,Ir),_n._rotateAround($e,Ir),cn._rotateAround($e,Ir),$r._rotateAround($e,Ir)}const sr=new Ae(0,0),hn=new Ae(0,0);Ge.push({tl:wr,tr:_n,bl:cn,br:$r,tex:xt,writingMode:de.writingMode,glyphOffset:Cr,sectionIndex:rt.sectionIndex,isSDF:nr,pixelOffsetTL:sr,pixelOffsetBR:hn,minFontScaleX:0,minFontScaleY:0})}}return Ge}(0,l,w,p,g,v,h,n.allowVerticalPlacement),ue=n.textSizeData;let ee=null;ue.kind==="source"?(ee=[io*p.layout.get("text-size").evaluate(v,{},W)],ee[0]>sl&&fr(`${n.layerIds[0]}: Value for "text-size" is >= ${ef}. Reduce your "text-size".`)):ue.kind==="composite"&&(ee=[io*O.compositeTextSizes[0].evaluate(v,{},W),io*O.compositeTextSizes[1].evaluate(v,{},W)],(ee[0]>sl||ee[1]>sl)&&fr(`${n.layerIds[0]}: Value for "text-size" is >= ${ef}. Reduce your "text-size".`)),n.addSymbols(n.text,Q,ee,w,g,v,k,e,i,S.lineStartIndex,S.lineLength,z,N,W);for(const le of M)P[le]=n.text.placedSymbolArray.length-1;return 4*Q.length}function ES(n){for(const e in n)return n[e];return null}function Dm(n,e,i,l,h,p,g,v,w,S){let k=g.top,M=g.bottom,P=g.left,z=g.right;const O=g.collisionPadding;if(O&&(P-=O[0],k-=O[1],z+=O[2],M+=O[3]),w){const N=new Ae(P,k),W=new Ae(z,k),Q=new Ae(P,M),ue=new Ae(z,M),ee=pt(w);let le=new Ae(0,0);S&&(le=new Ae(S[0],S[1])),N._rotateAround(ee,le),W._rotateAround(ee,le),Q._rotateAround(ee,le),ue._rotateAround(ee,le),P=Math.min(N.x,W.x,Q.x,ue.x),z=Math.max(N.x,W.x,Q.x,ue.x),k=Math.min(N.y,W.y,Q.y,ue.y),M=Math.max(N.y,W.y,Q.y,ue.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,P,k,z,M,v,l,h,p),n.length-1}function dv(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function JR(n,e,i,l){const h=n.compareText;if(e in h){const p=h[e];for(let g=p.length-1;g>=0;g--)if(l.dist(p[g])<i)return!0}else h[e]=[];return h[e].push(l),!1}function CS(n,e){const i=n.fovAboveCenter,l=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,h=(n._camera.position[2]*n.worldSize-l)/Math.cos(n._pitch),p=Math.sin(i)*h/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01)),g=Math.sin(n._pitch)*p+h;return Math.min(1.01*g,h*(1/n._horizonShift))}function Eu(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const i=Math.pow(2,-n.z),l=n.x*i,h=(n.x+1)*i,p=n.y*i,g=(n.y+1)*i,v=as(l),w=as(h),S=Wn(p),k=Wn(g),M=e.project(v,S),P=e.project(w,S),z=e.project(w,k),O=e.project(v,k);let N=Math.min(M.x,P.x,z.x,O.x),W=Math.min(M.y,P.y,z.y,O.y),Q=Math.max(M.x,P.x,z.x,O.x),ue=Math.max(M.y,P.y,z.y,O.y);const ee=i/16;function le(he,Re,Ie,je,Ke,Oe){const Ge=(Ie+Ke)/2,$e=(je+Oe)/2,He=e.project(as(Ge),Wn($e)),tt=Math.max(0,N-He.x,W-He.y,He.x-Q,He.y-ue);N=Math.min(N,He.x),Q=Math.max(Q,He.x),W=Math.min(W,He.y),ue=Math.max(ue,He.y),tt>ee&&(le(he,He,Ie,je,Ge,$e),le(He,Re,Ge,$e,Ke,Oe))}le(M,P,l,p,h,p),le(P,z,h,p,h,g),le(z,O,h,g,l,g),le(O,M,l,g,l,p),N-=ee,W-=ee,Q+=ee,ue+=ee;const de=1/Math.max(Q-N,ue-W);return{scale:de,x:N*de,y:W*de,x2:Q*de,y2:ue*de,projection:e}}const QR=eo(new Float32Array(16));class ol{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new vr(0,0)}projectTilePoint(e,i,l){return{x:e,y:i,z:0}}locationPoint(e,i,l=!0){return e._coordinatePoint(e.locationCoordinate(i),l)}pixelsPerMeter(e,i){return ro(1,e)*i}pixelSpaceConversion(e,i,l){return 1}farthestPixelDistance(e){return CS(e,e.pixelsPerMeter)}pointCoordinate(e,i,l,h){const p=e.horizonLineFromTop(!1),g=new Ae(i,Math.max(p,l));return e.rayIntersectionCoordinate(e.pointRayIntersection(g,h))}pointCoordinate3D(e,i,l){const h=new Ae(i,l);if(e.elevation)return e.elevation.pointCoordinate(h);{const p=this.pointCoordinate(e,h.x,h.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const l=e.horizonLineFromTop();return i.y<l}createInversionMatrix(e,i){return QR}createTileMatrix(e,i,l){let h,p,g;const v=l.canonical,w=eo(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=Eu(v,this);h=1,p=S.x+l.wrap*S.scale,g=S.y,yu(w,w,[h/S.scale,h/S.scale,e.pixelsPerMeter/i])}else h=i/e.zoomScale(v.z),p=(v.x+Math.pow(2,v.z)*l.wrap)*h,g=v.y*h;return Pd(w,w,[p,g,0]),yu(w,w,[h/St,h/St,1]),w}upVector(e,i,l){return[0,0,1]}upVectorScale(e,i,l){return{metersToTile:1}}}class eL extends ol{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,l]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(pt(i));this.n=(h+Math.sin(pt(l)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:l,c:h,r0:p}=this,g=pt(e-this.center[0]),v=pt(i),w=Math.sqrt(h-2*l*Math.sin(v))/l;return{x:w*Math.sin(g*l),y:w*Math.cos(g*l)-p,z:0}}unproject(e,i){const{n:l,c:h,r0:p}=this,g=p+i;let v=Math.atan2(e,Math.abs(g))*Math.sign(g);g*l<0&&(v-=Math.PI*Math.sign(e)*Math.sign(g));const w=pt(this.center[0])*l;v=It(v,-Math.PI-w,Math.PI-w);const S=st(Kt(v/l)+this.center[0],-180,180),k=Math.asin(st((h-(e*e+g*g)*l*l)/(2*l),-1,1)),M=st(Kt(k),-85.051129,no);return new vr(S,M)}}const tf=1.340264,rf=-.081106,nf=893e-6,sf=.003796,Om=Math.sqrt(3)/2;class tL extends ol{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const l=Math.asin(Om*Math.sin(i)),h=l*l,p=h*h*h;return{x:.5*(e*Math.cos(l)/(Om*(tf+3*rf*h+p*(7*nf+9*sf*h)))/Math.PI+.5),y:1-.5*(l*(tf+rf*h+p*(nf+sf*h))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let l=i=(2*(1-i)-1)*Math.PI,h=l*l,p=h*h*h;for(let k,M,P,z=0;z<12&&(M=l*(tf+rf*h+p*(nf+sf*h))-i,P=tf+3*rf*h+p*(7*nf+9*sf*h),k=M/P,l=st(l-k,-Math.PI/3,Math.PI/3),h=l*l,p=h*h*h,!(Math.abs(k)<1e-12));++z);const g=Om*e*(tf+3*rf*h+p*(7*nf+9*sf*h))/Math.cos(l),v=Math.asin(Math.sin(l)/Om),w=st(180*g/Math.PI,-180,180),S=st(180*v/Math.PI,-85.051129,no);return new vr(w,S)}}class rL extends ol{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const l=360*(e-.5),h=st(360*(.5-i),-85.051129,no);return new vr(l,h)}}const Kc=Math.PI/2;function Bm(n){return Math.tan((Kc+n)/2)}class nL extends ol{constructor(e){super(e),this.center=e.center||[0,30];const[i,l]=this.parallels=e.parallels||[30,30];let h=pt(i),p=pt(l);this.southernCenter=h+p<0,this.southernCenter&&(h=-h,p=-p);const g=Math.cos(h),v=Bm(h);this.n=h===p?Math.sin(h):Math.log(g/Math.cos(p))/Math.log(Bm(p)/v),this.f=g*Math.pow(Bm(h),this.n)/this.n}project(e,i){i=pt(i),this.southernCenter&&(i=-i),e=pt(e-this.center[0]);const l=1e-6,{n:h,f:p}=this;p>0?i<-Kc+l&&(i=-Kc+l):i>Kc-l&&(i=Kc-l);const g=p/Math.pow(Bm(i),h);let v=g*Math.sin(h*e),w=p-g*Math.cos(h*e);return v=.5*(v/Math.PI+.5),w=.5*(w/Math.PI+.5),{x:v,y:this.southernCenter?w:1-w,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:l,f:h}=this,p=h-i,g=Math.sign(p),v=Math.sign(l)*Math.sqrt(e*e+p*p);let w=Math.atan2(e,Math.abs(p))*g;p*l<0&&(w-=Math.PI*Math.sign(e)*g);const S=st(Kt(w/l)+this.center[0],-180,180),k=st(Kt(2*Math.atan(Math.pow(h/v,1/l))-Kc),-85.051129,no);return new vr(S,this.southernCenter?-k:k)}}class kS extends ol{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Oo(e),y:Bo(i),z:0}}unproject(e,i){const l=as(e),h=Wn(i);return new vr(l,h)}}const IS=pt(no);class iL extends ol{project(e,i){const l=(i=pt(i))*i,h=l*l;return{x:.5*((e=pt(e))*(.8707-.131979*l+h*(h*(.003971*l-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+l*(.015085+h*(.028874*l-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let l=i=(2*(1-i)-1)*Math.PI,h=25,p=0,g=l*l;do{g=l*l;const S=g*g;p=(l*(1.007226+g*(.015085+S*(.028874*g-.044475-.005916*S)))-i)/(1.007226+g*(.045255+S*(.259866*g-.311325-.005916*11*S))),l=st(l-p,-IS,IS)}while(Math.abs(p)>1e-6&&--h>0);g=l*l;const v=st(Kt(e/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),w=Kt(l);return new vr(v,w)}}const AS=pt(no);class sL extends ol{project(e,i){i=pt(i),e=pt(e);const l=Math.cos(i),h=2/Math.PI,p=Math.acos(l*Math.cos(e/2)),g=Math.sin(p)/p,v=.5*(e*h+2*l*Math.sin(e/2)/g)||0,w=.5*(i+Math.sin(i)/g)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(e,i){let l=e=(2*e-.5)*Math.PI,h=i=(2*(1-i)-1)*Math.PI,p=25;const g=1e-6;let v=0,w=0;do{const S=Math.cos(h),k=Math.sin(h),M=2*k*S,P=k*k,z=S*S,O=Math.cos(l/2),N=Math.sin(l/2),W=2*O*N,Q=N*N,ue=1-z*O*O,ee=ue?1/ue:0,le=ue?Math.acos(S*O)*Math.sqrt(1/ue):0,de=.5*(2*le*S*N+2*l/Math.PI)-e,he=.5*(le*k+h)-i,Re=.5*ee*(z*Q+le*S*O*P)+1/Math.PI,Ie=ee*(W*M/4-le*k*N),je=.125*ee*(M*N-le*k*z*W),Ke=.5*ee*(P*O+le*Q*S)+.5,Oe=Ie*je-Ke*Re;v=(he*Ie-de*Ke)/Oe,w=(de*je-he*Re)/Oe,l=st(l-v,-Math.PI,Math.PI),h=st(h-w,-AS,AS)}while((Math.abs(v)>g||Math.abs(w)>g)&&--p>0);return new vr(Kt(l),Kt(h))}}class MS extends ol{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(pt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:l,cosPhi:h}=this;return{x:pt(e)*h*l+.5,y:-Math.sin(pt(i))/h*l+.5,z:0}}unproject(e,i){const{scale:l,cosPhi:h}=this,p=-(i-.5)/l,g=st(Kt((e-.5)/l)/h,-180,180),v=Math.asin(st(p*h,-1,1)),w=st(Kt(v),-85.051129,no);return new vr(g,w)}}class oL extends kS{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,l){const h=jd(e,i,l);return Jr(h,h,Nd(Do(l))),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,i){const l=Oc(i.lat,i.lng),h=li([],l),p=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;Dd(l,l,h,ro(1,0)*St*p);const g=eo(new Float64Array(16));return _u(g,e.pixelMatrix,e.globeMatrix),Jr(l,l,g),new Ae(l[0],l[1])}pixelsPerMeter(e,i){return ro(1,0)*i}pixelSpaceConversion(e,i,l){const h=ro(1,e)*i,p=tr(ro(1,45)*i,h,l);return this.pixelsPerMeter(e,i)/p}createTileMatrix(e,i,l){const h=Oy(Do(l.canonical));return _u(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,i){const{center:l}=e,h=Nd(Do(i));return cm(h,h,pt(l.lng)),Cy(h,h,pt(l.lat)),yu(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,i,l,h){return iw(e,i,l,!0)||new Fc(0,0)}pointCoordinate3D(e,i,l){const h=this.pointCoordinate(e,i,l,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,i){return!iw(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(h,p){const g=h.cameraToCenterDistance,v=h._centerAltitude*p,w=h._camera,S=h._camera.forward(),k=da([],os([],S,-g),[0,0,v]),M=h.worldSize/(2*Math.PI),P=[0,0,-M],z=h.width/h.height,O=Math.tan(h.fovAboveCenter),N=os([],w.up(),O),W=os([],w.right(),O*z),Q=li([],da([],da([],S,N),W)),ue=[];let ee;if(new My(k,Q).closestPointOnSphere(P,M,ue)){const le=da([],ue,P),de=to([],le,k);ee=Math.cos(h.fovAboveCenter)*Rd(de)}else{const le=to([],k,P),de=to([],P,k);li(de,de);const he=Rd(le)-M;ee=Math.sqrt(he*(he+2*M));const Re=Math.acos(ee/(M+he))-Math.acos(ks(S,de));ee*=Math.cos(Re)}return 1.01*ee}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),l=Bc(e.zoom);if(l>0){const h=CS(e,ro(1,e.center.lat)*e.worldSize),p=e.worldSize/(2*Math.PI),g=Math.max(e.width,e.height)/e.worldSize*Math.PI;return tr(i,h+p*(1-Math.cos(g)),Math.pow(l,10))}return i}upVector(e,i,l){return jd(i,l,e,1)}upVectorScale(e){return{metersToTile:hm(fm(Do(e)))}}}function PS(n){const e=n.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new kS(n);case"equirectangular":return new rL(n);case"naturalEarth":return new iL(n);case"equalEarth":return new tL(n);case"winkelTripel":return new sL(n);case"albers":return i?new MS(n):new eL(n);case"lambertConformalConic":return i?new MS(n):new nL(n);case"globe":return new oL(n)}throw new Error(`Invalid projection name: ${n.name}`)}const aL=Sm.types,lL=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Fm(n,e,i,l,h,p,g,v,w,S,k,M,P){const z=v?Math.min(sl,Math.round(v[0])):0,O=v?Math.min(sl,Math.round(v[1])):0;n.emplaceBack(e,i,Math.round(32*l),Math.round(32*h),p,g,(z<<1)+(w?1:0),O,16*S,16*k,256*M,256*P)}function jm(n,e,i,l,h,p,g){n.emplaceBack(e,i,l,h,p,g)}function Nm(n,e,i,l,h){n.emplaceBack(e,i,l,h),n.emplaceBack(e,i,l,h),n.emplaceBack(e,i,l,h),n.emplaceBack(e,i,l,h)}function uL(n){for(const e of n.sections)if(by(e.text))return!0;return!1}class fv{constructor(e){this.layoutVertexArray=new We,this.indexArray=new yt,this.programConfigurations=e,this.segments=new an,this.dynamicLayoutVertexArray=new Ze,this.opacityVertexArray=new vt,this.placedSymbolArray=new on,this.globeExtVertexArray=new Qe}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,l,h){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,gR.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,yR.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,lL,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,_R.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}mt(fv,"SymbolBuffers");class pv{constructor(e,i,l){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new l,this.segments=new an,this.collisionVertexArray=new Zt,this.collisionVertexArrayExt=new Ht}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,vR.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,xR.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}mt(pv,"CollisionBuffers");class al{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=eo([]),this.placementViewportMatrix=eo([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=rv(this.zoom,i["text-size"]),this.iconSizeData=rv(this.zoom,i["icon-size"]);const l=this.layers[0].layout,h=l.get("symbol-sort-key"),p=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(g=>ls[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new fv(new gu(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new fv(new gu(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ai,this.lineVertexArray=new Pc,this.symbolInstances=new Mr}calculateGlyphDependencies(e,i,l,h,p){for(let g=0;g<e.length;g++)if(i[e.charCodeAt(g)]=!0,h&&p){const v=Yd[e.charAt(g)];v&&(i[v.charCodeAt(0)]=!0)}}populate(e,i,l,h){const p=this.layers[0],g=p.layout,v=this.projection.name==="globe",w=g.get("text-font"),S=g.get("text-field"),k=g.get("icon-image"),M=(S.value.kind!=="constant"||S.value.value instanceof Vn&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),P=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,z=g.get("symbol-sort-key");if(this.features=[],!M&&!P)return;const O=i.iconDependencies,N=i.glyphDependencies,W=i.availableImages,Q=new A(this.zoom);for(const{feature:ue,id:ee,index:le,sourceLayerIndex:de}of e){const he=p._featureFilter.needGeometry,Re=wu(ue,he);if(!p._featureFilter.filter(Q,Re,l))continue;if(he||(Re.geometry=fa(ue,l,h)),v&&ue.type!==1&&l.z<=5){const Oe=Re.geometry,Ge=.98078528056,$e=(He,tt)=>ks(jd(He.x,He.y,l,1),jd(tt.x,tt.y,l,1))<Ge;for(let He=0;He<Oe.length;He++)Oe[He]=vP(Oe[He],$e)}let Ie,je;if(M){const Oe=p.getValueAndResolveTokens("text-field",Re,l,W),Ge=Vn.factory(Oe);uL(Ge)&&(this.hasRTLText=!0),(!this.hasRTLText||x()==="unavailable"||this.hasRTLText&&C.isParsed())&&(Ie=SR(Ge,p,Re))}if(P){const Oe=p.getValueAndResolveTokens("icon-image",Re,l,W);je=Oe instanceof Qn?Oe:Qn.fromString(Oe)}if(!Ie&&!je)continue;const Ke=this.sortFeaturesByKey?z.evaluate(Re,{},l):void 0;if(this.features.push({id:ee,text:Ie,icon:je,index:le,sourceLayerIndex:de,geometry:Re.geometry,properties:ue.properties,type:aL[ue.type],sortKey:Ke}),je&&(O[je.name]=!0),Ie){const Oe=w.evaluate(Re,{},l).join(","),Ge=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ls.vertical)>=0;for(const $e of Ie.sections)if($e.image)O[$e.image.name]=!0;else{const He=Td(Ie.toString()),tt=$e.fontStack||Oe,Fe=N[tt]=N[tt]||{};this.calculateGlyphDependencies($e.text,Fe,Ge,this.allowVerticalPlacement,He)}}}g.get("symbol-placement")==="line"&&(this.features=function(ue){const ee={},le={},de=[];let he=0;function Re(Oe){de.push(ue[Oe]),he++}function Ie(Oe,Ge,$e){const He=le[Oe];return delete le[Oe],le[Ge]=He,de[He].geometry[0].pop(),de[He].geometry[0]=de[He].geometry[0].concat($e[0]),He}function je(Oe,Ge,$e){const He=ee[Ge];return delete ee[Ge],ee[Oe]=He,de[He].geometry[0].shift(),de[He].geometry[0]=$e[0].concat(de[He].geometry[0]),He}function Ke(Oe,Ge,$e){const He=$e?Ge[0][Ge[0].length-1]:Ge[0][0];return`${Oe}:${He.x}:${He.y}`}for(let Oe=0;Oe<ue.length;Oe++){const Ge=ue[Oe],$e=Ge.geometry,He=Ge.text?Ge.text.toString():null;if(!He){Re(Oe);continue}const tt=Ke(He,$e),Fe=Ke(He,$e,!0);if(tt in le&&Fe in ee&&le[tt]!==ee[Fe]){const ut=je(tt,Fe,$e),_t=Ie(tt,Fe,de[ut].geometry);delete ee[tt],delete le[Fe],le[Ke(He,de[_t].geometry,!0)]=_t,de[ut].geometry=null}else tt in le?Ie(tt,Fe,$e):Fe in ee?je(tt,Fe,$e):(Re(Oe),ee[tt]=he-1,le[Fe]=he-1)}return de.filter(Oe=>Oe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ue,ee)=>ue.sortKey-ee.sortKey)}update(e,i,l,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,l,h),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,l,h))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=PS(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const l=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:h,y:p}of i)this.lineVertexArray.emplaceBack(h,p);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,i,l,h,p,g,v,w,S,k,M,P,z,O){const N=e.indexArray,W=e.layoutVertexArray,Q=e.globeExtVertexArray,ue=e.segments.prepareSegment(4*i.length,W,N,this.canOverlap?g.sortKey:void 0),ee=this.glyphOffsetArray.length,le=ue.vertexLength,de=this.allowVerticalPlacement&&v===ls.vertical?Math.PI/2:0,he=g.text&&g.text.sections;for(let Ie=0;Ie<i.length;Ie++){const{tl:je,tr:Ke,bl:Oe,br:Ge,tex:$e,pixelOffsetTL:He,pixelOffsetBR:tt,minFontScaleX:Fe,minFontScaleY:ut,glyphOffset:_t,isSDF:ht,sectionIndex:zt}=i[Ie],rt=ue.vertexLength,xt=_t[1];if(Fm(W,S.x,S.y,je.x,xt+je.y,$e.x,$e.y,l,ht,He.x,He.y,Fe,ut),Fm(W,S.x,S.y,Ke.x,xt+Ke.y,$e.x+$e.w,$e.y,l,ht,tt.x,He.y,Fe,ut),Fm(W,S.x,S.y,Oe.x,xt+Oe.y,$e.x,$e.y+$e.h,l,ht,He.x,tt.y,Fe,ut),Fm(W,S.x,S.y,Ge.x,xt+Ge.y,$e.x+$e.w,$e.y+$e.h,l,ht,tt.x,tt.y,Fe,ut),w){const{x:Dt,y:nr,z:Ot}=w.anchor,[Ct,Ar,Ft]=w.up;jm(Q,Dt,nr,Ot,Ct,Ar,Ft),jm(Q,Dt,nr,Ot,Ct,Ar,Ft),jm(Q,Dt,nr,Ot,Ct,Ar,Ft),jm(Q,Dt,nr,Ot,Ct,Ar,Ft),Nm(e.dynamicLayoutVertexArray,Dt,nr,Ot,de)}else Nm(e.dynamicLayoutVertexArray,S.x,S.y,S.z,de);N.emplaceBack(rt,rt+1,rt+2),N.emplaceBack(rt+1,rt+2,rt+3),ue.vertexLength+=4,ue.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(_t[0]),Ie!==i.length-1&&zt===i[Ie+1].sectionIndex||e.programConfigurations.populatePaintArrays(W.length,g,g.index,{},z,O,he&&he[zt])}const Re=w?w.anchor:S;e.placedSymbolArray.emplaceBack(Re.x,Re.y,Re.z,S.x,S.y,ee,this.glyphOffsetArray.length-ee,le,k,M,S.segment,l?l[0]:0,l?l[1]:0,h[0],h[1],v,0,!1,0,P,0)}_commitLayoutVertex(e,i,l,h,p,g,v){e.emplaceBack(i,l,h,p,g,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(e,i,l,h,p,g,v){const w=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),S=w.vertexLength,k=v.tileAnchorX,M=v.tileAnchorY;for(let z=0;z<4;z++)l.collisionVertexArray.emplaceBack(0,0,0,0);l.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),l.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),l.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),l.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(l.layoutVertexArray,h,p,g,k,M,new Ae(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,p,g,k,M,new Ae(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,p,g,k,M,new Ae(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,h,p,g,k,M,new Ae(e.x1,e.y2)),w.vertexLength+=4;const P=l.indexArray;P.emplaceBack(S,S+1),P.emplaceBack(S+1,S+2),P.emplaceBack(S+2,S+3),P.emplaceBack(S+3,S),w.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,l,h,p,g){for(let v=h;v<p;v++){const w=l.get(v),S=this.getSymbolInstanceTextSize(e,g,i,v);this._addCollisionDebugVertices(w,S,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(e,i,l,h,p,g){for(let v=h;v<p;v++){const w=l.get(v),S=this.getSymbolInstanceIconSize(e,i,g.placedIconSymbolIndex);this._addCollisionDebugVertices(w,S,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,g)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new pv(gt,Yw.members,Cn),this.iconCollisionBox=new pv(gt,Yw.members,Cn);const l=$c(this.iconSizeData,e),h=$c(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const g=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(h,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(h,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(l,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(l,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(e,i,l,h){const p=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:h),g=km(this.textSizeData,e,p)/Dn;return this.tilePixelRatio*g}getSymbolInstanceIconSize(e,i,l){const h=this.icon.placedSymbolArray.get(l),p=km(this.iconSizeData,e,h);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,i,l){e.emplaceBack(i,-l,-l),e.emplaceBack(i,l,-l),e.emplaceBack(i,l,l),e.emplaceBack(i,-l,l)}_updateTextDebugCollisionBoxes(e,i,l,h,p,g){for(let v=h;v<p;v++){const w=l.get(v),S=this.getSymbolInstanceTextSize(e,g,i,v);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,w.padding)}}_updateIconDebugCollisionBoxes(e,i,l,h,p,g){for(let v=h;v<p;v++){const w=l.get(v),S=this.getSymbolInstanceIconSize(e,i,g);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,S,w.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=$c(this.iconSizeData,e),h=$c(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const g=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(h,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(h,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(l,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(l,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,l,h,p,g,v,w,S){const k={};if(i<l){const{x1:M,y1:P,x2:z,y2:O,padding:N,projectedAnchorX:W,projectedAnchorY:Q,projectedAnchorZ:ue,tileAnchorX:ee,tileAnchorY:le,featureIndex:de}=e.get(i);k.textBox={x1:M,y1:P,x2:z,y2:O,padding:N,projectedAnchorX:W,projectedAnchorY:Q,projectedAnchorZ:ue,tileAnchorX:ee,tileAnchorY:le},k.textFeatureIndex=de}if(h<p){const{x1:M,y1:P,x2:z,y2:O,padding:N,projectedAnchorX:W,projectedAnchorY:Q,projectedAnchorZ:ue,tileAnchorX:ee,tileAnchorY:le,featureIndex:de}=e.get(h);k.verticalTextBox={x1:M,y1:P,x2:z,y2:O,padding:N,projectedAnchorX:W,projectedAnchorY:Q,projectedAnchorZ:ue,tileAnchorX:ee,tileAnchorY:le},k.verticalTextFeatureIndex=de}if(g<v){const{x1:M,y1:P,x2:z,y2:O,padding:N,projectedAnchorX:W,projectedAnchorY:Q,projectedAnchorZ:ue,tileAnchorX:ee,tileAnchorY:le,featureIndex:de}=e.get(g);k.iconBox={x1:M,y1:P,x2:z,y2:O,padding:N,projectedAnchorX:W,projectedAnchorY:Q,projectedAnchorZ:ue,tileAnchorX:ee,tileAnchorY:le},k.iconFeatureIndex=de}if(w<S){const{x1:M,y1:P,x2:z,y2:O,padding:N,projectedAnchorX:W,projectedAnchorY:Q,projectedAnchorZ:ue,tileAnchorX:ee,tileAnchorY:le,featureIndex:de}=e.get(w);k.verticalIconBox={x1:M,y1:P,x2:z,y2:O,padding:N,projectedAnchorX:W,projectedAnchorY:Q,projectedAnchorZ:ue,tileAnchorX:ee,tileAnchorY:le},k.verticalIconFeatureIndex=de}return k}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const l=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const l=e.placedSymbolArray.get(i),h=l.vertexStartIndex+4*l.numGlyphs;for(let p=l.vertexStartIndex;p<h;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),l=Math.cos(e),h=[],p=[],g=[];for(let v=0;v<this.symbolInstances.length;++v){g.push(v);const w=this.symbolInstances.get(v);h.push(0|Math.round(i*w.tileAnchorX+l*w.tileAnchorY)),p.push(w.featureIndex)}return g.sort((v,w)=>h[v]-h[w]||p[w]-p[v]),g}addToSortKeyRanges(e,i){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===i?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const l=this.symbolInstances.get(i);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:S}=l;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&p!==h&&this.addIndicesForPlacedSymbol(this.text,p),g>=0&&g!==p&&g!==h&&this.addIndicesForPlacedSymbol(this.text,g),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}mt(al,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),al.MAX_GLYPHS=65535,al.addDynamicAttributes=Nm;const cL=new oe({"symbol-placement":new F(Be.layout_symbol["symbol-placement"]),"symbol-spacing":new F(Be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new F(Be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new H(Be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new F(Be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new F(Be.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new F(Be.layout_symbol["icon-ignore-placement"]),"icon-optional":new F(Be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new F(Be.layout_symbol["icon-rotation-alignment"]),"icon-size":new H(Be.layout_symbol["icon-size"]),"icon-text-fit":new F(Be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new F(Be.layout_symbol["icon-text-fit-padding"]),"icon-image":new H(Be.layout_symbol["icon-image"]),"icon-rotate":new H(Be.layout_symbol["icon-rotate"]),"icon-padding":new F(Be.layout_symbol["icon-padding"]),"icon-keep-upright":new F(Be.layout_symbol["icon-keep-upright"]),"icon-offset":new H(Be.layout_symbol["icon-offset"]),"icon-anchor":new H(Be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new F(Be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new F(Be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new F(Be.layout_symbol["text-rotation-alignment"]),"text-field":new H(Be.layout_symbol["text-field"]),"text-font":new H(Be.layout_symbol["text-font"]),"text-size":new H(Be.layout_symbol["text-size"]),"text-max-width":new H(Be.layout_symbol["text-max-width"]),"text-line-height":new H(Be.layout_symbol["text-line-height"]),"text-letter-spacing":new H(Be.layout_symbol["text-letter-spacing"]),"text-justify":new H(Be.layout_symbol["text-justify"]),"text-radial-offset":new H(Be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new F(Be.layout_symbol["text-variable-anchor"]),"text-anchor":new H(Be.layout_symbol["text-anchor"]),"text-max-angle":new F(Be.layout_symbol["text-max-angle"]),"text-writing-mode":new F(Be.layout_symbol["text-writing-mode"]),"text-rotate":new H(Be.layout_symbol["text-rotate"]),"text-padding":new F(Be.layout_symbol["text-padding"]),"text-keep-upright":new F(Be.layout_symbol["text-keep-upright"]),"text-transform":new H(Be.layout_symbol["text-transform"]),"text-offset":new H(Be.layout_symbol["text-offset"]),"text-allow-overlap":new F(Be.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new F(Be.layout_symbol["text-ignore-placement"]),"text-optional":new F(Be.layout_symbol["text-optional"])});var mv={paint:new oe({"icon-opacity":new H(Be.paint_symbol["icon-opacity"]),"icon-color":new H(Be.paint_symbol["icon-color"]),"icon-halo-color":new H(Be.paint_symbol["icon-halo-color"]),"icon-halo-width":new H(Be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new H(Be.paint_symbol["icon-halo-blur"]),"icon-translate":new F(Be.paint_symbol["icon-translate"]),"icon-translate-anchor":new F(Be.paint_symbol["icon-translate-anchor"]),"text-opacity":new H(Be.paint_symbol["text-opacity"]),"text-color":new H(Be.paint_symbol["text-color"],{runtimeType:Nn,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new H(Be.paint_symbol["text-halo-color"]),"text-halo-width":new H(Be.paint_symbol["text-halo-width"]),"text-halo-blur":new H(Be.paint_symbol["text-halo-blur"]),"text-translate":new F(Be.paint_symbol["text-translate"]),"text-translate-anchor":new F(Be.paint_symbol["text-translate-anchor"])}),layout:cL};class RS{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:$s,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}mt(RS,"FormatSectionOverride",{omit:["defaultValue"]});class Um extends Qs{constructor(e){super(e,mv)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const h=[];for(const p of l)h.indexOf(p)<0&&h.push(p);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,l,h){const p=this.layout.get(e).evaluate(i,{},l,h),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||Xa(g.value)||!p?p:function(v,w){return w.replace(/{([^{}]+)}/g,(S,k)=>k in v?String(v[k]):"")}(i.properties,p)}createBucket(e){return new al(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of mv.paint.overridableProperties){if(!Um.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),l=new RS(i),h=new Sc(l,i.property.specification);let p=null;p=i.value.kind==="constant"||i.value.kind==="source"?new fd("source",h):new au("composite",h,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new K(i.property,p,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,l){return!(!this.layout||i.isDataDriven()||l.isDataDriven())&&Um.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const l=e.get("text-field"),h=mv.paint.properties[i];let p=!1;const g=v=>{for(const w of v)if(h.overrides&&h.overrides.hasOverride(w))return void(p=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Vn)g(l.value.value.sections);else if(l.value.kind==="source"){const v=S=>{p||(S instanceof ta&&Lr(S.value)===To?g(S.value.sections):S instanceof Po?g(S.sections):S.eachChild(v))},w=l.value;w._styleExpression&&v(w._styleExpression.expression)}return p}getProgramConfiguration(e){return new rl(this,e)}}var hL={paint:new oe({"background-color":new F(Be.paint_background["background-color"]),"background-pattern":new F(Be.paint_background["background-pattern"]),"background-opacity":new F(Be.paint_background["background-opacity"])})},dL={paint:new oe({"raster-opacity":new F(Be.paint_raster["raster-opacity"]),"raster-hue-rotate":new F(Be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new F(Be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new F(Be.paint_raster["raster-brightness-max"]),"raster-saturation":new F(Be.paint_raster["raster-saturation"]),"raster-contrast":new F(Be.paint_raster["raster-contrast"]),"raster-resampling":new F(Be.paint_raster["raster-resampling"]),"raster-fade-duration":new F(Be.paint_raster["raster-fade-duration"])})};class fL extends Qs{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var pL={paint:new oe({"sky-type":new F(Be.paint_sky["sky-type"]),"sky-atmosphere-sun":new F(Be.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new F(Be.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new F(Be.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new F(Be.paint_sky["sky-gradient-radius"]),"sky-gradient":new ne(Be.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new F(Be.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new F(Be.paint_sky["sky-atmosphere-color"]),"sky-opacity":new F(Be.paint_sky["sky-opacity"])})};function gv(n,e,i){const l=[0,0,1],h=Jb([]);return ew(h,h,i?-pt(n)+Math.PI:pt(n)),Qb(h,h,-pt(e)),Zb(l,l,h),li(l,l)}const mL={circle:class extends Qs{constructor(n){super(n,CP)}createBucket(n){return new Vy(n)}queryRadius(n){const e=n;return jc("circle-radius",this,e)+jc("circle-stroke-width",this,e)+gm(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,l,h,p,g,v){const w=ww(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Sw(n,l,p,g,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,S)}getProgramIds(){return["circle"]}getProgramConfiguration(n){return new rl(this,n)}},heatmap:class extends Qs{createBucket(n){return new Ew(n)}constructor(n){super(n,MP),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=qy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return jc("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,l,h,p,g,v){const w=this.paint.get("heatmap-radius").evaluate(e,i);return Sw(n,l,p,g,v,!0,!0,new Ae(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(n){return new rl(this,n)}},hillshade:class extends Qs{constructor(n){super(n,PP)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Qs{constructor(n){super(n,qP)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(n){return new rl(this,n)}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new bm(n)}queryRadius(){return gm(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,l,h,p){return!n.queryGeometry.isAboveHorizon&&_w(bw(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}},"fill-extrusion":class extends Qs{constructor(n){super(n,lR)}createBucket(n){return new Zd(n)}queryRadius(){return gm(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(n){return new rl(this,n)}queryIntersectsFeature(n,e,i,l,h,p,g,v,w){const S=ww(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),k=this.paint.get("fill-extrusion-height").evaluate(e,i),M=this.paint.get("fill-extrusion-base").evaluate(e,i),P=[0,0],z=v&&p.elevation,O=p.elevation?p.elevation.exaggeration():1,N=n.tile.getBucket(this);if(z&&N instanceof Zd){const le=N.centroidVertexArray,de=w+1;de<le.length&&(P[0]=le.geta_centroid_pos0(de),P[1]=le.geta_centroid_pos1(de))}if(P[0]===0&&P[1]===1)return!1;p.projection.name==="globe"&&(l=$w([l],[new Ae(0,0),new Ae(St,St)],n.tileID.canonical).map(le=>le.polygon).flat());const W=z?v:null,[Q,ue]=function(le,de,he,Re,Ie,je,Ke,Oe,Ge,$e,He){return le.projection.name==="globe"?function(tt,Fe,ut,_t,ht,zt,rt,xt,Dt,nr,Ot){const Ct=[],Ar=[],Ft=tt.projection.upVectorScale(Ot,tt.center.lat,tt.worldSize).metersToTile,jt=[0,0,0,1],xr=[0,0,0,1],Cr=(br,Br,Hr,un)=>{br[0]=Br,br[1]=Hr,br[2]=un,br[3]=1},kr=Vw();ut>0&&(ut+=kr),_t+=kr;for(const br of Fe){const Br=[],Hr=[];for(const un of br){const wr=un.x+ht.x,_n=un.y+ht.y,cn=tt.projection.projectTilePoint(wr,_n,Ot),$r=tt.projection.upVector(Ot,un.x,un.y);let sr=ut,hn=_t;if(rt){const Ir=Hw(wr,_n,ut,_t,rt,xt,Dt,nr);sr+=Ir.base,hn+=Ir.top}ut!==0?Cr(jt,cn.x+$r[0]*Ft*sr,cn.y+$r[1]*Ft*sr,cn.z+$r[2]*Ft*sr):Cr(jt,cn.x,cn.y,cn.z),Cr(xr,cn.x+$r[0]*Ft*hn,cn.y+$r[1]*Ft*hn,cn.z+$r[2]*Ft*hn),Jr(jt,jt,zt),Jr(xr,xr,zt),Br.push(new Vc(jt[0],jt[1],jt[2])),Hr.push(new Vc(xr[0],xr[1],xr[2]))}Ct.push(Br),Ar.push(Hr)}return[Ct,Ar]}(le,de,he,Re,Ie,je,Ke,Oe,Ge,$e,He):Ke?function(tt,Fe,ut,_t,ht,zt,rt,xt,Dt){const nr=[],Ot=[],Ct=[0,0,0,1];for(const Ar of tt){const Ft=[],jt=[];for(const xr of Ar){const Cr=xr.x+_t.x,kr=xr.y+_t.y,br=Hw(Cr,kr,Fe,ut,zt,rt,xt,Dt);Ct[0]=Cr,Ct[1]=kr,Ct[2]=br.base,Ct[3]=1,vu(Ct,Ct,ht),Ct[3]=Math.max(Ct[3],1e-5);const Br=new Vc(Ct[0]/Ct[3],Ct[1]/Ct[3],Ct[2]/Ct[3]);Ct[0]=Cr,Ct[1]=kr,Ct[2]=br.top,Ct[3]=1,vu(Ct,Ct,ht),Ct[3]=Math.max(Ct[3],1e-5);const Hr=new Vc(Ct[0]/Ct[3],Ct[1]/Ct[3],Ct[2]/Ct[3]);Ft.push(Br),jt.push(Hr)}nr.push(Ft),Ot.push(jt)}return[nr,Ot]}(de,he,Re,Ie,je,Ke,Oe,Ge,$e):function(tt,Fe,ut,_t,ht){const zt=[],rt=[],xt=ht[8]*Fe,Dt=ht[9]*Fe,nr=ht[10]*Fe,Ot=ht[11]*Fe,Ct=ht[8]*ut,Ar=ht[9]*ut,Ft=ht[10]*ut,jt=ht[11]*ut;for(const xr of tt){const Cr=[],kr=[];for(const br of xr){const Br=br.x+_t.x,Hr=br.y+_t.y,un=ht[0]*Br+ht[4]*Hr+ht[12],wr=ht[1]*Br+ht[5]*Hr+ht[13],_n=ht[2]*Br+ht[6]*Hr+ht[14],cn=ht[3]*Br+ht[7]*Hr+ht[15],$r=un+xt,sr=wr+Dt,hn=_n+nr,Ir=Math.max(cn+Ot,1e-5),hi=un+Ct,dn=wr+Ar,On=_n+Ft,kn=Math.max(cn+jt,1e-5);Cr.push(new Vc($r/Ir,sr/Ir,hn/Ir)),kr.push(new Vc(hi/kn,dn/kn,On/kn))}zt.push(Cr),rt.push(kr)}return[zt,rt]}(de,he,Re,Ie,je)}(p,l,M,k,S,g,W,P,O,p.center.lat,n.tileID.canonical),ee=n.queryGeometry;return function(le,de,he){let Re=1/0;_w(he,de)&&(Re=qw(he,de[0]));for(let Ie=0;Ie<de.length;Ie++){const je=de[Ie],Ke=le[Ie];for(let Oe=0;Oe<je.length-1;Oe++){const Ge=je[Oe],$e=[Ge,je[Oe+1],Ke[Oe+1],Ke[Oe],Ge];gw(he,$e)&&(Re=Math.min(Re,qw(he,$e)))}}return Re!==1/0&&Re}(Q,ue,ee.isPointQuery()?ee.screenBounds:ee.screenGeometry)}},line:class extends Qs{constructor(n){super(n,Zw),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof ed,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=Xw.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new Cm(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(n){return new rl(this,n)}queryRadius(n){const e=n,i=Kw(jc("line-width",this,e),jc("line-gap-width",this,e)),l=jc("line-offset",this,e);return i/2+Math.abs(l)+gm(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,l,h,p){if(n.queryGeometry.isAboveHorizon)return!1;const g=bw(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),v=n.pixelToTileUnitsFactor/2*Kw(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),w=this.paint.get("line-offset").evaluate(e,i);return w&&(l=function(S,k){const M=[],P=new Ae(0,0);for(let z=0;z<S.length;z++){const O=S[z],N=[];for(let W=0;W<O.length;W++){const Q=O[W],ue=O[W+1],ee=W===0?P:Q.sub(O[W-1])._unit()._perp(),le=W===O.length-1?P:ue.sub(Q)._unit()._perp(),de=ee._add(le)._unit();de._mult(1/(de.x*le.x+de.y*le.y)),N.push(de._mult(k)._add(Q))}M.push(N)}return M}(l,w*n.pixelToTileUnitsFactor)),function(S,k,M){for(let P=0;P<k.length;P++){const z=k[P];if(S.length>=3){for(let O=0;O<z.length;O++)if(Su(S,z[O]))return!0}if(wP(S,z,M))return!0}return!1}(g,l,v)}isTileClipped(){return!0}},symbol:Um,background:class extends Qs{constructor(n){super(n,hL)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Qs{constructor(n){super(n,dL)}getProgramIds(){return["raster"]}},sky:class extends Qs{constructor(n){super(n,pL),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=qy({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const l=this.paint.get("sky-atmosphere-sun"),h=!l,p=n.style.light,g=p.properties.get("position");return h&&p.properties.get("anchor")==="viewport"&&fr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?gv(g.azimuthal,90-g.polar,e):gv(l[0],90-l[1],e)}const i=this.paint.get("sky-gradient-center");return gv(i[0],90-i[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}}};class of{constructor(e,i,l,h){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(i,h)}update(e,i,l){const{width:h,height:p}=e,{context:g}=this,{gl:v}=g,{HTMLImageElement:w,HTMLCanvasElement:S,HTMLVideoElement:k,ImageData:M,ImageBitmap:P}=I;if(v.bindTexture(v.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!i||i.premultiply!==!1)),l||this.size&&this.size[0]===h&&this.size[1]===p){const{x:z,y:O}=l||{x:0,y:0};e instanceof w||e instanceof S||e instanceof k||e instanceof M||P&&e instanceof P?v.texSubImage2D(v.TEXTURE_2D,0,z,O,v.RGBA,v.UNSIGNED_BYTE,e):v.texSubImage2D(v.TEXTURE_2D,0,z,O,h,p,v.RGBA,v.UNSIGNED_BYTE,e.data)}else this.size=[h,p],e instanceof w||e instanceof S||e instanceof k||e instanceof M||P&&e instanceof P?v.texImage2D(v.TEXTURE_2D,0,this.format,this.format,v.UNSIGNED_BYTE,e):v.texImage2D(v.TEXTURE_2D,0,this.format,h,p,0,this.format,v.UNSIGNED_BYTE,e.data);this.useMipmap=!!(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(e,i){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class gL{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class _L{constructor(){this.tasks={},this.taskQueue=[],Yn(["process"],this),this.invoker=new gL(this.process),this.nextId=0}add(e,i){const l=this.nextId++,h=function({type:p,isSymbolTile:g,zoom:v}){return v=v||0,p==="message"?0:p!=="maybePrepare"||g?p!=="parseTile"||g?p==="parseTile"&&g?300-v:p==="maybePrepare"&&g?400-v:500:200-v:100-v}(i);if(h===0){Ur();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[l]={fn:e,metadata:i,priority:h,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){Ur();try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let h=0;h<this.taskQueue.length;h++){const p=this.tasks[this.taskQueue[h]];p.priority<i&&(i=p.priority,e=h)}if(e===null)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}class LS{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const l=e[i];this._stringToNumber[l]=i,this._numberToString[i]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const yL=["tile","layer","source","sourceLayer","state"];class zS{constructor(e,i,l,h,p){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=l,this._y=h,this.properties=e.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const i of yL)this[i]!==void 0&&(e[i]=this[i]);return e}}const Ms=32,Fo=33,ll=new Uint16Array(8184);for(let n=0;n<2046;n++){let e=n+2,i=0,l=0,h=0,p=0,g=0,v=0;for(1&e?h=p=g=Ms:i=l=v=Ms;(e>>=1)>1;){const S=i+h>>1,k=l+p>>1;1&e?(h=i,p=l,i=g,l=v):(i=h,l=p,h=g,p=v),g=S,v=k}const w=4*n;ll[w+0]=i,ll[w+1]=l,ll[w+2]=h,ll[w+3]=p}const jo=new Uint16Array(2178),ul=new Uint8Array(1089),Vm=new Uint16Array(1089);function DS(n){return n===0?-.03125:n===32?.03125:0}var OS=xe([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const BS={type:2,extent:St,loadGeometry:()=>[[new Ae(0,0),new Ae(St+1,0),new Ae(St+1,St+1),new Ae(0,St+1),new Ae(0,0)]]};class _v{constructor(e,i,l,h,p){this.tileID=e,this.uid=jr(),this.uses=0,this.tileSize=i,this.tileZoom=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<Li.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Eu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,l){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(h,p){const g={};if(!p)return g;for(const v of h){const w=v.layerIds.map(S=>p.getLayer(S)).filter(Boolean);if(w.length!==0){v.layers=w,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(S=>w.filter(k=>k.id===S)[0]));for(const S of w)g[S.id]=v}}return g}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const p=this.buckets[h];if(p instanceof al){if(this.hasSymbolBuckets=!0,!l)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const p=this.buckets[h];if(p instanceof al&&p.hasRTLText){this.hasRTLText=!0,C.isLoading()||C.isLoaded()||x()!=="deferred"||E();break}}this.queryPadding=0;for(const h in this.buckets){const p=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(h).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new yr}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new of(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new of(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new of(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,l,h,p,g,v,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:v,transform:g,params:p,tileTransform:this.tileTransform},e,i,l):{}}querySourceFeatures(e,i){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),p=i?i.sourceLayer:"",g=h._geojsonTileLayer||h[p];if(!g)return;const v=kc(i&&i.filter),{z:w,x:S,y:k}=this.tileID.canonical,M={z:w,x:S,y:k};for(let P=0;P<g.length;P++){const z=g.feature(P);if(v.needGeometry){const W=wu(z,!0);if(!v.filter(new A(this.tileID.overscaledZ),W,this.tileID.canonical))continue}else if(!v.filter(new A(this.tileID.overscaledZ),z))continue;const O=l.getId(z,p),N=new zS(z,w,S,k,O);N.tile=M,e.push(N)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const l=rn(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(i)if(this.expirationTime<i)h=!0;else{const p=this.expirationTime-i;p?this.expirationTime=l+Math.max(p,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!i)return;const l=this.latestFeatureIndex.loadVTLayers(),h=i.style.listImages();for(const p in this.buckets){if(!i.style.hasLayer(p))continue;const g=this.buckets[p],v=g.layers[0].sourceLayer||"_geojsonTileLayer",w=l[v],S=e[v];if(!w||!S||Object.keys(S).length===0)continue;if(g.update(S,w,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),g instanceof Cm||g instanceof bm){const M=i.style._getSourceCache(g.layers[0].source);i._terrain&&i._terrain.enabled&&M&&g.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(M.id,this.tileID)}const k=i&&i.style&&i.style.getLayer(p);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Li.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Li.now()+e}setTexture(e,i){const l=i.context,h=l.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new of(l,e,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE))}setDependencies(e,i){const l={};for(const h of i)l[h]=!0;this.dependencies[e]=l}hasDependency(e,i){for(const l of e){const h=this.dependencies[l];if(h){for(const p of i)if(h[p])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const l=fa(BS,this.tileID.canonical,this.tileTransform)[0],h=new Xe,p=new ji;for(let g=0;g<l.length;g++){const{x:v,y:w}=l[g];h.emplaceBack(v,w),p.emplaceBack(g)}p.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(p),this._tileDebugBuffer=e.createVertexBuffer(h,Bd.members),this._tileDebugSegments=an.simpleSegment(0,0,h.length,p.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const l=fa(BS,this.tileID.canonical,this.tileTransform)[0];let h,p;if(this.isRaster){const g=function(v,w){const S=Eu(v,w),k=Math.pow(2,v.z);for(let W=0;W<Fo;W++)for(let Q=0;Q<Fo;Q++){const ue=as((v.x+(Q+DS(Q))/Ms)/k),ee=Wn((v.y+(W+DS(W))/Ms)/k),le=w.project(ue,ee),de=W*Fo+Q;jo[2*de+0]=Math.round((le.x*S.scale-S.x)*St),jo[2*de+1]=Math.round((le.y*S.scale-S.y)*St)}ul.fill(0),Vm.fill(0);for(let W=2045;W>=0;W--){const Q=4*W,ue=ll[Q+0],ee=ll[Q+1],le=ll[Q+2],de=ll[Q+3],he=ue+le>>1,Re=ee+de>>1,Ie=he+Re-ee,je=Re+ue-he,Ke=ee*Fo+ue,Oe=de*Fo+le,Ge=Re*Fo+he,$e=Math.hypot((jo[2*Ke+0]+jo[2*Oe+0])/2-jo[2*Ge+0],(jo[2*Ke+1]+jo[2*Oe+1])/2-jo[2*Ge+1])>=16;ul[Ge]=ul[Ge]||($e?1:0),W<1022&&(ul[Ge]=ul[Ge]||ul[(ee+je>>1)*Fo+(ue+Ie>>1)]||ul[(de+je>>1)*Fo+(le+Ie>>1)])}const M=new Ve,P=new yt;let z=0;function O(W,Q){const ue=Q*Fo+W;return Vm[ue]===0&&(M.emplaceBack(jo[2*ue+0],jo[2*ue+1],W*St/Ms,Q*St/Ms),Vm[ue]=++z),Vm[ue]-1}function N(W,Q,ue,ee,le,de){const he=W+ue>>1,Re=Q+ee>>1;if(Math.abs(W-le)+Math.abs(Q-de)>1&&ul[Re*Fo+he])N(le,de,W,Q,he,Re),N(ue,ee,le,de,he,Re);else{const Ie=O(W,Q),je=O(ue,ee),Ke=O(le,de);P.emplaceBack(Ie,je,Ke)}}return N(0,0,Ms,Ms,Ms,0),N(Ms,Ms,0,0,0,Ms),{vertices:M,indices:P}}(this.tileID.canonical,i);h=g.vertices,p=g.indices}else{h=new Ve,p=new yt;for(const{x:v,y:w}of l)h.emplaceBack(v,w,0,0);const g=Yy(h.int16,void 0,4);for(let v=0;v<g.length;v+=3)p.emplaceBack(g[v],g[v+1],g[v+2])}this._tileBoundsBuffer=e.createVertexBuffer(h,OS.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(p),this._tileBoundsSegments=an.simpleSegment(0,0,h.length,p.length)}_makeGlobeTileDebugBuffers(e,i){const l=i.projection;if(!l||l.name!=="globe"||i.freezeTileCoverage)return;const h=this.tileID.canonical,p=Nd(sw(h,i)),g=Bc(i.zoom);let v;g>0&&(v=Ey(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,h,i,p,v,g),this._makeGlobeTileDebugTextBuffer(e,h,i,p,v,g)}_globePoint(e,i,l,h,p,g,v){let w=jd(e,i,l);if(g){const S=1<<l.z,k=Oo(h.center.lng),M=Bo(h.center.lat),P=(l.x+.5)/S-k;let z=0;P>.5?z=-1:P<-.5&&(z=1);let O=(e/St+l.x)/S+z,N=(i/St+l.y)/S;O=(O-k)*h._pixelsPerMercatorPixel+k,N=(N-M)*h._pixelsPerMercatorPixel+M;const W=[O*h.worldSize,N*h.worldSize,0];Jr(W,W,g),w=bu(w,W,v)}return Jr(w,w,p)}_makeGlobeTileDebugBorderBuffer(e,i,l,h,p,g){const v=new Xe,w=new ji,S=new ke,k=(P,z,O,N,W)=>{const Q=(O-P)/(W-1),ue=(N-z)/(W-1),ee=v.length;for(let le=0;le<W;le++){const de=P+le*Q,he=z+le*ue;v.emplaceBack(de,he);const Re=this._globePoint(de,he,i,l,h,p,g);S.emplaceBack(Re[0],Re[1],Re[2]),w.emplaceBack(ee+le)}},M=St;k(0,0,M,0,16),k(M,0,M,M,16),k(M,M,0,M,16),k(0,M,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(w),this._tileDebugBuffer=e.createVertexBuffer(v,Bd.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(S,rw.members),this._tileDebugSegments=an.simpleSegment(0,0,v.length,w.length)}_makeGlobeTileDebugTextBuffer(e,i,l,h,p,g){const v=St/4,w=new Xe,S=new yt,k=new ke,M=25;S.reserve(32),w.reserve(M),k.reserve(M);const P=(z,O)=>M*z+O;for(let z=0;z<M;z++){const O=z*v;for(let N=0;N<M;N++){const W=N*v;w.emplaceBack(W,O);const Q=this._globePoint(W,O,i,l,h,p,g);k.emplaceBack(Q[0],Q[1],Q[2])}}for(let z=0;z<4;z++)for(let O=0;O<4;O++){const N=P(z,O),W=P(z,O+1),Q=P(z+1,O),ue=P(z+1,O+1);S.emplaceBack(N,W,Q),S.emplaceBack(Q,W,ue)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(S),this._tileDebugTextBuffer=e.createVertexBuffer(w,Bd.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(k,rw.members),this._tileDebugTextSegments=an.simpleSegment(0,0,M,32)}}class vL{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,l){const h=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][h]=this.stateChanges[e][h]||{},Yt(this.stateChanges[e][h],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const p in this.state[e])p!==h&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][h]===null){this.deletedStates[e][h]={};for(const p in this.state[e][h])l[p]||(this.deletedStates[e][h][p]=null)}else for(const p in l)this.deletedStates[e]&&this.deletedStates[e][h]&&this.deletedStates[e][h][p]===null&&delete this.deletedStates[e][h][p]}removeFeatureState(e,i,l){if(this.deletedStates[e]===null)return;const h=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&i!==void 0)this.deletedStates[e][h]!==null&&(this.deletedStates[e][h]=this.deletedStates[e][h]||{},this.deletedStates[e][h][l]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][h])for(l in this.deletedStates[e][h]={},this.stateChanges[e][h])this.deletedStates[e][h][l]=null;else this.deletedStates[e][h]=null;else this.deletedStates[e]=null}getState(e,i){const l=String(i),h=Yt({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const p=this.deletedStates[e][i];if(p===null)return{};for(const g in p)delete h[g]}return h}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const p={};for(const g in this.stateChanges[h])this.state[h][g]||(this.state[h][g]={}),Yt(this.state[h][g],this.stateChanges[h][g]),p[g]=this.state[h][g];l[h]=p}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const p={};if(this.deletedStates[h]===null)for(const g in this.state[h])p[g]={},this.state[h][g]={};else for(const g in this.deletedStates[h]){if(this.deletedStates[h][g]===null)this.state[h][g]={};else if(this.state[h][g])for(const v of Object.keys(this.deletedStates[h][g]))delete this.state[h][g][v];p[g]=this.state[h][g]}l[h]=l[h]||{},Yt(l[h],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const h in e)e[h].setFeatureState(l,i)}}class FS{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const l=this.toIdx(e,i);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function jS(n,e,i,l){let h=0,p=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(l[g])<1e-15){if(i[g]<n[g]||i[g]>e[g])return null}else{const v=1/l[g];let w=(n[g]-i[g])*v,S=(e[g]-i[g])*v;if(w>S){const k=w;w=S,S=k}if(w>h&&(h=w),S<p&&(p=S),h>p)return null}return h}function NS(n,e,i,l,h,p,g,v,w,S,k){const M=l-n,P=h-e,z=p-i,O=g-n,N=v-e,W=w-i,Q=k[1]*W-k[2]*N,ue=k[2]*O-k[0]*W,ee=k[0]*N-k[1]*O,le=M*Q+P*ue+z*ee;if(Math.abs(le)<1e-15)return null;const de=1/le,he=S[0]-n,Re=S[1]-e,Ie=S[2]-i,je=(he*Q+Re*ue+Ie*ee)*de;if(je<0||je>1)return null;const Ke=Re*z-Ie*P,Oe=Ie*M-he*z,Ge=he*P-Re*M,$e=(k[0]*Ke+k[1]*Oe+k[2]*Ge)*de;return $e<0||je+$e>1?null:(O*Ke+N*Oe+W*Ge)*de}function US(n,e,i){return(n-e)/(i-e)}function VS(n,e,i,l,h,p,g,v,w){const S=1<<i,k=p-l,M=g-h,P=(n+1)/S*k+l,z=(e+0)/S*M+h,O=(e+1)/S*M+h;v[0]=(n+0)/S*k+l,v[1]=z,w[0]=P,w[1]=O}class $S{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(p){const g=Math.ceil(Math.log2(p.dim/8)),v=[];let w=Math.ceil(Math.pow(2,g));const S=1/w,k=(z,O,N,W,Q)=>{const ue=W?1:0,ee=(z+1)*N-ue,le=O*N,de=(O+1)*N-ue;Q[0]=z*N,Q[1]=le,Q[2]=ee,Q[3]=de};let M=new FS(w);const P=[];for(let z=0;z<w*w;z++){k(z%w,Math.floor(z/w),S,!1,P);const O=cl(P[0],P[1],p),N=cl(P[2],P[1],p),W=cl(P[2],P[3],p),Q=cl(P[0],P[3],p);M.minimums.push(Math.min(O,N,W,Q)),M.maximums.push(Math.max(O,N,W,Q)),M.leaves.push(1)}for(v.push(M),w/=2;w>=1;w/=2){const z=v[v.length-1];M=new FS(w);for(let O=0;O<w*w;O++){k(O%w,Math.floor(O/w),2,!0,P);const N=z.getElevation(P[0],P[1]),W=z.getElevation(P[2],P[1]),Q=z.getElevation(P[2],P[3]),ue=z.getElevation(P[0],P[3]),ee=z.isLeaf(P[0],P[1]),le=z.isLeaf(P[2],P[1]),de=z.isLeaf(P[2],P[3]),he=z.isLeaf(P[0],P[3]),Re=Math.min(N.min,W.min,Q.min,ue.min),Ie=Math.max(N.max,W.max,Q.max,ue.max),je=ee&&le&&de&&he;M.maximums.push(Ie),M.minimums.push(Re),M.leaves.push(Ie-Re<=5&&je?1:0)}v.push(M)}return v}(this.dem),l=i.length-1,h=i[l];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(i,0,0,l,0)}raycastRoot(e,i,l,h,p,g,v=1){return jS([e,i,-100],[l,h,this.maximums[0]*v],p,g)}raycast(e,i,l,h,p,g,v=1){if(!this.nodeCount)return null;const w=this.raycastRoot(e,i,l,h,p,g,v);if(w==null)return null;const S=[],k=[],M=[],P=[],z=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;z.length>0;){const{idx:O,t:N,nodex:W,nodey:Q,depth:ue}=z.pop();if(this.leaves[O]){VS(W,Q,ue,e,i,l,h,M,P);const le=1<<ue,de=(W+0)/le,he=(W+1)/le,Re=(Q+0)/le,Ie=(Q+1)/le,je=cl(de,Re,this.dem)*v,Ke=cl(he,Re,this.dem)*v,Oe=cl(he,Ie,this.dem)*v,Ge=cl(de,Ie,this.dem)*v,$e=NS(M[0],M[1],je,P[0],M[1],Ke,P[0],P[1],Oe,p,g),He=NS(P[0],P[1],Oe,M[0],P[1],Ge,M[0],M[1],je,p,g),tt=Math.min($e!==null?$e:Number.MAX_VALUE,He!==null?He:Number.MAX_VALUE);if(tt!==Number.MAX_VALUE)return tt;{const Fe=Dd([],p,g,N);if(GS(je,Ke,Ge,Oe,US(Fe[0],M[0],P[0]),US(Fe[1],M[1],P[1]))>=Fe[2])return N}continue}let ee=0;for(let le=0;le<this._siblingOffset.length;le++){VS((W<<1)+this._siblingOffset[le][0],(Q<<1)+this._siblingOffset[le][1],ue+1,e,i,l,h,M,P),M[2]=-100,P[2]=this.maximums[this.childOffsets[O]+le]*v;const de=jS(M,P,p,g);if(de!=null){const he=de;S[le]=he;let Re=!1;for(let Ie=0;Ie<ee&&!Re;Ie++)he>=S[k[Ie]]&&(k.splice(Ie,0,le),Re=!0);Re||(k[ee]=le),ee++}}for(let le=0;le<ee;le++){const de=k[le];z.push({idx:this.childOffsets[O]+de,t:S[de],nodex:(W<<1)+this._siblingOffset[de][0],nodey:(Q<<1)+this._siblingOffset[de][1],depth:ue+1})}}return null}_addNode(e,i,l){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,l,h,p){if(e[h].isLeaf(i,l)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const g=h-1,v=e[g];let w=0,S=0;for(let k=0;k<this._siblingOffset.length;k++){const M=2*i+this._siblingOffset[k][0],P=2*l+this._siblingOffset[k][1],z=v.getElevation(M,P),O=v.isLeaf(M,P),N=this._addNode(z.min,z.max,O);O&&(w|=1<<k),S||(S=N)}for(let k=0;k<this._siblingOffset.length;k++)w&1<<k||this._construct(e,2*i+this._siblingOffset[k][0],2*l+this._siblingOffset[k][1],g,S+k)}}function GS(n,e,i,l,h,p){return tr(tr(n,i,p),tr(e,l,p),h)}function cl(n,e,i){const l=i.dim,h=st(n*l-.5,0,l-1),p=st(e*l-.5,0,l-1),g=Math.floor(h),v=Math.floor(p),w=Math.min(g+1,l-1),S=Math.min(v+1,l-1);return GS(i.get(g,v),i.get(w,v),i.get(g,S),i.get(w,S),h-g,p-v)}const WS={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function xL(n,e,i){return(256*n*256+256*e+i)/10-1e4}function bL(n,e,i){return 256*n+e+i/256-32768}class $m{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,l,h=!1,p=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return fr(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const g=this.dim=i.height-2,v=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=l||"mapbox",this.borderReady=h,!h){for(let w=0;w<g;w++)v[this._idx(-1,w)]=v[this._idx(0,w)],v[this._idx(g,w)]=v[this._idx(g-1,w)],v[this._idx(w,-1)]=v[this._idx(w,0)],v[this._idx(w,g)]=v[this._idx(w,g-1)];v[this._idx(-1,-1)]=v[this._idx(0,0)],v[this._idx(g,-1)]=v[this._idx(g-1,0)],v[this._idx(-1,g)]=v[this._idx(0,g-1)],v[this._idx(g,g)]=v[this._idx(g-1,g-1)],p&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new $S(this)}get(e,i,l=!1){l&&(e=st(e,-1,this.dim),i=st(i,-1,this.dim));const h=4*this._idx(e,i);return(this.encoding==="terrarium"?bL:xL)(this.pixels[h],this.pixels[h+1],this.pixels[h+2])}static getUnpackVector(e){return WS[e]}get unpackVector(){return WS[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const l=[0,0,0,0],h=$m.getUnpackVector(i);let p=Math.floor((e+h[3])/h[2]);return l[2]=p%256,p=Math.floor(p/256),l[1]=p%256,p=Math.floor(p/256),l[0]=p,l}getPixels(){return new Ui({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,p=i*this.dim+this.dim,g=l*this.dim,v=l*this.dim+this.dim;switch(i){case-1:h=p-1;break;case 1:p=h+1}switch(l){case-1:g=v-1;break;case 1:v=g+1}const w=-i*this.dim,S=-l*this.dim;for(let k=g;k<v;k++)for(let M=h;M<p;M++){const P=4*this._idx(M,k),z=4*this._idx(M+w,k+S);this.pixels[P+0]=e.pixels[z+0],this.pixels[P+1]=e.pixels[z+1],this.pixels[P+2]=e.pixels[z+2],this.pixels[P+3]=e.pixels[z+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}mt($m,"DEMData"),mt($S,"DemMinMaxQuadTree",{omit:["dem"]});class wL{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,l){const h=e.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const p={value:i,timeout:void 0};if(l!==void 0&&(p.timeout=setTimeout(()=>{this.remove(e,p)},l)),this.data[h].push(p),this.order.push(h),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const l=e.wrapped().key,h=i===void 0?0:this.data[l].indexOf(i),p=this.data[l][h];return this.data[l].splice(h,1),p.timeout&&clearTimeout(p.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(p.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const l in this.data)for(const h of this.data[l])e(h.value)||i.push(h);for(const l of i)this.remove(l.value.tileID,l)}}class Yc{constructor(e,i,l){this.func=e,this.mask=i,this.range=l}}Yc.ReadOnly=!1,Yc.ReadWrite=!0,Yc.disabled=new Yc(519,Yc.ReadOnly,[0,1]);const yv=7680;class vv{constructor(e,i,l,h,p,g){this.test=e,this.ref=i,this.mask=l,this.fail=h,this.depthFail=p,this.pass=g}}vv.disabled=new vv({func:519,mask:0},0,0,yv,yv,yv);class No{constructor(e,i,l){this.blendFunction=e,this.blendColor=i,this.mask=l}}No.Replace=[1,0],No.disabled=new No(No.Replace,Or.transparent,[!1,!1,!1,!1]),No.unblended=new No(No.Replace,Or.transparent,[!0,!0,!0,!0]),No.alphaBlended=new No([1,771],Or.transparent,[!0,!0,!0,!0]);const xv=1029,bv=2305;class oo{constructor(e,i,l){this.enable=e,this.mode=i,this.frontFace=l}}oo.disabled=new oo(!1,xv,bv),oo.backCCW=new oo(!0,xv,bv),oo.backCW=new oo(!0,xv,2304),oo.frontCW=new oo(!0,1028,2304),oo.frontCCW=new oo(!0,1028,bv);class Cu extends So{constructor(e,i,l){super(),this.id=e,this._onlySymbols=l,i.on("data",h=>{h.dataType==="source"&&h.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&h.dataType==="source"&&h.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new wL(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new vL,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const l=this._tiles[i];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return tn(this._tiles).map(e=>e.tileID).sort(qS).map(e=>e.key)}getRenderableIds(e){const i=[];for(const l in this._tiles)this._isIdRenderable(+l,e)&&i.push(this._tiles[l]);return e?i.sort((l,h)=>{const p=l.tileID,g=h.tileID,v=new Ae(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),w=new Ae(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-g.overscaledZ||w.y-v.y||w.x-v.x}).map(l=>l.tileID.key):i.map(l=>l.tileID).sort(qS).map(l=>l.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=i),this._loadTile(l,this._tileLoaded.bind(this,l,e,i)))}_tileLoaded(e,i,l,h){if(h)if(e.state="errored",h.status!==404)this._source.fire(new zi(h,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Li.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new bs("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let h=0;h<i.length;h++){const p=i[h];if(e.neighboringTiles&&e.neighboringTiles[p]){const g=this.getTileByID(p);l(e,g),l(g,e)}}function l(h,p){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let g=p.tileID.canonical.x-h.tileID.canonical.x;const v=p.tileID.canonical.y-h.tileID.canonical.y,w=Math.pow(2,h.tileID.canonical.z),S=p.tileID.key;g===0&&v===0||Math.abs(v)>1||(Math.abs(g)>1&&(Math.abs(g+w)===1?g+=w:Math.abs(g-w)===1&&(g-=w)),p.dem&&h.dem&&(h.dem.backfillBorder(p.dem,g,v),h.neighboringTiles&&h.neighboringTiles[S]&&(h.neighboringTiles[S].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,l,h){for(const p in this._tiles){let g=this._tiles[p];if(h[p]||!g.hasData()||g.tileID.overscaledZ<=i||g.tileID.overscaledZ>l)continue;let v=g.tileID;for(;g&&g.tileID.overscaledZ>i+1;){const S=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[S.key],g&&g.hasData()&&(v=S)}let w=v;for(;w.overscaledZ>i;)if(w=w.scaledTo(w.overscaledZ-1),e[w.key]){h[v.key]=v;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=i?l:null}for(let l=e.overscaledZ-1;l>=i;l--){const h=e.scaledTo(l),p=this._getLoadedTile(h);if(p)return p}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const l=Math.ceil(e.width/i)+1,h=Math.ceil(e.height/i)+1,p=Math.floor(l*h*5),g=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,p):p,v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(v)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const l={};for(const h in this._tiles){const p=this._tiles[h];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+i),l[p.tileID.key]=p}this._tiles=l;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(e,i,l){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!l)return;let h;this.updateCacheSize(e,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(v=>new ci(v.canonical.z,v.wrap,v.canonical.z,v.canonical.x,v.canonical.y)):(h=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!l,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(v=>this._source.hasTile(v)))):h=[];const p=this._updateRetainedTiles(h);if(HS(this._source.type)&&h.length!==0){const v={},w={},S=Object.keys(p);for(const M of S){const P=p[M],z=this._tiles[M];if(!z||z.fadeEndTime&&z.fadeEndTime<=Li.now())continue;const O=this.findLoadedParent(P,Math.max(P.overscaledZ-Cu.maxOverzooming,this._source.minzoom));O&&(this._addTile(O.tileID),v[O.tileID.key]=O.tileID),w[M]=P}const k=h[h.length-1].overscaledZ;for(const M in this._tiles){const P=this._tiles[M];if(p[M]||!P.hasData())continue;let z=P.tileID;for(;z.overscaledZ>k;){z=z.scaledTo(z.overscaledZ-1);const O=this._tiles[z.key];if(O&&O.hasData()&&w[z.key]){p[M]=P.tileID;break}}}for(const M in v)p[M]||(this._coveredTiles[M]=!0,p[M]=v[M])}for(const v in p)this._tiles[v].clearFadeHold();const g=function(v,w){const S=[];for(const k in v)k in w||S.push(k);return S}(this._tiles,p);for(const v of g){const w=this._tiles[v];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+v)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(e.length===0)return i;const l={},h=e.reduce((S,k)=>Math.min(S,k.overscaledZ),1/0),p=e[0].overscaledZ,g=Math.max(p-Cu.maxOverzooming,this._source.minzoom),v=Math.max(p+Cu.maxUnderzooming,this._source.minzoom),w={};for(const S of e){const k=this._addTile(S);i[S.key]=S,k.hasData()||h<this._source.maxzoom&&(w[S.key]=S)}this._retainLoadedChildren(w,h,v,i);for(const S of e){let k=this._tiles[S.key];if(k.hasData())continue;if(S.canonical.z>=this._source.maxzoom){const P=S.children(this._source.maxzoom)[0],z=this.getTile(P);if(z&&z.hasData()){i[P.key]=P;continue}}else{const P=S.children(this._source.maxzoom);if(i[P[0].key]&&i[P[1].key]&&i[P[2].key]&&i[P[3].key])continue}let M=k.wasRequested();for(let P=S.overscaledZ-1;P>=g;--P){const z=S.scaledTo(P);if(l[z.key]||(l[z.key]=!0,k=this.getTile(z),!k&&M&&(k=this._addTile(z)),k&&(i[z.key]=z,M=k.wasRequested(),k.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let l,h=this._tiles[e].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){l=this._loadedParentTiles[h.key];break}i.push(h.key);const p=h.scaledTo(h.overscaledZ-1);if(l=this._getLoadedTile(p),l)break;h=p}for(const p of i)this._loadedParentTiles[p]=l}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const l=!!i;if(!l){const h=this.map?this.map.painter:null;i=new _v(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,h,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,l||this._source.fire(new bs("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=i.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,l){const h=[],p=this.transform;if(!p)return h;const g=p.projection.name==="globe",v=Oo(p.center.lng);for(const w in this._tiles){const S=this._tiles[w];if(l&&S.clearQueryDebugViz(),S.holdingForFade())continue;let k;if(g){const M=S.tileID.canonical;if(M.z===0){const P=[Math.abs(st(v,...af(M,-1))-v),Math.abs(st(v,...af(M,1))-v)];k=[0,2*P.indexOf(Math.min(...P))-1]}else{const P=[Math.abs(st(v,...af(M,-1))-v),Math.abs(st(v,...af(M,0))-v),Math.abs(st(v,...af(M,1))-v)];k=[P.indexOf(Math.min(...P))-1]}}else k=[0];for(const M of k){const P=e.containsTile(S,p,i,M);P&&h.push(P)}}return h}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);for(const l of i)l.projMatrix=this.transform.calculateProjMatrix(l.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(HS(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=Li.now())return!0}return!1}setFeatureState(e,i,l){this._state.updateState(e=e||"_geojsonTileLayer",i,l)}removeFeatureState(e,i,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,l)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,l){const h=this._tiles[e];h&&h.setDependencies(i,l)}reloadTilesForDependencies(e,i){for(const l in this._tiles)this._tiles[l].hasDependency(e,i)&&this._reloadTile(+l,"reloading");this._cache.filter(l=>!l.hasDependency(e,i))}_preloadTiles(e,i){if(!this._sourceLoaded){const v=()=>{this._sourceLoaded&&(this._source.off("data",v),this._preloadTiles(e,i))};return void this._source.on("data",v)}const l=new Map,h=Array.isArray(e)?e:[e],p=this.map.painter.terrain,g=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const v of h){const w=v.coveringTiles({tileSize:g,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const S of w)l.set(S.key,S);this.usedForTerrain&&v.updateElevation(!1)}Bt(Array.from(l.values()),(v,w)=>{const S=new _v(v,this._source.tileSize*v.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(S,k=>{this._source.type==="raster-dem"&&S.dem&&this._backfillDEM(S),w(k,S)})},i)}}function qS(n,e){const i=Math.abs(2*n.wrap)-+(n.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||l-i||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x}function HS(n){return n==="raster"||n==="image"||n==="video"||n==="custom"}function af(n,e){const i=1<<n.z;return[n.x/i+e,(n.x+1)/i+e]}Cu.maxOverzooming=10,Cu.maxUnderzooming=3;class Gm{constructor(e,i,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=l}static create(e,i,l){const h=l||e.findDEMTileFor(i);if(!h||!h.dem)return;const p=h.dem,g=h.tileID,v=1<<i.canonical.z-g.canonical.z;return new Gm(h,h.tileSize/St/v,[(i.canonical.x/v-g.canonical.x)*p.dim,(i.canonical.y/v-g.canonical.y)*p.dim])}tileCoordToPixel(e,i){const l=i*this._scale+this._offset[1],h=Math.floor(e*this._scale+this._offset[0]),p=Math.floor(l);return new Ae(h,p)}getElevationAt(e,i,l,h){const p=e*this._scale+this._offset[0],g=i*this._scale+this._offset[1],v=Math.floor(p),w=Math.floor(g),S=this._dem;return h=!!h,l?tr(tr(S.get(v,w,h),S.get(v,w+1,h),g-w),tr(S.get(v+1,w,h),S.get(v+1,w+1,h),g-w),p-v):S.get(v,w,h)}getElevationAtPixel(e,i,l){return this._dem.get(e,i,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ro(1,e)*this._dem.stride}}class ZS{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new oa(St,16,0),this.featureIndexArray=new pu,this.promoteId=i}insert(e,i,l,h,p,g=0){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,h,p,g);const w=this.grid;for(let S=0;S<i.length;S++){const k=i[S],M=[1/0,1/0,-1/0,-1/0];for(let P=0;P<k.length;P++){const z=k[P];M[0]=Math.min(M[0],z.x),M[1]=Math.min(M[1],z.y),M[2]=Math.max(M[2],z.x),M[3]=Math.max(M[3],z.y)}M[0]<St&&M[1]<St&&M[2]>=0&&M[3]>=0&&w.insert(v,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new tv(new Am(this.rawTileData)).layers,this.sourceLayerCoder=new LS(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,l,h){this.loadVTLayers();const p=e.params||{},g=kc(p.filter),v=e.tileResult,w=e.transform,S=v.bufferedTilespaceBounds,k=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(O,N,W,Q)=>xw(v.bufferedTilespaceGeometry,O,N,W,Q));k.sort(SL);let M=null;w.elevation&&k.length>0&&(M=Gm.create(w.elevation,this.tileID));const P={};let z;for(let O=0;O<k.length;O++){const N=k[O];if(N===z)continue;z=N;const W=this.featureIndexArray.get(N);let Q=null;this.loadMatchingFeature(P,W,g,p.layers,p.availableImages,i,l,h,(ue,ee,le,de=0)=>(Q||(Q=fa(ue,this.tileID.canonical,e.tileTransform)),ee.queryIntersectsFeature(v,ue,le,Q,this.z,e.transform,e.pixelPosMatrix,M,de)))}return P}loadMatchingFeature(e,i,l,h,p,g,v,w,S){const{featureIndex:k,bucketIndex:M,sourceLayerIndex:P,layoutVertexArrayOffset:z}=i,O=this.bucketLayerIDs[M];if(h&&!function(ue,ee){for(let le=0;le<ue.length;le++)if(ee.indexOf(ue[le])>=0)return!0;return!1}(h,O))return;const N=this.sourceLayerCoder.decode(P),W=this.vtLayers[N].feature(k);if(l.needGeometry){const ue=wu(W,!0);if(!l.filter(new A(this.tileID.overscaledZ),ue,this.tileID.canonical))return}else if(!l.filter(new A(this.tileID.overscaledZ),W))return;const Q=this.getId(W,N);for(let ue=0;ue<O.length;ue++){const ee=O[ue];if(h&&h.indexOf(ee)<0)continue;const le=g[ee];if(!le)continue;let de={};Q!==void 0&&w&&(de=w.getState(le.sourceLayer||"_geojsonTileLayer",Q));const he=Yt({},v[ee]);he.paint=XS(he.paint,le.paint,W,de,p),he.layout=XS(he.layout,le.layout,W,de,p);const Re=!S||S(W,le,de,z);if(!Re)continue;const Ie=new zS(W,this.z,this.x,this.y,Q);Ie.layer=he;let je=e[ee];je===void 0&&(je=e[ee]=[]),je.push({featureIndex:k,feature:Ie,intersectionZ:Re})}}lookupSymbolFeatures(e,i,l,h,p,g,v,w){const S={};this.loadVTLayers();const k=kc(p);for(const M of e)this.loadMatchingFeature(S,{bucketIndex:l,sourceLayerIndex:h,featureIndex:M,layoutVertexArrayOffset:0},k,g,v,w,i);return S}loadFeature(e){const{featureIndex:i,sourceLayerIndex:l}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(l),p=this.vtFeatures[h];if(p[i])return p[i];const g=this.vtLayers[h].feature(i);return p[i]=g,g}hasLayer(e){for(const i of this.bucketLayerIDs)for(const l of i)if(e===l)return!0;return!1}getId(e,i){let l=e.id;if(this.promoteId){const h=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];h!=null&&(l=e.properties[h]),typeof l=="boolean"&&(l=Number(l))}return l}}function XS(n,e,i,l,h){return Lt(n,(p,g)=>{const v=e instanceof J?e.get(g):null;return v&&v.evaluate?v.evaluate(i,l,h):v})}function SL(n,e){return e-n}mt(ZS,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class KS{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new pa({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const l=this.getKey(e,i);return this.positions[l]}trim(){const e=this.width,i=this.height=Nr(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,l){const h=[];let p=e.length%2==1?-e[e.length-1]*l:0,g=e[0]*l,v=!0;h.push({left:p,right:g,isDash:v,zeroLength:e[0]===0});let w=e[0];for(let S=1;S<e.length;S++){v=!v;const k=e[S];p=w*l,w+=k,g=w*l,h.push({left:p,right:g,isDash:v,zeroLength:k===0})}return h}addRoundDash(e,i,l){const h=i/2;for(let p=-l;p<=l;p++){const g=this.width*(this.nextRow+l+p);let v=0,w=e[v];for(let S=0;S<this.width;S++){S/w.right>1&&(w=e[++v]);const k=Math.abs(S-w.left),M=Math.abs(S-w.right),P=Math.min(k,M);let z;const O=p/l*(h+1);if(w.isDash){const N=h-Math.abs(O);z=Math.sqrt(P*P+N*N)}else z=h-Math.sqrt(P*P+O*O);this.image.data[g+S]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(e,i){for(let w=e.length-1;w>=0;--w){const S=e[w],k=e[w+1];S.zeroLength?e.splice(w,1):k&&k.isDash===S.isDash&&(k.left=S.left,e.splice(w,1))}const l=e[0],h=e[e.length-1];l.isDash===h.isDash&&(l.left=h.left-this.width,h.right=l.right+this.width);const p=this.width*this.nextRow;let g=0,v=e[g];for(let w=0;w<this.width;w++){w/v.right>1&&(v=e[++g]);const S=Math.abs(w-v.left),k=Math.abs(w-v.right),M=Math.min(S,k);this.image.data[p+w]=Math.max(0,Math.min(255,(v.isDash?M:-M)+i+128))}}addDash(e,i){const l=this.getKey(e,i);if(this.positions[l])return this.positions[l];const h=i==="round",p=h?7:0,g=2*p+1;if(this.nextRow+g>this.height)return fr("LineAtlas out of space"),null;e.length===0&&e.push(1);let v=0;for(let k=0;k<e.length;k++)e[k]<0&&(fr("Negative value is found in line dasharray, replacing values with 0"),e[k]=0),v+=e[k];if(v!==0){const k=this.width/v,M=this.getDashRanges(e,this.width,k);h?this.addRoundDash(M,k,p):this.addRegularDash(M,i==="square"?.5*k:0)}const w=this.nextRow+p;this.nextRow+=g;const S={tl:[w,p],br:[v,0]};return this.positions[l]=S,S}}mt(KS,"LineAtlas");const YS=1*so;class JS{constructor(e){const i={},l=[];for(const v in e){const w=e[v],S=i[v]={};for(const k in w.glyphs){const M=w.glyphs[+k];if(!M||M.bitmap.width===0||M.bitmap.height===0)continue;const P=M.metrics.localGlyph?YS:1,z={x:0,y:0,w:M.bitmap.width+2*P,h:M.bitmap.height+2*P};l.push(z),S[k]=z}}const{w:h,h:p}=sv(l),g=new pa({width:h||1,height:p||1});for(const v in e){const w=e[v];for(const S in w.glyphs){const k=w.glyphs[+S];if(!k||k.bitmap.width===0||k.bitmap.height===0)continue;const M=i[v][S],P=k.metrics.localGlyph?YS:1;pa.copy(k.bitmap,g,{x:0,y:0},{x:M.x+P,y:M.y+P},k.bitmap)}}this.image=g,this.positions=i}}mt(JS,"GlyphAtlas");class TL{constructor(e){this.tileID=new ci(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Eu(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,l,h,p){this.status="parsing",this.data=e,this.collisionBoxArray=new yr;const g=new LS(Object.keys(e.layers).sort()),v=new ZS(this.tileID,this.promoteId);v.bucketLayerIDs=[];const w={},S=new KS(256,256),k={featureIndex:v,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:S,availableImages:l},M=i.familiesBySource[this.source];for(const de in M){const he=e.layers[de];if(!he)continue;let Re=!1,Ie=!1;for(const Oe of M[de])Oe[0].type==="symbol"?Re=!0:Ie=!0;if(this.isSymbolTile===!0&&!Re||this.isSymbolTile===!1&&!Ie)continue;he.version===1&&fr(`Vector tile source "${this.source}" layer "${de}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const je=g.encode(de),Ke=[];for(let Oe=0;Oe<he.length;Oe++){const Ge=he.feature(Oe),$e=v.getId(Ge,de);Ke.push({feature:Ge,id:$e,index:Oe,sourceLayerIndex:je})}for(const Oe of M[de]){const Ge=Oe[0];this.isSymbolTile!==void 0&&Ge.type==="symbol"!==this.isSymbolTile||Ge.minzoom&&this.zoom<Math.floor(Ge.minzoom)||Ge.maxzoom&&this.zoom>=Ge.maxzoom||Ge.visibility!=="none"&&(wv(Oe,this.zoom,l),(w[Ge.id]=Ge.createBucket({index:v.bucketLayerIDs.length,layers:Oe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:je,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:l})).populate(Ke,k,this.tileID.canonical,this.tileTransform),v.bucketLayerIDs.push(Oe.map($e=>$e.id)))}}let P,z,O,N;S.trim();const W={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Q=()=>{if(P)return p(P);if(z&&O&&N){const de=new JS(z),he=new sS(O,N);for(const Re in w){const Ie=w[Re];Ie instanceof al?(wv(Ie.layers,this.zoom,l),KR(Ie,z,de.positions,O,he.iconPositions,this.showCollisionBoxes,l,this.tileID.canonical,this.tileZoom,this.projection)):Ie.hasPattern&&(Ie instanceof Cm||Ie instanceof bm||Ie instanceof Zd)&&(wv(Ie.layers,this.zoom,l),Ie.addFeatures(k,this.tileID.canonical,he.patternPositions,l,this.tileTransform))}this.status="done",p(null,{buckets:tn(w).filter(Re=>!Re.isEmpty()),featureIndex:v,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:de.image,lineAtlas:S,imageAtlas:he,glyphMap:this.returnDependencies?z:null,iconMap:this.returnDependencies?O:null,glyphPositions:this.returnDependencies?de.positions:null})}},ue=Lt(k.glyphDependencies,de=>Object.keys(de).map(Number));Object.keys(ue).length?h.send("getGlyphs",{uid:this.uid,stacks:ue},(de,he)=>{P||(P=de,z=he,Q())},void 0,!1,W):z={};const ee=Object.keys(k.iconDependencies);ee.length?h.send("getImages",{icons:ee,source:this.source,tileID:this.tileID,type:"icons"},(de,he)=>{P||(P=de,O=he,Q())},void 0,!1,W):O={};const le=Object.keys(k.patternDependencies);le.length?h.send("getImages",{icons:le,source:this.source,tileID:this.tileID,type:"patterns"},(de,he)=>{P||(P=de,N=he,Q())},void 0,!1,W):N={},Q()}}function wv(n,e,i){const l=new A(e);for(const h of n)h.recalculate(l,i)}class QS{constructor(e){this.entries={},this.scheduler=e}request(e,i,l,h){const p=this.entries[e]=this.entries[e]||{callbacks:[]};if(p.result){const[g,v]=p.result;return this.scheduler?this.scheduler.add(()=>{h(g,v)},i):h(g,v),()=>{}}return p.callbacks.push(h),p.cancel||(p.cancel=l((g,v)=>{p.result=[g,v];for(const w of p.callbacks)this.scheduler?this.scheduler.add(()=>{w(g,v)},i):w(g,v);setTimeout(()=>delete this.entries[e],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(g=>g!==h),p.callbacks.length||(p.cancel(),delete this.entries[e]))}}}function eT(n,e,i){const l=JSON.stringify(n.request);return n.data&&(this.deduped.entries[l]={result:[null,n.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},h=>{const p=ns(n.request,(g,v,w,S)=>{g?h(g):v&&h(null,{vectorTile:i?void 0:new tv(new Am(v)),rawData:v,cacheControl:w,expires:S})});return()=>{p.cancel(),h()}},e)}const tT=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Sv{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,l]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=l>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const p=tT[15&l];if(!p)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new Sv(v,g,p,e)}constructor(e,i=64,l=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=tT.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-v%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${l}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+w,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+v+w),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+w,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=i,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Tv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:g,nodeSize:v}=this,w=[0,p.length-1,0],S=[];for(;w.length;){const k=w.pop()||0,M=w.pop()||0,P=w.pop()||0;if(M-P<=v){for(let W=P;W<=M;W++){const Q=g[2*W],ue=g[2*W+1];Q>=e&&Q<=l&&ue>=i&&ue<=h&&S.push(p[W])}continue}const z=P+M>>1,O=g[2*z],N=g[2*z+1];O>=e&&O<=l&&N>=i&&N<=h&&S.push(p[z]),(k===0?e<=O:i<=N)&&(w.push(P),w.push(z-1),w.push(1-k)),(k===0?l>=O:h>=N)&&(w.push(z+1),w.push(M),w.push(1-k))}return S}within(e,i,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:g}=this,v=[0,h.length-1,0],w=[],S=l*l;for(;v.length;){const k=v.pop()||0,M=v.pop()||0,P=v.pop()||0;if(M-P<=g){for(let W=P;W<=M;W++)nT(p[2*W],p[2*W+1],e,i)<=S&&w.push(h[W]);continue}const z=P+M>>1,O=p[2*z],N=p[2*z+1];nT(O,N,e,i)<=S&&w.push(h[z]),(k===0?e-l<=O:i-l<=N)&&(v.push(P),v.push(z-1),v.push(1-k)),(k===0?e+l>=O:i+l>=N)&&(v.push(z+1),v.push(M),v.push(1-k))}return w}}function Tv(n,e,i,l,h,p){if(h-l<=i)return;const g=l+h>>1;rT(n,e,g,l,h,p),Tv(n,e,i,l,g-1,1-p),Tv(n,e,i,g+1,h,1-p)}function rT(n,e,i,l,h,p){for(;h>l;){if(h-l>600){const S=h-l+1,k=i-l+1,M=Math.log(S),P=.5*Math.exp(2*M/3),z=.5*Math.sqrt(M*P*(S-P)/S)*(k-S/2<0?-1:1);rT(n,e,i,Math.max(l,Math.floor(i-k*P/S+z)),Math.min(h,Math.floor(i+(S-k)*P/S+z)),p)}const g=e[2*i+p];let v=l,w=h;for(lf(n,e,l,i),e[2*h+p]>g&&lf(n,e,l,h);v<w;){for(lf(n,e,v,w),v++,w--;e[2*v+p]<g;)v++;for(;e[2*w+p]>g;)w--}e[2*l+p]===g?lf(n,e,l,w):(w++,lf(n,e,w,h)),w<=i&&(l=w+1),i<=w&&(h=w-1)}}function lf(n,e,i,l){Ev(n,i,l),Ev(e,2*i,2*l),Ev(e,2*i+1,2*l+1)}function Ev(n,e,i){const l=n[e];n[e]=n[i],n[i]=l}function nT(n,e,i,l){const h=n-i,p=e-l;return h*h+p*p}a.ARRAY_TYPE=Ni,a.AUTH_ERR_MSG=ce,a.Aabb=ui,a.Actor=class{constructor(n,e,i){this.target=n,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},Yn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ur()?n:I,this.scheduler=new _L}send(n,e,i,l,h=!1,p){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=p,this.callbacks[g]=i);const v=Pn(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:n,hasCallback:!!i,targetMapId:l,mustQueue:h,sourceMapId:this.mapId,data:Qa(e,v)},v),{cancel:()=>{i&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(n){const e=n.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const l=this.cancelCallbacks[i];delete this.cancelCallbacks[i],l&&l.cancel()}else if(e.mustQueue||Ur()){const l=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),l&&l.metadata||{type:"message"})}else this.processTask(i,e)}processTask(n,e){if(e.type==="<response>"){const i=this.callbacks[n];delete this.callbacks[n],i&&(e.error?i(aa(e.error)):i(null,aa(e.data)))}else{const i=Pn(this.globalScope)?void 0:[],l=e.hasCallback?(p,g)=>{delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:p?Qa(p):null,data:Qa(g,i)},i)}:p=>{},h=aa(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,h,l);else if(this.parent.getWorkerSource){const p=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,p[0],h.source)[p[1]](h,l)}else l(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.CanonicalTileID=Em,a.Color=Or,a.ColorMode=No,a.CullFaceMode=oo,a.DEMData=$m,a.DataConstantProperty=F,a.DedupedRequest=QS,a.DepthMode=Yc,a.EXTENT=St,a.Elevation=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const i=e.getSource().maxzoom,l=1<<i,h=Math.floor(n.x),p=Math.floor((n.x-h)*l),g=Math.floor(n.y*l),v=this.findDEMTileFor(new ci(i,h,i,p,g));return!(!v||!v.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const l=this._source();if(!l||n.y<0||n.y>1)return e;const h=l.getSource().maxzoom,p=1<<h,g=Math.floor(n.x),v=n.x-g,w=new ci(h,g,h,Math.floor(v*p),Math.floor(n.y*p)),S=this.findDEMTileFor(w);if(!S||!S.dem)return e;const k=S.dem,M=1<<S.tileID.canonical.z,P=(v*M-S.tileID.canonical.x)*k.dim,z=(n.y*M-S.tileID.canonical.y)*k.dim,O=Math.floor(P),N=Math.floor(z);return(i?this.exaggeration():1)*tr(tr(k.get(O,N),k.get(O,N+1),z-N),tr(k.get(O+1,N),k.get(O+1,N+1),z-N),P-O)}getAtTileOffset(n,e,i){const l=1<<n.canonical.z;return this.getAtPointOrZero(new Fc(n.wrap+(n.canonical.x+e/St)/l,(n.canonical.y+i/St)/l))}getAtTileOffsetFunc(n,e,i,l){return h=>{const p=this.getAtTileOffset(n,h.x,h.y),g=l.upVector(n.canonical,h.x,h.y);return os(g,g,p*l.upVectorScale(n.canonical,e,i).metersToTile),g}}getForTilePoints(n,e,i,l){if(this.isUsingMockSource())return!1;const h=Gm.create(this,n,l);return!!h&&(e.forEach(p=>{p[2]=this.exaggeration()*h.getElevationAt(p[0],p[1],i)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,l=e.tileID,h=1<<n.canonical.z-l.canonical.z;let p=n.canonical.x/h-l.canonical.x,g=n.canonical.y/h-l.canonical.y,v=0;for(let w=0;w<n.canonical.z-l.canonical.z&&!i.leaves[v];w++){p*=2,g*=2;const S=2*Math.floor(g)+Math.floor(p);v=i.childOffsets[v]+S,p%=1,g%=1}return{min:this.exaggeration()*i.minimums[v],max:this.exaggeration()*i.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},a.ErrorEvent=zi,a.EvaluationParameters=A,a.Event=bs,a.Evented=So,a.FillExtrusionBucket=Zd,a.Frustum=Ry,a.FrustumCorners=Py,a.GLOBE_RADIUS=zo,a.GLOBE_SCALE_MATCH_LATITUDE=45,a.GLOBE_ZOOM_THRESHOLD_MAX=nw,a.GLOBE_ZOOM_THRESHOLD_MIN=Ly,a.GlobeSharedBuffers=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const n of this._wireframeSegments)n.destroy()}}_fillGridMeshWithLods(n,e){const i=new Xe,l=new yt,h=[],p=n+1+2,g=e[0]+1,v=e[0]+1+(1+e.length),w=(S,k,M)=>{let P=S===p-1?S-2:S===0?S:S-1;return P+=M?24575:0,[P,k]};for(let S=0;S<p;++S)i.emplaceBack(...w(S,0,!0));for(let S=0;S<g;++S)for(let k=0;k<p;++k)i.emplaceBack(...w(k,S,(k===0||k===p-1)&&!0));for(let S=0;S<e.length;++S){const k=e[S];for(let M=0;M<p;++M)i.emplaceBack(...w(M,k,!0))}for(let S=0;S<e.length;++S){const k=l.length,M=e[S]+1+2,P=new yt;for(let N=0;N<M-1;N++){const W=N===M-2,Q=W?p*(v-e.length+S-N):p;for(let ue=0;ue<p-1;ue++){const ee=N*p+ue;N===0||W||ue===0||ue===p-2?(P.emplaceBack(ee+1,ee,ee+Q),P.emplaceBack(ee+Q,ee+Q+1,ee+1)):(l.emplaceBack(ee+1,ee,ee+Q),l.emplaceBack(ee+Q,ee+Q+1,ee+1))}}const z=an.simpleSegment(0,k,i.length,l.length-k);for(let N=0;N<P.uint16.length;N+=3)l.emplaceBack(P.uint16[N],P.uint16[N+1],P.uint16[N+2]);const O=an.simpleSegment(0,k,i.length,l.length-k);h.push({withoutSkirts:z,withSkirts:O})}return{vertices:i,indices:l,segments:h}}_createGrid(n){const e=this._fillGridMeshWithLods(xu,Fd);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,Bd.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new yt;for(let h=0;h<=xu;h++)e.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const i=new _r,l=new _r;this._poleSegments=[];for(let h=0,p=0;h<Ly;h++){const g=360/(1<<h);i.emplaceBack(0,-zo,0,.5,0),l.emplaceBack(0,-zo,0,.5,1);for(let v=0;v<=xu;v++){const w=v/xu,S=tr(0,g,w),[k,M,P]=Dc(_P,yP,S,zo);i.emplaceBack(k,M,P,w,0),l.emplaceBack(k,M,P,w,1)}this._poleSegments.push(an.simpleSegment(p,0,66,64)),p+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,tw,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(l,tw,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}getWirefameBuffers(n,e){if(!this._wireframeSegments){const i=new Cn,l=xu,h=l+1+2,p=1;this._wireframeSegments=[];for(let g=0,v=0;g<Fd.length;g++){const w=Fd[g];for(let k=p;k<w+p;k++)for(let M=p;M<l+p;M++){const P=k*h+M;i.emplaceBack(P,P+1),i.emplaceBack(P,P+h),i.emplaceBack(P,P+h+1)}const S=w*l*3;this._wireframeSegments.push(an.simpleSegment(0,v,(w+1)*h,S)),v+=S}this._wireframeIndexBuffer=n.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},a.GlyphManager=Hc,a.ImagePosition=ov,a.KDBush=Sv,a.LivePerformanceUtils=bt,a.LngLat=vr,a.LngLatBounds=nl,a.LocalGlyphMode=uv,a.MAX_MERCATOR_LATITUDE=no,a.MercatorCoordinate=Fc,a.ONE_EM=Dn,a.OverscaledTileID=ci,a.PerformanceMarkers=Vs,a.Point=Ae,a.Properties=oe,a.RGBAImage=Ui,a.Ray=My,a.RequestManager=class{constructor(n,e,i){this._transformRequestFn=n,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const n=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ie,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,e){return this._transformRequestFn&&this._transformRequestFn(n,e)||{url:n}}normalizeStyleURL(n,e){if(!_e(n))return n;const i=ot(n);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(n,e){if(!_e(n))return n;const i=ot(n);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(n,e,i,l){if(!_e(n))return n;const h=ot(n);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),i&&h.params.push(`language=${i}`),l&&h.params.push(`worldview=${l}`),this._makeAPIURL(h,this._customAccessToken||e)}normalizeSpriteURL(n,e,i,l){const h=ot(n);return _e(n)?(h.path=`/styles/v1${h.path}/sprite${e}${i}`,this._makeAPIURL(h,this._customAccessToken||l)):(h.path+=`${e}${i}`,Ye(h))}normalizeTileURL(n,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!_e(n))return n;const l=ot(n);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&l.authority!=="raster"&&i===512?"@2x":""}${q.supported?".webp":"$1"}`),l.authority==="raster"?l.path=`/${V.RASTER_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${V.TILE_URL_VERSION}${l.path}`);const h=this._customAccessToken||function(p){for(const g of p){const v=g.match(/^access_token=(.*)$/);if(v)return v[1]}return null}(l.params)||V.ACCESS_TOKEN;return V.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,h)}canonicalizeTileURL(n,e){const i=ot(n);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return n;let l="mapbox://";i.path.match(/^\/raster\/v1\//)?l+=`raster/${i.path.replace(`/${V.RASTER_URL_PREFIX}/`,"")}`:l+=`tiles/${i.path.replace(`/${V.TILE_URL_VERSION}/`,"")}`;let h=i.params;return e&&(h=h.filter(p=>!p.match(/^access_token=/))),h.length&&(l+=`?${h.join("&")}`),l}canonicalizeTileset(n,e){const i=!!e&&_e(e),l=[];for(const h of n.tiles||[])Te(h)?l.push(this.canonicalizeTileURL(h,i)):l.push(h);return l}_makeAPIURL(n,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",l=ot(V.API_URL);if(n.protocol=l.protocol,n.authority=l.authority,n.protocol==="http"){const h=n.params.indexOf("secure");h>=0&&n.params.splice(h,1)}if(l.path!=="/"&&(n.path=`${l.path}${n.path}`),!V.REQUIRE_ACCESS_TOKEN)return Ye(n);if(e=e||V.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return n.params=n.params.filter(h=>h.indexOf("access_token")===-1),n.params.push(`access_token=${e||""}`),Ye(n)}},a.ResourceType=Pi,a.SegmentVector=an,a.SourceCache=Cu,a.StencilMode=vv,a.StructArrayLayout1ui2=ji,a.StructArrayLayout2f1f2i16=Et,a.StructArrayLayout2i4=Xe,a.StructArrayLayout2ui4=Cn,a.StructArrayLayout3f12=Ht,a.StructArrayLayout3ui6=yt,a.StructArrayLayout4i8=Ve,a.StructArrayLayout5f20=_r,a.Texture=of,a.Tile=_v,a.Transitionable=B,a.Uniform1f=lm,a.Uniform1i=class extends ca{constructor(n){super(n),this.current=0}set(n,e,i){this.fetchUniformLocation(n,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},a.Uniform2f=class extends ca{constructor(n){super(n),this.current=[0,0]}set(n,e,i){this.fetchUniformLocation(n,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},a.Uniform3f=class extends ca{constructor(n){super(n),this.current=[0,0,0]}set(n,e,i){this.fetchUniformLocation(n,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},a.Uniform4f=Fb,a.UniformColor=jb,a.UniformMatrix2f=class extends ca{constructor(n){super(n),this.current=tP}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let l=0;l<4;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}},a.UniformMatrix3f=class extends ca{constructor(n){super(n),this.current=eP}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let l=0;l<9;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},a.UniformMatrix4f=class extends ca{constructor(n){super(n),this.current=QM}set(n,e,i){if(this.fetchUniformLocation(n,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let l=1;l<16;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},a.UnwrappedTileID=Ww,a.ValidationError=ft,a.VectorTileFeature=Sm,a.VectorTileWorkerSource=class extends So{constructor(n,e,i,l,h){super(),this.actor=n,this.layerIndex=e,this.availableImages=i,this.loadVectorData=h||eT,this.loading={},this.loaded={},this.deduped=new QS(n.scheduler),this.isSpriteLoaded=l,this.scheduler=n.scheduler}loadTile(n,e){const i=n.uid,l=n&&n.request,h=l&&l.collectResourceTiming,p=this.loading[i]=new TL(n);p.abort=this.loadVectorData(n,(g,v)=>{const w=!this.loading[i];if(delete this.loading[i],w||g||!v)return p.status="done",w||(this.loaded[i]=p),e(g);const S=v.rawData,k={};v.expires&&(k.expires=v.expires),v.cacheControl&&(k.cacheControl=v.cacheControl),p.vectorTile=v.vectorTile||new tv(new Am(S));const M=()=>{p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,(P,z)=>{if(P||!z)return e(P);const O={};if(h){const N=Ra(l);N.length>0&&(O.resourceTiming=JSON.parse(JSON.stringify(N)))}e(null,Yt({rawTileData:S.slice(0)},z,k,O))})};this.isSpriteLoaded?M():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(M,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):M()}),this.loaded=this.loaded||{},this.loaded[i]=p})}reloadTile(n,e){const i=this.loaded,l=n.uid,h=this;if(i&&i[l]){const p=i[l];p.showCollisionBoxes=n.showCollisionBoxes,p.enableTerrain=!!n.enableTerrain,p.projection=n.projection,p.tileTransform=Eu(n.tileID.canonical,n.projection);const g=(v,w)=>{const S=p.reloadCallback;S&&(delete p.reloadCallback,p.parse(p.vectorTile,h.layerIndex,this.availableImages,h.actor,S)),e(v,w)};p.status==="parsing"?p.reloadCallback=g:p.status==="done"&&(p.vectorTile?p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,g):g())}}abortTile(n,e){const i=n.uid,l=this.loading[i];l&&(l.abort&&l.abort(),delete this.loading[i]),e()}removeTile(n,e){const i=this.loaded,l=n.uid;i&&i[l]&&delete i[l],e()}},a.WritingMode=ls,a.ZoomDependentExpression=au,a.add=da,a.addDynamicAttributes=Nm,a.adjoint=function(n,e){var i=e[0],l=e[1],h=e[2],p=e[3],g=e[4],v=e[5],w=e[6],S=e[7],k=e[8];return n[0]=g*k-v*S,n[1]=h*S-l*k,n[2]=l*v-h*g,n[3]=v*w-p*k,n[4]=i*k-h*w,n[5]=h*p-i*v,n[6]=p*S-g*w,n[7]=l*w-i*S,n[8]=i*g-l*p,n},a.asyncAll=Bt,a.bezier=xn,a.bindAll=Yn,a.boundsAttributes=OS,a.bufferConvexPolygon=function(n,e){const i=[];for(let l=0;l<n.length;l++){const h=It(l-1,-1,n.length-1),p=It(l+1,-1,n.length-1),g=n[l],v=n[p],w=n[h].sub(g).unit(),S=v.sub(g).unit(),k=S.angleWithSep(w.x,w.y),M=w.add(S).unit().mult(-1*e/Math.sin(k/2));i.push(g.add(M))}return i},a.cacheEntryPossiblyAdded=function(n){Us++,Us>xo&&(n.getActor().send("enforceCacheSizeLimit",Ns),Us=0)},a.calculateGlobeLabelMatrix=function(n,e){const{x:i,y:l}=n.point,h=lw(i,l,n.worldSize/n._pixelsPerMercatorPixel,0,0);return _u(h,h,Oy(Do(e)))},a.calculateGlobeMatrix=function(n){const{x:e,y:i}=n.point,{lng:l,lat:h}=n._center;return lw(e,i,n.worldSize,l,h)},a.calculateGlobeMercatorMatrix=function(n){const e=n.pixelsPerMeter,i=e/ro(1,n.center.lat),l=eo(new Float64Array(16));return Pd(l,l,[n.point.x,n.point.y,0]),yu(l,l,[i,i,e]),Float32Array.from(l)},a.circumferenceAtLatitude=Fy,a.clamp=st,a.clearTileCache=function(n){if(!xs())return;const e=I.caches.delete(Ai);n&&e.catch(n).then(()=>n())},a.clipLine=yS,a.clone=function(n){var e=new Ni(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},a.clone$1=qr,a.collisionCircleLayout=bR,a.config=V,a.conjugate=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},a.create=function(){var n=new Ni(16);return Ni!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},a.create$1=Vb,a.createExpression=Ka,a.createLayout=xe,a.createStyleLayer=function(n){return n.type==="custom"?new fL(n):new mL[n.type](n)},a.cross=Ay,a.degToRad=pt,a.distance=function(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])},a.div=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},a.dot=ks,a.earthRadius=Ud,a.ease=lt,a.easeCubicInOut=Sr,a.ecefToLatLng=function([n,e,i]){const l=Math.hypot(n,e,i),h=Math.atan2(n,i),p=.5*Math.PI-Math.acos(-e/l);return new vr(Kt(h),Kt(p))},a.emitValidationErrors=rm,a.endsWith=_i,a.enforceCacheSizeLimit=function(n){es(),Rn&&Rn.then(e=>{e.keys().then(i=>{for(let l=0;l<i.length-n;l++)e.delete(i[l])})})},a.evaluateSizeForFeature=km,a.evaluateSizeForZoom=$c,a.evaluateVariableOffset=SS,a.evented=y,a.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},a.exactEquals$1=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]},a.exported=Li,a.exported$1=q,a.extend=Yt,a.extend$1=Di,a.fillExtrusionHeightLift=Vw,a.filterObject=yi,a.fromMat4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},a.fromQuat=function(n,e){var i=e[0],l=e[1],h=e[2],p=e[3],g=i+i,v=l+l,w=h+h,S=i*g,k=l*g,M=l*v,P=h*g,z=h*v,O=h*w,N=p*g,W=p*v,Q=p*w;return n[0]=1-M-O,n[1]=k+Q,n[2]=P-W,n[3]=0,n[4]=k-Q,n[5]=1-S-O,n[6]=z+N,n[7]=0,n[8]=P+W,n[9]=z-N,n[10]=1-S-M,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},a.fromRotation=function(n,e){var i=Math.sin(e),l=Math.cos(e);return n[0]=l,n[1]=i,n[2]=0,n[3]=-i,n[4]=l,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},a.fromScaling=Gb,a.furthestTileCorner=function(n){const e=Math.round((n+45+360)%360/90)%4;return Dr[e]},a.getAABBPointSquareDist=function(n,e,i){let l=0;for(let h=0;h<2;++h){const p=i?i[h]:0;n[h]>p&&(l+=(n[h]-p)*(n[h]-p)),e[h]<p&&(l+=(p-e[h])*(p-e[h]))}return l},a.getAnchorAlignment=lv,a.getAnchorJustification=hv,a.getBounds=function(n){let e=1/0,i=1/0,l=-1/0,h=-1/0;for(const p of n)e=Math.min(e,p.x),i=Math.min(i,p.y),l=Math.max(l,p.x),h=Math.max(h,p.y);return{min:new Ae(e,i),max:new Ae(l,h)}},a.getColumn=si,a.getDefaultExportFromCjs=Se,a.getGridMatrix=function(n,e,i,l){const h=e.getNorth(),p=e.getSouth(),g=e.getWest(),v=e.getEast(),w=1<<n.z,S=v-g,k=h-p,M=S/xu,P=-k/Fd[i],z=[0,M,0,P,0,0,h,g,0];if(n.z>0){const O=180/l;$b(z,z,[O/S+1,0,0,0,O/k+1,0,-.5*O/M,.5*O/P,1])}return z[2]=w,z[5]=n.x,z[8]=n.y,z},a.getImage=re,a.getJSON=function(n,e){return rs(Yt(n,{type:"json"}),e)},a.getLatitudinalLod=function(n){const e=no-5;n=st(n,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(pt(n))),3);return Math.round(i*(Fd.length-1))},a.getMapSessionAPI=gn,a.getPerformanceMeasurement=Ra,a.getProjection=PS,a.getRTLTextPluginStatus=x,a.getReferrer=Ri,a.getTilePoint=function(n,{x:e,y:i},l=0){return new Ae(((e-l)*n.scale-n.x)*St,(i*n.scale-n.y)*St)},a.getTileVec3=function(n,e,i=0){return zc(((e.x-i)*n.scale-n.x)*St,(e.y*n.scale-n.y)*St,dw(e.z,e.y))},a.getVideo=function(n,e){const i=I.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let l=0;l<n.length;l++){const h=I.document.createElement("source");bo(n[l])||(i.crossOrigin="Anonymous"),h.src=n[l],i.appendChild(h)}return{cancel:()=>{}}},a.globeCenterToScreenPoint=function(n){const e=[0,0,0],i=eo(new Float64Array(16));return _u(i,n.pixelMatrix,n.globeMatrix),Jr(e,e,i),new Ae(e[0],e[1])},a.globeDenormalizeECEF=Oy,a.globeECEFOrigin=function(n,e){const i=[0,0,0];return Jr(i,i,Nd(Do(e.canonical))),Jr(i,i,n),i},a.globeMetersToEcef=hm,a.globeNormalizeECEF=Nd,a.globePixelsToTileUnits=function(n,e){return St/(512*Math.pow(2,n))*fm(Do(e))},a.globePoleMatrixForTile=function(n,e,i){const l=eo(new Float64Array(16)),h=(e/(1<<n)-.5)*Math.PI*2;return cm(l,i.globeMatrix,h),Float32Array.from(l)},a.globeTileBounds=Do,a.globeTiltAtLngLat=uw,a.globeToMercatorTransition=Bc,a.globeUseCustomAntiAliasing=function(n,e,i){const l=Bc(i.zoom),h=n.style.map._antialias,p=!!e.extStandardDerivatives,g=e.extStandardDerivativesForceOff||n.terrain&&n.terrain.exaggeration()>0;return l===0&&!h&&!g&&p},a.identity=eo,a.identity$1=Jb,a.invert=Ey,a.isFullscreen=function(){return!!I.document.fullscreenElement||!!I.document.webkitFullscreenElement},a.isLngLatBehindGlobe=By,a.isMapAuthenticated=function(n){return nn.has(n)},a.isMapboxURL=_e,a.isSafariWithAntialiasingBug=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!Pn(n)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.latFromMercatorY=Wn,a.latLngToECEF=Oc,a.len=cP,a.length=Rd,a.length$1=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},a.lngFromMercatorX=as,a.loadVectorTile=eT,a.makeRequest=rs,a.mapValue=function(n,e,i,l,h){return st((n-e)/(i-e)*(h-l)+l,l,h)},a.mercatorScale=fw,a.mercatorXfromLng=Oo,a.mercatorYfromLat=Bo,a.mercatorZfromAltitude=ro,a.mul=lP,a.mul$1=uP,a.multiply=_u,a.multiply$1=$b,a.multiply$2=Hb,a.nextPowerOfTwo=Nr,a.normalize=li,a.normalize$1=hP,a.normalize$2=Kb,a.number=tr,a.ortho=function(n,e,i,l,h,p,g){var v=1/(e-i),w=1/(l-h),S=1/(p-g);return n[0]=-2*v,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*w,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*S,n[11]=0,n[12]=(e+i)*v,n[13]=(h+l)*w,n[14]=(g+p)*S,n[15]=1,n},a.pbf=Jw,a.perspective=function(n,e,i,l,h){var p,g=1/Math.tan(e/2);return n[0]=g/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=g,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,h!=null&&h!==1/0?(n[10]=(h+l)*(p=1/(l-h)),n[14]=2*h*l*p):(n[10]=-1,n[14]=-2*l),n},a.pick=function(n,e){const i={};for(let l=0;l<e.length;l++){const h=e[l];h in n&&(i[h]=n[h])}return i},a.plugin=C,a.pointGeometry=qe,a.polesInViewport=function(n){const e=eo(new Float64Array(16));_u(e,n.pixelMatrix,n.globeMatrix);const i=[0,Is,0],l=[0,As,0];return Jr(i,i,e),Jr(l,l,e),[i[0]>0&&i[0]<=n.width&&i[1]>0&&i[1]<=n.height&&!By(n,new vr(n.center.lat,90)),l[0]>0&&l[0]<=n.width&&l[1]>0&&l[1]<=n.height&&!By(n,new vr(n.center.lat,-90))]},a.polygonContainsPoint=Su,a.polygonIntersectsBox=xw,a.polygonIntersectsPolygon=gw,a.polygonizeBounds=function(n,e,i=0,l=!0){const h=new Ae(i,i),p=n.sub(h),g=e.add(h),v=[p,new Ae(g.x,p.y),g,new Ae(p.x,g.y)];return l&&v.push(p.clone()),v},a.posAttributes=Bd,a.postMapLoadEvent=Rr,a.postPerformanceEvent=Yr,a.postTurnstileEvent=Xt,a.potpack=sv,a.prevPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},a.radToDeg=Kt,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.registerForPluginStateChange=function(n){return n({pluginStatus:d,pluginURL:s}),y.on("pluginStateChange",n),n},a.removeAuthState=function(n){nn.delete(n)},a.renderColorRamp=qy,a.resample=pw,a.rotateX=Cy,a.rotateX$1=Qb,a.rotateY=cm,a.rotateY$1=ew,a.rotateZ=function(n,e,i){var l=Math.sin(i),h=Math.cos(i),p=e[0],g=e[1],v=e[2],w=e[3],S=e[4],k=e[5],M=e[6],P=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=p*h+S*l,n[1]=g*h+k*l,n[2]=v*h+M*l,n[3]=w*h+P*l,n[4]=S*h-p*l,n[5]=k*h-g*l,n[6]=M*h-v*l,n[7]=P*h-w*l,n},a.rotateZ$1=function(n,e,i){i*=.5;var l=e[0],h=e[1],p=e[2],g=e[3],v=Math.sin(i),w=Math.cos(i);return n[0]=l*w+h*v,n[1]=h*w-l*v,n[2]=p*w+g*v,n[3]=g*w-p*v,n},a.scale=yu,a.scale$1=Xb,a.scale$2=os,a.scaleAndAdd=Dd,a.set=function(n,e,i,l){return n[0]=e,n[1]=i,n[2]=l,n},a.setCacheLimits=function(n,e){Ns=n,xo=e},a.setColumn=function(n,e,i){n[4*e+0]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i[3]},a.setRTLTextPlugin=function(n,e,i=!1){if(d===Cd||d===kd||d===Id)throw new Error("setRTLTextPlugin cannot be called multiple times.");s=Li.resolveURL(n),d=Cd,el=e,m(),i||E()},a.smoothstep=kt,a.spec=Be,a.squaredLength=function(n){var e=n[0],i=n[1],l=n[2];return e*e+i*i+l*l},a.storeAuthState=function(n,e){e?nn.add(n):nn.delete(n)},a.sub=to,a.subtract=Iy,a.symbolSize=wR,a.tileAABB=function(n,e,i,l,h,p,g,v,w){if(w.name==="globe")return gP(n,e,new Em(i,l,h));const S=Eu({z:i,x:l,y:h},w);return new ui([(p+S.x/S.scale)*e,e*(S.y/S.scale),g],[(p+S.x2/S.scale)*e,e*(S.y2/S.scale),v])},a.tileCornersToBounds=dm,a.tileTransform=Eu,a.transformMat3=function(n,e,i){var l=e[0],h=e[1],p=e[2];return n[0]=l*i[0]+h*i[3]+p*i[6],n[1]=l*i[1]+h*i[4]+p*i[7],n[2]=l*i[2]+h*i[5]+p*i[8],n},a.transformMat4=Jr,a.transformMat4$1=vu,a.transformQuat=Zb,a.transitionTileAABBinECEF=sw,a.translate=Pd,a.transpose=function(n,e){if(n===e){var i=e[1],l=e[2],h=e[5];n[1]=e[3],n[2]=e[6],n[3]=i,n[5]=e[7],n[6]=l,n[7]=h}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n},a.triggerPluginCompletionEvent=c,a.uniqueId=jr,a.updateGlobeVertexNormal=function(n,e,i,l,h){const p=5*e+2;n.float32[p+0]=i,n.float32[p+1]=l,n.float32[p+2]=h},a.validateCustomStyleLayer=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},a.validateFilter=n=>Fi(du(n)),a.validateFog=n=>Fi(Qp(n)),a.validateLayer=n=>Fi(Xp(n)),a.validateLight=n=>Fi(Jp(n)),a.validateSource=n=>Fi(Yp(n)),a.validateStyle=tm,a.validateTerrain=n=>Fi(bd(n)),a.values=tn,a.vectorTile=wm,a.version=D,a.warnOnce=fr,a.window=I,a.wrap=It}),b(["./shared"],function(a){function I(ae){if(typeof ae=="number"||typeof ae=="boolean"||typeof ae=="string"||ae==null)return JSON.stringify(ae);if(Array.isArray(ae)){let U="[";for(const re of ae)U+=`${I(re)},`;return`${U}]`}let $="{";for(const U of Object.keys(ae).sort())$+=`${U}:${I(ae[U])},`;return`${$}}`}function D(ae){let $="";for(const U of a.refProperties)$+=`/${I(ae[U])}`;return $}class j{constructor($){this.keyCache={},$&&this.replace($)}replace($){this._layerConfigs={},this._layers={},this.update($,[])}update($,U){for(const ce of $)this._layerConfigs[ce.id]=ce,(this._layers[ce.id]=a.createStyleLayer(ce)).compileFilter(),this.keyCache[ce.id]&&delete this.keyCache[ce.id];for(const ce of U)delete this.keyCache[ce],delete this._layerConfigs[ce],delete this._layers[ce];this.familiesBySource={};const re=function(ce,_e){const Te={};for(let ye=0;ye<ce.length;ye++){const ze=_e&&_e[ce[ye].id]||D(ce[ye]);_e&&(_e[ce[ye].id]=ze);let et=Te[ze];et||(et=Te[ze]=[]),et.push(ce[ye])}const Ee=[];for(const ye in Te)Ee.push(Te[ye]);return Ee}(a.values(this._layerConfigs),this.keyCache);for(const ce of re){const _e=ce.map(ot=>this._layers[ot.id]),Te=_e[0];if(Te.visibility==="none")continue;const Ee=Te.source||"";let ye=this.familiesBySource[Ee];ye||(ye=this.familiesBySource[Ee]={});const ze=Te.sourceLayer||"_geojsonTileLayer";let et=ye[ze];et||(et=ye[ze]=[]),et.push(_e)}}}class V{loadTile($,U){const{uid:re,encoding:ce,rawImageData:_e,padding:Te,buildQuadTree:Ee}=$,ye=a.window.ImageBitmap&&_e instanceof a.window.ImageBitmap?this.getImageData(_e,Te):_e;U(null,new a.DEMData(re,ye,ce,Te<1,Ee))}getImageData($,U){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas($.width,$.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=$.width,this.offscreenCanvas.height=$.height,this.offscreenCanvasContext.drawImage($,0,0,$.width,$.height);const re=this.offscreenCanvasContext.getImageData(-U,-U,$.width+2*U,$.height+2*U);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),re}}function q(ae,$){if(ae.length!==0){se(ae[0],$);for(var U=1;U<ae.length;U++)se(ae[U],!$)}}function se(ae,$){for(var U=0,re=0,ce=0,_e=ae.length,Te=_e-1;ce<_e;Te=ce++){var Ee=(ae[ce][0]-ae[Te][0])*(ae[Te][1]+ae[ce][1]),ye=U+Ee;re+=Math.abs(U)>=Math.abs(Ee)?U-ye+Ee:Ee-ye+U,U=ye}U+re>=0!=!!$&&ae.reverse()}var pe=a.getDefaultExportFromCjs(function ae($,U){var re,ce=$&&$.type;if(ce==="FeatureCollection")for(re=0;re<$.features.length;re++)ae($.features[re],U);else if(ce==="GeometryCollection")for(re=0;re<$.geometries.length;re++)ae($.geometries[re],U);else if(ce==="Feature")ae($.geometry,U);else if(ce==="Polygon")q($.coordinates,U);else if(ce==="MultiPolygon")for(re=0;re<$.coordinates.length;re++)q($.coordinates[re],U);return $});const be=a.VectorTileFeature.prototype.toGeoJSON;var te={exports:{}},X=a.pointGeometry,ie=a.vectorTile.VectorTileFeature,Se=Ce;function Ce(ae,$){this.options=$||{},this.features=ae,this.length=ae.length}function Le(ae,$){this.id=typeof ae.id=="number"?ae.id:void 0,this.type=ae.type,this.rawGeometry=ae.type===1?[ae.geometry]:ae.geometry,this.properties=ae.tags,this.extent=$||4096}Ce.prototype.feature=function(ae){return new Le(this.features[ae],this.options.extent)},Le.prototype.loadGeometry=function(){var ae=this.rawGeometry;this.geometry=[];for(var $=0;$<ae.length;$++){for(var U=ae[$],re=[],ce=0;ce<U.length;ce++)re.push(new X(U[ce][0],U[ce][1]));this.geometry.push(re)}return this.geometry},Le.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ae=this.geometry,$=1/0,U=-1/0,re=1/0,ce=-1/0,_e=0;_e<ae.length;_e++)for(var Te=ae[_e],Ee=0;Ee<Te.length;Ee++){var ye=Te[Ee];$=Math.min($,ye.x),U=Math.max(U,ye.x),re=Math.min(re,ye.y),ce=Math.max(ce,ye.y)}return[$,re,U,ce]},Le.prototype.toGeoJSON=ie.prototype.toGeoJSON;var Ne=a.pbf,qe=Se;function it(ae){var $=new Ne;return function(U,re){for(var ce in U.layers)re.writeMessage(3,Ae,U.layers[ce])}(ae,$),$.finish()}function Ae(ae,$){var U;$.writeVarintField(15,ae.version||1),$.writeStringField(1,ae.name||""),$.writeVarintField(5,ae.extent||4096);var re={keys:[],values:[],keycache:{},valuecache:{}};for(U=0;U<ae.length;U++)re.feature=ae.feature(U),$.writeMessage(2,Tt,re);var ce=re.keys;for(U=0;U<ce.length;U++)$.writeStringField(3,ce[U]);var _e=re.values;for(U=0;U<_e.length;U++)$.writeMessage(4,Sr,_e[U])}function Tt(ae,$){var U=ae.feature;U.id!==void 0&&$.writeVarintField(1,U.id),$.writeMessage(2,$t,ae),$.writeVarintField(3,U.type),$.writeMessage(4,Dr,U)}function $t(ae,$){var U=ae.feature,re=ae.keys,ce=ae.values,_e=ae.keycache,Te=ae.valuecache;for(var Ee in U.properties){var ye=U.properties[Ee],ze=_e[Ee];if(ye!==null){ze===void 0&&(re.push(Ee),_e[Ee]=ze=re.length-1),$.writeVarint(ze);var et=typeof ye;et!=="string"&&et!=="boolean"&&et!=="number"&&(ye=JSON.stringify(ye));var ot=et+":"+ye,Ye=Te[ot];Ye===void 0&&(ce.push(ye),Te[ot]=Ye=ce.length-1),$.writeVarint(Ye)}}}function pt(ae,$){return($<<3)+(7&ae)}function Kt(ae){return ae<<1^ae>>31}function Dr(ae,$){for(var U=ae.loadGeometry(),re=ae.type,ce=0,_e=0,Te=U.length,Ee=0;Ee<Te;Ee++){var ye=U[Ee],ze=1;re===1&&(ze=ye.length),$.writeVarint(pt(1,ze));for(var et=re===3?ye.length-1:ye.length,ot=0;ot<et;ot++){ot===1&&re!==1&&$.writeVarint(pt(2,et-1));var Ye=ye[ot].x-ce,Mt=ye[ot].y-_e;$.writeVarint(Kt(Ye)),$.writeVarint(Kt(Mt)),ce+=Ye,_e+=Mt}re===3&&$.writeVarint(pt(7,1))}}function Sr(ae,$){var U=typeof ae;U==="string"?$.writeStringField(1,ae):U==="boolean"?$.writeBooleanField(7,ae):U==="number"&&(ae%1!=0?$.writeDoubleField(3,ae):ae<0?$.writeSVarintField(6,ae):$.writeVarintField(5,ae))}te.exports=it,te.exports.fromVectorTileJs=it,te.exports.fromGeojsonVt=function(ae,$){$=$||{};var U={};for(var re in ae)U[re]=new qe(ae[re].features,$),U[re].name=re,U[re].version=$.version,U[re].extent=$.extent;return it({layers:U})},te.exports.GeoJSONWrapper=qe;var xn=a.getDefaultExportFromCjs(te.exports);const lt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ae=>ae},st=Math.fround||(kt=new Float32Array(1),ae=>(kt[0]=+ae,kt[0]));var kt;const It=3,Bt=5,tn=6;class Yt{constructor($){this.options=Object.assign(Object.create(lt),$),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load($){const{log:U,minZoom:re,maxZoom:ce}=this.options;U&&console.time("total time");const _e=`prepare ${$.length} points`;U&&console.time(_e),this.points=$;const Te=[];for(let ye=0;ye<$.length;ye++){const ze=$[ye];if(!ze.geometry)continue;const[et,ot]=ze.geometry.coordinates,Ye=st(dr(et)),Mt=st(Nr(ot));Te.push(Ye,Mt,1/0,ye,-1,1),this.options.reduce&&Te.push(0)}let Ee=this.trees[ce+1]=this._createTree(Te);U&&console.timeEnd(_e);for(let ye=ce;ye>=re;ye--){const ze=+Date.now();Ee=this.trees[ye]=this._createTree(this._cluster(Ee,ye)),U&&console.log("z%d: %d clusters in %dms",ye,Ee.numItems,+Date.now()-ze)}return U&&console.timeEnd("total time"),this}getClusters($,U){let re=(($[0]+180)%360+360)%360-180;const ce=Math.max(-90,Math.min(90,$[1]));let _e=$[2]===180?180:(($[2]+180)%360+360)%360-180;const Te=Math.max(-90,Math.min(90,$[3]));if($[2]-$[0]>=360)re=-180,_e=180;else if(re>_e){const ot=this.getClusters([re,ce,180,Te],U),Ye=this.getClusters([-180,ce,_e,Te],U);return ot.concat(Ye)}const Ee=this.trees[this._limitZoom(U)],ye=Ee.range(dr(re),Nr(Te),dr(_e),Nr(ce)),ze=Ee.data,et=[];for(const ot of ye){const Ye=this.stride*ot;et.push(ze[Ye+Bt]>1?Kr(ze,Ye,this.clusterProps):this.points[ze[Ye+It]])}return et}getChildren($){const U=this._getOriginId($),re=this._getOriginZoom($),ce="No cluster with the specified id.",_e=this.trees[re];if(!_e)throw new Error(ce);const Te=_e.data;if(U*this.stride>=Te.length)throw new Error(ce);const Ee=this.options.radius/(this.options.extent*Math.pow(2,re-1)),ye=_e.within(Te[U*this.stride],Te[U*this.stride+1],Ee),ze=[];for(const et of ye){const ot=et*this.stride;Te[ot+4]===$&&ze.push(Te[ot+Bt]>1?Kr(Te,ot,this.clusterProps):this.points[Te[ot+It]])}if(ze.length===0)throw new Error(ce);return ze}getLeaves($,U,re){const ce=[];return this._appendLeaves(ce,$,U=U||10,re=re||0,0),ce}getTile($,U,re){const ce=this.trees[this._limitZoom($)],_e=Math.pow(2,$),{extent:Te,radius:Ee}=this.options,ye=Ee/Te,ze=(re-ye)/_e,et=(re+1+ye)/_e,ot={features:[]};return this._addTileFeatures(ce.range((U-ye)/_e,ze,(U+1+ye)/_e,et),ce.data,U,re,_e,ot),U===0&&this._addTileFeatures(ce.range(1-ye/_e,ze,1,et),ce.data,_e,re,_e,ot),U===_e-1&&this._addTileFeatures(ce.range(0,ze,ye/_e,et),ce.data,-1,re,_e,ot),ot.features.length?ot:null}getClusterExpansionZoom($){let U=this._getOriginZoom($)-1;for(;U<=this.options.maxZoom;){const re=this.getChildren($);if(U++,re.length!==1)break;$=re[0].properties.cluster_id}return U}_appendLeaves($,U,re,ce,_e){const Te=this.getChildren(U);for(const Ee of Te){const ye=Ee.properties;if(ye&&ye.cluster?_e+ye.point_count<=ce?_e+=ye.point_count:_e=this._appendLeaves($,ye.cluster_id,re,ce,_e):_e<ce?_e++:$.push(Ee),$.length===re)break}return _e}_createTree($){const U=new a.KDBush($.length/this.stride|0,this.options.nodeSize,Float32Array);for(let re=0;re<$.length;re+=this.stride)U.add($[re],$[re+1]);return U.finish(),U.data=$,U}_addTileFeatures($,U,re,ce,_e,Te){for(const Ee of $){const ye=Ee*this.stride,ze=U[ye+Bt]>1;let et,ot,Ye;if(ze)et=jr(U,ye,this.clusterProps),ot=U[ye],Ye=U[ye+1];else{const Pt=this.points[U[ye+It]];et=Pt.properties;const[Ut,Xt]=Pt.geometry.coordinates;ot=dr(Ut),Ye=Nr(Xt)}const Mt={type:1,geometry:[[Math.round(this.options.extent*(ot*_e-re)),Math.round(this.options.extent*(Ye*_e-ce))]],tags:et};let Nt;Nt=ze||this.options.generateId?U[ye+It]:this.points[U[ye+It]].id,Nt!==void 0&&(Mt.id=Nt),Te.features.push(Mt)}}_limitZoom($){return Math.max(this.options.minZoom,Math.min(Math.floor(+$),this.options.maxZoom+1))}_cluster($,U){const{radius:re,extent:ce,reduce:_e,minPoints:Te}=this.options,Ee=re/(ce*Math.pow(2,U)),ye=$.data,ze=[],et=this.stride;for(let ot=0;ot<ye.length;ot+=et){if(ye[ot+2]<=U)continue;ye[ot+2]=U;const Ye=ye[ot],Mt=ye[ot+1],Nt=$.within(ye[ot],ye[ot+1],Ee),Pt=ye[ot+Bt];let Ut=Pt;for(const Xt of Nt){const pr=Xt*et;ye[pr+2]>U&&(Ut+=ye[pr+Bt])}if(Ut>Pt&&Ut>=Te){let Xt,pr=Ye*Pt,Rr=Mt*Pt,bn=-1;const Yr=((ot/et|0)<<5)+(U+1)+this.points.length;for(const vi of Nt){const gn=vi*et;if(ye[gn+2]<=U)continue;ye[gn+2]=U;const nn=ye[gn+Bt];pr+=ye[gn]*nn,Rr+=ye[gn+1]*nn,ye[gn+4]=Yr,_e&&(Xt||(Xt=this._map(ye,ot,!0),bn=this.clusterProps.length,this.clusterProps.push(Xt)),_e(Xt,this._map(ye,gn)))}ye[ot+4]=Yr,ze.push(pr/Ut,Rr/Ut,1/0,Yr,-1,Ut),_e&&ze.push(bn)}else{for(let Xt=0;Xt<et;Xt++)ze.push(ye[ot+Xt]);if(Ut>1)for(const Xt of Nt){const pr=Xt*et;if(!(ye[pr+2]<=U)){ye[pr+2]=U;for(let Rr=0;Rr<et;Rr++)ze.push(ye[pr+Rr])}}}}return ze}_getOriginId($){return $-this.points.length>>5}_getOriginZoom($){return($-this.points.length)%32}_map($,U,re){if($[U+Bt]>1){const Te=this.clusterProps[$[U+tn]];return re?Object.assign({},Te):Te}const ce=this.points[$[U+It]].properties,_e=this.options.map(ce);return re&&_e===ce?Object.assign({},_e):_e}}function Kr(ae,$,U){return{type:"Feature",id:ae[$+It],properties:jr(ae,$,U),geometry:{type:"Point",coordinates:[(re=ae[$],360*(re-.5)),Kn(ae[$+1])]}};var re}function jr(ae,$,U){const re=ae[$+Bt],ce=re>=1e4?`${Math.round(re/1e3)}k`:re>=1e3?Math.round(re/100)/10+"k":re,_e=ae[$+tn],Te=_e===-1?{}:Object.assign({},U[_e]);return Object.assign(Te,{cluster:!0,cluster_id:ae[$+It],point_count:re,point_count_abbreviated:ce})}function dr(ae){return ae/360+.5}function Nr(ae){const $=Math.sin(ae*Math.PI/180),U=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return U<0?0:U>1?1:U}function Kn(ae){const $=(180-360*ae)*Math.PI/180;return 360*Math.atan(Math.exp($))/Math.PI-90}function Yn(ae,$,U,re){for(var ce,_e=re,Te=U-$>>1,Ee=U-$,ye=ae[$],ze=ae[$+1],et=ae[U],ot=ae[U+1],Ye=$+3;Ye<U;Ye+=3){var Mt=_i(ae[Ye],ae[Ye+1],ye,ze,et,ot);if(Mt>_e)ce=Ye,_e=Mt;else if(Mt===_e){var Nt=Math.abs(Ye-Te);Nt<Ee&&(ce=Ye,Ee=Nt)}}_e>re&&(ce-$>3&&Yn(ae,$,ce,re),ae[ce+2]=_e,U-ce>3&&Yn(ae,ce,U,re))}function _i(ae,$,U,re,ce,_e){var Te=ce-U,Ee=_e-re;if(Te!==0||Ee!==0){var ye=((ae-U)*Te+($-re)*Ee)/(Te*Te+Ee*Ee);ye>1?(U=ce,re=_e):ye>0&&(U+=Te*ye,re+=Ee*ye)}return(Te=ae-U)*Te+(Ee=$-re)*Ee}function Lt(ae,$,U,re){var ce={id:ae===void 0?null:ae,type:$,geometry:U,tags:re,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(_e){var Te=_e.geometry,Ee=_e.type;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")yi(_e,Te);else if(Ee==="Polygon"||Ee==="MultiLineString")for(var ye=0;ye<Te.length;ye++)yi(_e,Te[ye]);else if(Ee==="MultiPolygon")for(ye=0;ye<Te.length;ye++)for(var ze=0;ze<Te[ye].length;ze++)yi(_e,Te[ye][ze])}(ce),ce}function yi(ae,$){for(var U=0;U<$.length;U+=3)ae.minX=Math.min(ae.minX,$[U]),ae.minY=Math.min(ae.minY,$[U+1]),ae.maxX=Math.max(ae.maxX,$[U]),ae.maxY=Math.max(ae.maxY,$[U+1])}function qr(ae,$,U,re){if($.geometry){var ce=$.geometry.coordinates,_e=$.geometry.type,Te=Math.pow(U.tolerance/((1<<U.maxZoom)*U.extent),2),Ee=[],ye=$.id;if(U.promoteId?ye=$.properties[U.promoteId]:U.generateId&&(ye=re||0),_e==="Point")Ji(ce,Ee);else if(_e==="MultiPoint")for(var ze=0;ze<ce.length;ze++)Ji(ce[ze],Ee);else if(_e==="LineString")fr(ce,Ee,Te,!1);else if(_e==="MultiLineString"){if(U.lineMetrics){for(ze=0;ze<ce.length;ze++)fr(ce[ze],Ee=[],Te,!1),ae.push(Lt(ye,"LineString",Ee,$.properties));return}jn(ce,Ee,Te,!1)}else if(_e==="Polygon")jn(ce,Ee,Te,!0);else{if(_e!=="MultiPolygon"){if(_e==="GeometryCollection"){for(ze=0;ze<$.geometry.geometries.length;ze++)qr(ae,{id:ye,geometry:$.geometry.geometries[ze],properties:$.properties},U,re);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ze=0;ze<ce.length;ze++){var et=[];jn(ce[ze],et,Te,!0),Ee.push(et)}}ae.push(Lt(ye,_e,Ee,$.properties))}}function Ji(ae,$){$.push(vs(ae[0])),$.push(Ur(ae[1])),$.push(0)}function fr(ae,$,U,re){for(var ce,_e,Te=0,Ee=0;Ee<ae.length;Ee++){var ye=vs(ae[Ee][0]),ze=Ur(ae[Ee][1]);$.push(ye),$.push(ze),$.push(0),Ee>0&&(Te+=re?(ce*ze-ye*_e)/2:Math.sqrt(Math.pow(ye-ce,2)+Math.pow(ze-_e,2))),ce=ye,_e=ze}var et=$.length-3;$[2]=1,Yn($,0,et,U),$[et+2]=1,$.size=Math.abs(Te),$.start=0,$.end=$.size}function jn(ae,$,U,re){for(var ce=0;ce<ae.length;ce++){var _e=[];fr(ae[ce],_e,U,re),$.push(_e)}}function vs(ae){return ae/360+.5}function Ur(ae){var $=Math.sin(ae*Math.PI/180),U=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return U<0?0:U>1?1:U}function rn(ae,$,U,re,ce,_e,Te,Ee){if(re/=$,_e>=(U/=$)&&Te<re)return ae;if(Te<U||_e>=re)return null;for(var ye=[],ze=0;ze<ae.length;ze++){var et=ae[ze],ot=et.geometry,Ye=et.type,Mt=ce===0?et.minX:et.minY,Nt=ce===0?et.maxX:et.maxY;if(Mt>=U&&Nt<re)ye.push(et);else if(!(Nt<U||Mt>=re)){var Pt=[];if(Ye==="Point"||Ye==="MultiPoint")ii(ot,Pt,U,re,ce);else if(Ye==="LineString")Pn(ot,Pt,U,re,ce,!1,Ee.lineMetrics);else if(Ye==="MultiLineString")si(ot,Pt,U,re,ce,!1);else if(Ye==="Polygon")si(ot,Pt,U,re,ce,!0);else if(Ye==="MultiPolygon")for(var Ut=0;Ut<ot.length;Ut++){var Xt=[];si(ot[Ut],Xt,U,re,ce,!0),Xt.length&&Pt.push(Xt)}if(Pt.length){if(Ee.lineMetrics&&Ye==="LineString"){for(Ut=0;Ut<Pt.length;Ut++)ye.push(Lt(et.id,Ye,Pt[Ut],et.tags));continue}Ye!=="LineString"&&Ye!=="MultiLineString"||(Pt.length===1?(Ye="LineString",Pt=Pt[0]):Ye="MultiLineString"),Ye!=="Point"&&Ye!=="MultiPoint"||(Ye=Pt.length===3?"Point":"MultiPoint"),ye.push(Lt(et.id,Ye,Pt,et.tags))}}}return ye.length?ye:null}function ii(ae,$,U,re,ce){for(var _e=0;_e<ae.length;_e+=3){var Te=ae[_e+ce];Te>=U&&Te<=re&&($.push(ae[_e]),$.push(ae[_e+1]),$.push(ae[_e+2]))}}function Pn(ae,$,U,re,ce,_e,Te){for(var Ee,ye,ze=Qi(ae),et=ce===0?Ns:xo,ot=ae.start,Ye=0;Ye<ae.length-3;Ye+=3){var Mt=ae[Ye],Nt=ae[Ye+1],Pt=ae[Ye+2],Ut=ae[Ye+3],Xt=ae[Ye+4],pr=ce===0?Mt:Nt,Rr=ce===0?Ut:Xt,bn=!1;Te&&(Ee=Math.sqrt(Math.pow(Mt-Ut,2)+Math.pow(Nt-Xt,2))),pr<U?Rr>U&&(ye=et(ze,Mt,Nt,Ut,Xt,U),Te&&(ze.start=ot+Ee*ye)):pr>re?Rr<re&&(ye=et(ze,Mt,Nt,Ut,Xt,re),Te&&(ze.start=ot+Ee*ye)):Ai(ze,Mt,Nt,Pt),Rr<U&&pr>=U&&(ye=et(ze,Mt,Nt,Ut,Xt,U),bn=!0),Rr>re&&pr<=re&&(ye=et(ze,Mt,Nt,Ut,Xt,re),bn=!0),!_e&&bn&&(Te&&(ze.end=ot+Ee*ye),$.push(ze),ze=Qi(ae)),Te&&(ot+=Ee)}var Yr=ae.length-3;Mt=ae[Yr],Nt=ae[Yr+1],Pt=ae[Yr+2],(pr=ce===0?Mt:Nt)>=U&&pr<=re&&Ai(ze,Mt,Nt,Pt),Yr=ze.length-3,_e&&Yr>=3&&(ze[Yr]!==ze[0]||ze[Yr+1]!==ze[1])&&Ai(ze,ze[0],ze[1],ze[2]),ze.length&&$.push(ze)}function Qi(ae){var $=[];return $.size=ae.size,$.start=ae.start,$.end=ae.end,$}function si(ae,$,U,re,ce,_e){for(var Te=0;Te<ae.length;Te++)Pn(ae[Te],$,U,re,ce,_e,!1)}function Ai(ae,$,U,re){ae.push($),ae.push(U),ae.push(re)}function Ns(ae,$,U,re,ce,_e){var Te=(_e-$)/(re-$);return ae.push(_e),ae.push(U+(ce-U)*Te),ae.push(1),Te}function xo(ae,$,U,re,ce,_e){var Te=(_e-U)/(ce-U);return ae.push($+(re-$)*Te),ae.push(_e),ae.push(1),Te}function Rn(ae,$){for(var U=[],re=0;re<ae.length;re++){var ce,_e=ae[re],Te=_e.type;if(Te==="Point"||Te==="MultiPoint"||Te==="LineString")ce=Mi(_e.geometry,$);else if(Te==="MultiLineString"||Te==="Polygon"){ce=[];for(var Ee=0;Ee<_e.geometry.length;Ee++)ce.push(Mi(_e.geometry[Ee],$))}else if(Te==="MultiPolygon")for(ce=[],Ee=0;Ee<_e.geometry.length;Ee++){for(var ye=[],ze=0;ze<_e.geometry[Ee].length;ze++)ye.push(Mi(_e.geometry[Ee][ze],$));ce.push(ye)}U.push(Lt(_e.id,Te,ce,_e.tags))}return U}function Mi(ae,$){var U=[];U.size=ae.size,ae.start!==void 0&&(U.start=ae.start,U.end=ae.end);for(var re=0;re<ae.length;re+=3)U.push(ae[re]+$,ae[re+1],ae[re+2]);return U}function xs(ae,$){if(ae.transformed)return ae;var U,re,ce,_e=1<<ae.z,Te=ae.x,Ee=ae.y;for(U=0;U<ae.features.length;U++){var ye=ae.features[U],ze=ye.geometry,et=ye.type;if(ye.geometry=[],et===1)for(re=0;re<ze.length;re+=2)ye.geometry.push(es(ze[re],ze[re+1],$,_e,Te,Ee));else for(re=0;re<ze.length;re++){var ot=[];for(ce=0;ce<ze[re].length;ce+=2)ot.push(es(ze[re][ce],ze[re][ce+1],$,_e,Te,Ee));ye.geometry.push(ot)}}return ae.transformed=!0,ae}function es(ae,$,U,re,ce,_e){return[Math.round(U*(ae*re-ce)),Math.round(U*($*re-_e))]}function ts(ae,$,U,re,ce){for(var _e=$===ce.maxZoom?0:ce.tolerance/((1<<$)*ce.extent),Te={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:U,y:re,z:$,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ee=0;Ee<ae.length;Ee++){Te.numFeatures++,Us(Te,ae[Ee],_e,ce);var ye=ae[Ee].minX,ze=ae[Ee].minY,et=ae[Ee].maxX,ot=ae[Ee].maxY;ye<Te.minX&&(Te.minX=ye),ze<Te.minY&&(Te.minY=ze),et>Te.maxX&&(Te.maxX=et),ot>Te.maxY&&(Te.maxY=ot)}return Te}function Us(ae,$,U,re){var ce=$.geometry,_e=$.type,Te=[];if(_e==="Point"||_e==="MultiPoint")for(var Ee=0;Ee<ce.length;Ee+=3)Te.push(ce[Ee]),Te.push(ce[Ee+1]),ae.numPoints++,ae.numSimplified++;else if(_e==="LineString")Pi(Te,ce,ae,U,!1,!1);else if(_e==="MultiLineString"||_e==="Polygon")for(Ee=0;Ee<ce.length;Ee++)Pi(Te,ce[Ee],ae,U,_e==="Polygon",Ee===0);else if(_e==="MultiPolygon")for(var ye=0;ye<ce.length;ye++){var ze=ce[ye];for(Ee=0;Ee<ze.length;Ee++)Pi(Te,ze[Ee],ae,U,!0,Ee===0)}if(Te.length){var et=$.tags||null;if(_e==="LineString"&&re.lineMetrics){for(var ot in et={},$.tags)et[ot]=$.tags[ot];et.mapbox_clip_start=ce.start/ce.size,et.mapbox_clip_end=ce.end/ce.size}var Ye={geometry:Te,type:_e==="Polygon"||_e==="MultiPolygon"?3:_e==="LineString"||_e==="MultiLineString"?2:1,tags:et};$.id!==null&&(Ye.id=$.id),ae.features.push(Ye)}}function Pi(ae,$,U,re,ce,_e){var Te=re*re;if(re>0&&$.size<(ce?Te:re))U.numPoints+=$.length/3;else{for(var Ee=[],ye=0;ye<$.length;ye+=3)(re===0||$[ye+2]>Te)&&(U.numSimplified++,Ee.push($[ye]),Ee.push($[ye+1])),U.numPoints++;ce&&function(ze,et){for(var ot=0,Ye=0,Mt=ze.length,Nt=Mt-2;Ye<Mt;Nt=Ye,Ye+=2)ot+=(ze[Ye]-ze[Nt])*(ze[Ye+1]+ze[Nt+1]);if(ot>0===et)for(Ye=0,Mt=ze.length;Ye<Mt/2;Ye+=2){var Pt=ze[Ye],Ut=ze[Ye+1];ze[Ye]=ze[Mt-2-Ye],ze[Ye+1]=ze[Mt-1-Ye],ze[Mt-2-Ye]=Pt,ze[Mt-1-Ye]=Ut}}(Ee,_e),ae.push(Ee)}}function cr(ae,$){var U=($=this.options=function(ce,_e){for(var Te in _e)ce[Te]=_e[Te];return ce}(Object.create(this.options),$)).debug;if(U&&console.time("preprocess data"),$.maxZoom<0||$.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if($.promoteId&&$.generateId)throw new Error("promoteId and generateId cannot be used together.");var re=function(ce,_e){var Te=[];if(ce.type==="FeatureCollection")for(var Ee=0;Ee<ce.features.length;Ee++)qr(Te,ce.features[Ee],_e,Ee);else qr(Te,ce.type==="Feature"?ce:{geometry:ce},_e);return Te}(ae,$);this.tiles={},this.tileCoords=[],U&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",$.indexMaxZoom,$.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),re=function(ce,_e){var Te=_e.buffer/_e.extent,Ee=ce,ye=rn(ce,1,-1-Te,Te,0,-1,2,_e),ze=rn(ce,1,1-Te,2+Te,0,-1,2,_e);return(ye||ze)&&(Ee=rn(ce,1,-Te,1+Te,0,-1,2,_e)||[],ye&&(Ee=Rn(ye,1).concat(Ee)),ze&&(Ee=Ee.concat(Rn(ze,-1)))),Ee}(re,$),re.length&&this.splitTile(re,0,0,0),U&&(re.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ri(ae,$,U){return 32*((1<<ae)*U+$)+ae}function rs(ae,$){const U=ae.tileID.canonical;if(!this._geoJSONIndex)return $(null,null);const re=this._geoJSONIndex.getTile(U.z,U.x,U.y);if(!re)return $(null,null);const ce=new class{constructor(Te){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=Te.length,this._features=Te}feature(Te){return new class{constructor(Ee){this._feature=Ee,this.extent=a.EXTENT,this.type=Ee.type,this.properties=Ee.tags,"id"in Ee&&!isNaN(Ee.id)&&(this.id=parseInt(Ee.id,10))}loadGeometry(){if(this._feature.type===1){const Ee=[];for(const ye of this._feature.geometry)Ee.push([new a.Point(ye[0],ye[1])]);return Ee}{const Ee=[];for(const ye of this._feature.geometry){const ze=[];for(const et of ye)ze.push(new a.Point(et[0],et[1]));Ee.push(ze)}return Ee}}toGeoJSON(Ee,ye,ze){return be.call(this,Ee,ye,ze)}}(this._features[Te])}}(re.features);let _e=xn(ce);_e.byteOffset===0&&_e.byteLength===_e.buffer.byteLength||(_e=new Uint8Array(_e)),$(null,{vectorTile:ce,rawData:_e.buffer})}cr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},cr.prototype.splitTile=function(ae,$,U,re,ce,_e,Te){for(var Ee=[ae,$,U,re],ye=this.options,ze=ye.debug;Ee.length;){re=Ee.pop(),U=Ee.pop(),$=Ee.pop(),ae=Ee.pop();var et=1<<$,ot=Ri($,U,re),Ye=this.tiles[ot];if(!Ye&&(ze>1&&console.time("creation"),Ye=this.tiles[ot]=ts(ae,$,U,re,ye),this.tileCoords.push({z:$,x:U,y:re}),ze)){ze>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$,U,re,Ye.numFeatures,Ye.numPoints,Ye.numSimplified),console.timeEnd("creation"));var Mt="z"+$;this.stats[Mt]=(this.stats[Mt]||0)+1,this.total++}if(Ye.source=ae,ce){if($===ye.maxZoom||$===ce)continue;var Nt=1<<ce-$;if(U!==Math.floor(_e/Nt)||re!==Math.floor(Te/Nt))continue}else if($===ye.indexMaxZoom||Ye.numPoints<=ye.indexMaxPoints)continue;if(Ye.source=null,ae.length!==0){ze>1&&console.time("clipping");var Pt,Ut,Xt,pr,Rr,bn,Yr=.5*ye.buffer/ye.extent,vi=.5-Yr,gn=.5+Yr,nn=1+Yr;Pt=Ut=Xt=pr=null,Rr=rn(ae,et,U-Yr,U+gn,0,Ye.minX,Ye.maxX,ye),bn=rn(ae,et,U+vi,U+nn,0,Ye.minX,Ye.maxX,ye),ae=null,Rr&&(Pt=rn(Rr,et,re-Yr,re+gn,1,Ye.minY,Ye.maxY,ye),Ut=rn(Rr,et,re+vi,re+nn,1,Ye.minY,Ye.maxY,ye),Rr=null),bn&&(Xt=rn(bn,et,re-Yr,re+gn,1,Ye.minY,Ye.maxY,ye),pr=rn(bn,et,re+vi,re+nn,1,Ye.minY,Ye.maxY,ye),bn=null),ze>1&&console.timeEnd("clipping"),Ee.push(Pt||[],$+1,2*U,2*re),Ee.push(Ut||[],$+1,2*U,2*re+1),Ee.push(Xt||[],$+1,2*U+1,2*re),Ee.push(pr||[],$+1,2*U+1,2*re+1)}}},cr.prototype.getTile=function(ae,$,U){var re=this.options,ce=re.extent,_e=re.debug;if(ae<0||ae>24)return null;var Te=1<<ae,Ee=Ri(ae,$=($%Te+Te)%Te,U);if(this.tiles[Ee])return xs(this.tiles[Ee],ce);_e>1&&console.log("drilling down to z%d-%d-%d",ae,$,U);for(var ye,ze=ae,et=$,ot=U;!ye&&ze>0;)ze--,et=Math.floor(et/2),ot=Math.floor(ot/2),ye=this.tiles[Ri(ze,et,ot)];return ye&&ye.source?(_e>1&&console.log("found parent tile z%d-%d-%d",ze,et,ot),_e>1&&console.time("drilling down"),this.splitTile(ye.source,ze,et,ot,ae,$,U),_e>1&&console.timeEnd("drilling down"),this.tiles[Ee]?xs(this.tiles[Ee],ce):null):null};class ns extends a.VectorTileWorkerSource{constructor($,U,re,ce,_e){super($,U,re,ce,rs),_e&&(this.loadGeoJSON=_e)}loadData($,U){const re=$&&$.request,ce=re&&re.collectResourceTiming;this.loadGeoJSON($,(_e,Te)=>{if(_e||!Te)return U(_e);if(typeof Te!="object")return U(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));{pe(Te,!0);try{if($.filter){const ye=a.createExpression($.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ye.result==="error")throw new Error(ye.value.map(et=>`${et.key}: ${et.message}`).join(", "));Te={type:"FeatureCollection",features:Te.features.filter(et=>ye.value.evaluate({zoom:0},et))}}this._geoJSONIndex=$.cluster?new Yt(function({superclusterOptions:ye,clusterProperties:ze}){if(!ze||!ye)return ye;const et={},ot={},Ye={accumulated:null,zoom:0},Mt={properties:null},Nt=Object.keys(ze);for(const Pt of Nt){const[Ut,Xt]=ze[Pt],pr=a.createExpression(Xt),Rr=a.createExpression(typeof Ut=="string"?[Ut,["accumulated"],["get",Pt]]:Ut);et[Pt]=pr.value,ot[Pt]=Rr.value}return ye.map=Pt=>{Mt.properties=Pt;const Ut={};for(const Xt of Nt)Ut[Xt]=et[Xt].evaluate(Ye,Mt);return Ut},ye.reduce=(Pt,Ut)=>{Mt.properties=Ut;for(const Xt of Nt)Ye.accumulated=Pt[Xt],Pt[Xt]=ot[Xt].evaluate(Ye,Mt)},ye}($)).load(Te.features):function(ye,ze){return new cr(ye,ze)}(Te,$.geojsonVtOptions)}catch(ye){return U(ye)}this.loaded={};const Ee={};if(ce){const ye=a.getPerformanceMeasurement(re);ye&&(Ee.resourceTiming={},Ee.resourceTiming[$.source]=JSON.parse(JSON.stringify(ye)))}U(null,Ee)}})}reloadTile($,U){const re=this.loaded;return re&&re[$.uid]?super.reloadTile($,U):this.loadTile($,U)}loadGeoJSON($,U){if($.request)a.getJSON($.request,U);else{if(typeof $.data!="string")return U(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));try{return U(null,JSON.parse($.data))}catch{return U(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom($,U){try{U(null,this._geoJSONIndex.getClusterExpansionZoom($.clusterId))}catch(re){U(re)}}getClusterChildren($,U){try{U(null,this._geoJSONIndex.getChildren($.clusterId))}catch(re){U(re)}}getClusterLeaves($,U){try{U(null,this._geoJSONIndex.getLeaves($.clusterId,$.limit,$.offset))}catch(re){U(re)}}}class bo{constructor($){this.self=$,this.actor=new a.Actor($,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.getProjection({name:"mercator"}),this.workerSourceTypes={vector:a.VectorTileWorkerSource,geojson:ns},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(U,re)=>{if(this.workerSourceTypes[U])throw new Error(`Worker source with name "${U}" already registered.`);this.workerSourceTypes[U]=re},this.self.registerRTLTextPlugin=U=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=U.applyArabicShaping,a.plugin.processBidirectionalText=U.processBidirectionalText,a.plugin.processStyledBidirectionalText=U.processStyledBidirectionalText}}clearCaches($,U,re){delete this.layerIndexes[$],delete this.availableImages[$],delete this.workerSources[$],delete this.demWorkerSources[$],re()}checkIfReady($,U,re){re()}setReferrer($,U){this.referrer=U}spriteLoaded($,U){this.isSpriteLoaded[$]=U;for(const re in this.workerSources[$]){const ce=this.workerSources[$][re];for(const _e in ce)ce[_e]instanceof a.VectorTileWorkerSource&&(ce[_e].isSpriteLoaded=U,ce[_e].fire(new a.Event("isSpriteLoaded")))}}setImages($,U,re){this.availableImages[$]=U;for(const ce in this.workerSources[$]){const _e=this.workerSources[$][ce];for(const Te in _e)_e[Te].availableImages=U}re()}enableTerrain($,U,re){this.terrain=U,re()}setProjection($,U){this.projections[$]=a.getProjection(U)}setLayers($,U,re){this.getLayerIndex($).replace(U),re()}updateLayers($,U,re){this.getLayerIndex($).update(U.layers,U.removedIds),re()}loadTile($,U,re){const ce=this.enableTerrain?a.extend({enableTerrain:this.terrain},U):U;ce.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,U.type,U.source).loadTile(ce,re)}loadDEMTile($,U,re){const ce=this.enableTerrain?a.extend({buildQuadTree:this.terrain},U):U;this.getDEMWorkerSource($,U.source).loadTile(ce,re)}reloadTile($,U,re){const ce=this.enableTerrain?a.extend({enableTerrain:this.terrain},U):U;ce.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,U.type,U.source).reloadTile(ce,re)}abortTile($,U,re){this.getWorkerSource($,U.type,U.source).abortTile(U,re)}removeTile($,U,re){this.getWorkerSource($,U.type,U.source).removeTile(U,re)}removeSource($,U,re){if(!this.workerSources[$]||!this.workerSources[$][U.type]||!this.workerSources[$][U.type][U.source])return;const ce=this.workerSources[$][U.type][U.source];delete this.workerSources[$][U.type][U.source],ce.removeSource!==void 0?ce.removeSource(U,re):re()}loadWorkerSource($,U,re){try{this.self.importScripts(U.url),re()}catch(ce){re(ce.toString())}}syncRTLPluginState($,U,re){try{a.plugin.setState(U);const ce=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&ce!=null){this.self.importScripts(ce);const _e=a.plugin.isParsed();re(_e?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ce}`),_e)}}catch(ce){re(ce.toString())}}getAvailableImages($){let U=this.availableImages[$];return U||(U=[]),U}getLayerIndex($){let U=this.layerIndexes[$];return U||(U=this.layerIndexes[$]=new j),U}getWorkerSource($,U,re){if(this.workerSources[$]||(this.workerSources[$]={}),this.workerSources[$][U]||(this.workerSources[$][U]={}),!this.workerSources[$][U][re]){const ce={send:(_e,Te,Ee,ye,ze,et)=>{this.actor.send(_e,Te,Ee,$,ze,et)},scheduler:this.actor.scheduler};this.workerSources[$][U][re]=new this.workerSourceTypes[U](ce,this.getLayerIndex($),this.getAvailableImages($),this.isSpriteLoaded[$])}return this.workerSources[$][U][re]}getDEMWorkerSource($,U){return this.demWorkerSources[$]||(this.demWorkerSources[$]={}),this.demWorkerSources[$][U]||(this.demWorkerSources[$][U]=new V),this.demWorkerSources[$][U]}enforceCacheSizeLimit($,U){a.enforceCacheSizeLimit(U)}getWorkerPerformanceMetrics($,U,re){re(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new bo(self)),bo}),b(["./shared"],function(a){function I(d,s){if(Array.isArray(d)){if(!Array.isArray(s)||d.length!==s.length)return!1;for(let c=0;c<d.length;c++)if(!I(d[c],s[c]))return!1;return!0}if(typeof d=="object"&&d!==null&&s!==null){if(typeof s!="object"||Object.keys(d).length!==Object.keys(s).length)return!1;for(const c in d)if(!I(d[c],s[c]))return!1;return!0}return d===s}var D=j;function j(d){return!function(s){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,y,x=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(x);try{y=new Worker(E),m=!0}catch{m=!1}return y&&y.terminate(),URL.revokeObjectURL(E),m}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var m=document.createElement("canvas");m.width=m.height=1;var y=m.getContext("2d");if(!y)return!1;var x=y.getImageData(0,0,1,1);return x&&x.width===m.width}()?(V[c=s&&s.failIfMajorPerformanceCaveat]===void 0&&(V[c]=function(m){var y,x=function(E){var C=document.createElement("canvas"),A=Object.create(j.webGLContextAttributes);return A.failIfMajorPerformanceCaveat=E,C.getContext("webgl",A)||C.getContext("experimental-webgl",A)}(m);if(!x)return!1;try{y=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!y||x.isContextLost())&&(x.shaderSource(y,"void main() {}"),x.compileShader(y),x.getShaderParameter(y,x.COMPILE_STATUS)===!0)}(c)),V[c]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var c}(d)}var V={};function q(d,s,c){const m=a.window.document.createElement(d);return s!==void 0&&(m.className=s),c&&c.appendChild(m),m}function se(d,s,c){const m=a.window.document.createElementNS("http://www.w3.org/2000/svg",d);for(const y of Object.keys(s))m.setAttributeNS(null,y,s[y]);return c&&c.appendChild(m),m}j.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const pe=a.window.document&&a.window.document.documentElement.style,be=pe&&pe.userSelect!==void 0?"userSelect":"WebkitUserSelect";let te;function X(){pe&&be&&(te=pe[be],pe[be]="none")}function ie(){pe&&be&&(pe[be]=te)}function Se(d){d.preventDefault(),d.stopPropagation(),a.window.removeEventListener("click",Se,!0)}function Ce(){a.window.addEventListener("click",Se,!0),a.window.setTimeout(()=>{a.window.removeEventListener("click",Se,!0)},0)}function Le(d,s){const c=d.getBoundingClientRect();return it(d,c,s)}function Ne(d,s){const c=d.getBoundingClientRect(),m=[];for(let y=0;y<s.length;y++)m.push(it(d,c,s[y]));return m}function qe(d){return a.window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&a.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function it(d,s,c){const m=d.offsetWidth===s.width?1:d.offsetWidth/s.width;return new a.Point((c.clientX-s.left)*m,(c.clientY-s.top)*m)}function Ae(d,s){var c=s[0],m=s[1],y=s[2],x=s[3],E=c*x-y*m;return E?(d[0]=x*(E=1/E),d[1]=-m*E,d[2]=-y*E,d[3]=c*E,d):null}function Tt(d){const{userImage:s}=d;return!!(s&&s.render&&s.render())&&(d.data.replace(new Uint8Array(s.data.buffer)),!0)}class $t extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:c,callback:m}of this.requestors)this._notify(c,m);this.requestors=[]}}hasImage(s){return!!this.getImage(s)}getImage(s){return this.images[s]}addImage(s,c){this._validate(s,c)&&(this.images[s]=c)}_validate(s,c){let m=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${s}" has invalid "stretchX" value`))),m=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${s}" has invalid "stretchY" value`))),m=!1),this._validateContent(c.content,c)||(this.fire(new a.ErrorEvent(new Error(`Image "${s}" has invalid "content" value`))),m=!1),m}_validateStretch(s,c){if(!s)return!0;let m=0;for(const y of s){if(y[0]<m||y[1]<y[0]||c<y[1])return!1;m=y[1]}return!0}_validateContent(s,c){return!(s&&(s.length!==4||s[0]<0||c.data.width<s[0]||s[1]<0||c.data.height<s[1]||s[2]<0||c.data.width<s[2]||s[3]<0||c.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,c){c.version=this.images[s].version+1,this.images[s]=c,this.updatedImages[s]=!0}removeImage(s){const c=this.images[s];delete this.images[s],delete this.patterns[s],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s,c){let m=!0;if(!this.isLoaded())for(const y of s)this.images[y]||(m=!1);this.isLoaded()||m?this._notify(s,c):this.requestors.push({ids:s,callback:c})}_notify(s,c){const m={};for(const y of s){this.images[y]||this.fire(new a.Event("styleimagemissing",{id:y}));const x=this.images[y];x?m[y]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:a.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,m)}getPixelSize(){const{width:s,height:c}=this.atlasImage;return{width:s,height:c}}getPattern(s){const c=this.patterns[s],m=this.getImage(s);if(!m)return null;if(c&&c.position.version===m.version)return c.position;if(c)c.position.version=m.version;else{const y={w:m.data.width+2,h:m.data.height+2,x:0,y:0},x=new a.ImagePosition(y,m);this.patterns[s]={bin:y,position:x}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const c=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.Texture(s,this.atlasImage,c.RGBA),this.atlasTexture&&this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const x in this.patterns)s.push(this.patterns[x].bin);const{w:c,h:m}=a.potpack(s),y=this.atlasImage;y.resize({width:c||1,height:m||1});for(const x in this.patterns){const{bin:E}=this.patterns[x],C=E.x+1,A=E.y+1,L=this.images[x].data,R=L.width,B=L.height;a.RGBAImage.copy(L,y,{x:0,y:0},{x:C,y:A},{width:R,height:B}),a.RGBAImage.copy(L,y,{x:0,y:B-1},{x:C,y:A-1},{width:R,height:1}),a.RGBAImage.copy(L,y,{x:0,y:0},{x:C,y:A+B},{width:R,height:1}),a.RGBAImage.copy(L,y,{x:R-1,y:0},{x:C-1,y:A},{width:1,height:B}),a.RGBAImage.copy(L,y,{x:0,y:0},{x:C+R,y:A},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const c of s){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const m=this.images[c];Tt(m)&&this.updateImage(c,m)}}}const pt=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(d,s){return function([c,m,y]){const x=a.degToRad(m+90),E=a.degToRad(y);return{x:c*Math.cos(x)*Math.sin(E),y:c*Math.sin(x)*Math.sin(E),z:c*Math.cos(E),azimuthal:m,polar:y}}(d.expression.evaluate(s))}interpolate(d,s,c){return{x:a.number(d.x,s.x,c),y:a.number(d.y,s.y,c),z:a.number(d.z,s.z,c),azimuthal:a.number(d.azimuthal,s.azimuthal,c),polar:a.number(d.polar,s.polar,c)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)});class Kt extends a.Evented{constructor(s){super(),this._transitionable=new a.Transitionable(pt),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,c={}){if(!this._validate(a.validateLight,s,c))for(const m in s){const y=s[m];a.endsWith(m,"-transition")?this._transitionable.setTransition(m.slice(0,-11),y):this._transitionable.setValue(m,y)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,c,m){return(!m||m.validate!==!1)&&a.emitValidationErrors(this,s.call(a.validateStyle,a.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}const Dr=new a.Properties({source:new a.DataConstantProperty(a.spec.terrain.source),exaggeration:new a.DataConstantProperty(a.spec.terrain.exaggeration)});let Sr=class extends a.Evented{constructor(d,s){super(),this._transitionable=new a.Transitionable(Dr),this.set(d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(d){for(const s in d){const c=d[s];a.endsWith(s,"-transition")?this._transitionable.setTransition(s.slice(0,-11),c):this._transitionable.setValue(s,c)}}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}};function xn(d,s,c,m){const y=a.smoothstep(45,65,c),[x,E]=lt(d,m),C=a.length(s);let A=1-Math.min(1,Math.exp((C-x)/(E-x)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*y*d.alpha}function lt(d,s){const c=.5/Math.tan(.5*s);return[d.range[0]+c,d.range[1]+c]}const st=new a.Properties({range:new a.DataConstantProperty(a.spec.fog.range),color:new a.DataConstantProperty(a.spec.fog.color),"high-color":new a.DataConstantProperty(a.spec.fog["high-color"]),"space-color":new a.DataConstantProperty(a.spec.fog["space-color"]),"horizon-blend":new a.DataConstantProperty(a.spec.fog["horizon-blend"]),"star-intensity":new a.DataConstantProperty(a.spec.fog["star-intensity"])});class kt extends a.Evented{constructor(s,c){super(),this._transitionable=new a.Transitionable(st),this.set(s),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){const s=this._transform,c=s.projection.name==="globe",m=a.globeToMercatorTransition(s.zoom),y=this.properties.get("range"),x=[.5,3];return{range:c?[a.number(x[0],y[0],m),a.number(x[1],y[1],m)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,c={}){if(!this._validate(a.validateFog,s,c)){for(const m of Object.keys(a.spec.fog))s&&s[m]===void 0&&(s[m]=a.spec.fog[m].default);for(const m in s){const y=s[m];a.endsWith(m,"-transition")?this._transitionable.setTransition(m.slice(0,-11),y):this._transitionable.setValue(m,y)}}}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.smoothstep(45,65,s))*c.a}getOpacityAtLatLng(s,c){return this._transform.projection.supportsFog?function(m,y,x){const E=a.MercatorCoordinate.fromLngLat(y),C=x.elevation?x.elevation.getAtPointOrZero(E):0,A=[E.x,E.y,C];return a.transformMat4(A,A,x.mercatorFogMatrix),xn(m,A,x.pitch,x._fov)}(this.state,s,c):0}getFovAdjustedRange(s){return this._transform.projection.supportsFog?lt(this.state,s):[0,1]}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,c,m){return(!m||m.validate!==!1)&&a.emitValidationErrors(this,s.call(a.validateStyle,a.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class It{constructor(s,c){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const m=this.workerPool.acquire(this.id);for(let y=0;y<m.length;y++){const x=new It.Actor(m[y],c,this.id);x.name=`Worker ${y}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(s,c,m){a.asyncAll(this.actors,(y,x)=>{y.send(s,c,x)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Bt(d,s,c){return s*(a.EXTENT/(d.tileSize*Math.pow(2,c-d.tileID.overscaledZ)))}It.Actor=a.Actor;class tn{constructor(s,c,m,y){this.screenBounds=s,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,y)}static createFromScreenPoints(s,c){let m,y;if(s instanceof a.Point||typeof s[0]=="number"){const x=a.Point.convert(s);m=[x],y=c.isPointAboveHorizon(x)}else{const x=a.Point.convert(s[0]),E=a.Point.convert(s[1]);m=[x,E],y=a.polygonizeBounds(x,E).every(C=>c.isPointAboveHorizon(C))}return new tn(m,c.getCameraPoint(),y,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(s){return a.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){const c=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new a.Point(1,1)):this.screenBounds[1],y=a.polygonizeBounds(c,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<m.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?y[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(y[3]=this.cameraPoint)),a.bufferConvexPolygon(y,s)}bufferedCameraGeometryGlobe(s){const c=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new a.Point(1,1)):this.screenBounds[1],y=a.polygonizeBounds(c,m,s),x=this.cameraPoint.clone();switch(3*((x.y>c.y)+(x.y>m.y))+((x.x>c.x)+(x.x>m.x))){case 0:y[0]=x,y[4]=x.clone();break;case 1:y.splice(1,0,x);break;case 2:y[1]=x;break;case 3:y.splice(4,0,x);break;case 5:y.splice(2,0,x);break;case 6:y[3]=x;break;case 7:y.splice(3,0,x);break;case 8:y[2]=x}return y}containsTile(s,c,m,y=0){const x=s.queryPadding/c._pixelsPerMercatorPixel+1,E=m?this._bufferedCameraMercator(x,c):this._bufferedScreenMercator(x,c);let C=s.tileID.wrap+(E.unwrapped?y:0);const A=E.polygon.map(J=>a.getTilePoint(s.tileTransform,J,C));if(!a.polygonIntersectsBox(A,0,0,a.EXTENT,a.EXTENT))return;C=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const L=this.screenGeometryMercator.polygon.map(J=>a.getTileVec3(s.tileTransform,J,C)),R=L.map(J=>new a.Point(J[0],J[1])),B=c.getFreeCameraOptions().position||new a.MercatorCoordinate(0,0,0),G=a.getTileVec3(s.tileTransform,B,C),Z=L.map(J=>{const F=a.sub(J,J,G);return a.normalize(F,F),new a.Ray(G,F)}),Y=Bt(s,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:R,tilespaceRays:Z,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(K=a.getBounds(A),K.min.x=a.clamp(K.min.x,0,a.EXTENT),K.min.y=a.clamp(K.min.y,0,a.EXTENT),K.max.x=a.clamp(K.max.x,0,a.EXTENT),K.max.y=a.clamp(K.max.y,0,a.EXTENT),K),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:Y};var K}_bufferedScreenMercator(s,c){const m=jr(s);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let y;return y=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(s),c):{polygon:this.bufferedScreenGeometry(s).map(x=>c.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[m]=y,y}}_bufferedCameraMercator(s,c){const m=jr(s);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let y;return y=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),c):{polygon:this.bufferedCameraGeometry(s).map(x=>c.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[m]=y,y}}_projectAndResample(s,c){const m=function(x,E){const C=a.multiply([],E.pixelMatrix,E.globeMatrix),A=[0,-a.GLOBE_RADIUS,0,1],L=[0,a.GLOBE_RADIUS,0,1],R=[0,0,0,1];a.transformMat4$1(A,A,C),a.transformMat4$1(L,L,C),a.transformMat4$1(R,R,C);const B=new a.Point(A[0]/A[3],A[1]/A[3]),G=new a.Point(L[0]/L[3],L[1]/L[3]),Z=a.polygonContainsPoint(x,B)&&A[3]<R[3],Y=a.polygonContainsPoint(x,G)&&L[3]<R[3];if(!Z&&!Y)return null;const K=function(me,we,xe){for(let Pe=1;Pe<me.length;Pe++){const Xe=Kr(we.pointCoordinate3D(me[Pe-1]).x),ke=Kr(we.pointCoordinate3D(me[Pe]).x);if(xe<0){if(Xe<ke)return{idx:Pe,t:-Xe/(ke-1-Xe)}}else if(ke<Xe)return{idx:Pe,t:(1-Xe)/(ke+1-Xe)}}return null}(x,E,Z?-1:1);if(!K)return null;const{idx:J,t:F}=K;let H=J>1?Yt(x.slice(0,J),E):[],ne=J<x.length?Yt(x.slice(J),E):[];H=H.map(me=>new a.Point(Kr(me.x),me.y)),ne=ne.map(me=>new a.Point(Kr(me.x),me.y));const oe=[...H];oe.length===0&&oe.push(ne[ne.length-1]);const fe=a.number(oe[oe.length-1].y,(ne.length===0?H[0]:ne[0]).y,F);let ge;return ge=Z?[new a.Point(0,fe),new a.Point(0,0),new a.Point(1,0),new a.Point(1,fe)]:[new a.Point(1,fe),new a.Point(1,1),new a.Point(0,1),new a.Point(0,fe)],oe.push(...ge),ne.length===0?oe.push(H[0]):oe.push(...ne),{polygon:oe.map(me=>new a.MercatorCoordinate(me.x,me.y)),unwrapped:!1}}(s,c);if(m)return m;const y=function(x,E){let C=!1,A=-1/0,L=0;for(let B=0;B<x.length-1;B++)x[B].x>A&&(A=x[B].x,L=B);for(let B=0;B<x.length-1;B++){const G=(L+B)%(x.length-1),Z=x[G],Y=x[G+1];Math.abs(Z.x-Y.x)>.5&&(Z.x<Y.x?(Z.x+=1,G===0&&(x[x.length-1].x+=1)):(Y.x+=1,G+1===x.length-1&&(x[0].x+=1)),C=!0)}const R=a.mercatorXfromLng(E.center.lng);return C&&R<Math.abs(R-1)&&x.forEach(B=>{B.x-=1}),{polygon:x,unwrapped:C}}(Yt(s,c).map(x=>new a.Point(Kr(x.x),x.y)),c);return{polygon:y.polygon.map(x=>new a.MercatorCoordinate(x.x,x.y)),unwrapped:y.unwrapped}}}function Yt(d,s){return a.resample(d,c=>{const m=s.pointCoordinate3D(c);c.x=m.x,c.y=m.y},1/256)}function Kr(d){return d<0?1+d%1:d%1}function jr(d){return 100*d|0}function dr(d,s,c,m,y){const x=function(E,C){if(E)return y(E);if(C){d.url&&C.tiles&&d.tiles&&delete d.tiles;const A=a.pick(a.extend(C,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(A.vectorLayers=C.vector_layers,A.vectorLayerIds=A.vectorLayers.map(L=>L.id)),A.tiles=s.canonicalizeTileset(A,d.url),y(null,A)}};return d.url?a.getJSON(s.transformRequest(s.normalizeSourceURL(d.url,null,c,m),a.ResourceType.Source),x):a.exported.frame(()=>x(null,d))}class Nr{constructor(s,c,m){this.bounds=a.LngLatBounds.convert(this.validateBounds(s)),this.minzoom=c||0,this.maxzoom=m||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const c=Math.pow(2,s.z),m=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*c),y=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*c),x=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*c),E=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*c);return s.x>=m&&s.x<x&&s.y>=y&&s.y<E}}class Kn{constructor(s,c,m){this.context=s;const y=s.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Yn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class _i{constructor(s,c,m,y){this.length=c.length,this.attributes=m,this.itemSize=c.bytesPerElement,this.dynamicDraw=y,this.context=s;const x=s.gl;this.buffer=x.createBuffer(),s.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,c){for(let m=0;m<this.attributes.length;m++){const y=c.attributes[this.attributes[m].name];y!==void 0&&s.enableVertexAttribArray(y)}}setVertexAttribPointers(s,c,m){for(let y=0;y<this.attributes.length;y++){const x=this.attributes[y],E=c.attributes[x.name];E!==void 0&&s.vertexAttribPointer(E,x.components,s[Yn[x.type]],!1,this.itemSize,x.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Lt{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class yi extends Lt{getDefault(){return a.Color.transparent}set(s){const c=this.current;(s.r!==c.r||s.g!==c.g||s.b!==c.b||s.a!==c.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class qr extends Lt{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Ji extends Lt{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class fr extends Lt{getDefault(){return[!0,!0,!0,!0]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class jn extends Lt{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class vs extends Lt{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class Ur extends Lt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const c=this.current;(s.func!==c.func||s.ref!==c.ref||s.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class rn extends Lt{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class ii extends Lt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=s,this.dirty=!1}}class Pn extends Lt{getDefault(){return[0,1]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class Qi extends Lt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=s,this.dirty=!1}}class si extends Lt{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Ai extends Lt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.BLEND):c.disable(c.BLEND),this.current=s,this.dirty=!1}}class Ns extends Lt{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class xo extends Lt{getDefault(){return a.Color.transparent}set(s){const c=this.current;(s.r!==c.r||s.g!==c.g||s.b!==c.b||s.a!==c.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Rn extends Lt{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class Mi extends Lt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=s,this.dirty=!1}}class xs extends Lt{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class es extends Lt{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let ts,Us=class extends Lt{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class Pi extends Lt{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class cr extends Lt{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Ri extends Lt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class rs extends Lt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class ns extends Lt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class bo extends Lt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class ae extends Lt{getDefault(){return null}set(s){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class $ extends Lt{constructor(s){super(s),this.vao=s.extVertexArrayObject}getDefault(){return null}set(s){this.vao&&(s!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(s),this.current=s,this.dirty=!1)}}class U extends Lt{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class re extends Lt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class ce extends Lt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class _e extends Lt{constructor(s,c){super(s),this.context=s,this.parent=c}getDefault(){return null}}class Te extends _e{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Ee extends _e{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class ye extends Ee{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ze{constructor(s,c,m,y){this.context=s,this.width=c,this.height=m;const x=this.framebuffer=s.gl.createFramebuffer();this.colorAttachment=new Te(s,x),y&&(this.depthAttachment=new Ee(s,x))}destroy(){const s=this.context.gl,c=this.colorAttachment.get();if(c&&s.deleteTexture(c),this.depthAttachment){const m=this.depthAttachment.get();m&&s.deleteRenderbuffer(m)}s.deleteFramebuffer(this.framebuffer)}}class et{constructor(s,c=!1){if(this.gl=s,this.isWebGL2=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),c){const m=s;this.extVertexArrayObject={createVertexArrayOES:m.createVertexArray.bind(s),deleteVertexArrayOES:m.deleteVertexArray.bind(s),bindVertexArrayOES:m.bindVertexArray.bind(s)}}this.clearColor=new yi(this),this.clearDepth=new qr(this),this.clearStencil=new Ji(this),this.colorMask=new fr(this),this.depthMask=new jn(this),this.stencilMask=new vs(this),this.stencilFunc=new Ur(this),this.stencilOp=new rn(this),this.stencilTest=new ii(this),this.depthRange=new Pn(this),this.depthTest=new Qi(this),this.depthFunc=new si(this),this.blend=new Ai(this),this.blendFunc=new Ns(this),this.blendColor=new xo(this),this.blendEquation=new Rn(this),this.cullFace=new Mi(this),this.cullFaceSide=new xs(this),this.frontFace=new es(this),this.program=new Us(this),this.activeTexture=new Pi(this),this.viewport=new cr(this),this.bindFramebuffer=new Ri(this),this.bindRenderbuffer=new rs(this),this.bindTexture=new ns(this),this.bindVertexBuffer=new bo(this),this.bindElementBuffer=new ae(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new $(this),this.pixelStoreUnpack=new U(this),this.pixelStoreUnpackPremultiplyAlpha=new re(this),this.pixelStoreUnpackFlipY=new ce(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),c||(this.extTextureHalfFloat=s.getExtension("OES_texture_half_float")),(c||this.extTextureHalfFloat&&s.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=c||s.getExtension("OES_standard_derivatives"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,c){return new Kn(this,s,c)}createVertexBuffer(s,c,m){return new _i(this,s,c,m)}createRenderbuffer(s,c,m){const y=this.gl,x=y.createRenderbuffer();return this.bindRenderbuffer.set(x),y.renderbufferStorage(y.RENDERBUFFER,s,c,m),this.bindRenderbuffer.set(null),x}createFramebuffer(s,c,m){return new ze(this,s,c,m)}clear({color:s,depth:c,stencil:m}){const y=this.gl;let x=0;s&&(x|=y.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(x|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),m!==void 0&&(x|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),y.clear(x)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){I(s.blendFunction,a.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ot extends a.Evented{constructor(s,c,m,y){if(super(),this.id=s,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(c,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},c),this._collectResourceTiming=c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new a.DedupedRequest}load(s){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map._worldview;this._tileJSONRequest=dr(this._options,this.map._requestManager,c,m,(y,x)=>{this._tileJSONRequest=null,this._loaded=!0,y?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),m&&m.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new a.ErrorEvent(y))):x&&(a.extend(this,x),x.bounds&&(this.tileBounds=new Nr(x.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(x.tiles,this.map._requestManager._customAccessToken),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))),s&&s(y)})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return a.extend({},this._options)}loadTile(s,c){const m=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(m,a.ResourceType.Tile),data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile};if(y.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired")s.state==="loading"?s.reloadCallback=c:s.request=s.actor.send("reloadTile",y,x.bind(this));else if(s.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",y,x.bind(this),void 0,!0);else{const E=a.loadVectorTile.call({deduped:this._deduped},y,(C,A)=>{C||!A?x.call(this,C):(y.data={cacheControl:A.cacheControl,expires:A.expires,rawData:A.rawData.slice(0)},s.actor&&s.actor.send("loadTile",y,x.bind(this),void 0,!0))},!0);s.request={cancel:E}}function x(E,C){return delete s.request,s.aborted?c(null):E&&E.status!==404?c(E):(C&&C.resourceTiming&&(s.resourceTiming=C.resourceTiming),this.map._refreshExpiredTiles&&C&&s.setExpiryData(C),s.loadVectorData(C,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),c(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id})}unloadTile(s){s.unloadVectorData(),s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ye extends a.Evented{constructor(s,c,m,y){super(),this.id=s,this.dispatcher=m,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},c),a.extend(this,a.pick(c,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=dr(this._options,this.map._requestManager,null,null,(c,m)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new a.ErrorEvent(c)):m&&(a.extend(this,m),m.bounds&&(this.tileBounds=new Nr(m.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(m.tiles),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))),s&&s(c)})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return a.extend({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,c){const m=a.exported.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);s.request=a.getImage(this.map._requestManager.transformRequest(y,a.ResourceType.Tile),(x,E,C,A)=>(delete s.request,s.aborted?(s.state="unloaded",c(null)):x?(s.state="errored",c(x)):E?(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:C,expires:A}),s.setTexture(E,this.map.painter),s.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),void c(null)):c(null)))}static loadTileData(s,c,m){s.setTexture(c,m)}static unloadTileData(s,c){s.texture&&c.saveTileTexture(s.texture)}abortTile(s,c){s.request&&(s.request.cancel(),delete s.request),c()}unloadTile(s,c){s.texture&&this.map.painter.saveTileTexture(s.texture),c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Mt(d,s,c,m,y,x,E,C){const A=[d,c,y,s,m,x,1,1,1],L=[E,C,1],R=a.adjoint([],A),[B,G,Z]=a.transformMat3(L,L,a.transpose(R,R));return a.multiply$1(A,[B,0,0,0,G,0,0,0,Z],A)}class Nt extends a.Evented{constructor(s,c,m,y){super(),this.id=s,this.dispatcher=m,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=c,this._dirty=!1}load(s,c){this._loaded=c||!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(m,y)=>{if(this._imageRequest=null,this._loaded=!0,m)this.fire(new a.ErrorEvent(m));else if(y){const{HTMLImageElement:x}=a.window;this.image=y instanceof x?a.exported.getImageData(y):y,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,s&&(this.coordinates=s),this._finishLoading()}})}loaded(){return this._loaded}updateImage(s){return this.image&&s.url?(this._imageRequest&&s.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=s.url,this.load(s.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(s){this.coordinates=s,this._boundsArray=void 0;const c=s.map(a.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let y=1/0,x=1/0,E=-1/0,C=-1/0;for(const B of m)y=Math.min(y,B.x),x=Math.min(x,B.y),E=Math.max(E,B.x),C=Math.max(C,B.y);const A=Math.max(E-y,C-x),L=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),R=Math.pow(2,L);return new a.CanonicalTileID(L,Math.floor((y+E)/2*R),Math.floor((x+C)/2*R))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(s){for(const A in this.tiles){const L=this.tiles[A];L.state!=="loaded"&&(L.state="loaded",L.texture=this.texture)}if(this._boundsArray)return;const c=a.tileTransform(this.tileID,this.map.transform.projection),[m,y,x,E]=this.coordinates.map(A=>{const L=c.projection.project(A[0],A[1]);return a.getTilePoint(c,L)._round()});this.perspectiveTransform=function(A,L,R,B,G,Z,Y,K,J,F){const H=Mt(0,0,A,0,0,L,A,L),ne=Mt(R,B,G,Z,Y,K,J,F);return a.multiply$1(ne,a.adjoint(H,H),ne),[ne[6]/ne[8]*A/a.EXTENT,ne[7]/ne[8]*L/a.EXTENT]}(this.width,this.height,m.x,m.y,y.x,y.y,E.x,E.y,x.x,x.y);const C=this._boundsArray=new a.StructArrayLayout4i8;C.emplaceBack(m.x,m.y,0,0),C.emplaceBack(y.x,y.y,a.EXTENT,0),C.emplaceBack(E.x,E.y,0,a.EXTENT),C.emplaceBack(x.x,x.y,a.EXTENT,a.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=s.createVertexBuffer(C,a.boundsAttributes.members),this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const s=this.map.painter.context,c=s.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new a.Texture(s,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(s)}loadTile(s,c){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},c(null)):(s.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Pt={vector:ot,raster:Ye,"raster-dem":class extends Ye{constructor(d,s,c,m){super(d,s,c,m),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(d,s){const c=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(y,x){y&&(d.state="errored",s(y)),x&&(d.dem=x,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",s(null))}d.request=a.getImage(this.map._requestManager.transformRequest(c,a.ResourceType.Tile),(function(y,x,E,C){if(delete d.request,d.aborted)d.state="unloaded",s(null);else if(y)d.state="errored",s(y);else if(x){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:E,expires:C});const A=a.window.ImageBitmap&&x instanceof a.window.ImageBitmap&&(ts==null&&(ts=a.window.OffscreenCanvas&&new a.window.OffscreenCanvas(1,1).getContext("2d")&&typeof a.window.createImageBitmap=="function"),ts),L=1-(x.width-a.prevPowerOfTwo(x.width))/2;L<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const R=A?x:a.exported.getImageData(x,L),B={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:R,encoding:this.encoding,padding:L};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",B,m.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){const s=d.canonical,c=Math.pow(2,s.z),m=(s.x-1+c)%c,y=s.x===0?d.wrap-1:d.wrap,x=(s.x+1+c)%c,E=s.x+1===c?d.wrap+1:d.wrap,C={};return C[new a.OverscaledTileID(d.overscaledZ,y,s.z,m,s.y).key]={backfilled:!1},C[new a.OverscaledTileID(d.overscaledZ,E,s.z,x,s.y).key]={backfilled:!1},s.y>0&&(C[new a.OverscaledTileID(d.overscaledZ,y,s.z,m,s.y-1).key]={backfilled:!1},C[new a.OverscaledTileID(d.overscaledZ,d.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},C[new a.OverscaledTileID(d.overscaledZ,E,s.z,x,s.y-1).key]={backfilled:!1}),s.y+1<c&&(C[new a.OverscaledTileID(d.overscaledZ,y,s.z,m,s.y+1).key]={backfilled:!1},C[new a.OverscaledTileID(d.overscaledZ,d.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},C[new a.OverscaledTileID(d.overscaledZ,E,s.z,x,s.y+1).key]={backfilled:!1}),C}unloadTile(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded"}},geojson:class extends a.Evented{constructor(d,s,c,m){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(m),this._data=s.data,this._options=a.extend({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const y=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*y,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*y,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:a.EXTENT,radius:(s.clusterRadius!==void 0?s.clusterRadius:50)*y,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},s),this}getClusterChildren(d,s){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},s),this}getClusterLeaves(d,s,c,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:s,offset:c},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.Event("dataloading",{dataType:"source"})),this._loaded=!1;const d=a.extend({},this.workerOptions),s=this._data;typeof s=="string"?(d.request=this.map._requestManager.transformRequest(a.exported.resolveURL(s),a.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(c,m)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new a.ErrorEvent(c));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(y.resourceTiming=m.resourceTiming[this.id]),this.fire(new a.Event("data",y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,s){const c=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(c,{type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,y)=>(delete d.request,d.unloadVectorData(),d.aborted?s(null):m?s(m):(d.loadVectorData(y,this.map.painter,c==="reloadTile"),s(null))),void 0,c==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Nt{constructor(d,s,c,m){super(d,s,c,m),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const s of d.urls)this.urls.push(this.map._requestManager.transformRequest(s,a.ResourceType.Source).url);a.getVideo(this.urls,(s,c)=>{this._loaded=!0,s?this.fire(new a.ErrorEvent(s)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const s=this.video.seekable;d<s.start(0)||d>s.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,s=d.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new a.Texture(d,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Nt,canvas:class extends Nt{constructor(d,s,c,m){super(d,s,c,m),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(x=>typeof x!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${d}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof a.window.HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${d}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof a.window.HTMLCanvasElement?this.options.canvas:a.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context;this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.Texture(s,this.canvas,s.gl.RGBA,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends a.Evented{constructor(d,s,c,m){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=s,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Nr(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),a.extend(this,a.pick(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this._map=d,this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:s,y:c,z:m}=d.canonical;return this._implementation.hasTile({x:s,y:c,z:m})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,s){const{x:c,y:m,z:y}=d.tileID.canonical,x=new a.window.AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:c,y:m,z:y},{signal:x.signal})).then((function(E){return delete d.request,d.aborted?(d.state="unloaded",s(null)):E===void 0?(d.state="errored",s(null)):E===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",s(null)):function(C){return C instanceof a.window.ImageData||C instanceof a.window.HTMLCanvasElement||C instanceof a.window.ImageBitmap||C instanceof a.window.HTMLImageElement}(E)?(this.loadTileData(d,E),d.state="loaded",void s(null)):(d.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(E=>{E.code!==20&&(d.state="errored",s(E))}),d.request.cancel=()=>x.abort()}loadTileData(d,s){Ye.loadTileData(d,s,this._map.painter)}unloadTileData(d){Ye.unloadTileData(d,this._map.painter)}unloadTile(d,s){if(this.unloadTileData(d),this._implementation.unloadTile){const{x:c,y:m,z:y}=d.tileID.canonical;this._implementation.unloadTile({x:c,y:m,z:y})}s()}abortTile(d,s){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),s()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Ut=function(d,s,c,m){const y=new Pt[s.type](d,s,c,m);if(y.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${y.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],y),y};function Xt(d,s){const c=a.identity([]);return a.scale(c,c,[.5*d.width,.5*-d.height,1]),a.translate(c,c,[1,-1,0]),a.multiply(c,c,d.calculateProjMatrix(s.toUnwrapped())),Float32Array.from(c)}function pr(d,s,c,m,y,x,E,C=!1){const A=d.tilesIn(m,E,C);A.sort(bn);const L=[];for(const B of A)L.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(s,c,d._state,B,y,x,Xt(d.transform,B.tile.tileID),C)});const R=function(B){const G={},Z={};for(const Y of B){const K=Y.queryResults,J=Y.wrappedTileID,F=Z[J]=Z[J]||{};for(const H in K){const ne=K[H],oe=F[H]=F[H]||{},fe=G[H]=G[H]||[];for(const ge of ne)oe[ge.featureIndex]||(oe[ge.featureIndex]=!0,fe.push(ge))}}return G}(L);for(const B in R)R[B].forEach(G=>{const Z=G.feature,Y=Z.layer;Y&&Y.type!=="background"&&Y.type!=="sky"&&(Z.source=Y.source,Y["source-layer"]&&(Z.sourceLayer=Y["source-layer"]),Z.state=Z.id!==void 0?d.getFeatureState(Y["source-layer"],Z.id):{})});return R}function Rr(d,s){const c=d.getRenderableIds().map(x=>d.getTileByID(x)),m=[],y={};for(let x=0;x<c.length;x++){const E=c[x],C=E.tileID.canonical.key;y[C]||(y[C]=!0,E.querySourceFeatures(m,s))}return m}function bn(d,s){const c=d.tileID,m=s.tileID;return c.overscaledZ-m.overscaledZ||c.canonical.y-m.canonical.y||c.wrap-m.wrap||c.canonical.x-m.canonical.x}function Yr(){return el.workerClass!=null?new el.workerClass:new a.window.Worker(el.workerUrl)}const vi="mapboxgl_preloaded_worker_pool";class gn{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<gn.workerCount;)this.workers.push(new Yr);return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[vi]}numActive(){return Object.keys(this.active).length}}let nn;function Vs(){return nn||(nn=new gn),nn}function bt(d,s){const c={};for(const m in d)m!=="ref"&&(c[m]=d[m]);return a.refProperties.forEach(m=>{m in s&&(c[m]=s[m])}),c}function ic(d){d=d.slice();const s=Object.create(null);for(let c=0;c<d.length;c++)s[d[c].id]=d[c];for(let c=0;c<d.length;c++)"ref"in d[c]&&(d[c]=bt(d[c],s[d[c].ref]));return d}gn.workerCount=2;const Wt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ra(d,s,c){c.push({command:Wt.addSource,args:[d,s[d]]})}function wo(d,s,c){s.push({command:Wt.removeSource,args:[d]}),c[d]=!0}function La(d,s,c,m){wo(d,c,m),Ra(d,s,c)}function Jo(d,s,c){let m;for(m in d[c])if(d[c].hasOwnProperty(m)&&m!=="data"&&!I(d[c][m],s[c][m]))return!1;for(m in s[c])if(s[c].hasOwnProperty(m)&&m!=="data"&&!I(d[c][m],s[c][m]))return!1;return!0}function xi(d,s,c,m,y,x){let E;for(E in s=s||{},d=d||{})d.hasOwnProperty(E)&&(I(d[E],s[E])||c.push({command:x,args:[m,E,s[E],y]}));for(E in s)s.hasOwnProperty(E)&&!d.hasOwnProperty(E)&&(I(d[E],s[E])||c.push({command:x,args:[m,E,s[E],y]}))}function Li(d){return d.id}function za(d,s){return d[s.id]=s,d}class Da{constructor(s,c){this.reset(s,c)}reset(s,c){this.points=s||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=a.clamp(s,0,1);let c=1,m=this._distances[c];const y=s*this.paddedLength+this.padding;for(;m<y&&c<this._distances.length;)m=this._distances[++c];const x=c-1,E=this._distances[x],C=m-E,A=C>0?(y-E)/C:0;return this.points[x].mult(1-A).add(this.points[c].mult(A))}}class bs{constructor(s,c,m){const y=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(s/m),this.yCellCount=Math.ceil(c/m);for(let E=0;E<this.xCellCount*this.yCellCount;E++)y.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=c,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,c,m,y,x){this._forEachCell(c,m,y,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(y),this.bboxes.push(x)}insertCircle(s,c,m,y){this._forEachCell(c-y,m-y,c+y,m+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(c),this.circles.push(m),this.circles.push(y)}_insertBoxCell(s,c,m,y,x,E){this.boxCells[x].push(E)}_insertCircleCell(s,c,m,y,x,E){this.circleCells[x].push(E)}_query(s,c,m,y,x,E){if(m<0||s>this.width||y<0||c>this.height)return!x&&[];const C=[];if(s<=0&&c<=0&&this.width<=m&&this.height<=y){if(x)return!0;for(let A=0;A<this.boxKeys.length;A++)C.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const L=this.circles[3*A],R=this.circles[3*A+1],B=this.circles[3*A+2];C.push({key:this.circleKeys[A],x1:L-B,y1:R-B,x2:L+B,y2:R+B})}return E?C.filter(E):C}return this._forEachCell(s,c,m,y,this._queryCell,C,{hitTest:x,seenUids:{box:{},circle:{}}},E),x?C.length>0:C}_queryCircle(s,c,m,y,x){const E=s-m,C=s+m,A=c-m,L=c+m;if(C<0||E>this.width||L<0||A>this.height)return!y&&[];const R=[];return this._forEachCell(E,A,C,L,this._queryCellCircle,R,{hitTest:y,circle:{x:s,y:c,radius:m},seenUids:{box:{},circle:{}}},x),y?R.length>0:R}query(s,c,m,y,x){return this._query(s,c,m,y,!1,x)}hitTest(s,c,m,y,x){return this._query(s,c,m,y,!0,x)}hitTestCircle(s,c,m,y){return this._queryCircle(s,c,m,!0,y)}_queryCell(s,c,m,y,x,E,C,A){const L=C.seenUids,R=this.boxCells[x];if(R!==null){const G=this.bboxes;for(const Z of R)if(!L.box[Z]){L.box[Z]=!0;const Y=4*Z;if(s<=G[Y+2]&&c<=G[Y+3]&&m>=G[Y+0]&&y>=G[Y+1]&&(!A||A(this.boxKeys[Z]))){if(C.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[Z],x1:G[Y],y1:G[Y+1],x2:G[Y+2],y2:G[Y+3]})}}}const B=this.circleCells[x];if(B!==null){const G=this.circles;for(const Z of B)if(!L.circle[Z]){L.circle[Z]=!0;const Y=3*Z;if(this._circleAndRectCollide(G[Y],G[Y+1],G[Y+2],s,c,m,y)&&(!A||A(this.circleKeys[Z]))){if(C.hitTest)return E.push(!0),!0;{const K=G[Y],J=G[Y+1],F=G[Y+2];E.push({key:this.circleKeys[Z],x1:K-F,y1:J-F,x2:K+F,y2:J+F})}}}}}_queryCellCircle(s,c,m,y,x,E,C,A){const L=C.circle,R=C.seenUids,B=this.boxCells[x];if(B!==null){const Z=this.bboxes;for(const Y of B)if(!R.box[Y]){R.box[Y]=!0;const K=4*Y;if(this._circleAndRectCollide(L.x,L.y,L.radius,Z[K+0],Z[K+1],Z[K+2],Z[K+3])&&(!A||A(this.boxKeys[Y])))return E.push(!0),!0}}const G=this.circleCells[x];if(G!==null){const Z=this.circles;for(const Y of G)if(!R.circle[Y]){R.circle[Y]=!0;const K=3*Y;if(this._circlesCollide(Z[K],Z[K+1],Z[K+2],L.x,L.y,L.radius)&&(!A||A(this.circleKeys[Y])))return E.push(!0),!0}}}_forEachCell(s,c,m,y,x,E,C,A){const L=this._convertToXCellCoord(s),R=this._convertToYCellCoord(c),B=this._convertToXCellCoord(m),G=this._convertToYCellCoord(y);for(let Z=L;Z<=B;Z++)for(let Y=R;Y<=G;Y++)if(x.call(this,s,c,m,y,this.xCellCount*Y+Z,E,C,A))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,c,m,y,x,E){const C=y-s,A=x-c,L=m+E;return L*L>C*C+A*A}_circleAndRectCollide(s,c,m,y,x,E,C){const A=(E-y)/2,L=Math.abs(s-(y+A));if(L>A+m)return!1;const R=(C-x)/2,B=Math.abs(c-(x+R));if(B>R+m)return!1;if(L<=A||B<=R)return!0;const G=L-A,Z=B-R;return G*G+Z*Z<=m*m}}const zi={unknown:0,flipRequired:1,flipNotRequired:2},So=Math.tan(85*Math.PI/180);function Be(d,s,c,m,y,x,E){const C=a.create();if(c)if(x.name==="globe"){const A=a.calculateGlobeLabelMatrix(y,s);a.multiply(C,C,A)}else{const A=Ae([],E);C[0]=A[0],C[1]=A[1],C[4]=A[2],C[5]=A[3],m||a.rotateZ(C,C,y.angle)}else a.multiply(C,y.labelPlaneMatrix,d);return C}function Di(d,s,c,m,y,x,E){const C=Be(d,s,c,m,y,x,E);return x.name==="globe"&&c||(C[2]=C[6]=C[10]=C[14]=0),C}function Vr(d,s,c,m,y,x,E){if(c){if(x.name==="globe"){const C=Be(d,s,c,m,y,x,E);return a.invert(C,C),a.multiply(C,d,C),C}{const C=a.clone(d),A=a.identity([]);return A[0]=E[0],A[1]=E[1],A[4]=E[2],A[5]=E[3],a.multiply(C,C,A),m||a.rotateZ(C,C,-y.angle),C}}return y.glCoordMatrix}function sn(d,s,c,m){const y=[d,s,c,1];c?a.transformMat4$1(y,y,m):Gt(y,y,m);const x=y[3];return y[0]/=x,y[1]/=x,y[2]/=x,y}function ql(d,s){return Math.min(.5+d/s*.5,1.5)}function bi(d,s){const c=d[0]/d[3],m=d[1]/d[3];return c>=-s[0]&&c<=s[0]&&m>=-s[1]&&m<=s[1]}function Oa(d,s,c,m,y,x,E,C,A,L){const R=c.transform,B=m?d.textSizeData:d.iconSizeData,G=a.evaluateSizeForZoom(B,c.transform.zoom),Z=R.projection.name==="globe",Y=[256/c.width*2+1,256/c.height*2+1],K=m?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;K.clear();let J=null;Z&&(J=m?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const F=d.lineVertexArray,H=m?d.text.placedSymbolArray:d.icon.placedSymbolArray,ne=c.transform.width/c.transform.height;let oe,fe=!1;for(let ge=0;ge<H.length;ge++){const me=H.get(ge),{numGlyphs:we,writingMode:xe}=me;if(xe!==a.WritingMode.vertical||fe||oe===a.WritingMode.horizontal||(fe=!0),oe=xe,(me.hidden||xe===a.WritingMode.vertical)&&!fe){oi(we,K);continue}fe=!1;const Pe=new a.Point(me.tileAnchorX,me.tileAnchorY);let{x:Xe,y:ke,z:Ve}=R.projection.projectTilePoint(Pe.x,Pe.y,L.canonical);if(A){const[At,gt,Et]=A(Pe);Xe+=At,ke+=gt,Ve+=Et}const De=[Xe,ke,Ve,1];if(a.transformMat4$1(De,De,s),!bi(De,Y)){oi(we,K);continue}const Ze=ql(c.transform.cameraToCenterDistance,De[3]),Me=a.evaluateSizeForFeature(B,G,me),Ue=E?Me/Ze:Me*Ze,Je=sn(Xe,ke,Ve,y);if(Je[3]<=0){oi(we,K);continue}let We={};const Qe=E?null:A,vt=ct(me,Ue,!1,C,s,y,x,d.glyphOffsetArray,F,K,J,Je,Pe,We,ne,Qe,R.projection,L,E);fe=vt.useVertical,Qe&&vt.needsFlipping&&(We={}),(vt.notEnoughRoom||fe||vt.needsFlipping&&ct(me,Ue,!0,C,s,y,x,d.glyphOffsetArray,F,K,J,Je,Pe,We,ne,Qe,R.projection,L,E).notEnoughRoom)&&oi(we,K)}m?(d.text.dynamicLayoutVertexBuffer.updateData(K),J&&d.text.globeExtVertexBuffer.updateData(J)):(d.icon.dynamicLayoutVertexBuffer.updateData(K),J&&d.icon.globeExtVertexBuffer.updateData(J))}function Hl(d,s,c,m,y,x,E,C,A,L,R,B,G,Z,Y,K){const{lineStartIndex:J,glyphStartIndex:F,segment:H}=C,ne=F+C.numGlyphs,oe=J+C.lineLength,fe=s.getoffsetX(F),ge=s.getoffsetX(ne-1),me=Nn(d*fe,c,m,y,x,E,H,J,oe,A,L,R,B,G,!0,Z,Y,K);if(!me)return null;const we=Nn(d*ge,c,m,y,x,E,H,J,oe,A,L,R,B,G,!0,Z,Y,K);return we?{first:me,last:we}:null}function $s(d,s,c,m){return d===a.WritingMode.horizontal&&Math.abs(m)>Math.abs(c)?{useVertical:!0}:d===a.WritingMode.vertical?m>0?{needsFlipping:!0}:null:s!==zi.unknown&&function(y,x){return y===0||Math.abs(x/y)>So}(c,m)?s===zi.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function ct(d,s,c,m,y,x,E,C,A,L,R,B,G,Z,Y,K,J,F,H){const ne=s/24,oe=d.lineOffsetX*ne,fe=d.lineOffsetY*ne,{lineStartIndex:ge,glyphStartIndex:me,numGlyphs:we,segment:xe,writingMode:Pe,flipState:Xe}=d,ke=ge+d.lineLength,Ve=De=>{if(R){const[Je,We,Qe]=De.up,vt=L.length;a.updateGlobeVertexNormal(R,vt+0,Je,We,Qe),a.updateGlobeVertexNormal(R,vt+1,Je,We,Qe),a.updateGlobeVertexNormal(R,vt+2,Je,We,Qe),a.updateGlobeVertexNormal(R,vt+3,Je,We,Qe)}const[Ze,Me,Ue]=De.point;a.addDynamicAttributes(L,Ze,Me,Ue,De.angle)};if(we>1){const De=Hl(ne,C,oe,fe,c,B,G,d,A,x,Z,K,!1,J,F,H);if(!De)return{notEnoughRoom:!0};if(m&&!c){let[Ze,Me,Ue]=De.first.point,[Je,We,Qe]=De.last.point;[Ze,Me]=sn(Ze,Me,Ue,E),[Je,We]=sn(Je,We,Qe,E);const vt=$s(Pe,Xe,(Je-Ze)*Y,We-Me);if(d.flipState=vt&&vt.needsFlipping?zi.flipRequired:zi.flipNotRequired,vt)return vt}Ve(De.first);for(let Ze=me+1;Ze<me+we-1;Ze++){const Me=Nn(ne*C.getoffsetX(Ze),oe,fe,c,B,G,xe,ge,ke,A,x,Z,K,!1,!1,J,F,H);if(!Me)return L.length-=4*(Ze-me),{notEnoughRoom:!0};Ve(Me)}Ve(De.last)}else{if(m&&!c){const Ze=sn(G.x,G.y,0,y),Me=ge+xe+1,Ue=new a.Point(A.getx(Me),A.gety(Me)),Je=sn(Ue.x,Ue.y,0,y),We=Je[3]>0?Je:Vt(G,Ue,Ze,1,y,void 0,J,F.canonical),Qe=$s(Pe,Xe,(We[0]-Ze[0])*Y,We[1]-Ze[1]);if(d.flipState=Qe&&Qe.needsFlipping?zi.flipRequired:zi.flipNotRequired,Qe)return Qe}const De=Nn(ne*C.getoffsetX(me),oe,fe,c,B,G,xe,ge,ke,A,x,Z,K,!1,!1,J,F,H);if(!De)return{notEnoughRoom:!0};Ve(De)}return{}}function qt(d,s,c,m,y){const{x,y:E,z:C}=m.projectTilePoint(d.x,d.y,s);if(!y)return sn(x,E,C,c);const[A,L,R]=y(d);return sn(x+A,E+L,C+R,c)}function Vt(d,s,c,m,y,x,E,C){const A=qt(d.sub(s)._unit()._add(d),C,y,E,x);return a.sub(A,c,A),a.normalize(A,A),a.scaleAndAdd(A,c,A,m)}function Nn(d,s,c,m,y,x,E,C,A,L,R,B,G,Z,Y,K,J,F){const H=m?d-s:d+s;let ne=H>0?1:-1,oe=0;m&&(ne*=-1,oe=Math.PI),ne<0&&(oe+=Math.PI);let fe=C+E+(ne>0?0:1)|0,ge=y,me=y,we=0,xe=0;const Pe=Math.abs(H),Xe=[],ke=[];let Ve=x,De=Ve;const Ze=()=>Vt(De,Ve,me,Pe-we+1,R,G,K,J.canonical);for(;we+xe<=Pe;){if(fe+=ne,fe<C||fe>=A)return null;if(me=ge,De=Ve,Xe.push(me),Z&&ke.push(De),Ve=new a.Point(L.getx(fe),L.gety(fe)),ge=B[fe],!ge){const Et=qt(Ve,J.canonical,R,K,G);ge=Et[3]>0?B[fe]=Et:Ze()}we+=xe,xe=a.distance(me,ge)}Y&&G&&(B[fe]&&(ge=Ze(),xe=a.distance(me,ge)),B[fe]=ge);const Me=(Pe-we)/xe,Ue=Ve.sub(De)._mult(Me)._add(De),Je=a.sub([],ge,me),We=a.scaleAndAdd([],me,Je,Me);let Qe=[0,0,1],vt=Je[0],At=Je[1];if(F&&(Qe=K.upVector(J.canonical,Ue.x,Ue.y),Qe[0]!==0||Qe[1]!==0||Qe[2]!==1)){const Et=[Qe[2],0,-Qe[0]],Zt=a.cross([],Qe,Et);a.normalize(Et,Et),a.normalize(Zt,Zt),vt=a.dot(Je,Et),At=a.dot(Je,Zt)}if(c){const Et=a.cross([],Qe,Je);a.normalize(Et,Et),a.scaleAndAdd(We,We,Et,c*ne)}const gt=oe+Math.atan2(At,vt);return Xe.push(We),Z&&ke.push(Ue),{point:We,angle:gt,path:Xe,tilePath:ke,up:Qe}}function oi(d,s){const c=s.length,m=c+4*d;s.resize(m),s.float32.fill(-1/0,4*c,4*m)}function Gt(d,s,c){const m=s[0],y=s[1];return d[0]=c[0]*m+c[4]*y+c[12],d[1]=c[1]*m+c[5]*y+c[13],d[3]=c[3]*m+c[7]*y+c[15],d}const Un=100;class To{constructor(s,c,m=new bs(s.width+200,s.height+200,25),y=new bs(s.width+200,s.height+200,25)){this.transform=s,this.grid=m,this.ignoredGrid=y,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+Un,this.screenBottomBoundary=s.height+Un,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=c}placeCollisionBox(s,c,m,y,x,E,C,A){let L=m.projectedAnchorX,R=m.projectedAnchorY,B=m.projectedAnchorZ;const G=m.elevation,Z=m.tileID,Y=s.getProjection();if(G&&Z){const[ge,me,we]=Y.upVector(Z.canonical,m.tileAnchorX,m.tileAnchorY),xe=Y.upVectorScale(Z.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;L+=ge*G*xe,R+=me*G*xe,B+=we*G*xe}const K=this.projectAndGetPerspectiveRatio(C,L,R,B,m.tileID,Y.name==="globe"||!!G||this.transform.pitch>0,Y),J=E*K.perspectiveRatio,F=(m.x1*c+y.x-m.padding)*J+K.point.x,H=(m.y1*c+y.y-m.padding)*J+K.point.y,ne=(m.x2*c+y.x+m.padding)*J+K.point.x,oe=(m.y2*c+y.y+m.padding)*J+K.point.y,fe=K.perspectiveRatio<=.55||K.occluded;return!this.isInsideGrid(F,H,ne,oe)||!x&&this.grid.hitTest(F,H,ne,oe,A)||fe?{box:[],offscreen:!1,occluded:K.occluded}:{box:[F,H,ne,oe],offscreen:this.isOffscreen(F,H,ne,oe),occluded:!1}}placeCollisionCircles(s,c,m,y,x,E,C,A,L,R,B,G,Z,Y,K){const J=[],F=this.transform.elevation,H=s.getProjection(),ne=F?F.getAtTileOffsetFunc(K,this.transform.center.lat,this.transform.worldSize,H):null,oe=new a.Point(m.tileAnchorX,m.tileAnchorY);let{x:fe,y:ge,z:me}=H.projectTilePoint(oe.x,oe.y,K.canonical);if(ne){const[Ue,Je,We]=ne(oe);fe+=Ue,ge+=Je,me+=We}const we=H.name==="globe",xe=this.projectAndGetPerspectiveRatio(C,fe,ge,me,K,we||!!F||this.transform.pitch>0,H),{perspectiveRatio:Pe}=xe,Xe=(B?E/Pe:E*Pe)/a.ONE_EM,ke=sn(fe,ge,me,A),Ve=xe.signedDistanceFromCamera>0?Hl(Xe,x,m.lineOffsetX*Xe,m.lineOffsetY*Xe,!1,ke,oe,m,y,A,{},F&&!B?ne:null,B&&!!F,H,K,B):null;let De=!1,Ze=!1,Me=!0;if(Ve&&!xe.occluded){const Ue=.5*Z*Pe+Y,Je=new a.Point(-100,-100),We=new a.Point(this.screenRightBoundary,this.screenBottomBoundary),Qe=new Da,{first:vt,last:At}=Ve,gt=vt.path.length;let Et=[];for(let yt=gt-1;yt>=1;yt--)Et.push(vt.path[yt]);for(let yt=1;yt<At.path.length;yt++)Et.push(At.path[yt]);const Zt=2.5*Ue;L&&(Et=Et.map(([yt,lr,mr],gr)=>(ne&&!we&&(mr=ne(gr<gt-1?vt.tilePath[gt-1-gr]:At.tilePath[gr-gt+2])[2]),sn(yt,lr,mr,L))),Et.some(yt=>yt[3]<=0)&&(Et=[]));let Ht=[];if(Et.length>0){let yt=1/0,lr=-1/0,mr=1/0,gr=-1/0;for(const _r of Et)yt=Math.min(yt,_r[0]),mr=Math.min(mr,_r[1]),lr=Math.max(lr,_r[0]),gr=Math.max(gr,_r[1]);lr>=Je.x&&yt<=We.x&&gr>=Je.y&&mr<=We.y&&(Ht=[Et.map(_r=>new a.Point(_r[0],_r[1]))],(yt<Je.x||lr>We.x||mr<Je.y||gr>We.y)&&(Ht=a.clipLine(Ht,Je.x,Je.y,We.x,We.y)))}for(const yt of Ht){Qe.reset(yt,.25*Ue);let lr=0;lr=Qe.length<=.5*Ue?1:Math.ceil(Qe.paddedLength/Zt)+1;for(let mr=0;mr<lr;mr++){const gr=mr/Math.max(lr-1,1),_r=Qe.lerp(gr),Gn=_r.x+Un,Cn=_r.y+Un;J.push(Gn,Cn,Ue,0);const ji=Gn-Ue,Cs=Cn-Ue,zr=Gn+Ue,yr=Cn+Ue;if(Me=Me&&this.isOffscreen(ji,Cs,zr,yr),Ze=Ze||this.isInsideGrid(ji,Cs,zr,yr),!c&&this.grid.hitTestCircle(Gn,Cn,Ue,G)&&(De=!0,!R))return{circles:[],offscreen:!1,collisionDetected:De,occluded:!1}}}}return{circles:!R&&De||!Ze?[]:J,offscreen:Me,collisionDetected:De,occluded:xe.occluded}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let m=1/0,y=1/0,x=-1/0,E=-1/0;for(const R of s){const B=new a.Point(R.x+Un,R.y+Un);m=Math.min(m,B.x),y=Math.min(y,B.y),x=Math.max(x,B.x),E=Math.max(E,B.y),c.push(B)}const C=this.grid.query(m,y,x,E).concat(this.ignoredGrid.query(m,y,x,E)),A={},L={};for(const R of C){const B=R.key;if(A[B.bucketInstanceId]===void 0&&(A[B.bucketInstanceId]={}),A[B.bucketInstanceId][B.featureIndex])continue;const G=[new a.Point(R.x1,R.y1),new a.Point(R.x2,R.y1),new a.Point(R.x2,R.y2),new a.Point(R.x1,R.y2)];a.polygonIntersectsPolygon(c,G)&&(A[B.bucketInstanceId][B.featureIndex]=!0,L[B.bucketInstanceId]===void 0&&(L[B.bucketInstanceId]=[]),L[B.bucketInstanceId].push(B.featureIndex))}return L}insertCollisionBox(s,c,m,y,x){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:y,collisionGroupID:x},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,c,m,y,x){const E=c?this.ignoredGrid:this.grid,C={bucketInstanceId:m,featureIndex:y,collisionGroupID:x};for(let A=0;A<s.length;A+=4)E.insertCircle(C,s[A],s[A+1],s[A+2])}projectAndGetPerspectiveRatio(s,c,m,y,x,E,C){const A=[c,m,y,1];let L=!1;y||this.transform.pitch>0?(a.transformMat4$1(A,A,s),this.fogState&&x&&C.name!=="globe"&&(L=function(G,Z,Y,K,J,F){const H=F.calculateFogTileMatrix(J),ne=[Z,Y,K];return a.transformMat4(ne,ne,H),xn(G,ne,F.pitch,F._fov)}(this.fogState,c,m,y,x.toUnwrapped(),this.transform)>.9)):Gt(A,A,s);const R=A[3];return{point:new a.Point((A[0]/R+1)/2*this.transform.width+Un,(-A[1]/R+1)/2*this.transform.height+Un),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/R*.5,1.5),signedDistanceFromCamera:R,occluded:E&&A[2]>R||L}}isOffscreen(s,c,m,y){return m<Un||s>=this.screenRightBoundary||y<Un||c>this.screenBottomBoundary}isInsideGrid(s,c,m,y){return m>=0&&s<this.gridRightBoundary&&y>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const s=a.identity([]);return a.translate(s,s,[-100,-100,0]),s}}function ws(d,s,c){const m=s.createTileMatrix(d,d.worldSize,c.toUnwrapped());return a.multiply(new Float32Array(16),d.projMatrix,m)}function Jn(d,s,c){if(s.projection.name===c.projection.name)return d.projMatrix;const m=c.clone();return m.setProjection(s.projection),ws(m,s.getProjection(),d)}function Tr(d,s,c){return s.name===c.projection.name?d.projMatrix:ws(c,s,d)}class Zl{constructor(s,c,m,y){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?c:-c))):y&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class Oi{constructor(s,c,m,y,x,E=!1){this.text=new Zl(s?s.text:null,c,m,x),this.icon=new Zl(s?s.icon:null,c,y,x),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Eo{constructor(s,c,m,y=!1){this.text=s,this.icon=c,this.skipFade=m,this.clipped=y}}class Co{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class Ba{constructor(s,c,m,y,x){this.bucketInstanceId=s,this.featureIndex=c,this.sourceLayerIndex=m,this.bucketIndex=y,this.tileID=x}}class Xl{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const c=++this.maxGroupID;this.collisionGroups[s]={ID:c,predicate:m=>m.collisionGroupID===c}}return this.collisionGroups[s]}}function ko(d,s,c,m,y){const{horizontalAlign:x,verticalAlign:E}=a.getAnchorAlignment(d),C=-(x-.5)*s,A=-(E-.5)*c,L=a.evaluateVariableOffset(d,m);return new a.Point(C+L[0]*y,A+L[1]*y)}function Io(d,s,c,m,y){const x=new a.Point(d,s);return c&&x._rotate(m?y:-y),x}class Qo{constructor(s,c,m,y,x){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new To(this.transform,x),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Xl(m),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,c,m,y){const x=m.getBucket(c),E=m.latestFeatureIndex;if(!x||!E||c.id!==x.layerIds[0])return;const C=x.layers[0].layout,A=m.collisionBoxArray,L=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),R=m.tileSize/a.EXTENT,B=m.tileID.toUnwrapped();this.transform.setProjection(x.projection);const G=(Z=m.tileID,Y=x.getProjection(),K=this.transform,Y.name===this.projection?K.calculateProjMatrix(Z.toUnwrapped()):ws(K,Y,Z));var Z,Y,K;const J=C.get("text-pitch-alignment")==="map",F=C.get("text-rotation-alignment")==="map";c.compileFilter();const H=c.dynamicFilter(),ne=c.dynamicFilterNeedsFeature(),oe=this.transform.calculatePixelsToTileUnitsMatrix(m),fe=Di(G,m.tileID.canonical,J,F,this.transform,x.getProjection(),oe);let ge=null;if(J){const xe=Vr(G,m.tileID.canonical,J,F,this.transform,x.getProjection(),oe);ge=a.multiply([],this.transform.labelPlaneMatrix,xe)}let me=null;H&&m.latestFeatureIndex&&(me={unwrappedTileID:B,dynamicFilter:H,dynamicFilterNeedsFeature:ne,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new Ba(x.bucketInstanceId,E,x.sourceLayerIndex,x.index,m.tileID);const we={bucket:x,layout:C,posMatrix:G,textLabelPlaneMatrix:fe,labelToScreenMatrix:ge,clippingData:me,scale:L,textPixelRatio:R,holdingForFade:m.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.evaluateSizeForZoom(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(y)for(const xe of x.sortKeyRanges){const{sortKey:Pe,symbolInstanceStart:Xe,symbolInstanceEnd:ke}=xe;s.push({sortKey:Pe,symbolInstanceStart:Xe,symbolInstanceEnd:ke,parameters:we})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:we})}attemptAnchorPlacement(s,c,m,y,x,E,C,A,L,R,B,G,Z,Y,K,J,F,H){const{textOffset0:ne,textOffset1:oe,crossTileID:fe}=G,ge=[ne,oe],me=ko(s,m,y,ge,x),we=this.collisionIndex.placeCollisionBox(Y,x,c,Io(me.x,me.y,E,C,this.transform.angle),B,A,L,R.predicate);if(J){const xe=Y.getSymbolInstanceIconSize(H,this.transform.zoom,G.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Y,xe,J,Io(me.x,me.y,E,C,this.transform.angle),B,A,L,R.predicate).box.length===0)return}if(we.box.length>0){let xe;return this.prevPlacement&&this.prevPlacement.variableOffsets[fe]&&this.prevPlacement.placements[fe]&&this.prevPlacement.placements[fe].text&&(xe=this.prevPlacement.variableOffsets[fe].anchor),this.variableOffsets[fe]={textOffset:ge,width:m,height:y,anchor:s,textScale:x,prevAnchor:xe},this.markUsedJustification(Y,s,G,K),Y.allowVerticalPlacement&&(this.markUsedOrientation(Y,K,G),this.placedOrientations[fe]=K),{shift:me,placedGlyphBoxes:we}}}placeLayerBucketPart(s,c,m,y){const{bucket:x,layout:E,posMatrix:C,textLabelPlaneMatrix:A,labelToScreenMatrix:L,clippingData:R,textPixelRatio:B,holdingForFade:G,collisionBoxArray:Z,partiallyEvaluatedTextSize:Y,partiallyEvaluatedIconSize:K,collisionGroup:J}=s.parameters,F=E.get("text-optional"),H=E.get("icon-optional"),ne=E.get("text-allow-overlap"),oe=E.get("icon-allow-overlap"),fe=E.get("text-rotation-alignment")==="map",ge=E.get("text-pitch-alignment")==="map",me=E.get("icon-text-fit")!=="none",we=E.get("symbol-z-order")==="viewport-y";this.transform.setProjection(x.projection);let xe=ne&&(oe||!x.hasIconData()||H),Pe=oe&&(ne||!x.hasTextData()||F);!x.collisionArrays&&Z&&x.deserializeCollisionBoxes(Z),m&&y&&x.updateCollisionDebugBuffers(this.transform.zoom,Z);const Xe=(ke,Ve,De)=>{const{crossTileID:Ze,numVerticalGlyphVertices:Me}=ke;if(R){const zr={zoom:this.transform.zoom,pitch:this.transform.pitch};let yr=null;if(R.dynamicFilterNeedsFeature){const ir=this.retainedQueryData[x.bucketInstanceId];yr=R.featureIndex.loadFeature({featureIndex:ke.featureIndex,bucketIndex:ir.bucketIndex,sourceLayerIndex:ir.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,R.dynamicFilter)(zr,yr,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new a.Point(ke.tileAnchorX,ke.tileAnchorY),this.transform.calculateDistanceTileData(R.unwrappedTileID)))return this.placements[Ze]=new Eo(!1,!1,!1,!0),void c.add(Ze)}if(c.has(Ze))return;if(G)return void(this.placements[Ze]=new Eo(!1,!1,!1));let Ue=!1,Je=!1,We=!0,Qe=!1,vt=!1,At=null,gt={box:null,offscreen:null,occluded:null},Et={box:null,offscreen:null,occluded:null},Zt=null,Ht=null,yt=null,lr=0,mr=0,gr=0;De.textFeatureIndex?lr=De.textFeatureIndex:ke.useRuntimeCollisionCircles&&(lr=ke.featureIndex),De.verticalTextFeatureIndex&&(mr=De.verticalTextFeatureIndex);const _r=zr=>{zr.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;const yr=this.transform.elevation;(yr||zr.elevation)&&(zr.elevation=yr?yr.getAtTileOffset(zr.tileID,zr.tileAnchorX,zr.tileAnchorY):0)},Gn=De.textBox;if(Gn){_r(Gn);const zr=ir=>{let on=a.WritingMode.horizontal;if(x.allowVerticalPlacement&&!ir&&this.prevPlacement){const ei=this.prevPlacement.placedOrientations[Ze];ei&&(this.placedOrientations[Ze]=ei,on=ei,this.markUsedOrientation(x,on,ke))}return on},yr=(ir,on)=>{if(x.allowVerticalPlacement&&Me>0&&De.verticalTextBox){for(const ei of x.writingModes)if(ei===a.WritingMode.vertical?(gt=on(),Et=gt):gt=ir(),gt&&gt.box&&gt.box.length)break}else gt=ir()};if(E.get("text-variable-anchor")){let ir=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ze]){const Mr=this.prevPlacement.variableOffsets[Ze];ir.indexOf(Mr.anchor)>0&&(ir=ir.filter(ai=>ai!==Mr.anchor),ir.unshift(Mr.anchor))}const on=(Mr,ai,Pc)=>{const la=x.getSymbolInstanceTextSize(Y,ke,this.transform.zoom,Ve),pu=(Mr.x2-Mr.x1)*la+2*Mr.padding,Ys=(Mr.y2-Mr.y1)*la+2*Mr.padding,Lo=me&&!oe?ai:null;Lo&&_r(Lo);let ua={box:[],offscreen:!1,occluded:!1};const Rc=ne?2*ir.length:ir.length;for(let mu=0;mu<Rc;++mu){const Ad=this.attemptAnchorPlacement(ir[mu%ir.length],Mr,pu,Ys,la,fe,ge,B,C,J,mu>=ir.length,ke,Ve,x,Pc,Lo,Y,K);if(Ad&&(ua=Ad.placedGlyphBoxes,ua&&ua.box&&ua.box.length)){Ue=!0,At=Ad.shift;break}}return ua};yr(()=>on(Gn,De.iconBox,a.WritingMode.horizontal),()=>{const Mr=De.verticalTextBox;return Mr&&_r(Mr),x.allowVerticalPlacement&&!(gt&&gt.box&&gt.box.length)&&Me>0&&Mr?on(Mr,De.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),gt&&(Ue=gt.box,We=gt.offscreen,Qe=gt.occluded);const ei=zr(!(!gt||!gt.box));if(!Ue&&this.prevPlacement){const Mr=this.prevPlacement.variableOffsets[Ze];Mr&&(this.variableOffsets[Ze]=Mr,this.markUsedJustification(x,Mr.anchor,ke,ei))}}else{const ir=(on,ei)=>{const Mr=x.getSymbolInstanceTextSize(Y,ke,this.transform.zoom,Ve),ai=this.collisionIndex.placeCollisionBox(x,Mr,on,new a.Point(0,0),ne,B,C,J.predicate);return ai&&ai.box&&ai.box.length&&(this.markUsedOrientation(x,ei,ke),this.placedOrientations[Ze]=ei),ai};yr(()=>ir(Gn,a.WritingMode.horizontal),()=>{const on=De.verticalTextBox;return x.allowVerticalPlacement&&Me>0&&on?(_r(on),ir(on,a.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),zr(!!(gt&&gt.box&&gt.box.length))}}if(Zt=gt,Ue=Zt&&Zt.box&&Zt.box.length>0,We=Zt&&Zt.offscreen,Qe=Zt&&Zt.occluded,ke.useRuntimeCollisionCircles){const zr=x.text.placedSymbolArray.get(ke.centerJustifiedTextSymbolIndex>=0?ke.centerJustifiedTextSymbolIndex:ke.verticalPlacedTextSymbolIndex),yr=a.evaluateSizeForFeature(x.textSizeData,Y,zr),ir=E.get("text-padding");Ht=this.collisionIndex.placeCollisionCircles(x,ne,zr,x.lineVertexArray,x.glyphOffsetArray,yr,C,A,L,m,ge,J.predicate,ke.collisionCircleDiameter*yr/a.ONE_EM,ir,this.retainedQueryData[x.bucketInstanceId].tileID),Ue=ne||Ht.circles.length>0&&!Ht.collisionDetected,We=We&&Ht.offscreen,Qe=Ht.occluded}if(De.iconFeatureIndex&&(gr=De.iconFeatureIndex),De.iconBox){const zr=yr=>{_r(yr);const ir=me&&At?Io(At.x,At.y,fe,ge,this.transform.angle):new a.Point(0,0),on=x.getSymbolInstanceIconSize(K,this.transform.zoom,ke.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,on,yr,ir,oe,B,C,J.predicate)};Et&&Et.box&&Et.box.length&&De.verticalIconBox?(yt=zr(De.verticalIconBox),Je=yt.box.length>0):(yt=zr(De.iconBox),Je=yt.box.length>0),We=We&&yt.offscreen,vt=yt.occluded}const Cn=F||ke.numHorizontalGlyphVertices===0&&Me===0,ji=H||ke.numIconVertices===0;if(Cn||ji?ji?Cn||(Je=Je&&Ue):Ue=Je&&Ue:Je=Ue=Je&&Ue,Ue&&Zt&&Zt.box&&this.collisionIndex.insertCollisionBox(Zt.box,E.get("text-ignore-placement"),x.bucketInstanceId,Et&&Et.box&&mr?mr:lr,J.ID),Je&&yt&&this.collisionIndex.insertCollisionBox(yt.box,E.get("icon-ignore-placement"),x.bucketInstanceId,gr,J.ID),Ht&&(Ue&&this.collisionIndex.insertCollisionCircles(Ht.circles,E.get("text-ignore-placement"),x.bucketInstanceId,lr,J.ID),m)){const zr=x.bucketInstanceId;let yr=this.collisionCircleArrays[zr];yr===void 0&&(yr=this.collisionCircleArrays[zr]=new Co);for(let ir=0;ir<Ht.circles.length;ir+=4)yr.circles.push(Ht.circles[ir+0]),yr.circles.push(Ht.circles[ir+1]),yr.circles.push(Ht.circles[ir+2]),yr.circles.push(Ht.collisionDetected?1:0)}const Cs=x.projection.name!=="globe";xe=xe&&(Cs||!Qe),Pe=Pe&&(Cs||!vt),this.placements[Ze]=new Eo(Ue||xe,Je||Pe,We||x.justReloaded),c.add(Ze)};if(we){const ke=x.getSortedSymbolIndexes(this.transform.angle);for(let Ve=ke.length-1;Ve>=0;--Ve){const De=ke[Ve];Xe(x.symbolInstances.get(De),De,x.collisionArrays[De])}}else for(let ke=s.symbolInstanceStart;ke<s.symbolInstanceEnd;ke++)Xe(x.symbolInstances.get(ke),ke,x.collisionArrays[ke]);if(m&&x.bucketInstanceId in this.collisionCircleArrays){const ke=this.collisionCircleArrays[x.bucketInstanceId];a.invert(ke.invProjMatrix,C),ke.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(s,c,m,y){const{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:A,crossTileID:L}=m,R=a.getAnchorJustification(c),B=y===a.WritingMode.vertical?A:R==="left"?x:R==="center"?E:R==="right"?C:-1;x>=0&&(s.text.placedSymbolArray.get(x).crossTileID=B>=0&&x!==B?0:L),E>=0&&(s.text.placedSymbolArray.get(E).crossTileID=B>=0&&E!==B?0:L),C>=0&&(s.text.placedSymbolArray.get(C).crossTileID=B>=0&&C!==B?0:L),A>=0&&(s.text.placedSymbolArray.get(A).crossTileID=B>=0&&A!==B?0:L)}markUsedOrientation(s,c,m){const y=c===a.WritingMode.horizontal||c===a.WritingMode.horizontalOnly?c:0,x=c===a.WritingMode.vertical?c:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:L}=m,R=s.text.placedSymbolArray;E>=0&&(R.get(E).placedOrientation=y),C>=0&&(R.get(C).placedOrientation=y),A>=0&&(R.get(A).placedOrientation=y),L>=0&&(R.get(L).placedOrientation=x)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let m=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const y=c?c.symbolFadeChange(s):1,x=c?c.opacities:{},E=c?c.variableOffsets:{},C=c?c.placedOrientations:{};for(const A in this.placements){const L=this.placements[A],R=x[A];R?(this.opacities[A]=new Oi(R,y,L.text,L.icon,null,L.clipped),m=m||L.text!==R.text.placed||L.icon!==R.icon.placed):(this.opacities[A]=new Oi(null,y,L.text,L.icon,L.skipFade,L.clipped),m=m||L.text||L.icon)}for(const A in x){const L=x[A];if(!this.opacities[A]){const R=new Oi(L,y,!1,!1);R.isHidden()||(this.opacities[A]=R,m=m||L.text.placed||L.icon.placed)}}for(const A in E)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=E[A]);for(const A in C)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=C[A]);m?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:s)}updateLayerOpacities(s,c){const m=new Set;for(const y of c){const x=y.getBucket(s);x&&y.latestFeatureIndex&&s.id===x.layerIds[0]&&this.updateBucketOpacities(x,m,y.collisionBoxArray)}}updateBucketOpacities(s,c,m){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const y=s.layers[0].layout,x=!!s.layers[0].dynamicFilter(),E=new Oi(null,0,!1,!1,!0),C=y.get("text-allow-overlap"),A=y.get("icon-allow-overlap"),L=y.get("text-variable-anchor"),R=y.get("text-rotation-alignment")==="map",B=y.get("text-pitch-alignment")==="map",G=y.get("icon-text-fit")!=="none",Z=new Oi(null,0,C&&(A||!s.hasIconData()||y.get("icon-optional")),A&&(C||!s.hasTextData()||y.get("text-optional")),!0);!s.collisionArrays&&m&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(m);const Y=(J,F,H)=>{for(let ne=0;ne<F/4;ne++)J.opacityVertexArray.emplaceBack(H)};let K=0;for(let J=0;J<s.symbolInstances.length;J++){const F=s.symbolInstances.get(J),{numHorizontalGlyphVertices:H,numVerticalGlyphVertices:ne,crossTileID:oe,numIconVertices:fe}=F,ge=c.has(oe);let me=this.opacities[oe];ge?me=E:me||(me=Z,this.opacities[oe]=me),c.add(oe);const we=H>0||ne>0,xe=fe>0,Pe=this.placedOrientations[oe],Xe=Pe===a.WritingMode.vertical,ke=Pe===a.WritingMode.horizontal||Pe===a.WritingMode.horizontalOnly;if(!we&&!xe||me.isHidden()||K++,we){const Ve=Ao(me.text);Y(s.text,H,Xe?Lr:Ve),Y(s.text,ne,ke?Lr:Ve);const De=me.text.isHidden(),{leftJustifiedTextSymbolIndex:Ze,centerJustifiedTextSymbolIndex:Me,rightJustifiedTextSymbolIndex:Ue,verticalPlacedTextSymbolIndex:Je}=F,We=s.text.placedSymbolArray,Qe=De||Xe?1:0;Ze>=0&&(We.get(Ze).hidden=Qe),Me>=0&&(We.get(Me).hidden=Qe),Ue>=0&&(We.get(Ue).hidden=Qe),Je>=0&&(We.get(Je).hidden=De||ke?1:0);const vt=this.variableOffsets[oe];vt&&this.markUsedJustification(s,vt.anchor,F,Pe);const At=this.placedOrientations[oe];At&&(this.markUsedJustification(s,"left",F,At),this.markUsedOrientation(s,At,F))}if(xe){const Ve=Ao(me.icon),{placedIconSymbolIndex:De,verticalPlacedIconSymbolIndex:Ze}=F,Me=s.icon.placedSymbolArray,Ue=me.icon.isHidden()?1:0;De>=0&&(Y(s.icon,fe,Xe?Lr:Ve),Me.get(De).hidden=Ue),Ze>=0&&(Y(s.icon,F.numVerticalIconVertices,ke?Lr:Ve),Me.get(Ze).hidden=Ue)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Ve=s.collisionArrays[J];if(Ve){let De=new a.Point(0,0),Ze=!0;if(Ve.textBox||Ve.verticalTextBox){if(L){const Ue=this.variableOffsets[oe];Ue?(De=ko(Ue.anchor,Ue.width,Ue.height,Ue.textOffset,Ue.textScale),R&&De._rotate(B?this.transform.angle:-this.transform.angle)):Ze=!1}x&&(Ze=!me.clipped),Ve.textBox&&Gs(s.textCollisionBox.collisionVertexArray,me.text.placed,!Ze||Xe,De.x,De.y),Ve.verticalTextBox&&Gs(s.textCollisionBox.collisionVertexArray,me.text.placed,!Ze||ke,De.x,De.y)}const Me=Ze&&!!(!ke&&Ve.verticalIconBox);Ve.iconBox&&Gs(s.iconCollisionBox.collisionVertexArray,me.icon.placed,Me,G?De.x:0,G?De.y:0),Ve.verticalIconBox&&Gs(s.iconCollisionBox.collisionVertexArray,me.icon.placed,!Me,G?De.x:0,G?De.y:0)}}}if(s.fullyClipped=K===0,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const J=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=J.invProjMatrix,s.placementViewportMatrix=J.viewportMatrix,s.collisionCircleArray=J.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,c){const m=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*m>s}setStale(){this.stale=!0}}function Gs(d,s,c,m,y){d.emplaceBack(s?1:0,c?1:0,m||0,y||0),d.emplaceBack(s?1:0,c?1:0,m||0,y||0),d.emplaceBack(s?1:0,c?1:0,m||0,y||0),d.emplaceBack(s?1:0,c?1:0,m||0,y||0)}const Ln=Math.pow(2,25),Or=Math.pow(2,24),Fa=Math.pow(2,17),ea=Math.pow(2,16),Vn=Math.pow(2,9),Qn=Math.pow(2,8),Kl=Math.pow(2,1);function Ao(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const s=d.placed?1:0,c=Math.floor(127*d.opacity);return c*Ln+s*Or+c*Fa+s*ea+c*Vn+s*Qn+c*Kl+s}const Lr=0;class Mo{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&s.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,c,m,y,x){const E=this._bucketParts;for(;this._currentTileIndex<s.length;)if(c.getBucketParts(E,y,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((C,A)=>C.sortKey-A.sortKey));this._currentPartIndex<E.length;){const C=E[this._currentPartIndex];if(c.placeLayerBucketPart(C,this._seenCrossTileIDs,m,C.symbolInstanceStart===0),this._currentPartIndex++,x())return!0}return!1}}class Vh{constructor(s,c,m,y,x,E,C,A){this.placement=new Qo(s,x,E,C,A),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(s,c,m){const y=a.exported.now(),x=()=>{const E=a.exported.now()-y;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=c[s[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=C)&&(!E.maxzoom||E.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new Mo(E)),this._inProgressLayer.continuePlacement(m[E.source],this.placement,this._showCollisionBoxes,E,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const ta=512/a.EXTENT/2;class zn{constructor(s,c,m){this.tileID=s,this.bucketInstanceId=m,this.index=new a.KDBush(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=s.canonical.x*a.EXTENT,x=s.canonical.y*a.EXTENT;for(let E=0;E<c.length;E++){const{key:C,crossTileID:A,tileAnchorX:L,tileAnchorY:R}=c.get(E),B=Math.floor((y+L)*ta),G=Math.floor((x+R)*ta);this.index.add(B,G),this.keys.push(C),this.crossTileIDs.push(A)}this.index.finish()}findMatches(s,c,m){const y=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),x=ta/Math.pow(2,c.canonical.z-this.tileID.canonical.z),E=c.canonical.x*a.EXTENT,C=c.canonical.y*a.EXTENT;for(let A=0;A<s.length;A++){const L=s.get(A);if(L.crossTileID)continue;const{key:R,tileAnchorX:B,tileAnchorY:G}=L,Z=Math.floor((E+B)*x),Y=Math.floor((C+G)*x),K=this.index.range(Z-y,Y-y,Z+y,Y+y);for(const J of K){const F=this.crossTileIDs[J];if(this.keys[J]===R&&!m.has(F)){m.add(F),L.crossTileID=F;break}}}}}class $h{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Gh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const c=Math.round((s-this.lng)/360);if(c!==0)for(const m in this.indexes){const y=this.indexes[m],x={};for(const E in y){const C=y[E];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+c),x[C.tileID.key]=C}this.indexes[m]=x}this.lng=s}addBucket(s,c,m){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let x=0;x<c.symbolInstances.length;x++)c.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);const y=this.usedCrossTileIDs[s.overscaledZ];for(const x in this.indexes){const E=this.indexes[x];if(Number(x)>s.overscaledZ)for(const C in E){const A=E[C];A.tileID.isChildOf(s)&&A.findMatches(c.symbolInstances,s,y)}else{const C=E[s.scaledTo(Number(x)).key];C&&C.findMatches(c.symbolInstances,s,y)}}for(let x=0;x<c.symbolInstances.length;x++){const E=c.symbolInstances.get(x);E.crossTileID||(E.crossTileID=m.generate(),y.add(E.crossTileID))}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new zn(s,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(s,c){for(const m of c.crossTileIDs)this.usedCrossTileIDs[s].delete(m)}removeStaleBuckets(s){let c=!1;for(const m in this.indexes){const y=this.indexes[m];for(const x in y)s[y[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,y[x]),delete y[x],c=!0)}return c}}class Ws{constructor(){this.layerIndexes={},this.crossTileIDs=new $h,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,c,m,y){let x=this.layerIndexes[s.id];x===void 0&&(x=this.layerIndexes[s.id]=new Gh);let E=!1;const C={};y.name!=="globe"&&x.handleWrapJump(m);for(const A of c){const L=A.getBucket(s);L&&s.id===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(A.tileID,L,this.crossTileIDs)&&(E=!0),C[L.bucketInstanceId]=!0)}return x.removeStaleBuckets(C)&&(E=!0),E}pruneUnusedLayers(s){const c={};s.forEach(m=>{c[m]=!0});for(const m in this.layerIndexes)c[m]||delete this.layerIndexes[m]}}const Po=(d,s)=>a.emitValidationErrors(d,s&&s.filter(c=>c.identifier!=="source.canvas")),sc=a.pick(Wt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),ey=a.pick(Wt,["setCenter","setZoom","setBearing","setPitch"]),Wh={version:8,layers:[],sources:{}},ja={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ss extends a.Evented{constructor(s,c={}){super(),this.map=s,this.dispatcher=new It(Vs(),this),this.imageManager=new $t,this.imageManager.setEventedParent(this),this.glyphManager=new a.GlyphManager(s._requestManager,c.localFontFamily?a.LocalGlyphMode.all:c.localIdeographFontFamily?a.LocalGlyphMode.ideographs:a.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.crossTileSymbolIndex=new Ws,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const m=this;this._rtlTextPluginCallback=Ss.registerForPluginStateChange(y=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(x,E)=>{if(a.triggerPluginCompletionEvent(x),E&&E.every(C=>C))for(const C in m._sourceCaches){const A=m._sourceCaches[C],L=A.getSource().type;L!=="vector"&&L!=="geojson"||A.reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const x=this.getSource(y.sourceId);if(x&&x.vectorLayerIds)for(const E in this._layers){const C=this._layers[E];C.source===x.id&&this._validateLayer(C)}})}loadURL(s,c={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const m=typeof c.validate=="boolean"?c.validate:!a.isMapboxURL(s);s=this.map._requestManager.normalizeStyleURL(s,c.accessToken);const y=this.map._requestManager.transformRequest(s,a.ResourceType.Style);this._request=a.getJSON(y,(x,E)=>{this._request=null,x?this.fire(new a.ErrorEvent(x)):E&&this._load(E,m)})}loadJSON(s,c={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(s,c.validate!==!1)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(Wh,!1)}_updateLayerCount(s,c){const m=c?1:-1;s.is3D()&&(this._num3DLayers+=m),s.type==="circle"&&(this._numCircleLayers+=m),s.type==="symbol"&&(this._numSymbolLayers+=m)}_load(s,c){if(c&&Po(this,a.validateStyle(s)))return;this._loaded=!0,this.stylesheet=a.clone$1(s),this._updateMapProjection();for(const y in s.sources)this.addSource(y,s.sources[y],{validate:!1});this._changed=!1,s.sprite?this._loadSprite(s.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(s.glyphs);const m=ic(this.stylesheet.layers);this._order=m.map(y=>y.id),this._layers={},this._serializedLayers={};for(const y of m){const x=a.createStyleLayer(y);x.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=x,this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Kt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(s){this._spriteRequest=function(c,m,y){let x,E,C;const A=a.exported.devicePixelRatio>1?"@2x":"";let L=a.getJSON(m.transformRequest(m.normalizeSpriteURL(c,A,".json"),a.ResourceType.SpriteJSON),(G,Z)=>{L=null,C||(C=G,x=Z,B())}),R=a.getImage(m.transformRequest(m.normalizeSpriteURL(c,A,".png"),a.ResourceType.SpriteImage),(G,Z)=>{R=null,C||(C=G,E=Z,B())});function B(){if(C)y(C);else if(x&&E){const G=a.exported.getImageData(E),Z={};for(const Y in x){const{width:K,height:J,x:F,y:H,sdf:ne,pixelRatio:oe,stretchX:fe,stretchY:ge,content:me}=x[Y],we=new a.RGBAImage({width:K,height:J});a.RGBAImage.copy(G,we,{x:F,y:H},{x:0,y:0},{width:K,height:J}),Z[Y]={data:we,pixelRatio:oe,sdf:ne,stretchX:fe,stretchY:ge,content:me}}y(null,Z)}}return{cancel(){L&&(L.cancel(),L=null),R&&(R.cancel(),R=null)}}}(s,this.map._requestManager,(c,m)=>{if(this._spriteRequest=null,c)this.fire(new a.ErrorEvent(c));else if(m)for(const y in m)this.imageManager.addImage(y,m[y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(s){const c=this.getSource(s.source);if(!c)return;const m=s.sourceLayer;m&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(m)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${c.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(s){const c=[];for(const m of s){const y=this._layers[m];y.type!=="custom"&&c.push(y.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(s){return!!this.terrain&&(typeof s.isLayerDraped=="function"?s.isLayerDraped():ja[s.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(s){if(!this._loaded)return;const c=this._changed;if(this._changed){const y=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(y.length||x.length)&&this._updateWorkerLayers(y,x);for(const E in this._updatedSources){const C=this._updatedSources[E];C==="reload"?this._reloadSource(E):C==="clear"&&this._clearSource(E)}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(s);this.light.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this._resetUpdates()}const m={};for(const y in this._sourceCaches){const x=this._sourceCaches[y];m[y]=x.used,x.used=!1}for(const y of this._order){const x=this._layers[y];if(x.recalculate(s,this._availableImages),!x.isHidden(s.zoom)){const C=this._getLayerSourceCache(x);C&&(C.used=!0)}const E=this.map.painter;if(E){const C=x.getProgramIds();if(!C)continue;const A=x.getProgramConfiguration(s.zoom);for(const L of C)E.useProgram(L,A)}}for(const y in m){const x=this._sourceCaches[y];m[y]!==x.used&&x.getSource().fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:x.getSource().id}))}this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateWorkerLayers(s,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(s),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(s){if(this._checkLoaded(),Po(this,a.validateStyle(s)))return!1;(s=a.clone$1(s)).layers=ic(s.layers);const c=function(y,x){if(!y)return[{command:Wt.setStyle,args:[x]}];let E=[];try{if(!I(y.version,x.version))return[{command:Wt.setStyle,args:[x]}];I(y.center,x.center)||E.push({command:Wt.setCenter,args:[x.center]}),I(y.zoom,x.zoom)||E.push({command:Wt.setZoom,args:[x.zoom]}),I(y.bearing,x.bearing)||E.push({command:Wt.setBearing,args:[x.bearing]}),I(y.pitch,x.pitch)||E.push({command:Wt.setPitch,args:[x.pitch]}),I(y.sprite,x.sprite)||E.push({command:Wt.setSprite,args:[x.sprite]}),I(y.glyphs,x.glyphs)||E.push({command:Wt.setGlyphs,args:[x.glyphs]}),I(y.transition,x.transition)||E.push({command:Wt.setTransition,args:[x.transition]}),I(y.light,x.light)||E.push({command:Wt.setLight,args:[x.light]}),I(y.fog,x.fog)||E.push({command:Wt.setFog,args:[x.fog]}),I(y.projection,x.projection)||E.push({command:Wt.setProjection,args:[x.projection]});const C={},A=[];(function(B,G,Z,Y){let K;for(K in G=G||{},B=B||{})B.hasOwnProperty(K)&&(G.hasOwnProperty(K)||wo(K,Z,Y));for(K in G){if(!G.hasOwnProperty(K))continue;const J=G[K];B.hasOwnProperty(K)?I(B[K],J)||(B[K].type==="geojson"&&J.type==="geojson"&&Jo(B,G,K)?Z.push({command:Wt.setGeoJSONSourceData,args:[K,J.data]}):La(K,G,Z,Y)):Ra(K,G,Z)}})(y.sources,x.sources,A,C);const L=[];y.layers&&y.layers.forEach(B=>{B.source&&C[B.source]?E.push({command:Wt.removeLayer,args:[B.id]}):L.push(B)});let R=y.terrain;R&&C[R.source]&&(E.push({command:Wt.setTerrain,args:[void 0]}),R=void 0),E=E.concat(A),I(R,x.terrain)||E.push({command:Wt.setTerrain,args:[x.terrain]}),function(B,G,Z){G=G||[];const Y=(B=B||[]).map(Li),K=G.map(Li),J=B.reduce(za,{}),F=G.reduce(za,{}),H=Y.slice(),ne=Object.create(null);let oe,fe,ge,me,we,xe,Pe;for(oe=0,fe=0;oe<Y.length;oe++)ge=Y[oe],F.hasOwnProperty(ge)?fe++:(Z.push({command:Wt.removeLayer,args:[ge]}),H.splice(H.indexOf(ge,fe),1));for(oe=0,fe=0;oe<K.length;oe++)ge=K[K.length-1-oe],H[H.length-1-oe]!==ge&&(J.hasOwnProperty(ge)?(Z.push({command:Wt.removeLayer,args:[ge]}),H.splice(H.lastIndexOf(ge,H.length-fe),1)):fe++,xe=H[H.length-oe],Z.push({command:Wt.addLayer,args:[F[ge],xe]}),H.splice(H.length-oe,0,ge),ne[ge]=!0);for(oe=0;oe<K.length;oe++)if(ge=K[oe],me=J[ge],we=F[ge],!ne[ge]&&!I(me,we))if(I(me.source,we.source)&&I(me["source-layer"],we["source-layer"])&&I(me.type,we.type)){for(Pe in xi(me.layout,we.layout,Z,ge,null,Wt.setLayoutProperty),xi(me.paint,we.paint,Z,ge,null,Wt.setPaintProperty),I(me.filter,we.filter)||Z.push({command:Wt.setFilter,args:[ge,we.filter]}),I(me.minzoom,we.minzoom)&&I(me.maxzoom,we.maxzoom)||Z.push({command:Wt.setLayerZoomRange,args:[ge,we.minzoom,we.maxzoom]}),me)me.hasOwnProperty(Pe)&&Pe!=="layout"&&Pe!=="paint"&&Pe!=="filter"&&Pe!=="metadata"&&Pe!=="minzoom"&&Pe!=="maxzoom"&&(Pe.indexOf("paint.")===0?xi(me[Pe],we[Pe],Z,ge,Pe.slice(6),Wt.setPaintProperty):I(me[Pe],we[Pe])||Z.push({command:Wt.setLayerProperty,args:[ge,Pe,we[Pe]]}));for(Pe in we)we.hasOwnProperty(Pe)&&!me.hasOwnProperty(Pe)&&Pe!=="layout"&&Pe!=="paint"&&Pe!=="filter"&&Pe!=="metadata"&&Pe!=="minzoom"&&Pe!=="maxzoom"&&(Pe.indexOf("paint.")===0?xi(me[Pe],we[Pe],Z,ge,Pe.slice(6),Wt.setPaintProperty):I(me[Pe],we[Pe])||Z.push({command:Wt.setLayerProperty,args:[ge,Pe,we[Pe]]}))}else Z.push({command:Wt.removeLayer,args:[ge]}),xe=H[H.lastIndexOf(ge)+1],Z.push({command:Wt.addLayer,args:[we,xe]})}(L,x.layers,E)}catch(C){console.warn("Unable to compute style diff:",C),E=[{command:Wt.setStyle,args:[x]}]}return E}(this.serialize(),s).filter(y=>!(y.command in ey));if(c.length===0)return!1;const m=c.filter(y=>!(y.command in sc));if(m.length>0)throw new Error(`Unimplemented: ${m.map(y=>y.command).join(", ")}.`);return c.forEach(y=>{y.command!=="setTransition"&&y.command!=="setProjection"&&this[y.command].apply(this,y.args)}),this.stylesheet=s,this._updateMapProjection(),!0}addImage(s,c){return this.getImage(s)?this.fire(new a.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(s,c),this._afterImageUpdated(s),this)}updateImage(s,c){this.imageManager.updateImage(s,c)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s),this._afterImageUpdated(s),this):this.fire(new a.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(s,c,m={}){if(this._checkLoaded(),this.getSource(s)!==void 0)throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(a.validateSource,`sources.${s}`,c,null,m))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const y=Ut(s,c,this.dispatcher,this);y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(s),source:y.serialize(),sourceId:s}));const x=E=>{const C=(E?"symbol:":"other:")+s,A=this._sourceCaches[C]=new a.SourceCache(C,y,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[s]=A,A.style=this,A.onAdd(this.map)};x(!1),c.type!=="vector"&&c.type!=="geojson"||x(!0),y.onAdd&&y.onAdd(this.map),this._changed=!0}removeSource(s){this._checkLoaded();const c=this.getSource(s);if(!c)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===s)return this.fire(new a.ErrorEvent(new Error(`Source "${s}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.get().source===s)return this.fire(new a.ErrorEvent(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(s);for(const y of m)delete this._sourceCaches[y.id],delete this._updatedSources[y.id],y.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles();return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(s,c){this._checkLoaded(),this.getSource(s).setData(c),this._changed=!0}getSource(s){const c=this._getSourceCache(s);return c&&c.getSource()}_getSources(){const s=[];for(const c in this._otherSourceCaches){const m=this._getSourceCache(c);m&&s.push(m.getSource())}return s}addLayer(s,c,m={}){this._checkLoaded();const y=s.id;if(this.getLayer(y))return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${y}" already exists on this map`)));let x;if(s.type==="custom"){if(Po(this,a.validateCustomStyleLayer(s)))return;x=a.createStyleLayer(s)}else{if(typeof s.source=="object"&&(this.addSource(y,s.source),s=a.clone$1(s),s=a.extend(s,{source:y})),this._validate(a.validateLayer,`layers.${y}`,s,{arrayIndex:-1},m))return;x=a.createStyleLayer(s),this._validateLayer(x),x.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0)}const E=c?this._order.indexOf(c):this._order.length;if(c&&E===-1)return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(E,0,y),this._layerOrderChanged=!0,this._layers[y]=x;const C=this._getLayerSourceCache(x);if(this._removedLayers[y]&&x.source&&C&&x.type!=="custom"){const A=this._removedLayers[y];delete this._removedLayers[y],A.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",C.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(s,c){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new a.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===c)return;const m=this._order.indexOf(s);this._order.splice(m,1);const y=c?this._order.indexOf(c):this._order.length;c&&y===-1?this.fire(new a.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(y,0,s),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(s){this._checkLoaded();const c=this._layers[s];if(!c)return void this.fire(new a.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const m=this._order.indexOf(s);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=c,delete this._layers[s],delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(s){return this._layers[s]}hasLayer(s){return s in this._layers}hasLayerType(s){for(const c in this._layers)if(this._layers[c].type===s)return!0;return!1}setLayerZoomRange(s,c,m){this._checkLoaded();const y=this.getLayer(s);y?y.minzoom===c&&y.maxzoom===m||(c!=null&&(y.minzoom=c),m!=null&&(y.maxzoom=m),this._updateLayer(y)):this.fire(new a.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(s,c,m={}){this._checkLoaded();const y=this.getLayer(s);if(y){if(!I(y.filter,c))return c==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(a.validateFilter,`layers.${y.id}.filter`,c,{layerType:y.type},m)||(y.filter=a.clone$1(c),this._updateLayer(y)))}else this.fire(new a.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be filtered.`)))}getFilter(s){const c=this.getLayer(s);return c&&a.clone$1(c.filter)}setLayoutProperty(s,c,m,y={}){this._checkLoaded();const x=this.getLayer(s);x?I(x.getLayoutProperty(c),m)||(x.setLayoutProperty(c,m,y),this._updateLayer(x)):this.fire(new a.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(s,c){const m=this.getLayer(s);if(m)return m.getLayoutProperty(c);this.fire(new a.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style.`)))}setPaintProperty(s,c,m,y={}){this._checkLoaded();const x=this.getLayer(s);x?I(x.getPaintProperty(c),m)||(x.setPaintProperty(c,m,y)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new a.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(s,c){const m=this.getLayer(s);return m&&m.getPaintProperty(c)}setFeatureState(s,c){this._checkLoaded();const m=s.source,y=s.sourceLayer,x=this.getSource(m);if(!x)return void this.fire(new a.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const E=x.type;if(E==="geojson"&&y)return void this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(E==="vector"&&!y)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));s.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided.")));const C=this._getSourceCaches(m);for(const A of C)A.setFeatureState(y,s.id,c)}removeFeatureState(s,c){this._checkLoaded();const m=s.source,y=this.getSource(m);if(!y)return void this.fire(new a.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const x=y.type,E=x==="vector"?s.sourceLayer:void 0;if(x==="vector"&&!E)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof s.id!="string"&&typeof s.id!="number")return void this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const C=this._getSourceCaches(m);for(const A of C)A.removeFeatureState(E,s.id,c)}getFeatureState(s){this._checkLoaded();const c=s.source,m=s.sourceLayer,y=this.getSource(c);if(y){if(y.type!=="vector"||m)return s.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(m,s.id);this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const s={};for(const c in this._sourceCaches){const m=this._sourceCaches[c].getSource();s[m.id]||(s[m.id]=m.serialize())}return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:s,layers:this._serializeLayers(this._order)},c=>c!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0;const c=this._getLayerSourceCache(s);s.source&&!this._updatedSources[s.source]&&c&&c.getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",c.pause()),this._changed=!0,s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){const c=E=>this._layers[E].type==="fill-extrusion",m={},y=[];for(let E=this._order.length-1;E>=0;E--){const C=this._order[E];if(c(C)){m[C]=E;for(const A of s){const L=A[C];if(L)for(const R of L)y.push(R)}}}y.sort((E,C)=>C.intersectionZ-E.intersectionZ);const x=[];for(let E=this._order.length-1;E>=0;E--){const C=this._order[E];if(c(C))for(let A=y.length-1;A>=0;A--){const L=y[A].feature;if(m[L.layer.id]<E)break;x.push(L),y.pop()}else for(const A of s){const L=A[C];if(L)for(const R of L)x.push(R.feature)}}return x}queryRenderedFeatures(s,c,m){c&&c.filter&&this._validate(a.validateFilter,"queryRenderedFeatures.filter",c.filter,null,c);const y={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const A of c.layers){const L=this._layers[A];if(!L)return this.fire(new a.ErrorEvent(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];y[L.source]=!0}}const x=[];c.availableImages=this._availableImages;const E=c&&c.layers?c.layers.some(A=>{const L=this.getLayer(A);return L&&L.is3D()}):this.has3DLayers(),C=tn.createFromScreenPoints(s,m);for(const A in this._sourceCaches){const L=this._sourceCaches[A].getSource().id;c.layers&&!y[L]||x.push(pr(this._sourceCaches[A],this._layers,this._serializedLayers,C,c,m,E,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(A,L,R,B,G,Z,Y){const K={},J=Z.queryRenderedSymbols(B),F=[];for(const H of Object.keys(J).map(Number))F.push(Y[H]);F.sort(bn);for(const H of F){const ne=H.featureIndex.lookupSymbolFeatures(J[H.bucketInstanceId],L,H.bucketIndex,H.sourceLayerIndex,G.filter,G.layers,G.availableImages,A);for(const oe in ne){const fe=K[oe]=K[oe]||[],ge=ne[oe];ge.sort((me,we)=>{const xe=H.featureSortOrder;if(xe){const Pe=xe.indexOf(me.featureIndex);return xe.indexOf(we.featureIndex)-Pe}return we.featureIndex-me.featureIndex});for(const me of ge)fe.push(me)}}for(const H in K)K[H].forEach(ne=>{const oe=ne.feature,fe=R(A[H]);if(!fe)return;const ge=fe.getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=ge});return K}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),C.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(s,c){c&&c.filter&&this._validate(a.validateFilter,"querySourceFeatures.filter",c.filter,null,c);const m=this._getSourceCaches(s);let y=[];for(const x of m)y=y.concat(Rr(x,c));return y}addSourceType(s,c,m){return Ss.getSourceType(s)?m(new Error(`A source type called "${s}" already exists.`)):(Ss.setSourceType(s,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:c.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(s,c={}){this._checkLoaded();const m=this.light.getLight();let y=!1;for(const E in s)if(!I(s[E],m[E])){y=!0;break}if(!y)return;const x=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(s,c),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(s,c=1){if(this._checkLoaded(),!s)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let m=s;if(c===1){if(typeof m.source=="object"){const y="terrain-dem-src";this.addSource(y,m.source),m=a.clone$1(m),m=a.extend(m,{source:y})}if(this._validate(a.validateTerrain,"terrain",m))return}if(!this.terrain||this.terrain&&c!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,c)}else{const y=this.terrain,x=y.get();for(const E of Object.keys(a.spec.terrain))!m.hasOwnProperty(E)&&a.spec.terrain[E].default&&(m[E]=a.spec.terrain[E].default);for(const E in m)if(!I(m[E],x[E])){y.set(m),this.stylesheet.terrain=m;const C=this._setTransitionParameters({duration:0});y.updateTransitions(C);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){const c=this.fog=new kt(s,this.map.transform);this.stylesheet.fog=s;const m=this._setTransitionParameters({duration:0});c.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,m=c.get();Object.keys(s).length===0&&c.set(s);for(const y in s)if(!I(s[y],m[y])){c.set(s),this.stylesheet.fog=s;const x=this._setTransitionParameters({duration:0});c.updateTransitions(x);break}}else this._createFog(s);this._markersNeedUpdate=!0}_setTransitionParameters(s){return{now:a.exported.now(),transition:a.extend(s,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const s=this._order.filter(m=>this.isLayerDraped(this._layers[m])),c=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...c)}_createTerrain(s,c){const m=this.terrain=new Sr(s,c);this.stylesheet.terrain=s,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const y=this._setTransitionParameters({duration:0});m.updateTransitions(y)}_force3DLayerUpdate(){for(const s in this._layers){const c=this._layers[s];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const s in this._layers){const c=this._layers[s];c.type==="symbol"&&this._updateLayer(c)}}_validate(s,c,m,y,x={}){return(!x||x.validate!==!1)&&Po(this,s.call(a.validateStyle,a.extend({key:c,style:this.serialize(),value:m,styleSpec:a.spec},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this._sourceCaches)this._sourceCaches[s].clearTiles(),this._sourceCaches[s].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(s){const c=this._getSourceCaches(s);for(const m of c)m.clearTiles()}_reloadSource(s){const c=this._getSourceCaches(s);for(const m of c)m.resume(),m.reload()}_reloadSources(){for(const s of this._getSources())s.reload&&s.reload()}_updateSources(s){for(const c in this._sourceCaches)this._sourceCaches[c].update(s)}_generateCollisionBoxes(){for(const s in this._sourceCaches){const c=this._sourceCaches[s];c.resume(),c.reload()}}_updatePlacement(s,c,m,y,x=!1){let E=!1,C=!1;const A={};for(const L of this._order){const R=this._layers[L];if(R.type!=="symbol")continue;if(!A[R.source]){const G=this._getLayerSourceCache(R);if(!G)continue;A[R.source]=G.getRenderableIds(!0).map(Z=>G.getTileByID(Z)).sort((Z,Y)=>Y.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(Y.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(R,A[R.source],s.center.lng,s.projection);E=E||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),x=x||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new a.Event("neworder")),(x||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),s.zoom))&&(this.pauseablePlacement=new Vh(s,this._order,x,c,m,y,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),C=!0),E&&this.pauseablePlacement.placement.setStale()),C||E)for(const L of this._order){const R=this._layers[L];R.type==="symbol"&&this.placement.updateLayerOpacities(R,A[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,c,m){this.imageManager.getImages(c.icons,m),this._updateTilesForChangedImages();const y=x=>{x&&x.setDependencies(c.tileID.key,c.type,c.icons)};y(this._otherSourceCaches[c.source]),y(this._symbolSourceCaches[c.source])}getGlyphs(s,c,m){this.glyphManager.getGlyphs(c.stacks,m)}getResource(s,c,m){return a.makeRequest(c,m)}_getSourceCache(s){return this._otherSourceCaches[s]}_getLayerSourceCache(s){return s.type==="symbol"?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}_getSourceCaches(s){const c=[];return this._otherSourceCaches[s]&&c.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&c.push(this._symbolSourceCaches[s]),c}_isSourceCacheLoaded(s){const c=this._getSourceCaches(s);return c.length===0?(this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${s}'`))),!1):c.every(m=>m.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ss.getSourceType=function(d){return Pt[d]},Ss.setSourceType=function(d,s){Pt[d]=s},Ss.registerForPluginStateChange=a.registerForPluginStateChange;var qh=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,ra="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",qs=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Yl=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Hs=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let oc={},Na={};const Jl=[];Ua(qh,Jl),Ua(qs,Jl),Ua(Yl,Jl),Ua(Hs,Jl),oc=ar("",qs),Na=ar(Hs,Yl);const Ep=ar(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),ac=qh,Hh=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Zh={background:ar(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ar(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:ar(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ar("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ar(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ar(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ar("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ar("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ar("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:ar(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:ar(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ar(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ar(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ar(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:ar(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:ar(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ar(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ar(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:ar(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:ar(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:ar(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:ar(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:ar(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:ar(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:ar(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:ar(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ra),skyboxGradient:ar(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ra),skyboxCapture:ar(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ar(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ar(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Ua(d,s){const c=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let m of c)if(m=m.trim(),m[0]==="#"&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=m.split(" ");for(const x of y)s.includes(x)||s.push(x)}}function ar(d,s){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=s.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),y={},x=[...Jl];return Ua(d,x),Ua(s,x),{fragmentSource:d=d.replace(c,(E,C,A,L,R)=>(y[R]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${R}
varying ${A} ${L} ${R};
#else
uniform ${A} ${L} u_${R};
#endif
`:`
#ifdef HAS_UNIFORM_u_${R}
    ${A} ${L} ${R} = u_${R};
#endif
`)),vertexSource:s=s.replace(c,(E,C,A,L,R)=>{const B=L==="float"?"vec2":"vec4",G=R.match(/color/)?"color":B;return y[R]?C==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
attribute ${A} ${B} a_${R};
varying ${A} ${L} ${R};
#else
uniform ${A} ${L} u_${R};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = a_${R};
#else
    ${A} ${L} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = unpack_mix_${G}(a_${R}, u_${R}_t);
#else
    ${A} ${L} ${R} = u_${R};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
attribute ${A} ${B} a_${R};
#else
uniform ${A} ${L} u_${R};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${A} ${L} ${R} = a_${R};
#else
    ${A} ${L} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${A} ${L} ${R} = unpack_mix_${G}(a_${R}, u_${R}_t);
#else
    ${A} ${L} ${R} = u_${R};
#endif
`}),staticAttributes:m,usedDefines:x}}class ty{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,c,m,y,x,E,C){this.context=s;let A=this.boundPaintVertexBuffers.length!==y.length;for(let R=0;!A&&R<y.length;R++)this.boundPaintVertexBuffers[R]!==y[R]&&(A=!0);let L=this.boundDynamicVertexBuffers.length!==C.length;for(let R=0;!L&&R<C.length;R++)this.boundDynamicVertexBuffers[R]!==C[R]&&(L=!0);if(!s.extVertexArrayObject||!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==m||A||L||this.boundIndexBuffer!==x||this.boundVertexOffset!==E)this.freshBind(c,m,y,x,E,C);else{s.bindVertexArrayOES.set(this.vao);for(const R of C)R&&R.bind();x&&x.dynamicDraw&&x.bind()}}freshBind(s,c,m,y,x,E){let C;const A=s.numAttributes,L=this.context,R=L.gl;if(L.extVertexArrayObject)this.vao&&this.destroy(),this.vao=L.extVertexArrayObject.createVertexArrayOES(),L.bindVertexArrayOES.set(this.vao),C=0,this.boundProgram=s,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=y,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=E;else{C=L.currentNumAttributes||0;for(let B=A;B<C;B++)R.disableVertexAttribArray(B)}c.enableAttributes(R,s),c.bind(),c.setVertexAttribPointers(R,s,x);for(const B of m)B.enableAttributes(R,s),B.bind(),B.setVertexAttribPointers(R,s,x);for(const B of E)B&&(B.enableAttributes(R,s),B.bind(),B.setVertexAttribPointers(R,s,x));y&&y.bind(),L.currentNumAttributes=A}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Xh(d,s){const c=Math.pow(2,s.canonical.z),m=s.canonical.y;return[new a.MercatorCoordinate(0,m/c).toLngLat().lat,new a.MercatorCoordinate(0,(m+1)/c).toLngLat().lat]}function Cp(d,s,c,m,y,x,E){const C=d.context,A=C.gl,L=c.fbo;if(!L)return;d.prepareDrawTile();const R=d.useProgram("hillshade");C.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,L.colorAttachment.get());const B=((K,J,F,H)=>{const ne=F.paint.get("hillshade-shadow-color"),oe=F.paint.get("hillshade-highlight-color"),fe=F.paint.get("hillshade-accent-color");let ge=F.paint.get("hillshade-illumination-direction")*(Math.PI/180);F.paint.get("hillshade-illumination-anchor")==="viewport"&&(ge-=K.transform.angle);const me=!K.options.moving;return{u_matrix:H||K.transform.calculateProjMatrix(J.tileID.toUnwrapped(),me),u_image:0,u_latrange:Xh(0,J.tileID),u_light:[F.paint.get("hillshade-exaggeration"),ge],u_shadow:ne,u_highlight:oe,u_accent:fe}})(d,c,m,d.terrain?s.projMatrix:null);d.prepareDrawProgram(C,R,s.toUnwrapped());const{tileBoundsBuffer:G,tileBoundsIndexBuffer:Z,tileBoundsSegments:Y}=d.getTileBoundsBuffers(c);R.draw(C,A.TRIANGLES,y,x,E,a.CullFaceMode.disabled,B,m.id,G,Z,Y)}function Kh(d,s,c){if(!s.needsDEMTextureUpload)return;const m=d.context,y=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||d.getTileTexture(c.stride);const x=c.getPixels();s.demTexture?s.demTexture.update(x,{premultiply:!1}):s.demTexture=new a.Texture(m,x,y.RGBA,{premultiply:!1}),s.needsDEMTextureUpload=!1}function kp(d,s,c,m,y,x){const E=d.context,C=E.gl;if(!s.dem)return;const A=s.dem;if(E.activeTexture.set(C.TEXTURE1),Kh(d,s,A),!s.demTexture)return;s.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);const L=A.dim;E.activeTexture.set(C.TEXTURE0);let R=s.fbo;if(!R){const Y=new a.Texture(E,{width:L,height:L,data:null},C.RGBA);Y.bind(C.LINEAR,C.CLAMP_TO_EDGE),R=s.fbo=E.createFramebuffer(L,L,!0),R.colorAttachment.set(Y.texture)}E.bindFramebuffer.set(R.framebuffer),E.viewport.set([0,0,L,L]);const{tileBoundsBuffer:B,tileBoundsIndexBuffer:G,tileBoundsSegments:Z}=d.getMercatorTileBoundsBuffers();d.useProgram("hillshadePrepare").draw(E,C.TRIANGLES,m,y,x,a.CullFaceMode.disabled,((Y,K)=>{const J=K.stride,F=a.create();return a.ortho(F,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(F,F,[0,-a.EXTENT,0]),{u_matrix:F,u_image:1,u_dimension:[J,J],u_zoom:Y.overscaledZ,u_unpack:K.unpackVector}})(s.tileID,A),c.id,B,G,Z),s.needsHillshadePrepare=!1}const Yh=d=>({u_matrix:new a.UniformMatrix4f(d),u_image0:new a.Uniform1i(d),u_skirt_height:new a.Uniform1f(d)}),Va=(d,s)=>({u_matrix:d,u_image0:0,u_skirt_height:s}),lc=(d,s,c,m,y,x,E,C,A,L,R,B,G,Z,Y)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:c,u_zoom_transition:y,u_merc_center:x,u_image0:0,u_frustum_tl:E,u_frustum_tr:C,u_frustum_br:A,u_frustum_bl:L,u_globe_pos:R,u_globe_radius:B,u_viewport:G,u_grid_matrix:Y?Float32Array.from(Y):new Float32Array(9),u_skirt_height:Z});function $a(d,s){return d!=null&&s!=null&&!(!d.hasData()||!s.hasData())&&d.demTexture!=null&&s.demTexture!=null&&d.tileID.key!==s.tileID.key}const Zs=new class{constructor(){this.operations={}}newMorphing(d,s,c,m,y){if(d in this.operations){const x=this.operations[d];x.to.tileID.key!==c.tileID.key&&(x.queued=c)}else this.operations[d]={startTime:m,phase:0,duration:y,from:s,to:c,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const s=this.operations[d];return{from:s.from,to:s.to,phase:s.phase}}update(d){for(const s in this.operations){const c=this.operations[s];for(c.phase=(d-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,d)){delete this.operations[s];break}}}_nextOp(d,s){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=s,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},na={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function uc(d){return 6*Math.pow(1.5,22-d)}function Ip(d,s){const c=1<<d.z;return!s&&(d.x===0||d.x===c-1)||d.y===0||d.y===c-1}const Ql=d=>({u_matrix:d});function Jh(d,s,c,m,y){if(y>0){const x=a.exported.now(),E=(x-d.timeAdded)/y,C=s?(x-s.timeAdded)/y:-1,A=c.getSource(),L=m.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),R=!s||Math.abs(s.tileID.overscaledZ-L)>Math.abs(d.tileID.overscaledZ-L),B=R&&d.refreshedUponExpiration?1:a.clamp(R?E:1-C,0,1);return d.refreshedUponExpiration&&E>=1&&(d.refreshedUponExpiration=!1),s?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}class Qh extends a.SourceCache{constructor(s){const c={type:"raster-dem",maxzoom:s.transform.maxZoom},m=new It(Vs(),null),y=Ut("mock-dem",c,m,s.style);super("mock-dem",y,!1),y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,c){s.state="loaded",c(null)}}class cc extends a.SourceCache{constructor(s){const c=Ut("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},new It(Vs(),null),s.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,c,m){if(s.freezeTileCoverage)return;this.transform=s;const y=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,E)=>{if(x[E.key]="",!this._tiles[E.key]){const C=new a.Tile(E,this._source.tileSize*E.overscaleFactor(),s.tileZoom);C.state="loaded",this._tiles[E.key]=C}return x},{});for(const x in this._tiles)x in y||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(s){const c=this.proxyCachedFBO[s];if(c!==void 0){const m=Object.values(c);this.renderCachePool.push(...m),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class hc extends a.OverscaledTileID{constructor(s,c,m){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=c,this.projMatrix=m}}class ed extends a.Elevation{constructor(s,c){super(),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,y,x]=function(A){const L=new a.StructArrayLayout2i4,R=new a.StructArrayLayout3ui6,B=131;L.reserve(17161),R.reserve(33800);const G=a.EXTENT/128,Z=a.EXTENT+G/2,Y=Z+G;for(let J=-G;J<Y;J+=G)for(let F=-G;F<Y;F+=G){const H=F<0||F>Z||J<0||J>Z?24575:0,ne=a.clamp(Math.round(F),0,a.EXTENT),oe=a.clamp(Math.round(J),0,a.EXTENT);L.emplaceBack(ne+H,oe)}const K=(J,F)=>{const H=F*B+J;R.emplaceBack(H+1,H,H+B),R.emplaceBack(H+B,H+B+1,H+1)};for(let J=1;J<129;J++)for(let F=1;F<129;F++)K(F,J);return[0,129].forEach(J=>{for(let F=0;F<130;F++)K(F,J),K(J,F)}),[L,R,32768]}(),E=s.context;this.gridBuffer=E.createVertexBuffer(m,a.posAttributes.members),this.gridIndexBuffer=E.createIndexBuffer(y),this.gridSegments=a.SegmentVector.simpleSegment(0,0,m.length,y.length),this.gridNoSkirtSegments=a.SegmentVector.simpleSegment(0,0,m.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new cc(c.map),this.orthoMatrix=a.create(),a.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.EXTENT,0,a.EXTENT,0,1);const C=E.gl;this._overlapStencilMode=new a.StencilMode({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Qh(c.map)}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),s.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=s,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(s,c,m){if(s&&s.terrain){this._style!==s&&(this.style=s),this.enabled=!0;const y=s.terrain.properties;this.sourceCache=s.terrain.drapeRenderMode===0?this._mockSourceCache:s._getSourceCache(y.get("source")),this._exaggeration=y.get("exaggeration");const x=()=>{this.sourceCache.used&&a.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const E=this.getScaledDemTileSize();this.sourceCache.update(c,E,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,x(),this._initializing=!0),x(),c.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const s=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||s.efficiency!==100&&a.warnOnce(`Terrain render cache efficiency is not optimal (${s.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${s.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(s){s.coord&&s.dataType==="source"?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):s.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const s in this._style._sourceCaches)this._style._sourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=c.getIds().map(A=>{const L=c.getTileByID(A).tileID;return L.projMatrix=m.calculateProjMatrix(L.toUnwrapped()),L});(function(A,L){const R=L.transform.pointCoordinate(L.transform.getCameraPoint()),B=new a.Point(R.x,R.y);A.sort((G,Z)=>{if(Z.overscaledZ-G.overscaledZ)return Z.overscaledZ-G.overscaledZ;const Y=new a.Point(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),K=new a.Point(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),J=B.mult(1<<G.canonical.z);return J.x-=.5,J.y-=.5,J.distSqr(Y)-J.distSqr(K)})})(y,this.painter),this._previousZoom=m.zoom;const x=this.proxyToSource||{};this.proxyToSource={},y.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};const E=this._style._sourceCaches;for(const A in E){const L=E[A];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,s[A],x),L.usedForTerrain))continue;const R=s[A];L.getSource().reparseOverscaled&&this._assignTerrainTiles(R)}this.proxiedCoords[c.id]=y.map(A=>new hc(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1,this._updateTimestamp=a.exported.now();const C={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const L=this.terrainTileForTile[A.key];if(!L)continue;const R=L.tileID.key;R in C||(this._visibleDemTiles.push(L),C[R]=R)}}_assignTerrainTiles(s){this._initializing||s.forEach(c=>{if(this.terrainTileForTile[c.key])return;const m=this._findTileCoveringTileID(c,this.sourceCache);m&&(this.terrainTileForTile[c.key]=m)})}_prepareDEMTextures(){const s=this.painter.context,c=s.gl;for(const m in this.terrainTileForTile){const y=this.terrainTileForTile[m],x=y.dem;!x||y.demTexture&&!y.needsDEMTextureUpload||(s.activeTexture.set(c.TEXTURE1),Kh(this.painter,y,x))}}_prepareDemTileUniforms(s,c,m,y){if(!c||c.demTexture==null)return!1;const x=s.tileID.canonical,E=Math.pow(2,c.tileID.canonical.z-x.z),C=y||"";return m[`u_dem_tl${C}`]=[x.x*E%1,x.y*E%1],m[`u_dem_scale${C}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const s=this.painter.context,c=s.gl;if(!this._emptyDepthBufferTexture){const m=new a.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new a.Texture(s,m,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let s=0;const c=this._visibleDemTiles.reduce((m,y)=>{if(!y.dem)return m;const x=y.dem.tree.minimums[0];return x>0&&s++,m+x},0);return s?c/s:0}_updateEmptyDEMTexture(){const s=this.painter.context,c=s.gl;s.activeTexture.set(c.TEXTURE2);const m=this._getLoadedAreaMinimum(),y=new a.RGBAImage({width:1,height:1},new Uint8Array(a.DEMData.pack(m,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(y,{premultiply:!1}):x=this._emptyDEMTexture=new a.Texture(s,y,c.RGBA,{premultiply:!1}),x}setupElevationDraw(s,c,m){const y=this.painter.context,x=y.gl,E=(C=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:a.DEMData.getUnpackVector(C),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var C;E.u_dem_size=this.sourceCache.getSource().tileSize,E.u_exaggeration=this.exaggeration();let A=null,L=null,R=1;if(m&&m.morphing&&this._useVertexMorphing){const B=m.morphing.srcDemTile,G=m.morphing.dstDemTile;R=m.morphing.phase,B&&G&&(this._prepareDemTileUniforms(s,B,E,"_prev")&&(L=B),this._prepareDemTileUniforms(s,G,E)&&(A=G))}if(L&&A?(y.activeTexture.set(x.TEXTURE2),A.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),y.activeTexture.set(x.TEXTURE4),L.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),E.u_dem_lerp=R):(A=this.terrainTileForTile[s.tileID.key],y.activeTexture.set(x.TEXTURE2),(this._prepareDemTileUniforms(s,A,E)?A.demTexture:this.emptyDEMTexture).bind(x.NEAREST,x.CLAMP_TO_EDGE)),y.activeTexture.set(x.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),this._depthFBO&&(E.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),E.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&A){const B=(1<<A.tileID.canonical.z)*a.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=B}if(m&&m.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),c.setTerrainUniformValues(y,E),this.painter.transform.projection.name==="globe"){const B=this.globeUniformValues(this.painter.transform,s.tileID.canonical,m&&m.useDenormalizedUpVectorScale);c.setGlobeUniformValues(y,B)}}globeUniformValues(s,c,m){const y=s.projection;return{u_tile_tl_up:y.upVector(c,0,0),u_tile_tr_up:y.upVector(c,a.EXTENT,0),u_tile_br_up:y.upVector(c,a.EXTENT,a.EXTENT),u_tile_bl_up:y.upVector(c,0,a.EXTENT),u_tile_up_scale:m?a.globeMetersToEcef(1):y.upVectorScale(c,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){const c=this.painter,m=this.painter.context;s.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(y,x,E,C,A){if(y.transform.projection.name==="globe")(function(L,R,B,G,Z){const Y=L.context,K=Y.gl;let J,F;const H=L.options.showTerrainWireframe?2:0,ne=L.transform,oe=a.globeUseCustomAntiAliasing(L,Y,ne),fe=(Ze,Me)=>{if(F===Ze)return;const Ue=[na[Ze],"PROJECTION_GLOBE_VIEW"];oe&&Ue.push("CUSTOM_ANTIALIASING"),Me&&Ue.push(na[H]),J=L.useProgram("globeRaster",null,Ue),F=Ze},ge=L.colorModeForRenderPass(),me=new a.DepthMode(K.LEQUAL,a.DepthMode.ReadWrite,L.depthRangeFor3D);Zs.update(Z);const we=a.calculateGlobeMercatorMatrix(ne),xe=[a.mercatorXfromLng(ne.center.lng),a.mercatorYfromLat(ne.center.lat)],Pe=H?[!1,!0]:[!1],Xe=L.globeSharedBuffers,ke=[ne.width*a.exported.devicePixelRatio,ne.height*a.exported.devicePixelRatio],Ve=Float32Array.from(ne.globeMatrix),De={useDenormalizedUpVectorScale:!0};if(Pe.forEach(Ze=>{const Me=L.transform,Ue=uc(Me.zoom)*R.exaggeration();F=-1;const Je=Ze?K.LINES:K.TRIANGLES;for(const We of G){const Qe=B.getTile(We),vt=a.StencilMode.disabled,At=R.prevTerrainTileForTile[We.key],gt=R.terrainTileForTile[We.key];$a(At,gt)&&Zs.newMorphing(We.key,At,gt,Z,250),Y.activeTexture.set(K.TEXTURE0),Qe.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const Et=Zs.getMorphValuesForProxy(We.key),Zt=Et?1:0;Et&&a.extend$1(De,{morphing:{srcDemTile:Et.from,dstDemTile:Et.to,phase:a.easeCubicInOut(Et.phase)}});const Ht=a.tileCornersToBounds(We.canonical),yt=a.getLatitudinalLod(Ht.getCenter().lat),lr=a.getGridMatrix(We.canonical,Ht,yt,Me.worldSize/Me._pixelsPerMercatorPixel),mr=a.globeNormalizeECEF(a.globeTileBounds(We.canonical)),gr=lc(Me.projMatrix,Ve,we,mr,a.globeToMercatorTransition(Me.zoom),xe,Me.frustumCorners.TL,Me.frustumCorners.TR,Me.frustumCorners.BR,Me.frustumCorners.BL,Me.globeCenterInViewSpace,Me.globeRadius,ke,Ue,lr);if(fe(Zt,Ze),R.setupElevationDraw(Qe,J,De),L.prepareDrawProgram(Y,J,We.toUnwrapped()),Xe){const[_r,Gn,Cn]=Ze?Xe.getWirefameBuffers(L.context,yt):Xe.getGridBuffers(yt,Ue!==0);J.draw(Y,Je,me,vt,ge,a.CullFaceMode.backCCW,gr,"globe_raster",_r,Gn,Cn)}}}),Xe){const Ze=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];oe&&Ze.push("CUSTOM_ANTIALIASING"),J=L.useProgram("globeRaster",null,Ze);for(const Me of G){const{x:Ue,y:Je,z:We}=Me.canonical,Qe=Je===0,vt=Je===(1<<We)-1,[At,gt,Et,Zt]=Xe.getPoleBuffers(We);if(Zt&&(Qe||vt)){const Ht=B.getTile(Me);Y.activeTexture.set(K.TEXTURE0),Ht.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);let yt=a.globePoleMatrixForTile(We,Ue,ne);const lr=a.globeNormalizeECEF(a.globeTileBounds(Me.canonical)),mr=(gr,_r)=>gr.draw(Y,K.TRIANGLES,me,a.StencilMode.disabled,ge,a.CullFaceMode.disabled,lc(ne.projMatrix,yt,yt,lr,0,xe,ne.frustumCorners.TL,ne.frustumCorners.TR,ne.frustumCorners.BR,ne.frustumCorners.BL,ne.globeCenterInViewSpace,ne.globeRadius,ke,0),"globe_pole_raster",_r,Et,Zt);R.setupElevationDraw(Ht,J,De),L.prepareDrawProgram(Y,J,Me.toUnwrapped()),Qe&&mr(J,At),vt&&(yt=a.scale(a.create(),yt,[1,-1,1]),mr(J,gt))}}}})(y,x,E,C,A);else{const L=y.context,R=L.gl;let B,G;const Z=y.options.showTerrainWireframe?2:0,Y=(ne,oe)=>{if(G===ne)return;const fe=[na[ne]];oe&&fe.push(na[Z]),B=y.useProgram("terrainRaster",null,fe),G=ne},K=y.colorModeForRenderPass(),J=new a.DepthMode(R.LEQUAL,a.DepthMode.ReadWrite,y.depthRangeFor3D);Zs.update(A);const F=y.transform,H=uc(F.zoom)*x.exaggeration();(Z?[!1,!0]:[!1]).forEach(ne=>{G=-1;const oe=ne?R.LINES:R.TRIANGLES,[fe,ge]=ne?x.getWirefameBuffer():[x.gridIndexBuffer,x.gridSegments];for(const me of C){const we=E.getTile(me),xe=a.StencilMode.disabled,Pe=x.prevTerrainTileForTile[me.key],Xe=x.terrainTileForTile[me.key];$a(Pe,Xe)&&Zs.newMorphing(me.key,Pe,Xe,A,250),L.activeTexture.set(R.TEXTURE0),we.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST);const ke=Zs.getMorphValuesForProxy(me.key),Ve=ke?1:0;let De;ke&&(De={morphing:{srcDemTile:ke.from,dstDemTile:ke.to,phase:a.easeCubicInOut(ke.phase)}});const Ze=Va(me.projMatrix,Ip(me.canonical,F.renderWorldCopies)?H/10:H);Y(Ve,ne),x.setupElevationDraw(we,B,De),y.prepareDrawProgram(L,B,me.toUnwrapped()),B.draw(L,oe,J,xe,K,a.CullFaceMode.backCCW,Ze,"terrain_raster",x.gridBuffer,fe,ge)}})}}(c,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(this._drapedRenderBatches.length===0)return s+1;this.renderingToTexture=!0;const c=this.painter,m=this.painter.context,y=this.proxySourceCache,x=this.proxiedCoords[y.id],E=this._drapedRenderBatches.shift(),C=[],A=c.style.order;let L=0;for(const R of x){const B=y.getTileByID(R.proxyTileKey),G=y.proxyCachedFBO[R.key]?y.proxyCachedFBO[R.key][s]:void 0,Z=G!==void 0?y.renderCache[G]:this.pool[L++],Y=G!==void 0;if(B.texture=Z.tex,Y&&!Z.dirty){C.push(B.tileID);continue}let K;m.bindFramebuffer.set(Z.fb.framebuffer),this.renderedToTile=!1,Z.dirty&&(m.clear({color:a.Color.transparent,stencil:0}),Z.dirty=!1);for(let J=E.start;J<=E.end;++J){const F=c.style._layers[A[J]];if(F.isHidden(c.transform.zoom))continue;const H=c.style._getLayerSourceCache(F),ne=H?this.proxyToSource[R.key][H.id]:[R];if(!ne)continue;const oe=ne;m.viewport.set([0,0,Z.fb.width,Z.fb.height]),K!==(H?H.id:null)&&(this._setupStencil(Z,ne,F,H),K=H?H.id:null),c.renderLayer(c,H,F,oe)}this.renderedToTile?(Z.dirty=!0,C.push(B.tileID)):Y||--L,L===5&&(L=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),E.end+1}postRender(){}renderCacheEfficiency(s){const c=s.order.length;if(c===0)return{efficiency:100};let m,y=0,x=0,E=!1;for(let C=0;C<c;++C){const A=s._layers[s.order[C]];this._style.isLayerDraped(A)?(E&&++y,++x):E||(E=!0,m=A.id)}return x===0?{efficiency:100}:{efficiency:100*(1-y/x),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{s=Math.min(s,c.dem.tree.minimums[0])}),s===0?s:(s-30)*this._exaggeration}raycast(s,c,m){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const E=x.tileID,C=1<<E.overscaledZ,{x:A,y:L}=E.canonical,R=A/C,B=(A+1)/C,G=L/C,Z=(L+1)/C;return{minx:R,miny:G,maxx:B,maxy:Z,t:x.dem.tree.raycastRoot(R,G,B,Z,s,c,m),tile:x}});y.sort((x,E)=>(x.t!==null?x.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE));for(const x of y){if(x.t==null)return null;const E=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,s,c,m);if(E!=null)return E}return null}_createFBO(){const s=this.painter.context,c=s.gl,m=this.drapeBufferSize;s.activeTexture.set(c.TEXTURE0);const y=new a.Texture(s,{width:m[0],height:m[1],data:null},c.RGBA);y.bind(c.LINEAR,c.CLAMP_TO_EDGE);const x=s.createFramebuffer(m[0],m[1],!1);return x.colorAttachment.set(y.texture),x.depthAttachment=new ye(s,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&!s.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:x,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const s in this._style._sourceCaches)if(this._style._sourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{const c=this._style._layers[s],m=c.isHidden(this.painter.transform.zoom);return c.type==="custom"?!m&&c.shouldRedrape():!m&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let s=!1;for(const m of this._style._getSources())if(m instanceof ot){s=!0;break}if(!s)return;const c={};for(let m=0;m<this._style.order.length;++m){const y=this._style._layers[this._style.order[m]],x=this._style._getLayerSourceCache(y);if(x&&!c[x.id]&&!y.isHidden(this.painter.transform.zoom)&&y.type==="line"&&y.widthExpression()instanceof a.ZoomDependentExpression){c[x.id]=!0;for(const E of this.proxyCoords){const C=this.proxyToSource[E.key][x.id];if(C)for(const A of C)this._clearRenderCacheForTile(x.id,A)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(const m in this._style._sourceCaches)if(this._style._sourceCaches[m]._source instanceof Ye){s=!0;break}if(!s)return;const c={};for(let m=0;m<this._style.order.length;++m){const y=this._style._layers[this._style.order[m]],x=this._style._getLayerSourceCache(y);if(!x||c[x.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const E=y.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const A=this.proxyToSource[C.key][x.id];if(A)for(const L of A){const R=Jh(x.getTile(L),x.findLoadedParent(L,0),x,this.painter.transform,E);(R.opacity!==1||R.mix!==0)&&this._clearRenderCacheForTile(x.id,L)}}}}_setupDrapedRenderBatches(){const s=this._style.order,c=s.length;if(c===0)return;const m=[];let y,x=0,E=this._style._layers[s[x]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++x<c;)E=this._style._layers[s[x]];for(;x<c;++x){const C=this._style._layers[s[x]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?y===void 0&&(y=x):y!==void 0&&(m.push({start:y,end:x-1}),y=void 0))}y!==void 0&&m.push({start:y,end:x-1}),this._drapedRenderBatches=m}_setupRenderCache(s){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const E=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let C=0;C<E.length;++C){const A=Object.values(E[C]);c.renderCachePool.push(...A)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,y=this._tilesDirty;for(let E=m.length-1;E>=0;E--){const C=m[E];if(c.getTileByID(C.key),c.proxyCachedFBO[C.key]!==void 0){const A=s[C.key],L=this.proxyToSource[C.key];let R=0;for(const B in L){const G=L[B],Z=A[B];if(!Z||Z.length!==G.length||G.some((Y,K)=>Y!==Z[K]||y[B]&&y[B].hasOwnProperty(Y.key))){R=-1;break}++R}for(const B in c.proxyCachedFBO[C.key])c.renderCache[c.proxyCachedFBO[C.key][B]].dirty=R<0||R!==Object.values(A).length}}const x=[...this._drapedRenderBatches];x.sort((E,C)=>C.end-C.start-(E.end-E.start));for(const E of x)for(const C of m){if(c.proxyCachedFBO[C.key])continue;let A=c.renderCachePool.pop();A===void 0&&c.renderCache.length<50&&(A=c.renderCache.length,c.renderCache.push(this._createFBO())),A!==void 0&&(c.proxyCachedFBO[C.key]={},c.proxyCachedFBO[C.key][E.start]=A,c.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(s,c,m,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,E=x.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let C;if(m.isTileClipped())C=c.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):a.StencilMode.disabled}_renderTileClippingMasks(s,c){const m=this.painter,y=this.painter.context,x=y.gl;m._tileClippingMaskIDs={},y.setColorMode(a.ColorMode.disabled),y.setDepthMode(a.DepthMode.disabled);const E=m.useProgram("clippingMask");for(const C of s){const A=m._tileClippingMaskIDs[C.key]=--c;E.draw(y,x.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:x.ALWAYS,mask:0},A,255,x.KEEP,x.KEEP,x.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,Ql(C.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(s){const c=this.painter.transform;if(s.x<0||s.x>c.width||s.y<0||s.y>c.height)return null;const m=[s.x,s.y,1,1];a.transformMat4$1(m,m,c.pixelMatrixInverse),a.scale$1(m,m,1/m[3]),m[0]/=c.worldSize,m[1]/=c.worldSize;const y=c._camera.position,x=a.mercatorZfromAltitude(1,c.center.lat),E=[y[0],y[1],y[2]/x,0],C=a.subtract([],m.slice(0,3),E);a.normalize(C,C);const A=this.raycast(E,C,this._exaggeration);return A!==null&&A?(a.scaleAndAdd(E,E,C,A),E[3]=E[2],E[2]*=x,E):null}drawDepth(){const s=this.painter,c=s.context,m=this.proxySourceCache,y=Math.ceil(s.width),x=Math.ceil(s.height);if(!this._depthFBO||this._depthFBO.width===y&&this._depthFBO.height===x||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const E=c.gl,C=c.createFramebuffer(y,x,!0);c.activeTexture.set(E.TEXTURE0);const A=new a.Texture(c,{width:y,height:x,data:null},E.RGBA);A.bind(E.NEAREST,E.CLAMP_TO_EDGE),C.colorAttachment.set(A.texture);const L=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,y,x);C.depthAttachment.set(L),this._depthFBO=C,this._depthTexture=A}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,y,x]),function(E,C,A,L){if(E.transform.projection.name==="globe")return;const R=E.context,B=R.gl;R.clear({depth:1});const G=E.useProgram("terrainDepth"),Z=new a.DepthMode(B.LESS,a.DepthMode.ReadWrite,E.depthRangeFor3D);for(const Y of L){const K=A.getTile(Y),J=Va(Y.projMatrix,0);C.setupElevationDraw(K,G),G.draw(R,B.TRIANGLES,Z,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.backCCW,J,"terrain_depth",C.gridBuffer,C.gridIndexBuffer,C.gridNoSkirtSegments)}}(s,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(s,c,m){if(s.getSource()instanceof Nt)return this._setupProxiedCoordsForImageSource(s,c,m);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};const y=this.proxiedCoords[s.id]=[],x=this.proxyCoords;for(let C=0;C<x.length;C++){const A=x[C],L=this._findTileCoveringTileID(A,s);if(L){const R=this._createProxiedId(A,L,m[A.key]&&m[A.key][s.id]);y.push(R),this.proxyToSource[A.key][s.id]=[R]}}let E=!1;for(let C=0;C<c.length;C++){const A=s.getTile(c[C]);if(!A||!A.hasData())continue;const L=this._findTileCoveringTileID(A.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==A.tileID.canonical.z){const R=this.proxyToSource[L.tileID.key][s.id],B=this._createProxiedId(L.tileID,A,m[L.tileID.key]&&m[L.tileID.key][s.id]);R?R.splice(R.length-1,0,B):this.proxyToSource[L.tileID.key][s.id]=[B],y.push(B),E=!0}}this._sourceTilesOverlap[s.id]=E}_setupProxiedCoordsForImageSource(s,c,m){if(!s.getSource().loaded())return;const y=this.proxiedCoords[s.id]=[],x=this.proxyCoords,E=s.getSource(),C=new a.Point(E.tileID.x,E.tileID.y)._div(1<<E.tileID.z),A=E.coordinates.map(a.MercatorCoordinate.fromLngLat).reduce((R,B)=>(R.min.x=Math.min(R.min.x,B.x-C.x),R.min.y=Math.min(R.min.y,B.y-C.y),R.max.x=Math.max(R.max.x,B.x-C.x),R.max.y=Math.max(R.max.y,B.y-C.y),R),{min:new a.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(R,B)=>{const G=R.wrap+R.canonical.x/(1<<R.canonical.z),Z=R.canonical.y/(1<<R.canonical.z),Y=a.EXTENT/(1<<R.canonical.z),K=B.wrap+B.canonical.x/(1<<B.canonical.z),J=B.canonical.y/(1<<B.canonical.z);return G+Y<K+A.min.x||G>K+A.max.x||Z+Y<J+A.min.y||Z>J+A.max.y};for(let R=0;R<x.length;R++){const B=x[R];for(let G=0;G<c.length;G++){const Z=s.getTile(c[G]);if(!Z||!Z.hasData()||L(B,Z.tileID))continue;const Y=this._createProxiedId(B,Z,m[B.key]&&m[B.key][s.id]),K=this.proxyToSource[B.key][s.id];K?K.push(Y):this.proxyToSource[B.key][s.id]=[Y],y.push(Y)}}}_createProxiedId(s,c,m){let y=this.orthoMatrix;if(m){const x=m.find(E=>E.key===c.tileID.key);if(x)return x}if(c.tileID.key!==s.key){const x=s.canonical.z-c.tileID.canonical.z;let E,C,A;y=a.create();const L=c.tileID.wrap-s.wrap<<s.overscaledZ;x>0?(E=a.EXTENT>>x,C=E*((c.tileID.canonical.x<<x)-s.canonical.x+L),A=E*((c.tileID.canonical.y<<x)-s.canonical.y)):(E=a.EXTENT<<-x,C=a.EXTENT*(c.tileID.canonical.x-(s.canonical.x+L<<-x)),A=a.EXTENT*(c.tileID.canonical.y-(s.canonical.y<<-x))),a.ortho(y,0,E,0,E,0,1),a.translate(y,y,[C,A,0])}return new hc(c.tileID,s.key,y)}_findTileCoveringTileID(s,c){let m=c.getTile(s);if(m&&m.hasData())return m;const y=this._findCoveringTileCache[c.id],x=y[s.key];if(m=x?c.getTileByID(x):null,m&&m.hasData()||x===null)return m;let E=m?m.tileID:s,C=E.overscaledZ;const A=c.getSource().minzoom,L=[];if(!x){const B=c.getSource().maxzoom;if(s.canonical.z>=B){const G=s.canonical.z-B;c.getSource().reparseOverscaled?(C=Math.max(s.canonical.z+2,c.transform.tileZoom),E=new a.OverscaledTileID(C,s.wrap,B,s.canonical.x>>G,s.canonical.y>>G)):G!==0&&(C=B,E=new a.OverscaledTileID(C,s.wrap,B,s.canonical.x>>G,s.canonical.y>>G))}E.key!==s.key&&(L.push(E.key),m=c.getTile(E))}const R=B=>{L.forEach(G=>{y[G]=B}),L.length=0};for(C-=1;C>=A&&(!m||!m.hasData());C--){m&&R(m.tileID.key);const B=E.calculateScaledKey(C);if(m=c.getTileByID(B),m&&m.hasData())break;const G=y[B];if(G===null)break;G===void 0?L.push(B):m=c.getTileByID(G)}return R(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,c){let m=this._tilesDirty[s];m||(m=this._tilesDirty[s]={}),m[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const s=function(c){let m=0;const y=new a.StructArrayLayout2ui4,x=131;for(let E=1;E<129;E++){for(let C=1;C<129;C++)m=E*x+C,y.emplaceBack(m,m+1),y.emplaceBack(m,m+x),y.emplaceBack(m+1,m+x),E===128&&y.emplaceBack(m+x,m+x+1);y.emplaceBack(m+1,m+1+x)}return y}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(s),this.wireframeSegments=a.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,s.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class tr{static cacheKey(s,c,m,y){let x=`${c}${y?y.cacheKey:""}`;for(const E of m)s.usedDefines.includes(E)&&(x+=`/${E}`);return x}constructor(s,c,m,y,x,E){const C=s.gl;this.program=C.createProgram();const A=function(F){const H=[];for(let ne=0;ne<F.length;ne++){if(F[ne]===null)continue;const oe=F[ne].split(" ");H.push(oe.pop())}return H}(m.staticAttributes),L=y?y.getBinderAttributes():[],R=A.concat(L);let B=y?y.defines():[];B=B.concat(E.map(F=>`#define ${F}`));const G=s.isWebGL2?`#version 300 es
`:"",Z=G+B.concat(s.extStandardDerivatives&&G.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(Hh):Hh,Hh,ac,Ep.fragmentSource,Na.fragmentSource,m.fragmentSource).join(`
`),Y=G+B.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,ac,Ep.vertexSource,Na.vertexSource,oc.vertexSource,m.vertexSource).join(`
`),K=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(K,Z),C.compileShader(K),C.attachShader(this.program,K);const J=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(J,Y),C.compileShader(J),C.attachShader(this.program,J),this.attributes={},this.numAttributes=R.length;for(let F=0;F<this.numAttributes;F++)R[F]&&(C.bindAttribLocation(this.program,F,R[F]),this.attributes[R[F]]=F);C.linkProgram(this.program),C.deleteShader(J),C.deleteShader(K),this.fixedUniforms=x(s),this.binderUniforms=y?y.getUniforms(s):[],E.includes("TERRAIN")&&(this.terrainUniforms=(F=>({u_dem:new a.Uniform1i(F),u_dem_prev:new a.Uniform1i(F),u_dem_unpack:new a.Uniform4f(F),u_dem_tl:new a.Uniform2f(F),u_dem_scale:new a.Uniform1f(F),u_dem_tl_prev:new a.Uniform2f(F),u_dem_scale_prev:new a.Uniform1f(F),u_dem_size:new a.Uniform1f(F),u_dem_lerp:new a.Uniform1f(F),u_exaggeration:new a.Uniform1f(F),u_depth:new a.Uniform1i(F),u_depth_size_inv:new a.Uniform2f(F),u_meter_to_dem:new a.Uniform1f(F),u_label_plane_matrix_inv:new a.UniformMatrix4f(F)}))(s)),E.includes("GLOBE")&&(this.globeUniforms=(F=>({u_tile_tl_up:new a.Uniform3f(F),u_tile_tr_up:new a.Uniform3f(F),u_tile_br_up:new a.Uniform3f(F),u_tile_bl_up:new a.Uniform3f(F),u_tile_up_scale:new a.Uniform1f(F)}))(s)),E.includes("FOG")&&(this.fogUniforms=(F=>({u_fog_matrix:new a.UniformMatrix4f(F),u_fog_range:new a.Uniform2f(F),u_fog_color:new a.Uniform4f(F),u_fog_horizon_blend:new a.Uniform1f(F),u_fog_temporal_offset:new a.Uniform1f(F),u_frustum_tl:new a.Uniform3f(F),u_frustum_tr:new a.Uniform3f(F),u_frustum_br:new a.Uniform3f(F),u_frustum_bl:new a.Uniform3f(F),u_globe_pos:new a.Uniform3f(F),u_globe_radius:new a.Uniform1f(F),u_globe_transition:new a.Uniform1f(F),u_is_globe:new a.Uniform1i(F),u_viewport:new a.Uniform2f(F)}))(s))}}setTerrainUniformValues(s,c){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const y in c)m[y]&&m[y].set(this.program,y,c[y])}}setGlobeUniformValues(s,c){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const y in c)m[y]&&m[y].set(this.program,y,c[y])}}setFogUniformValues(s,c){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const y in c)m[y].set(this.program,y,c[y])}}draw(s,c,m,y,x,E,C,A,L,R,B,G,Z,Y,K){const J=s.gl;if(this.failedToCreate)return;s.program.set(this.program),s.setDepthMode(m),s.setStencilMode(y),s.setColorMode(x),s.setCullFace(E);for(const H of Object.keys(this.fixedUniforms))this.fixedUniforms[H].set(this.program,H,C[H]);Y&&Y.setUniforms(this.program,s,this.binderUniforms,G,{zoom:Z});const F={[J.LINES]:2,[J.TRIANGLES]:3,[J.LINE_STRIP]:1}[c];for(const H of B.get()){const ne=H.vaos||(H.vaos={});(ne[A]||(ne[A]=new ty)).bind(s,this,L,Y?Y.getPaintVertexBuffers():[],R,H.vertexOffset,K||[]),J.drawElements(c,H.primitiveLength*F,J.UNSIGNED_SHORT,H.primitiveOffset*F*2)}}}function eu(d,s){const c=Math.pow(2,s.tileID.overscaledZ),m=s.tileSize*Math.pow(2,d.transform.tileZoom)/c,y=m*(s.tileID.canonical.x+s.tileID.wrap*c),x=m*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_tile_units_to_pixels:1/Bt(s,1,d.transform.tileZoom),u_pixel_coord_upper:[y>>16,x>>16],u_pixel_coord_lower:[65535&y,65535&x]}}const Ap=a.create(),td=(d,s,c,m,y,x,E,C,A,L,R)=>{const B=s.style.light,G=B.properties.get("position"),Z=[G.x,G.y,G.z],Y=a.create$1();B.properties.get("anchor")==="viewport"&&(a.fromRotation(Y,-s.transform.angle),a.transformMat3(Z,Z,Y));const K=B.properties.get("color"),J=s.transform,F={u_matrix:d,u_lightpos:Z,u_lightintensity:B.properties.get("intensity"),u_lightcolor:[K.r,K.g,K.b],u_vertical_gradient:+c,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ap,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:y,u_edge_radius:x};return J.projection.name==="globe"&&(F.u_tile_id=[E.canonical.x,E.canonical.y,1<<E.canonical.z],F.u_zoom_transition=A,F.u_inv_rot_matrix=R,F.u_merc_center=L,F.u_up_dir=J.projection.upVector(new a.CanonicalTileID(0,0,0),L[0]*a.EXTENT,L[1]*a.EXTENT),F.u_height_lift=C),F},Mp=(d,s,c,m,y,x,E,C,A,L,R,B)=>{const G=td(d,s,c,m,y,x,E,A,L,R,B),Z={u_height_factor:-Math.pow(2,E.overscaledZ)/C.tileSize/8};return a.extend(G,eu(s,C),Z)},ia=d=>({u_matrix:d}),rd=(d,s,c)=>a.extend(ia(d),eu(s,c)),ry=(d,s)=>({u_matrix:d,u_world:s}),ny=(d,s,c,m)=>a.extend(rd(d,s,c),{u_world:m}),iy=a.create(),nd=(d,s,c,m,y,x)=>{const E=d.transform,C=E.projection.name==="globe";let A;if(x.paint.get("circle-pitch-alignment")==="map")if(C){const R=a.globePixelsToTileUnits(E.zoom,s.canonical)*E._pixelsPerMercatorPixel;A=Float32Array.from([R,0,0,R])}else A=E.calculatePixelsToTileUnitsMatrix(c);else A=new Float32Array([E.pixelsToGLUnits[0],0,0,E.pixelsToGLUnits[1]]);const L={u_camera_to_center_distance:E.cameraToCenterDistance,u_matrix:d.translatePosMatrix(s.projMatrix,c,x.paint.get("circle-translate"),x.paint.get("circle-translate-anchor")),u_device_pixel_ratio:a.exported.devicePixelRatio,u_extrude_scale:A,u_inv_rot_matrix:iy,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){L.u_inv_rot_matrix=m,L.u_merc_center=y,L.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],L.u_zoom_transition=a.globeToMercatorTransition(E.zoom);const R=y[0]*a.EXTENT,B=y[1]*a.EXTENT;L.u_up_dir=E.projection.upVector(new a.CanonicalTileID(0,0,0),R,B)}return L},id=d=>{const s=[];return d.paint.get("circle-pitch-alignment")==="map"&&s.push("PITCH_WITH_MAP"),d.paint.get("circle-pitch-scale")==="map"&&s.push("SCALE_WITH_MAP"),s},sd=(d,s,c,m)=>{const y=a.EXTENT/c.tileSize;return{u_matrix:d,u_camera_to_center_distance:s.getCameraToCenterDistance(m),u_extrude_scale:[s.pixelsToGLUnits[0]/y,s.pixelsToGLUnits[1]/y]}},dc=(d,s,c=1)=>({u_matrix:d,u_color:s,u_overlay:0,u_overlay_scale:c}),Pp=a.create(),Rp=(d,s,c,m,y,x,E)=>{const C=d.transform,A=C.projection.name==="globe",L=A?a.globePixelsToTileUnits(C.zoom,s.canonical)*C._pixelsPerMercatorPixel:Bt(c,1,x),R={u_matrix:s.projMatrix,u_extrude_scale:L,u_intensity:E,u_inv_rot_matrix:Pp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){R.u_inv_rot_matrix=m,R.u_merc_center=y,R.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],R.u_zoom_transition=a.globeToMercatorTransition(C.zoom);const B=y[0]*a.EXTENT,G=y[1]*a.EXTENT;R.u_up_dir=C.projection.upVector(new a.CanonicalTileID(0,0,0),B,G)}return R},sy=(d,s,c,m,y,x,E)=>{const C=d.transform,A=C.calculatePixelsToTileUnitsMatrix(s);return{u_matrix:od(d,s,c,m),u_pixels_to_tile_units:A,u_device_pixel_ratio:x,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:y,u_texsize:ru(c)?s.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Ga(s,d.transform),u_alpha_discard_threshold:0,u_trim_offset:E}},tu=(d,s,c,m,y)=>{const x=d.transform;return{u_matrix:od(d,s,c,m),u_texsize:s.imageAtlasTexture.size,u_pixels_to_tile_units:x.calculatePixelsToTileUnitsMatrix(s),u_device_pixel_ratio:y,u_image:0,u_tile_units_to_pixels:Ga(s,x),u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Ga(d,s){return 1/Bt(d,1,s.tileZoom)}function od(d,s,c,m){return d.translatePosMatrix(m||s.tileID.projMatrix,s,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}function ru(d){const s=d.paint.get("line-dasharray").value;return s.value||s.kind!=="constant"}const ad=(d,s,c,m,y,x)=>{return{u_matrix:d,u_tl_parent:s,u_scale_parent:c,u_fade_t:m.mix,u_opacity:m.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(C=y.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(E=y.paint.get("raster-contrast"),E>0?1/(1-E):1+E),u_spin_weights:Ts(y.paint.get("raster-hue-rotate")),u_perspective_transform:x};var E,C};function Ts(d){d*=Math.PI/180;const s=Math.sin(d),c=Math.cos(d);return[(2*c+1)/3,(-Math.sqrt(3)*s-c+1)/3,(Math.sqrt(3)*s-c+1)/3]}const fc=a.create(),ld=(d,s,c,m,y,x,E,C,A,L,R,B,G,Z,Y,K)=>{const J=y.transform,F={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:J.cameraToCenterDistance,u_rotate_symbol:+c,u_aspect_ratio:J.width/J.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:E,u_coord_matrix:C,u_is_text:+A,u_pitch_with_map:+m,u_texsize:L,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:fc,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:fc,u_up_vector:[0,-1,0]};return K.name==="globe"&&(F.u_tile_id=[R.canonical.x,R.canonical.y,1<<R.canonical.z],F.u_zoom_transition=B,F.u_inv_rot_matrix=Z,F.u_merc_center=G,F.u_camera_forward=J._camera.forward(),F.u_ecef_origin=a.globeECEFOrigin(J.globeMatrix,R.toUnwrapped()),F.u_tile_matrix=Float32Array.from(J.globeMatrix),F.u_up_vector=Y),F},pc=(d,s,c,m,y,x,E,C,A,L,R,B,G,Z,Y,K,J)=>a.extend(ld(d,s,c,m,y,x,E,C,A,L,B,G,Z,Y,K,J),{u_gamma_scale:m?y.transform.cameraToCenterDistance*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:a.exported.devicePixelRatio,u_is_halo:1}),Lp=(d,s,c,m,y,x,E,C,A,L,R,B,G,Z,Y,K)=>a.extend(pc(d,s,c,m,y,x,E,C,!0,A,!0,R,B,G,Z,Y,K),{u_texsize_icon:L,u_texture_icon:1}),ud=(d,s,c)=>({u_matrix:d,u_opacity:s,u_color:c}),oy=(d,s,c,m,y)=>a.extend(function(x,E,C){const A=E.imageManager.getPattern(x.toString()),{width:L,height:R}=E.imageManager.getPixelSize(),B=Math.pow(2,C.tileID.overscaledZ),G=C.tileSize*Math.pow(2,E.transform.tileZoom)/B,Z=G*(C.tileID.canonical.x+C.tileID.wrap*B),Y=G*C.tileID.canonical.y;return{u_image:0,u_pattern_tl:A.tl,u_pattern_br:A.br,u_texsize:[L,R],u_pattern_size:A.displaySize,u_tile_units_to_pixels:1/Bt(C,1,E.transform.tileZoom),u_pixel_coord_upper:[Z>>16,Y>>16],u_pixel_coord_lower:[65535&Z,65535&Y]}}(m,c,y),{u_matrix:d,u_opacity:s}),cd={fillExtrusion:d=>({u_matrix:new a.UniformMatrix4f(d),u_lightpos:new a.Uniform3f(d),u_lightintensity:new a.Uniform1f(d),u_lightcolor:new a.Uniform3f(d),u_vertical_gradient:new a.Uniform1f(d),u_opacity:new a.Uniform1f(d),u_edge_radius:new a.Uniform1f(d),u_ao:new a.Uniform2f(d),u_tile_id:new a.Uniform3f(d),u_zoom_transition:new a.Uniform1f(d),u_inv_rot_matrix:new a.UniformMatrix4f(d),u_merc_center:new a.Uniform2f(d),u_up_dir:new a.Uniform3f(d),u_height_lift:new a.Uniform1f(d)}),fillExtrusionPattern:d=>({u_matrix:new a.UniformMatrix4f(d),u_lightpos:new a.Uniform3f(d),u_lightintensity:new a.Uniform1f(d),u_lightcolor:new a.Uniform3f(d),u_vertical_gradient:new a.Uniform1f(d),u_height_factor:new a.Uniform1f(d),u_edge_radius:new a.Uniform1f(d),u_ao:new a.Uniform2f(d),u_tile_id:new a.Uniform3f(d),u_zoom_transition:new a.Uniform1f(d),u_inv_rot_matrix:new a.UniformMatrix4f(d),u_merc_center:new a.Uniform2f(d),u_up_dir:new a.Uniform3f(d),u_height_lift:new a.Uniform1f(d),u_image:new a.Uniform1i(d),u_texsize:new a.Uniform2f(d),u_pixel_coord_upper:new a.Uniform2f(d),u_pixel_coord_lower:new a.Uniform2f(d),u_tile_units_to_pixels:new a.Uniform1f(d),u_opacity:new a.Uniform1f(d)}),fill:d=>({u_matrix:new a.UniformMatrix4f(d)}),fillPattern:d=>({u_matrix:new a.UniformMatrix4f(d),u_image:new a.Uniform1i(d),u_texsize:new a.Uniform2f(d),u_pixel_coord_upper:new a.Uniform2f(d),u_pixel_coord_lower:new a.Uniform2f(d),u_tile_units_to_pixels:new a.Uniform1f(d)}),fillOutline:d=>({u_matrix:new a.UniformMatrix4f(d),u_world:new a.Uniform2f(d)}),fillOutlinePattern:d=>({u_matrix:new a.UniformMatrix4f(d),u_world:new a.Uniform2f(d),u_image:new a.Uniform1i(d),u_texsize:new a.Uniform2f(d),u_pixel_coord_upper:new a.Uniform2f(d),u_pixel_coord_lower:new a.Uniform2f(d),u_tile_units_to_pixels:new a.Uniform1f(d)}),circle:d=>({u_camera_to_center_distance:new a.Uniform1f(d),u_extrude_scale:new a.UniformMatrix2f(d),u_device_pixel_ratio:new a.Uniform1f(d),u_matrix:new a.UniformMatrix4f(d),u_inv_rot_matrix:new a.UniformMatrix4f(d),u_merc_center:new a.Uniform2f(d),u_tile_id:new a.Uniform3f(d),u_zoom_transition:new a.Uniform1f(d),u_up_dir:new a.Uniform3f(d)}),collisionBox:d=>({u_matrix:new a.UniformMatrix4f(d),u_camera_to_center_distance:new a.Uniform1f(d),u_extrude_scale:new a.Uniform2f(d)}),collisionCircle:d=>({u_matrix:new a.UniformMatrix4f(d),u_inv_matrix:new a.UniformMatrix4f(d),u_camera_to_center_distance:new a.Uniform1f(d),u_viewport_size:new a.Uniform2f(d)}),debug:d=>({u_color:new a.UniformColor(d),u_matrix:new a.UniformMatrix4f(d),u_overlay:new a.Uniform1i(d),u_overlay_scale:new a.Uniform1f(d)}),clippingMask:d=>({u_matrix:new a.UniformMatrix4f(d)}),heatmap:d=>({u_extrude_scale:new a.Uniform1f(d),u_intensity:new a.Uniform1f(d),u_matrix:new a.UniformMatrix4f(d),u_inv_rot_matrix:new a.UniformMatrix4f(d),u_merc_center:new a.Uniform2f(d),u_tile_id:new a.Uniform3f(d),u_zoom_transition:new a.Uniform1f(d),u_up_dir:new a.Uniform3f(d)}),heatmapTexture:d=>({u_image:new a.Uniform1i(d),u_color_ramp:new a.Uniform1i(d),u_opacity:new a.Uniform1f(d)}),hillshade:d=>({u_matrix:new a.UniformMatrix4f(d),u_image:new a.Uniform1i(d),u_latrange:new a.Uniform2f(d),u_light:new a.Uniform2f(d),u_shadow:new a.UniformColor(d),u_highlight:new a.UniformColor(d),u_accent:new a.UniformColor(d)}),hillshadePrepare:d=>({u_matrix:new a.UniformMatrix4f(d),u_image:new a.Uniform1i(d),u_dimension:new a.Uniform2f(d),u_zoom:new a.Uniform1f(d),u_unpack:new a.Uniform4f(d)}),line:d=>({u_matrix:new a.UniformMatrix4f(d),u_pixels_to_tile_units:new a.UniformMatrix2f(d),u_device_pixel_ratio:new a.Uniform1f(d),u_units_to_pixels:new a.Uniform2f(d),u_dash_image:new a.Uniform1i(d),u_gradient_image:new a.Uniform1i(d),u_image_height:new a.Uniform1f(d),u_texsize:new a.Uniform2f(d),u_tile_units_to_pixels:new a.Uniform1f(d),u_alpha_discard_threshold:new a.Uniform1f(d),u_trim_offset:new a.Uniform2f(d)}),linePattern:d=>({u_matrix:new a.UniformMatrix4f(d),u_texsize:new a.Uniform2f(d),u_pixels_to_tile_units:new a.UniformMatrix2f(d),u_device_pixel_ratio:new a.Uniform1f(d),u_image:new a.Uniform1i(d),u_units_to_pixels:new a.Uniform2f(d),u_tile_units_to_pixels:new a.Uniform1f(d),u_alpha_discard_threshold:new a.Uniform1f(d)}),raster:d=>({u_matrix:new a.UniformMatrix4f(d),u_tl_parent:new a.Uniform2f(d),u_scale_parent:new a.Uniform1f(d),u_fade_t:new a.Uniform1f(d),u_opacity:new a.Uniform1f(d),u_image0:new a.Uniform1i(d),u_image1:new a.Uniform1i(d),u_brightness_low:new a.Uniform1f(d),u_brightness_high:new a.Uniform1f(d),u_saturation_factor:new a.Uniform1f(d),u_contrast_factor:new a.Uniform1f(d),u_spin_weights:new a.Uniform3f(d),u_perspective_transform:new a.Uniform2f(d)}),symbolIcon:d=>({u_is_size_zoom_constant:new a.Uniform1i(d),u_is_size_feature_constant:new a.Uniform1i(d),u_size_t:new a.Uniform1f(d),u_size:new a.Uniform1f(d),u_camera_to_center_distance:new a.Uniform1f(d),u_rotate_symbol:new a.Uniform1i(d),u_aspect_ratio:new a.Uniform1f(d),u_fade_change:new a.Uniform1f(d),u_matrix:new a.UniformMatrix4f(d),u_label_plane_matrix:new a.UniformMatrix4f(d),u_coord_matrix:new a.UniformMatrix4f(d),u_is_text:new a.Uniform1i(d),u_pitch_with_map:new a.Uniform1i(d),u_texsize:new a.Uniform2f(d),u_tile_id:new a.Uniform3f(d),u_zoom_transition:new a.Uniform1f(d),u_inv_rot_matrix:new a.UniformMatrix4f(d),u_merc_center:new a.Uniform2f(d),u_camera_forward:new a.Uniform3f(d),u_tile_matrix:new a.UniformMatrix4f(d),u_up_vector:new a.Uniform3f(d),u_ecef_origin:new a.Uniform3f(d),u_texture:new a.Uniform1i(d)}),symbolSDF:d=>({u_is_size_zoom_constant:new a.Uniform1i(d),u_is_size_feature_constant:new a.Uniform1i(d),u_size_t:new a.Uniform1f(d),u_size:new a.Uniform1f(d),u_camera_to_center_distance:new a.Uniform1f(d),u_rotate_symbol:new a.Uniform1i(d),u_aspect_ratio:new a.Uniform1f(d),u_fade_change:new a.Uniform1f(d),u_matrix:new a.UniformMatrix4f(d),u_label_plane_matrix:new a.UniformMatrix4f(d),u_coord_matrix:new a.UniformMatrix4f(d),u_is_text:new a.Uniform1i(d),u_pitch_with_map:new a.Uniform1i(d),u_texsize:new a.Uniform2f(d),u_texture:new a.Uniform1i(d),u_gamma_scale:new a.Uniform1f(d),u_device_pixel_ratio:new a.Uniform1f(d),u_tile_id:new a.Uniform3f(d),u_zoom_transition:new a.Uniform1f(d),u_inv_rot_matrix:new a.UniformMatrix4f(d),u_merc_center:new a.Uniform2f(d),u_camera_forward:new a.Uniform3f(d),u_tile_matrix:new a.UniformMatrix4f(d),u_up_vector:new a.Uniform3f(d),u_ecef_origin:new a.Uniform3f(d),u_is_halo:new a.Uniform1i(d)}),symbolTextAndIcon:d=>({u_is_size_zoom_constant:new a.Uniform1i(d),u_is_size_feature_constant:new a.Uniform1i(d),u_size_t:new a.Uniform1f(d),u_size:new a.Uniform1f(d),u_camera_to_center_distance:new a.Uniform1f(d),u_rotate_symbol:new a.Uniform1i(d),u_aspect_ratio:new a.Uniform1f(d),u_fade_change:new a.Uniform1f(d),u_matrix:new a.UniformMatrix4f(d),u_label_plane_matrix:new a.UniformMatrix4f(d),u_coord_matrix:new a.UniformMatrix4f(d),u_is_text:new a.Uniform1i(d),u_pitch_with_map:new a.Uniform1i(d),u_texsize:new a.Uniform2f(d),u_texsize_icon:new a.Uniform2f(d),u_texture:new a.Uniform1i(d),u_texture_icon:new a.Uniform1i(d),u_gamma_scale:new a.Uniform1f(d),u_device_pixel_ratio:new a.Uniform1f(d),u_is_halo:new a.Uniform1i(d)}),background:d=>({u_matrix:new a.UniformMatrix4f(d),u_opacity:new a.Uniform1f(d),u_color:new a.UniformColor(d)}),backgroundPattern:d=>({u_matrix:new a.UniformMatrix4f(d),u_opacity:new a.Uniform1f(d),u_image:new a.Uniform1i(d),u_pattern_tl:new a.Uniform2f(d),u_pattern_br:new a.Uniform2f(d),u_texsize:new a.Uniform2f(d),u_pattern_size:new a.Uniform2f(d),u_pixel_coord_upper:new a.Uniform2f(d),u_pixel_coord_lower:new a.Uniform2f(d),u_tile_units_to_pixels:new a.Uniform1f(d)}),terrainRaster:Yh,terrainDepth:Yh,skybox:d=>({u_matrix:new a.UniformMatrix4f(d),u_sun_direction:new a.Uniform3f(d),u_cubemap:new a.Uniform1i(d),u_opacity:new a.Uniform1f(d),u_temporal_offset:new a.Uniform1f(d)}),skyboxGradient:d=>({u_matrix:new a.UniformMatrix4f(d),u_color_ramp:new a.Uniform1i(d),u_center_direction:new a.Uniform3f(d),u_radius:new a.Uniform1f(d),u_opacity:new a.Uniform1f(d),u_temporal_offset:new a.Uniform1f(d)}),skyboxCapture:d=>({u_matrix_3f:new a.UniformMatrix3f(d),u_sun_direction:new a.Uniform3f(d),u_sun_intensity:new a.Uniform1f(d),u_color_tint_r:new a.Uniform4f(d),u_color_tint_m:new a.Uniform4f(d),u_luminance:new a.Uniform1f(d)}),globeRaster:d=>({u_proj_matrix:new a.UniformMatrix4f(d),u_globe_matrix:new a.UniformMatrix4f(d),u_normalize_matrix:new a.UniformMatrix4f(d),u_merc_matrix:new a.UniformMatrix4f(d),u_zoom_transition:new a.Uniform1f(d),u_merc_center:new a.Uniform2f(d),u_image0:new a.Uniform1i(d),u_grid_matrix:new a.UniformMatrix3f(d),u_skirt_height:new a.Uniform1f(d),u_frustum_tl:new a.Uniform3f(d),u_frustum_tr:new a.Uniform3f(d),u_frustum_br:new a.Uniform3f(d),u_frustum_bl:new a.Uniform3f(d),u_globe_pos:new a.Uniform3f(d),u_globe_radius:new a.Uniform1f(d),u_viewport:new a.Uniform2f(d)}),globeAtmosphere:d=>({u_frustum_tl:new a.Uniform3f(d),u_frustum_tr:new a.Uniform3f(d),u_frustum_br:new a.Uniform3f(d),u_frustum_bl:new a.Uniform3f(d),u_horizon:new a.Uniform1f(d),u_transition:new a.Uniform1f(d),u_fadeout_range:new a.Uniform1f(d),u_color:new a.Uniform4f(d),u_high_color:new a.Uniform4f(d),u_space_color:new a.Uniform4f(d),u_star_intensity:new a.Uniform1f(d),u_star_density:new a.Uniform1f(d),u_star_size:new a.Uniform1f(d),u_temporal_offset:new a.Uniform1f(d),u_horizon_angle:new a.Uniform1f(d),u_rotation_matrix:new a.UniformMatrix4f(d)})};let mc;function nu(d,s,c,m,y,x,E){const C=d.context,A=C.gl,L=d.transform,R=d.useProgram("collisionBox"),B=[];let G=0,Z=0;for(let oe=0;oe<m.length;oe++){const fe=m[oe],ge=s.getTile(fe),me=ge.getBucket(c);if(!me)continue;const we=Jn(fe,me,L);let xe=we;y[0]===0&&y[1]===0||(xe=d.translatePosMatrix(we,ge,y,x));const Pe=E?me.textCollisionBox:me.iconCollisionBox,Xe=me.collisionCircleArray;if(Xe.length>0){const ke=a.create(),Ve=xe;a.mul(ke,me.placementInvProjMatrix,L.glCoordMatrix),a.mul(ke,ke,me.placementViewportMatrix),B.push({circleArray:Xe,circleOffset:Z,transform:Ve,invTransform:ke,projection:me.getProjection()}),G+=Xe.length/4,Z=G}Pe&&(d.terrain&&d.terrain.setupElevationDraw(ge,R),R.draw(C,A.LINES,a.DepthMode.disabled,a.StencilMode.disabled,d.colorModeForRenderPass(),a.CullFaceMode.disabled,sd(xe,L,ge,me.getProjection()),c.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,null,L.zoom,null,[Pe.collisionVertexBuffer,Pe.collisionVertexBufferExt]))}if(!E||!B.length)return;const Y=d.useProgram("collisionCircle"),K=new a.StructArrayLayout2f1f2i16;K.resize(4*G),K._trim();let J=0;for(const oe of B)for(let fe=0;fe<oe.circleArray.length/4;fe++){const ge=4*fe,me=oe.circleArray[ge+0],we=oe.circleArray[ge+1],xe=oe.circleArray[ge+2],Pe=oe.circleArray[ge+3];K.emplace(J++,me,we,xe,Pe,0),K.emplace(J++,me,we,xe,Pe,1),K.emplace(J++,me,we,xe,Pe,2),K.emplace(J++,me,we,xe,Pe,3)}(!mc||mc.length<2*G)&&(mc=function(oe){const fe=2*oe,ge=new a.StructArrayLayout3ui6;ge.resize(fe),ge._trim();for(let me=0;me<fe;me++){const we=6*me;ge.uint16[we+0]=4*me+0,ge.uint16[we+1]=4*me+1,ge.uint16[we+2]=4*me+2,ge.uint16[we+3]=4*me+2,ge.uint16[we+4]=4*me+3,ge.uint16[we+5]=4*me+0}return ge}(G));const F=C.createIndexBuffer(mc,!0),H=C.createVertexBuffer(K,a.collisionCircleLayout.members,!0);for(const oe of B){const fe={u_matrix:oe.transform,u_inv_matrix:oe.invTransform,u_camera_to_center_distance:(ne=L).getCameraToCenterDistance(oe.projection),u_viewport_size:[ne.width,ne.height]};Y.draw(C,A.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,d.colorModeForRenderPass(),a.CullFaceMode.disabled,fe,c.id,H,F,a.SegmentVector.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,L.zoom)}var ne;H.destroy(),F.destroy()}const zp=a.create();function hd({width:d,height:s,anchor:c,textOffset:m,textScale:y},x){const{horizontalAlign:E,verticalAlign:C}=a.getAnchorAlignment(c),A=-(E-.5)*d,L=-(C-.5)*s,R=a.evaluateVariableOffset(c,m);return new a.Point((A/y+R[0])*x,(L/y+R[1])*x)}function ay(d,s,c,m,y,x,E,C,A,L,R){const B=d.text.placedSymbolArray,G=d.text.dynamicLayoutVertexArray,Z=d.icon.dynamicLayoutVertexArray,Y={},K=d.getProjection(),J=Tr(C,K,x),F=x.elevation,H=K.upVectorScale(C.canonical,x.center.lat,x.worldSize).metersToTile;G.clear();for(let ne=0;ne<B.length;ne++){const oe=B.get(ne),{tileAnchorX:fe,tileAnchorY:ge,numGlyphs:me}=oe,we=oe.hidden||!oe.crossTileID||d.allowVerticalPlacement&&!oe.placedOrientation?null:m[oe.crossTileID];if(we){let xe=0,Pe=0,Xe=0;if(F){const Qe=F?F.getAtTileOffset(C,fe,ge):0,[vt,At,gt]=K.upVector(C.canonical,fe,ge);xe=Qe*vt*H,Pe=Qe*At*H,Xe=Qe*gt*H}let[ke,Ve,De,Ze]=sn(oe.projectedAnchorX+xe,oe.projectedAnchorY+Pe,oe.projectedAnchorZ+Xe,c?J:E);const Me=ql(x.getCameraToCenterDistance(K),Ze);let Ue=y.evaluateSizeForFeature(d.textSizeData,L,oe)*Me/a.ONE_EM;c&&(Ue*=d.tilePixelRatio/A);const Je=hd(we,Ue);c?({x:ke,y:Ve,z:De}=K.projectTilePoint(fe+Je.x,ge+Je.y,C.canonical),[ke,Ve,De]=sn(ke+xe,Ve+Pe,De+Xe,E)):(s&&Je._rotate(-x.angle),ke+=Je.x,Ve+=Je.y,De=0);const We=d.allowVerticalPlacement&&oe.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let Qe=0;Qe<me;Qe++)a.addDynamicAttributes(G,ke,Ve,De,We);R&&oe.associatedIconIndex>=0&&(Y[oe.associatedIconIndex]={x:ke,y:Ve,z:De,angle:We})}else oi(me,G)}if(R){Z.clear();const ne=d.icon.placedSymbolArray;for(let oe=0;oe<ne.length;oe++){const fe=ne.get(oe),{numGlyphs:ge}=fe,me=Y[oe];if(fe.hidden||!me)oi(ge,Z);else{const{x:we,y:xe,z:Pe,angle:Xe}=me;for(let ke=0;ke<ge;ke++)a.addDynamicAttributes(Z,we,xe,Pe,Xe)}}d.icon.dynamicLayoutVertexBuffer.updateData(Z)}d.text.dynamicLayoutVertexBuffer.updateData(G)}function dd(d,s,c){return c.iconsInText&&s?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function Dp(d,s,c,m,y,x,E,C,A,L,R,B){const G=d.context,Z=G.gl,Y=d.transform,K=C==="map",J=A==="map",F=K&&c.layout.get("symbol-placement")!=="point",H=K&&!J&&!F,ne=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let oe=!1;const fe=d.depthModeForSublayer(0,a.DepthMode.ReadOnly),ge=[a.mercatorXfromLng(Y.center.lng),a.mercatorYfromLat(Y.center.lat)],me=c.layout.get("text-variable-anchor"),we=Y.projection.name==="globe",xe=[],Pe=[0,-1,0];let Xe=Pe;!we&&!Y.mercatorFromTransition||K||(Xe=function(ke){const Ve=ke._camera.getWorldToCamera(ke.worldSize,1),De=a.multiply([],Ve,ke.globeMatrix);a.invert(De,De);const Ze=[0,0,0],Me=[0,1,0,0];return a.transformMat4$1(Me,Me,De),Ze[0]=Me[0],Ze[1]=Me[1],Ze[2]=Me[2],a.normalize(Ze,Ze),Ze}(Y));for(const ke of m){const Ve=s.getTile(ke),De=Ve.getBucket(c);if(!De||De.projection.name==="mercator"&&we)continue;const Ze=y?De.text:De.icon;if(!Ze||De.fullyClipped||!Ze.segments.get().length)continue;const Me=Ze.programConfigurations.get(c.id),Ue=y||De.sdfIcons,Je=y?De.textSizeData:De.iconSizeData,We=J||Y.pitch!==0,Qe=a.evaluateSizeForZoom(Je,Y.zoom);let vt,At,gt,Et,Zt=[0,0],Ht=null;if(y)At=Ve.glyphAtlasTexture,gt=Z.LINEAR,vt=Ve.glyphAtlasTexture.size,De.iconsInText&&(Zt=Ve.imageAtlasTexture.size,Ht=Ve.imageAtlasTexture,Et=We||d.options.rotating||d.options.zooming||Je.kind==="composite"||Je.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const Ys=c.layout.get("icon-size").constantOr(0)!==1||De.iconsNeedLinear;At=Ve.imageAtlasTexture,gt=Ue||d.options.rotating||d.options.zooming||Ys||We?Z.LINEAR:Z.NEAREST,vt=Ve.imageAtlasTexture.size}const yt=De.projection.name==="globe",lr=yt?Xe:Pe,mr=yt?a.globeToMercatorTransition(Y.zoom):0,gr=Tr(ke,De.getProjection(),Y),_r=Y.calculatePixelsToTileUnitsMatrix(Ve),Gn=Be(gr,Ve.tileID.canonical,J,K,Y,De.getProjection(),_r),Cn=d.terrain&&J&&F?a.invert(a.create(),Gn):zp,ji=Vr(gr,Ve.tileID.canonical,J,K,Y,De.getProjection(),_r),Cs=me&&De.hasTextData(),zr=c.layout.get("icon-text-fit")!=="none"&&Cs&&De.hasIconData();if(F){const Ys=Y.elevation,Lo=Ys?Ys.getAtTileOffsetFunc(ke,Y.center.lat,Y.worldSize,De.getProjection()):null,ua=Di(gr,Ve.tileID.canonical,J,K,Y,De.getProjection(),_r);Oa(De,gr,d,y,ua,ji,J,L,Lo,ke)}const yr=F||y&&me||zr,ir=d.translatePosMatrix(gr,Ve,x,E),on=yr?zp:Gn,ei=d.translatePosMatrix(ji,Ve,x,E,!0),Mr=De.getProjection().createInversionMatrix(Y,ke.canonical),ai=[];d.terrainRenderModeElevated()&&J&&ai.push("PITCH_WITH_MAP_TERRAIN"),yt&&ai.push("PROJECTION_GLOBE_VIEW"),yr&&ai.push("PROJECTED_POS_ON_VIEWPORT");const Pc=Ue&&c.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let la;la=Ue?De.iconsInText?Lp(Je.kind,Qe,H,J,d,ir,on,ei,vt,Zt,ke,mr,ge,Mr,lr,De.getProjection()):pc(Je.kind,Qe,H,J,d,ir,on,ei,y,vt,!0,ke,mr,ge,Mr,lr,De.getProjection()):ld(Je.kind,Qe,H,J,d,ir,on,ei,y,vt,ke,mr,ge,Mr,lr,De.getProjection());const pu={program:d.useProgram(dd(Ue,y,De),Me,ai),buffers:Ze,uniformValues:la,atlasTexture:At,atlasTextureIcon:Ht,atlasInterpolation:gt,atlasInterpolationIcon:Et,isSDF:Ue,hasHalo:Pc,tile:Ve,labelPlaneMatrixInv:Cn};if(ne&&De.canOverlap){oe=!0;const Ys=Ze.segments.get();for(const Lo of Ys)xe.push({segments:new a.SegmentVector([Lo]),sortKey:Lo.sortKey,state:pu})}else xe.push({segments:Ze.segments,sortKey:0,state:pu})}oe&&xe.sort((ke,Ve)=>ke.sortKey-Ve.sortKey);for(const ke of xe){const Ve=ke.state;if(d.terrain&&d.terrain.setupElevationDraw(Ve.tile,Ve.program,{useDepthForOcclusion:!we,labelPlaneMatrixInv:Ve.labelPlaneMatrixInv}),G.activeTexture.set(Z.TEXTURE0),Ve.atlasTexture.bind(Ve.atlasInterpolation,Z.CLAMP_TO_EDGE),Ve.atlasTextureIcon&&(G.activeTexture.set(Z.TEXTURE1),Ve.atlasTextureIcon&&Ve.atlasTextureIcon.bind(Ve.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),Ve.isSDF){const De=Ve.uniformValues;Ve.hasHalo&&(De.u_is_halo=1,iu(Ve.buffers,ke.segments,c,d,Ve.program,fe,R,B,De)),De.u_is_halo=0}iu(Ve.buffers,ke.segments,c,d,Ve.program,fe,R,B,Ve.uniformValues)}}function iu(d,s,c,m,y,x,E,C,A){const L=m.context,R=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.globeExtVertexBuffer];y.draw(L,L.gl.TRIANGLES,x,E,C,a.CullFaceMode.disabled,A,c.id,d.layoutVertexBuffer,d.indexBuffer,s,c.paint,m.transform.zoom,d.programConfigurations.get(c.id),R)}function Op(d,s,c,m,y,x,E){const C=d.context.gl,A=c.paint.get("fill-pattern"),L=A&&A.constantOr(1);let R,B,G,Z,Y;E?(B=L&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=C.LINES):(B=L?"fillPattern":"fill",R=C.TRIANGLES);for(const K of m){const J=s.getTile(K);if(L&&!J.patternsLoaded())continue;const F=J.getBucket(c);if(!F)continue;d.prepareDrawTile();const H=F.programConfigurations.get(c.id),ne=d.useProgram(B,H);L&&(d.context.activeTexture.set(C.TEXTURE0),J.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),H.updatePaintBuffers());const oe=A.constantOr(null);if(oe&&J.imageAtlas){const ge=J.imageAtlas.patternPositions[oe.toString()];ge&&H.setConstantPatternPositions(ge)}const fe=d.translatePosMatrix(K.projMatrix,J,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(E){Z=F.indexBuffer2,Y=F.segments2;const ge=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];G=B==="fillOutlinePattern"&&L?ny(fe,d,J,ge):ry(fe,ge)}else Z=F.indexBuffer,Y=F.segments,G=L?rd(fe,d,J):ia(fe);d.prepareDrawProgram(d.context,ne,K.toUnwrapped()),ne.draw(d.context,R,y,d.stencilModeForClipping(K),x,a.CullFaceMode.disabled,G,c.id,F.layoutVertexBuffer,Z,Y,c.paint,d.transform.zoom,H)}}function gc(d,s,c,m,y,x,E){const C=d.context,A=C.gl,L=d.transform,R=c.paint.get("fill-extrusion-pattern"),B=R.constantOr(1),G=c.paint.get("fill-extrusion-opacity"),Z=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),c.paint.get("fill-extrusion-ambient-occlusion-radius")],Y=c.layout.get("fill-extrusion-edge-radius"),K=Y>0&&!c.paint.get("fill-extrusion-rounded-roof"),J=K?0:Y,F=L.projection.name==="globe"?a.fillExtrusionHeightLift():0,H=L.projection.name==="globe",ne=H?a.globeToMercatorTransition(L.zoom):0,oe=[a.mercatorXfromLng(L.center.lng),a.mercatorYfromLat(L.center.lat)],fe=[];H&&fe.push("PROJECTION_GLOBE_VIEW"),Z[0]>0&&fe.push("FAUX_AO"),K&&fe.push("ZERO_ROOF_RADIUS");for(const ge of m){const me=s.getTile(ge),we=me.getBucket(c);if(!we||we.projection.name!==L.projection.name)continue;const xe=we.programConfigurations.get(c.id),Pe=d.useProgram(B?"fillExtrusionPattern":"fillExtrusion",xe,fe);if(d.terrain){const Ue=d.terrain;if(d.style.terrainSetForDrapingOnly())Ue.setupElevationDraw(me,Pe,{useMeterToDem:!0});else{if(!we.enableTerrain)continue;if(Ue.setupElevationDraw(me,Pe,{useMeterToDem:!0}),Bp(C,s,ge,we,c,Ue),!we.centroidVertexBuffer){const Je=Pe.attributes.a_centroid_pos;Je!==void 0&&A.vertexAttrib2f(Je,0,0)}}}B&&(d.context.activeTexture.set(A.TEXTURE0),me.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),xe.updatePaintBuffers());const Xe=R.constantOr(null);if(Xe&&me.imageAtlas){const Ue=me.imageAtlas.patternPositions[Xe.toString()];Ue&&xe.setConstantPatternPositions(Ue)}const ke=d.translatePosMatrix(ge.projMatrix,me,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Ve=L.projection.createInversionMatrix(L,ge.canonical),De=c.paint.get("fill-extrusion-vertical-gradient"),Ze=B?Mp(ke,d,De,G,Z,J,ge,me,F,ne,oe,Ve):td(ke,d,De,G,Z,J,ge,F,ne,oe,Ve);d.prepareDrawProgram(C,Pe,ge.toUnwrapped());const Me=[];d.terrain&&Me.push(we.centroidVertexBuffer),H&&Me.push(we.layoutVertexExtBuffer),Pe.draw(C,C.gl.TRIANGLES,y,x,E,a.CullFaceMode.backCCW,Ze,c.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,c.paint,d.transform.zoom,xe,Me)}}function Bp(d,s,c,m,y,x){const E=[F=>{let H=F.canonical.x-1,ne=F.wrap;return H<0&&(H=(1<<F.canonical.z)-1,ne--),new a.OverscaledTileID(F.overscaledZ,ne,F.canonical.z,H,F.canonical.y)},F=>{let H=F.canonical.x+1,ne=F.wrap;return H===1<<F.canonical.z&&(H=0,ne++),new a.OverscaledTileID(F.overscaledZ,ne,F.canonical.z,H,F.canonical.y)},F=>new a.OverscaledTileID(F.overscaledZ,F.wrap,F.canonical.z,F.canonical.x,(F.canonical.y===0?1<<F.canonical.z:F.canonical.y)-1),F=>new a.OverscaledTileID(F.overscaledZ,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y===(1<<F.canonical.z)-1?0:F.canonical.y+1)],C=F=>{const H=s.getSource().minzoom,ne=fe=>{const ge=s.getTileByID(fe);if(ge&&ge.hasData())return ge.getBucket(y)},oe=[0,-1,1];for(const fe of oe){if(F.overscaledZ+fe<H)continue;const ge=ne(F.calculateScaledKey(F.overscaledZ+fe));if(ge)return ge}},A=[0,0,0],L=(F,H)=>(A[0]=Math.min(F.min.y,H.min.y),A[1]=Math.max(F.max.y,H.max.y),A[2]=a.EXTENT-H.min.x>F.max.x?H.min.x-a.EXTENT:F.max.x,A),R=(F,H)=>(A[0]=Math.min(F.min.x,H.min.x),A[1]=Math.max(F.max.x,H.max.x),A[2]=a.EXTENT-H.min.y>F.max.y?H.min.y-a.EXTENT:F.max.y,A),B=[(F,H)=>L(F,H),(F,H)=>L(H,F),(F,H)=>R(F,H),(F,H)=>R(H,F)],G=new a.Point(0,0);let Z,Y,K;const J=(F,H,ne,oe,fe)=>{const ge=[[oe?ne:F,oe?F:ne,0],[oe?ne:H,oe?H:ne,0]],me=fe<0?a.EXTENT+fe:fe,we=[oe?me:(F+H)/2,oe?(F+H)/2:me,0];return ne===0&&fe<0||ne!==0&&fe>0?x.getForTilePoints(K,[we],!0,Y):ge.push(we),x.getForTilePoints(c,ge,!0,Z),Math.max(ge[0][2],ge[1][2],we[2])/x.exaggeration()};for(let F=0;F<4;F++){const H=(F<2?1:5)-F,ne=m.borders[F];if(ne.length===0)continue;const oe=K=E[F](c),fe=C(oe);if(!(fe&&fe instanceof a.FillExtrusionBucket&&fe.enableTerrain)||m.borderDoneWithNeighborZ[F]===fe.canonical.z&&fe.borderDoneWithNeighborZ[H]===m.canonical.z||(Y=x.findDEMTileFor(oe),!Y||!Y.dem))continue;if(!Z){const xe=x.findDEMTileFor(c);if(!xe||!xe.dem)return;Z=xe}const ge=fe.borders[H];let me=0;const we=fe.borderDoneWithNeighborZ[H]!==m.canonical.z;if(m.canonical.z===fe.canonical.z){for(let xe=0;xe<ne.length;xe++){const Pe=m.featuresOnBorder[ne[xe]],Xe=Pe.borders[F];let ke;for(;me<ge.length&&(ke=fe.featuresOnBorder[ge[me]],!(ke.borders[H][1]>Xe[0]+3));)we&&fe.encodeCentroid(void 0,ke,!1),me++;if(ke&&me<ge.length){const Ve=me;let De=0;for(;!(ke.borders[H][0]>Xe[1]-3)&&(De++,++me!==ge.length);)ke=fe.featuresOnBorder[ge[me]];if(ke=fe.featuresOnBorder[ge[Ve]],Pe.intersectsCount()>1||ke.intersectsCount()>1||De!==1){De!==1&&(me=Ve),m.encodeCentroid(void 0,Pe,!1),we&&fe.encodeCentroid(void 0,ke,!1);continue}const Ze=B[F](Pe,ke),Me=F%2?a.EXTENT-1:0;G.x=J(Ze[0],Math.min(a.EXTENT-1,Ze[1]),Me,F<2,Ze[2]),G.y=0,m.encodeCentroid(G,Pe,!1),we&&fe.encodeCentroid(G,ke,!1)}else m.encodeCentroid(void 0,Pe,!1)}m.borderDoneWithNeighborZ[F]=fe.canonical.z,m.needsCentroidUpdate=!0,we&&(fe.borderDoneWithNeighborZ[H]=m.canonical.z,fe.needsCentroidUpdate=!0)}else{for(const xe of ne)m.encodeCentroid(void 0,m.featuresOnBorder[xe],!1);if(we){for(const xe of ge)fe.encodeCentroid(void 0,fe.featuresOnBorder[xe],!1);fe.borderDoneWithNeighborZ[H]=m.canonical.z,fe.needsCentroidUpdate=!0}m.borderDoneWithNeighborZ[F]=fe.canonical.z,m.needsCentroidUpdate=!0}}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(d)}const Wa=new a.Color(1,0,0,1),ly=new a.Color(0,1,0,1),uy=new a.Color(0,0,1,1),cy=new a.Color(1,0,1,1),hy=new a.Color(0,1,1,1);function dy(d,s,c){const m=d.context,y=d.transform,x=m.gl,E=y.projection.name==="globe",C=E?["PROJECTION_GLOBE_VIEW"]:null;let A=c.projMatrix;if(E&&a.globeToMercatorTransition(y.zoom)>0){const Pe=a.transitionTileAABBinECEF(c.canonical,y),Xe=a.globeDenormalizeECEF(Pe);A=a.multiply(new Float32Array(16),y.globeMatrix,Xe),a.multiply(A,y.projMatrix,A)}const L=d.useProgram("debug",null,C),R=s.getTileByID(c.key);d.terrain&&d.terrain.setupElevationDraw(R,L);const B=a.DepthMode.disabled,G=a.StencilMode.disabled,Z=d.colorModeForRenderPass(),Y="$debug";m.activeTexture.set(x.TEXTURE0),d.emptyTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),E?R._makeGlobeTileDebugBuffers(d.context,y):R._makeDebugTileBoundsBuffers(d.context,y.projection);const K=R._tileDebugBuffer||d.debugBuffer,J=R._tileDebugIndexBuffer||d.debugIndexBuffer,F=R._tileDebugSegments||d.debugSegments;L.draw(m,x.LINE_STRIP,B,G,Z,a.CullFaceMode.disabled,dc(A,a.Color.red),Y,K,J,F,null,null,null,[R._globeTileDebugBorderBuffer]);const H=R.latestRawTileData,ne=Math.floor((H&&H.byteLength||0)/1024),oe=s.getTile(c).tileSize,fe=512/Math.min(oe,512)*(c.overscaledZ/y.zoom)*.5;let ge=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(ge+=` => ${c.overscaledZ}`),ge+=` ${ne}kb`,function(Pe,Xe){Pe.initDebugOverlayCanvas();const ke=Pe.debugOverlayCanvas,Ve=Pe.context.gl,De=Pe.debugOverlayCanvas.getContext("2d");De.clearRect(0,0,ke.width,ke.height),De.shadowColor="white",De.shadowBlur=2,De.lineWidth=1.5,De.strokeStyle="white",De.textBaseline="top",De.font="bold 36px Open Sans, sans-serif",De.fillText(Xe,5,5),De.strokeText(Xe,5,5),Pe.debugOverlayTexture.update(ke),Pe.debugOverlayTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE)}(d,ge);const me=R._tileDebugTextBuffer||d.debugBuffer,we=R._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,xe=R._tileDebugTextSegments||d.debugSegments;L.draw(m,x.TRIANGLES,B,G,a.ColorMode.alphaBlended,a.CullFaceMode.disabled,dc(A,a.Color.transparent,fe),Y,me,we,xe,null,null,null,[R._globeTileDebugTextBuffer])}function Fp(d,s,c,m){qa(d,0,s+c/2,d.transform.width,c,m)}function _c(d,s,c,m){qa(d,s-c/2,0,c,d.transform.height,m)}function qa(d,s,c,m,y,x){const E=d.context,C=E.gl;C.enable(C.SCISSOR_TEST),C.scissor(s*a.exported.devicePixelRatio,c*a.exported.devicePixelRatio,m*a.exported.devicePixelRatio,y*a.exported.devicePixelRatio),E.clear({color:x}),C.disable(C.SCISSOR_TEST)}const jp=a.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Np}=jp;function Xs(d,s,c,m){d.emplaceBack(s,c,m)}class yc{constructor(s){this.vertexArray=new a.StructArrayLayout3f12,this.indices=new a.StructArrayLayout3ui6,Xs(this.vertexArray,-1,-1,1),Xs(this.vertexArray,1,-1,1),Xs(this.vertexArray,-1,1,1),Xs(this.vertexArray,1,1,1),Xs(this.vertexArray,-1,-1,-1),Xs(this.vertexArray,1,-1,-1),Xs(this.vertexArray,-1,1,-1),Xs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,Np),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=a.SegmentVector.simpleSegment(0,0,36,12)}}function Bi(d,s,c,m,y,x){const E=d.gl,C=s.paint.get("sky-atmosphere-color"),A=s.paint.get("sky-atmosphere-halo-color"),L=s.paint.get("sky-atmosphere-sun-intensity"),R=((B,G,Z,Y,K)=>({u_matrix_3f:B,u_sun_direction:G,u_sun_intensity:Z,u_color_tint_r:[Y.r,Y.g,Y.b,Y.a],u_color_tint_m:[K.r,K.g,K.b,K.a],u_luminance:5e-5}))(a.fromMat4(a.create$1(),m),y,L,C,A);E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+x,s.skyboxTexture,0),c.draw(d,E.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.frontCW,R,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}const su=a.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Up{constructor(s){const c=new a.StructArrayLayout5f20;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const m=new a.StructArrayLayout3ui6;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(c,su.members),this.indexBuffer=s.createIndexBuffer(m),this.segments=a.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const sa={symbol:function(d,s,c,m,y){if(d.renderPass!=="translucent")return;const x=a.StencilMode.disabled,E=d.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(C,A,L,R,B,G,Z){const Y=A.transform,K=B==="map",J=G==="map";for(const F of C){const H=R.getTile(F),ne=H.getBucket(L);if(!ne||!ne.text||!ne.text.segments.get().length)continue;const oe=a.evaluateSizeForZoom(ne.textSizeData,Y.zoom),fe=Tr(F,ne.getProjection(),Y),ge=Y.calculatePixelsToTileUnitsMatrix(H),me=Be(fe,H.tileID.canonical,J,K,Y,ne.getProjection(),ge),we=L.layout.get("icon-text-fit")!=="none"&&ne.hasIconData();if(oe){const xe=Math.pow(2,Y.zoom-H.tileID.overscaledZ);ay(ne,K,J,Z,a.symbolSize,Y,me,F,xe,oe,we)}}}(m,d,c,s,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),y),c.paint.get("icon-opacity").constantOr(1)!==0&&Dp(d,s,c,m,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),x,E),c.paint.get("text-opacity").constantOr(1)!==0&&Dp(d,s,c,m,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),x,E),s.map.showCollisionBoxes&&(nu(d,s,c,m,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),nu(d,s,c,m,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(d,s,c,m){if(d.renderPass!=="translucent")return;const y=c.paint.get("circle-opacity"),x=c.paint.get("circle-stroke-width"),E=c.paint.get("circle-stroke-opacity"),C=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(y.constantOr(1)===0&&(x.constantOr(1)===0||E.constantOr(1)===0))return;const A=d.context,L=A.gl,R=d.transform,B=d.depthModeForSublayer(0,a.DepthMode.ReadOnly),G=a.StencilMode.disabled,Z=d.colorModeForRenderPass(),Y=R.projection.name==="globe",K=[a.mercatorXfromLng(R.center.lng),a.mercatorYfromLat(R.center.lat)],J=[];for(let H=0;H<m.length;H++){const ne=m[H],oe=s.getTile(ne),fe=oe.getBucket(c);if(!fe||fe.projection.name!==R.projection.name)continue;const ge=fe.programConfigurations.get(c.id),me=id(c);Y&&me.push("PROJECTION_GLOBE_VIEW");const we=d.useProgram("circle",ge,me),xe=fe.layoutVertexBuffer,Pe=fe.globeExtVertexBuffer,Xe=fe.indexBuffer,ke=R.projection.createInversionMatrix(R,ne.canonical),Ve={programConfiguration:ge,program:we,layoutVertexBuffer:xe,globeExtVertexBuffer:Pe,indexBuffer:Xe,uniformValues:nd(d,ne,oe,ke,K,c),tile:oe};if(C){const De=fe.segments.get();for(const Ze of De)J.push({segments:new a.SegmentVector([Ze]),sortKey:Ze.sortKey,state:Ve})}else J.push({segments:fe.segments,sortKey:0,state:Ve})}C&&J.sort((H,ne)=>H.sortKey-ne.sortKey);const F={useDepthForOcclusion:!Y};for(const H of J){const{programConfiguration:ne,program:oe,layoutVertexBuffer:fe,globeExtVertexBuffer:ge,indexBuffer:me,uniformValues:we,tile:xe}=H.state,Pe=H.segments;d.terrain&&d.terrain.setupElevationDraw(xe,oe,F),d.prepareDrawProgram(A,oe,xe.tileID.toUnwrapped()),oe.draw(A,L.TRIANGLES,B,G,Z,a.CullFaceMode.disabled,we,c.id,fe,me,Pe,c.paint,R.zoom,ne,[ge])}},heatmap:function(d,s,c,m){if(c.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const y=d.context,x=y.gl,E=a.StencilMode.disabled,C=new a.ColorMode([x.ONE,x.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(Z,Y,K,J){const F=Z.gl,H=Y.width*J,ne=Y.height*J;Z.activeTexture.set(F.TEXTURE1),Z.viewport.set([0,0,H,ne]);let oe=K.heatmapFbo;if(!oe||oe&&(oe.width!==H||oe.height!==ne)){oe&&oe.destroy();const fe=F.createTexture();F.bindTexture(F.TEXTURE_2D,fe),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.LINEAR),oe=K.heatmapFbo=Z.createFramebuffer(H,ne,!1),function(ge,me,we,xe,Pe,Xe){const ke=ge.gl;ke.texImage2D(ke.TEXTURE_2D,0,ge.isWebGL2&&ge.extRenderToTextureHalfFloat?ke.RGBA16F:ke.RGBA,Pe,Xe,0,ke.RGBA,ge.extRenderToTextureHalfFloat?ge.isWebGL2?ke.HALF_FLOAT:ge.extTextureHalfFloat.HALF_FLOAT_OES:ke.UNSIGNED_BYTE,null),xe.colorAttachment.set(we)}(Z,0,fe,oe,H,ne)}else F.bindTexture(F.TEXTURE_2D,oe.colorAttachment.get()),Z.bindFramebuffer.set(oe.framebuffer)})(y,d,c,d.transform.projection.name==="globe"?.5:.25),y.clear({color:a.Color.transparent});const A=d.transform,L=A.projection.name==="globe",R=L?["PROJECTION_GLOBE_VIEW"]:null,B=L?a.CullFaceMode.frontCCW:a.CullFaceMode.disabled,G=[a.mercatorXfromLng(A.center.lng),a.mercatorYfromLat(A.center.lat)];for(let Z=0;Z<m.length;Z++){const Y=m[Z];if(s.hasRenderableParent(Y))continue;const K=s.getTile(Y),J=K.getBucket(c);if(!J||J.projection.name!==A.projection.name)continue;const F=J.programConfigurations.get(c.id),H=d.useProgram("heatmap",F,R),{zoom:ne}=d.transform;d.terrain&&d.terrain.setupElevationDraw(K,H),d.prepareDrawProgram(y,H,Y.toUnwrapped());const oe=A.projection.createInversionMatrix(A,Y.canonical);H.draw(y,x.TRIANGLES,a.DepthMode.disabled,E,C,B,Rp(d,Y,K,oe,G,ne,c.paint.get("heatmap-intensity")),c.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,c.paint,d.transform.zoom,F,L?[J.globeExtVertexBuffer]:null)}y.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(y,x){const E=y.context,C=E.gl,A=x.heatmapFbo;if(!A)return;E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,A.colorAttachment.get()),E.activeTexture.set(C.TEXTURE1);let L=x.colorRampTexture;L||(L=x.colorRampTexture=new a.Texture(E,x.colorRamp,C.RGBA)),L.bind(C.LINEAR,C.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(E,C.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,y.colorModeForRenderPass(),a.CullFaceMode.disabled,((R,B,G,Z)=>({u_image:0,u_color_ramp:1,u_opacity:B.paint.get("heatmap-opacity")}))(0,x),x.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,x.paint,y.transform.zoom)}(d,c))},line:function(d,s,c,m){if(d.renderPass!=="translucent")return;const y=c.paint.get("line-opacity"),x=c.paint.get("line-width");if(y.constantOr(1)===0||x.constantOr(1)===0)return;const E=d.depthModeForSublayer(0,a.DepthMode.ReadOnly),C=d.colorModeForRenderPass(),A=d.terrain&&d.terrain.renderingToTexture?1:a.exported.devicePixelRatio,L=c.paint.get("line-dasharray"),R=L.constantOr(1),B=c.layout.get("line-cap"),G=c.paint.get("line-pattern"),Z=G.constantOr(1),Y=c.paint.get("line-gradient"),K=Z?"linePattern":"line",J=d.context,F=J.gl,H=(oe=>{const fe=[];ru(oe)&&fe.push("RENDER_LINE_DASH"),oe.paint.get("line-gradient")&&fe.push("RENDER_LINE_GRADIENT");const ge=oe.paint.get("line-trim-offset");ge[0]===0&&ge[1]===0||fe.push("RENDER_LINE_TRIM_OFFSET");const me=oe.paint.get("line-pattern").constantOr(1),we=oe.paint.get("line-opacity").constantOr(1)!==1;return!me&&we&&fe.push("RENDER_LINE_ALPHA_DISCARD"),fe})(c);let ne=H.includes("RENDER_LINE_ALPHA_DISCARD");d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(ne=!1);for(const oe of m){const fe=s.getTile(oe);if(Z&&!fe.patternsLoaded())continue;const ge=fe.getBucket(c);if(!ge)continue;d.prepareDrawTile();const me=ge.programConfigurations.get(c.id),we=d.useProgram(K,me,H),xe=G.constantOr(null);if(xe&&fe.imageAtlas){const Ue=fe.imageAtlas.patternPositions[xe.toString()];Ue&&me.setConstantPatternPositions(Ue)}const Pe=L.constantOr(null),Xe=B.constantOr(null);if(!Z&&Pe&&Xe&&fe.lineAtlas){const Ue=fe.lineAtlas.getDash(Pe,Xe);Ue&&me.setConstantPatternPositions(Ue)}let[ke,Ve]=c.paint.get("line-trim-offset");(Xe==="round"||Xe==="square")&&ke!==Ve&&(ke===0&&(ke-=1),Ve===1&&(Ve+=1));const De=d.terrain?oe.projMatrix:null,Ze=Z?tu(d,fe,c,De,A):sy(d,fe,c,De,ge.lineClipsArray.length,A,[ke,Ve]);if(Y){const Ue=ge.gradients[c.id];let Je=Ue.texture;if(c.gradientVersion!==Ue.version){let We=256;if(c.stepInterpolant){const Qe=s.getSource().maxzoom,vt=oe.canonical.z===Qe?Math.ceil(1<<d.transform.maxZoom-oe.canonical.z):1;We=a.clamp(a.nextPowerOfTwo(ge.maxLineLength/a.EXTENT*1024*vt),256,J.maxTextureSize)}Ue.gradient=a.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:We,image:Ue.gradient||void 0,clips:ge.lineClipsArray}),Ue.texture?Ue.texture.update(Ue.gradient):Ue.texture=new a.Texture(J,Ue.gradient,F.RGBA),Ue.version=c.gradientVersion,Je=Ue.texture}J.activeTexture.set(F.TEXTURE1),Je.bind(c.stepInterpolant?F.NEAREST:F.LINEAR,F.CLAMP_TO_EDGE)}R&&(J.activeTexture.set(F.TEXTURE0),fe.lineAtlasTexture.bind(F.LINEAR,F.REPEAT),me.updatePaintBuffers()),Z&&(J.activeTexture.set(F.TEXTURE0),fe.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),me.updatePaintBuffers()),d.prepareDrawProgram(J,we,oe.toUnwrapped());const Me=Ue=>{we.draw(J,F.TRIANGLES,E,Ue,C,a.CullFaceMode.disabled,Ze,c.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,c.paint,d.transform.zoom,me,[ge.layoutVertexBuffer2])};if(ne){const Ue=d.stencilModeForClipping(oe).ref;Ue===0&&d.terrain&&J.clear({stencil:0});const Je={func:F.EQUAL,mask:255};Ze.u_alpha_discard_threshold=.8,Me(new a.StencilMode(Je,Ue,255,F.KEEP,F.KEEP,F.INVERT)),Ze.u_alpha_discard_threshold=0,Me(new a.StencilMode(Je,Ue,255,F.KEEP,F.KEEP,F.KEEP))}else Me(d.stencilModeForClipping(oe))}ne&&(d.resetStencilClippingMasks(),d.terrain&&J.clear({stencil:0}))},fill:function(d,s,c,m){const y=c.paint.get("fill-color"),x=c.paint.get("fill-opacity");if(x.constantOr(1)===0)return;const E=d.colorModeForRenderPass(),C=c.paint.get("fill-pattern"),A=d.opaquePassEnabledForLayer()&&!C.constantOr(1)&&y.constantOr(a.Color.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===A){const L=d.depthModeForSublayer(1,d.renderPass==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly);Op(d,s,c,m,L,E,!1)}if(d.renderPass==="translucent"&&c.paint.get("fill-antialias")){const L=d.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,a.DepthMode.ReadOnly);Op(d,s,c,m,L,E,!0)}},"fill-extrusion":function(d,s,c,m){const y=c.paint.get("fill-extrusion-opacity");if(y!==0&&d.renderPass==="translucent"){const x=new a.DepthMode(d.context.gl.LEQUAL,a.DepthMode.ReadWrite,d.depthRangeFor3D);if(y!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))gc(d,s,c,m,x,a.StencilMode.disabled,a.ColorMode.disabled),gc(d,s,c,m,x,d.stencilModeFor3D(),d.colorModeForRenderPass()),d.resetStencilClippingMasks();else{const E=d.colorModeForRenderPass();gc(d,s,c,m,x,a.StencilMode.disabled,E)}}},hillshade:function(d,s,c,m){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const y=d.context,x=d.depthModeForSublayer(0,a.DepthMode.ReadOnly),E=d.colorModeForRenderPass(),C=d.terrain&&d.terrain.renderingToTexture,[A,L]=d.renderPass!=="translucent"||C?[{},m]:d.stencilConfigForOverlap(m);for(const R of L){const B=s.getTile(R);if(B.needsHillshadePrepare&&d.renderPass==="offscreen")kp(d,B,c,x,a.StencilMode.disabled,E);else if(d.renderPass==="translucent"){const G=C&&d.terrain?d.terrain.stencilModeForRTTOverlap(R):A[R.overscaledZ];Cp(d,R,B,c,x,G,E)}}y.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,s,c,m,y,x){if(d.renderPass!=="translucent"||c.paint.get("raster-opacity")===0||!m.length)return;const E=d.context,C=E.gl,A=s.getSource(),L=d.useProgram("raster"),R=d.colorModeForRenderPass(),B=d.terrain&&d.terrain.renderingToTexture,[G,Z]=A instanceof Nt||B?[{},m]:d.stencilConfigForOverlap(m),Y=Z[Z.length-1].overscaledZ,K=!d.options.moving;for(const J of Z){const F=B?a.DepthMode.disabled:d.depthModeForSublayer(J.overscaledZ-Y,c.paint.get("raster-opacity")===1?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly,C.LESS),H=J.toUnwrapped(),ne=s.getTile(J);if(B&&(!ne||!ne.hasData()))continue;const oe=B?J.projMatrix:d.transform.calculateProjMatrix(H,K),fe=d.terrain&&B?d.terrain.stencilModeForRTTOverlap(J):G[J.overscaledZ],ge=x?0:c.paint.get("raster-fade-duration");ne.registerFadeDuration(ge);const me=s.findLoadedParent(J,0),we=Jh(ne,me,s,d.transform,ge);let xe,Pe;d.terrain&&d.terrain.prepareDrawTile();const Xe=c.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;E.activeTexture.set(C.TEXTURE0),ne.texture.bind(Xe,C.CLAMP_TO_EDGE),E.activeTexture.set(C.TEXTURE1),me?(me.texture.bind(Xe,C.CLAMP_TO_EDGE),xe=Math.pow(2,me.tileID.overscaledZ-ne.tileID.overscaledZ),Pe=[ne.tileID.canonical.x*xe%1,ne.tileID.canonical.y*xe%1]):ne.texture.bind(Xe,C.CLAMP_TO_EDGE),ne.texture.useMipmap&&E.extTextureFilterAnisotropic&&d.transform.pitch>20&&C.texParameterf(C.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax);const ke=ad(oe,Pe||[0,0],xe||1,we,c,A instanceof Nt?A.perspectiveTransform:[0,0]);if(d.prepareDrawProgram(E,L,H),A instanceof Nt)A.boundsBuffer&&A.boundsSegments&&L.draw(E,C.TRIANGLES,F,a.StencilMode.disabled,R,a.CullFaceMode.disabled,ke,c.id,A.boundsBuffer,d.quadTriangleIndexBuffer,A.boundsSegments);else{const{tileBoundsBuffer:Ve,tileBoundsIndexBuffer:De,tileBoundsSegments:Ze}=d.getTileBoundsBuffers(ne);L.draw(E,C.TRIANGLES,F,fe,R,a.CullFaceMode.disabled,ke,c.id,Ve,De,Ze)}}d.resetStencilClippingMasks()},background:function(d,s,c,m){const y=c.paint.get("background-color"),x=c.paint.get("background-opacity");if(x===0)return;const E=d.context,C=E.gl,A=d.transform,L=A.tileSize,R=c.paint.get("background-pattern");if(d.isPatternMissing(R))return;const B=!R&&y.a===1&&x===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==B)return;const G=a.StencilMode.disabled,Z=d.depthModeForSublayer(0,B==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly),Y=d.colorModeForRenderPass(),K=d.useProgram(R?"backgroundPattern":"background");let J,F=m;F||(J=d.getBackgroundTiles(),F=Object.values(J).map(H=>H.tileID)),R&&(E.activeTexture.set(C.TEXTURE0),d.imageManager.bind(d.context));for(const H of F){const ne=H.toUnwrapped(),oe=m?H.projMatrix:d.transform.calculateProjMatrix(ne);d.prepareDrawTile();const fe=s?s.getTile(H):J?J[H.key]:new a.Tile(H,L,A.zoom,d),ge=R?oy(oe,x,d,R,{tileID:H,tileSize:L}):ud(oe,x,y);d.prepareDrawProgram(E,K,ne);const{tileBoundsBuffer:me,tileBoundsIndexBuffer:we,tileBoundsSegments:xe}=d.getTileBoundsBuffers(fe);K.draw(E,C.TRIANGLES,Z,G,Y,a.CullFaceMode.disabled,ge,c.id,me,we,xe)}},sky:function(d,s,c){const m=d.transform,y=m.projection.name==="mercator"||m.projection.name==="globe"?1:a.smoothstep(7,8,m.zoom),x=c.paint.get("sky-opacity")*y;if(x===0)return;const E=d.context,C=c.paint.get("sky-type"),A=new a.DepthMode(E.gl.LEQUAL,a.DepthMode.ReadOnly,[0,1]),L=d.frameCounter/1e3%1;C==="atmosphere"?d.renderPass==="offscreen"?c.needsSkyboxCapture(d)&&(function(R,B,G,Z){const Y=R.context,K=Y.gl;let J=B.skyboxFbo;if(!J){J=B.skyboxFbo=Y.createFramebuffer(32,32,!1),B.skyboxGeometry=new yc(Y),B.skyboxTexture=Y.gl.createTexture(),K.bindTexture(K.TEXTURE_CUBE_MAP,B.skyboxTexture),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MAG_FILTER,K.LINEAR);for(let oe=0;oe<6;++oe)K.texImage2D(K.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,K.RGBA,32,32,0,K.RGBA,K.UNSIGNED_BYTE,null)}Y.bindFramebuffer.set(J.framebuffer),Y.viewport.set([0,0,32,32]);const F=B.getCenter(R,!0),H=R.useProgram("skyboxCapture"),ne=new Float64Array(16);a.identity(ne),a.rotateY(ne,ne,.5*-Math.PI),Bi(Y,B,H,ne,F,0),a.identity(ne),a.rotateY(ne,ne,.5*Math.PI),Bi(Y,B,H,ne,F,1),a.identity(ne),a.rotateX(ne,ne,.5*-Math.PI),Bi(Y,B,H,ne,F,2),a.identity(ne),a.rotateX(ne,ne,.5*Math.PI),Bi(Y,B,H,ne,F,3),a.identity(ne),Bi(Y,B,H,ne,F,4),a.identity(ne),a.rotateY(ne,ne,Math.PI),Bi(Y,B,H,ne,F,5),Y.viewport.set([0,0,R.width,R.height])}(d,c),c.markSkyboxValid(d)):d.renderPass==="sky"&&function(R,B,G,Z,Y){const K=R.context,J=K.gl,F=R.transform,H=R.useProgram("skybox");K.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_CUBE_MAP,B.skyboxTexture);const ne=((oe,fe,ge,me,we)=>({u_matrix:oe,u_sun_direction:fe,u_cubemap:0,u_opacity:me,u_temporal_offset:we}))(F.skyboxMatrix,B.getCenter(R,!1),0,Z,Y);R.prepareDrawProgram(K,H),H.draw(K,J.TRIANGLES,G,a.StencilMode.disabled,R.colorModeForRenderPass(),a.CullFaceMode.backCW,ne,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(d,c,A,x,L):C==="gradient"&&d.renderPass==="sky"&&function(R,B,G,Z,Y){const K=R.context,J=K.gl,F=R.transform,H=R.useProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new yc(K)),K.activeTexture.set(J.TEXTURE0);let ne=B.colorRampTexture;ne||(ne=B.colorRampTexture=new a.Texture(K,B.colorRamp,J.RGBA)),ne.bind(J.LINEAR,J.CLAMP_TO_EDGE);const oe=((fe,ge,me,we,xe)=>({u_matrix:fe,u_color_ramp:0,u_center_direction:ge,u_radius:a.degToRad(me),u_opacity:we,u_temporal_offset:xe}))(F.skyboxMatrix,B.getCenter(R,!1),B.paint.get("sky-gradient-radius"),Z,Y);R.prepareDrawProgram(K,H),H.draw(K,J.TRIANGLES,G,a.StencilMode.disabled,R.colorModeForRenderPass(),a.CullFaceMode.backCW,oe,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(d,c,A,x,L)},debug:function(d,s,c){for(let m=0;m<c.length;m++)dy(d,s,c[m])},custom:function(d,s,c,m){const y=d.context,x=c.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&c.isLayerDraped()){if(d.renderPass==="offscreen"){const E=x.prerender;if(E){if(d.setCustomLayerDefaults(),y.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){const C=d.transform.pointMerc;E.call(x,y.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),a.globeToMercatorTransition(d.transform.zoom),[C.x,C.y],d.transform.pixelsPerMeterRatio)}else E.call(x,y.gl,d.transform.customLayerMatrix());y.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){const C=x.renderToTile;if(C){const A=m[0].canonical,L=new a.MercatorCoordinate(A.x+m[0].wrap*(1<<A.z),A.y,A.z);y.setDepthMode(a.DepthMode.disabled),y.setStencilMode(a.StencilMode.disabled),y.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),C.call(x,y.gl,L),y.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),y.setColorMode(d.colorModeForRenderPass()),y.setStencilMode(a.StencilMode.disabled);const E=x.renderingMode==="3d"?new a.DepthMode(d.context.gl.LEQUAL,a.DepthMode.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,a.DepthMode.ReadOnly);if(y.setDepthMode(E),d.transform.projection.name==="globe"){const C=d.transform.pointMerc;x.render(y.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),a.globeToMercatorTransition(d.transform.zoom),[C.x,C.y],d.transform.pixelsPerMeterRatio)}else x.render(y.gl,d.transform.customLayerMatrix());y.setDirty(),d.setBaseState(),y.bindFramebuffer.set(null)}}else a.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Ha{constructor(s,c,m=!1){this.context=new et(s,m),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=a.SourceCache.maxUnderzooming+a.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(s,c){const m=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ed(this,s));const y=this._terrain;this.transform.elevation=m?y:null,y.update(s,this.transform,c)}_updateFog(s){const c=s.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,y]=c.getFovAdjustedRange(this.transform._fov);if(m>y)return void(this.transform.fogCullDistSq=null);const x=m+.78*(y-m);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(s,c){if(this.width=s*a.exported.devicePixelRatio,this.height=c*a.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const s=this.context,c=new a.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(a.EXTENT,0),c.emplaceBack(0,a.EXTENT),c.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=s.createVertexBuffer(c,a.posAttributes.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const m=new a.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(a.EXTENT,0),m.emplaceBack(0,a.EXTENT),m.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=s.createVertexBuffer(m,a.posAttributes.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const y=new a.StructArrayLayout2i4;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(y,a.posAttributes.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const x=new a.StructArrayLayout4i8;x.emplaceBack(0,0,0,0),x.emplaceBack(a.EXTENT,0,a.EXTENT,0),x.emplaceBack(0,a.EXTENT,0,a.EXTENT),x.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.mercatorBoundsBuffer=s.createVertexBuffer(x,a.boundsAttributes.members),this.mercatorBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const E=new a.StructArrayLayout3ui6;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(E);const C=new a.StructArrayLayout1ui2;for(const L of[0,1,3,2,0])C.emplaceBack(L);this.debugIndexBuffer=s.createIndexBuffer(C),this.emptyTexture=new a.Texture(s,new a.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA),this.identityMat=a.create();const A=this.context.gl;this.stencilClearMode=new a.StencilMode({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(a.window.performance.now()),this.atmosphereBuffer=new Up(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const s=this.context,c=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(s,c.TRIANGLES,a.DepthMode.disabled,this.stencilClearMode,a.ColorMode.disabled,a.CullFaceMode.disabled,Ql(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,c,m){if(!c||this.currentStencilSource===c.id||!s.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const A of m)if(this._tileClippingMaskIDs[A.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=c.id;const y=this.context,x=y.gl;this.nextStencilID+m.length>256&&this.clearStencil(),y.setColorMode(a.ColorMode.disabled),y.setDepthMode(a.DepthMode.disabled);const E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of m){const A=c.getTile(C),L=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:R,tileBoundsIndexBuffer:B,tileBoundsSegments:G}=this.getTileBoundsBuffers(A);E.draw(y,x.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:x.ALWAYS,mask:0},L,255,x.KEEP,x.KEEP,x.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,Ql(C.projMatrix),"$clipping",R,B,G)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,c=this.context.gl;return new a.StencilMode({func:c.NOTEQUAL,mask:255},s,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);const c=this.context.gl;return new a.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(s){const c=this.context.gl,m=s.sort((E,C)=>C.overscaledZ-E.overscaledZ),y=m[m.length-1].overscaledZ,x=m[0].overscaledZ-y+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const E={};for(let C=0;C<x;C++)E[C+y]=new a.StencilMode({func:c.GEQUAL,mask:255},C+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=x,[E,m]}return[{[y]:a.StencilMode.disabled},m]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new a.ColorMode([s.CONSTANT_COLOR,s.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?a.ColorMode.unblended:a.ColorMode.alphaBlended}depthModeForSublayer(s,c,m){if(!this.opaquePassEnabledForLayer())return a.DepthMode.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new a.DepthMode(m||this.context.gl.LEQUAL,c,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,c){this.style=s,this.options=c,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const m=this.style.order,y=this.style._sourceCaches;for(const L in y){const R=y[L];R.used&&R.prepare(this.context)}const x={},E={},C={};for(const L in y){const R=y[L];x[L]=R.getVisibleCoordinates(),E[L]=x[L].slice().reverse(),C[L]=R.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let L=0;L<m.length;L++)if(this.style._layers[m[L]].is3D()){this.opaquePassCutoff=L;break}if(this.terrain&&(this.terrain.updateTileBinding(C),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.GlobeSharedBuffers(this.context)),!a.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const L of m){const R=this.style._layers[L],B=s._getLayerSourceCache(R);if(!R.hasOffscreenPass()||R.isHidden(this.transform.zoom))continue;const G=B?E[B.id]:void 0;(R.type==="custom"||R.isSky()||G&&G.length)&&this.renderLayer(this,B,R,G)}this.depthRangeFor3D=[0,1-(s.order.length+2)*this.numSublayers*this.depthEpsilon];const A=this.terrain;if(A&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&A.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:c.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const L=this.style._layers[m[this.currentLayer]],R=s._getLayerSourceCache(L);if(L.isSky())continue;const B=R?E[R.id]:void 0;this._renderTileClippingMasks(L,R,B),this.renderLayer(this,R,L,B)}if(this.style.fog&&this.transform.projection.supportsFog&&function(L,R){const B=L.context,G=B.gl,Z=L.transform,Y=new a.DepthMode(G.LEQUAL,a.DepthMode.ReadOnly,[0,1]),K=L.useProgram("globeAtmosphere",null,Z.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),J=a.globeToMercatorTransition(Z.zoom),F=R.properties.get("color").toArray01(),H=R.properties.get("high-color").toArray01(),ne=R.properties.get("space-color").toArray01PremultipliedAlpha(),oe=a.identity$1([]);a.rotateY$1(oe,oe,-a.degToRad(Z._center.lng)),a.rotateX$1(oe,oe,a.degToRad(Z._center.lat)),a.rotateZ$1(oe,oe,Z.angle),a.rotateX$1(oe,oe,-Z._pitch);const fe=a.fromQuat(new Float32Array(16),oe),ge=a.mapValue(R.properties.get("star-intensity"),0,1,0,.25),me=5e-4,we=a.mapValue(R.properties.get("horizon-blend"),0,1,me,.25),xe=a.globeUseCustomAntiAliasing(L,B,Z)&&we===me?Z.worldSize/(2*Math.PI*1.025)-1:Z.globeRadius,Pe=L.frameCounter/1e3%1,Xe=a.length(Z.globeCenterInViewSpace),ke=Math.sqrt(Math.pow(Xe,2)-Math.pow(xe,2)),Ve=Math.acos(ke/Xe),De=((Me,Ue,Je,We,Qe,vt,At,gt,Et,Zt,Ht,yt,lr,mr)=>({u_frustum_tl:Me,u_frustum_tr:Ue,u_frustum_br:Je,u_frustum_bl:We,u_horizon:Qe,u_transition:vt,u_fadeout_range:At,u_color:gt,u_high_color:Et,u_space_color:Zt,u_star_intensity:Ht,u_star_size:5*a.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:yt,u_horizon_angle:lr,u_rotation_matrix:mr}))(Z.frustumCorners.TL,Z.frustumCorners.TR,Z.frustumCorners.BR,Z.frustumCorners.BL,Z.frustumCorners.horizon,J,we,F,H,ne,ge,Pe,Ve,fe);L.prepareDrawProgram(B,K);const Ze=L.atmosphereBuffer;Ze&&K.draw(B,G.TRIANGLES,Y,a.StencilMode.disabled,a.ColorMode.alphaBlended,a.CullFaceMode.backCW,De,"skybox",Ze.vertexBuffer,Ze.indexBuffer,Ze.segments)}(this,this.style.fog),this.renderPass="sky",(a.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const L=this.style._layers[m[this.currentLayer]],R=s._getLayerSourceCache(L);L.isSky()&&this.renderLayer(this,R,L,R?E[R.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const L=this.style._layers[m[this.currentLayer]],R=s._getLayerSourceCache(L);if(L.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(L)){if(L.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const B=R?(L.type==="symbol"?C:E)[R.id]:void 0;this._renderTileClippingMasks(L,R,R?x[R.id]:void 0),this.renderLayer(this,R,L,B),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let L=null;a.values(this.style._layers).forEach(R=>{const B=s._getLayerSourceCache(R);B&&!R.isHidden(this.transform.zoom)&&(!L||L.getSource().maxzoom<B.getSource().maxzoom)&&(L=B)}),L&&this.options.showTileBoundaries&&sa.debug(this,L,L.getVisibleCoordinates())}this.options.showPadding&&function(L){const R=L.transform.padding;Fp(L,L.transform.height-(R.top||0),3,Wa),Fp(L,R.bottom||0,3,ly),_c(L,R.left||0,3,uy),_c(L,L.transform.width-(R.right||0),3,cy);const B=L.transform.centerPoint;(function(G,Z,Y,K){qa(G,Z-1,Y-10,2,20,K),qa(G,Z-10,Y-1,20,2,K)})(L,B.x,L.transform.height-B.y,hy)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(a.window.performance.now()),this.saveCanvasCopy())}renderLayer(s,c,m,y){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||y&&y.length)&&(this.id=m.id,this.gpuTimingStart(m),(!s.transform.projection.unsupportedLayers||!s.transform.projection.unsupportedLayers.includes(m.type)||s.terrain&&m.type==="custom")&&sa[m.type](s,c,m,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let m=this.gpuTimers[s.id];m||(m=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),m.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const s=this.context.extTimerQuery,c=s.createQueryEXT();this.deferredRenderGpuTimeQueries.push(c),s.beginQueryEXT(s.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){const s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){const c={};for(const m in s){const y=s[m],x=this.context.extTimerQuery,E=x.getQueryObjectEXT(y.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(y.query),c[m]=E}return c}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.extTimerQuery;let m=0;for(const y of s)m+=c.getQueryObjectEXT(y,c.QUERY_RESULT_EXT)/1e6,c.deleteQueryEXT(y);return m}translatePosMatrix(s,c,m,y,x){if(!m[0]&&!m[1])return s;const E=x?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(E){const L=Math.sin(E),R=Math.cos(E);m=[m[0]*R-m[1]*L,m[0]*L+m[1]*R]}const C=[x?m[0]:Bt(c,m[0],this.transform.zoom),x?m[1]:Bt(c,m[1],this.transform.zoom),0],A=new Float32Array(16);return a.translate(A,s,C),A}saveTileTexture(s){const c=this._tileTextures[s.size[0]];c?c.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const c=this._tileTextures[s];return c&&c.length>0?c.pop():null}isPatternMissing(s){return s===null||s!==void 0&&!this.imageManager.getPattern(s.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const s=this.terrain&&this.terrain.renderingToTexture,c=this.terrain&&this.terrain.exaggeration()===0,m=this.style&&this.style.fog,y=[];return this.terrainRenderModeElevated()&&y.push("TERRAIN"),this.transform.projection.name==="globe"&&y.push("GLOBE"),c&&y.push("ZERO_EXAGGERATION"),m&&!s&&m.getOpacity(this.transform.pitch)!==0&&y.push("FOG"),s&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}useProgram(s,c,m){this.cache=this.cache||{};const y=m||[],x=this.currentGlobalDefines().concat(y),E=tr.cacheKey(Zh[s],s,x,c);return this.cache[E]||(this.cache[E]=new tr(this.context,s,Zh[s],c,cd[s],x)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=a.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(s,c,m){if(this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const x=y.getOpacity(this.transform.pitch),E=((C,A,L,R,B,G,Z,Y,K,J,F)=>{const H=C.transform,ne=A.properties.get("color").toArray01();ne[3]=R;const oe=C.frameCounter/1e3%1;return{u_fog_matrix:L?H.calculateFogTileMatrix(L):C.identityMat,u_fog_range:A.getFovAdjustedRange(H._fov),u_fog_color:ne,u_fog_horizon_blend:A.properties.get("horizon-blend"),u_fog_temporal_offset:oe,u_frustum_tl:B,u_frustum_tr:G,u_frustum_br:Z,u_frustum_bl:Y,u_globe_pos:K,u_globe_radius:J,u_viewport:F,u_globe_transition:a.globeToMercatorTransition(H.zoom),u_is_globe:+(H.projection.name==="globe")}})(this,y,m,x,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.exported.devicePixelRatio,this.transform.height*a.exported.devicePixelRatio]);c.setFogUniformValues(s,E)}}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){const s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){const s=this.context.gl,c=s.createTexture();return s.bindTexture(s.TEXTURE_2D,c),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const s=this.style&&this.style.fog;return!!s&&s.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const s=this._backgroundTiles,c=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const y of m)c[y.key]=s[y.key]||new a.Tile(y,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class vc{constructor(s=0,c=0,m=0,y=0){if(isNaN(s)||s<0||isNaN(c)||c<0||isNaN(m)||m<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=c,this.left=m,this.right=y}interpolate(s,c,m){return c.top!=null&&s.top!=null&&(this.top=a.number(s.top,c.top,m)),c.bottom!=null&&s.bottom!=null&&(this.bottom=a.number(s.bottom,c.bottom,m)),c.left!=null&&s.left!=null&&(this.left=a.number(s.left,c.left,m)),c.right!=null&&s.right!=null&&(this.right=a.number(s.right,c.right,m)),this}getCenter(s,c){const m=a.clamp((this.left+s-this.right)/2,0,s),y=a.clamp((this.top+c-this.bottom)/2,0,c);return new a.Point(m,y)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new vc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function xc(d,s){const c=a.getColumn(d,3);a.fromQuat(d,s),a.setColumn(d,3,c)}function rr(d,s){const c=a.identity$1([]);return a.rotateZ$1(c,c,-s),a.rotateX$1(c,c,-d),c}function ou(d,s){const c=[d[0],d[1],0],m=[s[0],s[1],0];if(a.length(c)>=1e-15){const E=a.normalize([],c);a.scale$2(m,E,a.dot(m,E)),s[0]=m[0],s[1]=m[1]}const y=a.cross([],s,d);if(a.len(y)<1e-15)return null;const x=Math.atan2(-y[1],y[0]);return rr(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),x)}class Vp{constructor(s,c){this.position=s,this.orientation=c}get position(){return this._position}set position(s){if(s){const c=s instanceof a.MercatorCoordinate?s:new a.MercatorCoordinate(s[0],s[1],s[2]);this._renderWorldCopies&&(c.x=a.wrap(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(s,c){if(this.orientation=null,!this.position)return;const m=this.position,y=this._elevation?this._elevation.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(s)):0,x=a.MercatorCoordinate.fromLngLat(s,y),E=[x.x-m.x,x.y-m.y,x.z-m.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=ou(E,c)}setPitchBearing(s,c){this.orientation=rr(a.degToRad(s),a.degToRad(-c))}}class bc{constructor(s,c){this._transform=a.identity([]),this.orientation=c,this.position=s}get mercatorPosition(){const s=this.position;return new a.MercatorCoordinate(s[0],s[1],s[2])}get position(){const s=a.getColumn(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var c;s&&a.setColumn(this._transform,3,[(c=s)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||a.identity$1([]),s&&xc(this._transform,this._orientation)}getPitchBearing(){const s=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,c){this._orientation=rr(s,c),xc(this._transform,this._orientation)}forward(){const s=a.getColumn(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){const s=a.getColumn(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){const s=a.getColumn(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,c){const m=new Float64Array(16);return a.invert(m,this.getWorldToCamera(s,c)),m}getWorldToCameraPosition(s,c,m){const y=this.position;a.scale$2(y,y,-s);const x=new Float64Array(16);return a.fromScaling(x,[m,m,m]),a.translate(x,x,y),x[10]*=c,x}getWorldToCamera(s,c){const m=new Float64Array(16),y=new Float64Array(4),x=this.position;return a.conjugate(y,this._orientation),a.scale$2(x,x,-s),a.fromQuat(m,y),a.translate(m,m,x),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=c,m[9]*=c,m[10]*=c,m[11]*=c,m}getCameraToClipPerspective(s,c,m,y){const x=new Float64Array(16);return a.perspective(x,s,c,m,y),x}getDistanceToElevation(s,c=!1){const m=s===0?0:a.mercatorZfromAltitude(s,c?a.latFromMercatorY(this.position[1]):this.position[1]),y=this.forward();return(m-this.position[2])/y[2]}clone(){return new bc([...this.position],[...this.orientation])}}function Za(d,s){const c=wc(d.projection,d.zoom,d.width,d.height),m=function(x,E,C,A,L){const R=new a.LngLat(C.lng-180*Ks,C.lat),B=new a.LngLat(C.lng+180*Ks,C.lat),G=x.project(R.lng,R.lat),Z=x.project(B.lng,B.lat),Y=-Math.atan2(Z.y-G.y,Z.x-G.x),K=a.MercatorCoordinate.fromLngLat(C);K.y=a.clamp(K.y,-1+Ks,1-Ks);const J=K.toLngLat(),F=x.project(J.lng,J.lat),H=a.MercatorCoordinate.fromLngLat(J);H.x+=Ks;const ne=H.toLngLat(),oe=x.project(ne.lng,ne.lat),fe=Sc(oe.x-F.x,oe.y-F.y,Y),ge=a.MercatorCoordinate.fromLngLat(J);ge.y+=Ks;const me=ge.toLngLat(),we=x.project(me.lng,me.lat),xe=Sc(we.x-F.x,we.y-F.y,Y),Pe=Math.abs(fe.x)/Math.abs(xe.y),Xe=a.identity([]);a.rotateZ(Xe,Xe,-Y*(1-(L?0:A)));const ke=a.identity([]);return a.scale(ke,ke,[1,1-(1-Pe)*A,1]),ke[4]=-xe.x/xe.y*A,a.rotateZ(ke,ke,Y),a.multiply(ke,Xe,ke),ke}(d.projection,0,d.center,c,s),y=$p(d);return a.scale(m,m,[y,y,1]),m}function $p(d){const s=d.projection,c=wc(d.projection,d.zoom,d.width,d.height),m=Gp(s,d.center),y=Gp(s,a.LngLat.convert(s.center));return Math.pow(2,m*c+(1-c)*y)}function wc(d,s,c,m,y=1/0){const x=d.range;if(!x)return 0;const E=Math.min(y,Math.max(c,m)),C=Math.log(E/1024)/Math.LN2;return a.smoothstep(x[0]+C,x[1]+C,s)}const Ks=1/4e4;function Gp(d,s){const c=a.clamp(s.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),m=new a.LngLat(s.lng-180*Ks,c),y=new a.LngLat(s.lng+180*Ks,c),x=d.project(m.lng,c),E=d.project(y.lng,c),C=a.MercatorCoordinate.fromLngLat(m),A=a.MercatorCoordinate.fromLngLat(y),L=E.x-x.x,R=E.y-x.y,B=A.x-C.x,G=A.y-C.y,Z=Math.sqrt((B*B+G*G)/(L*L+R*R));return Math.log(Z)/Math.LN2}function Sc(d,s,c){const m=Math.cos(c),y=Math.sin(c);return{x:d*m-s*y,y:d*y+s*m}}class Xa{constructor(s,c,m,y,x,E,C){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=s||0,this._maxZoom=c||22,this._minPitch=m??0,this._maxPitch=y??60,this.setProjection(E),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new vc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new bc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const s=new Xa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(s,c=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||m)&&this._updateCameraOnTerrain(),(s||m)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return a.pick(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=a.getProjection(this.projectionOptions);const m=!I(c,this.getProjection());return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setMercatorFromTransition(){const s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.getProjection({name:"mercator"});const c=s!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.Point(this.width,this.height)}get bearing(){return a.wrap(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){const c=-s*Math.PI/180;var m;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(m=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),function(y,x,E){var C=x[0],A=x[1],L=x[2],R=x[3],B=Math.sin(E),G=Math.cos(E);y[0]=C*G+L*B,y[1]=A*G+R*B,y[2]=C*-B+L*G,y[3]=A*-B+R*G}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const c=a.clamp(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=a.degToRad(s),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){const c=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const s=this._elevation;this._centerAltitude=s.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=s.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const s=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let y=0,x=0;for(let E=0;E<c.length;E++){const C=new a.Point(c[E][0]*this.width,m+c[E][1]*(this.height-m)),A=s.pointCoordinate(C);if(!A)continue;const L=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);y+=A[3]*L,x+=L}return x===0?NaN:y/x}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const s=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*c,y=this._mercatorZfromZoom(s),x=this._mercatorZfromZoom(this._maxZoom),E=Math.max(y-m,x);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude()));let m;m=s.z<this._camera.position[2]?[c.x,c.y,c.z]:[s.x,s.y,s.z];const y=a.length(a.sub([],this._camera.position,m));return a.clamp(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let c=!1;if(s.orientation&&!a.exactEquals(s.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(s.orientation)),s.position){const m=[s.position.x,s.position.y,s.position.z];a.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const s=this._camera.position,c=new Vp;return c.position=new a.MercatorCoordinate(s[0],s[1],s[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(s){if(!a.length$1(s))return!1;a.normalize$1(s,s);const c=a.transformQuat([],[0,0,-1],s),m=a.transformQuat([],[0,-1,0],s);if(m[2]<0)return!1;const y=ou(c,m);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(s){const c=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;s[2]=a.clamp(s[2],y/m,y/c),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,c,m){this._unmodified=!1,this._edgeInsets.interpolate(s,c,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const c=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(s){const c=[new a.UnwrappedTileID(0,s)];if(this.renderWorldCopies){const m=this.pointCoordinate(new a.Point(0,0)),y=this.pointCoordinate(new a.Point(this.width,0)),x=this.pointCoordinate(new a.Point(this.width,this.height)),E=this.pointCoordinate(new a.Point(0,this.height)),C=Math.floor(Math.min(m.x,y.x,x.x,E.x)),A=Math.floor(Math.max(m.x,y.x,x.x,E.x)),L=1;for(let R=C-L;R<=A+L;R++)R!==0&&c.push(new a.UnwrappedTileID(R,s))}return c}coveringTiles(s){let c=this.coveringZoomLevel(s);const m=c,y=this.elevation&&!s.isTerrainDEM,x=this.projection.name==="mercator";if(s.minzoom!==void 0&&c<s.minzoom)return[];s.maxzoom!==void 0&&c>s.maxzoom&&(c=s.maxzoom);const E=this.locationCoordinate(this.center),C=this.center.lat,A=1<<c,L=[A*E.x,A*E.y,0],R=this.projection.name==="globe",B=!R,G=a.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,B),Z=R?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Y=A*a.mercatorZfromAltitude(1,this.center.lat),K=this._camera.position[2]/a.mercatorZfromAltitude(1,this.center.lat),J=[A*Z.x,A*Z.y,K*(B?1:Y)],F=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),H=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?c:0,ne=s.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,oe=s.isTerrainDEM?-ne:this._elevation?this._elevation.getMinElevationBelowMSL():0,fe=this.projection.isReprojectedInTileSpace?$p(this):1,ge=Me=>{const Je=new a.MercatorCoordinate(Me.x+25e-6,Me.y,Me.z),We=new a.MercatorCoordinate(Me.x,Me.y+25e-6,Me.z),Qe=Me.toLngLat(),vt=Je.toLngLat(),At=We.toLngLat(),gt=this.locationCoordinate(Qe),Et=this.locationCoordinate(vt),Zt=this.locationCoordinate(At),Ht=Math.hypot(Et.x-gt.x,Et.y-gt.y),yt=Math.hypot(Zt.x-gt.x,Zt.y-gt.y);return Math.sqrt(Ht*yt)*fe/25e-6},me=Me=>{const Ue=ne,Je=oe;return{aabb:a.tileAABB(this,A,0,0,0,Me,Je,Ue,this.projection),zoom:0,x:0,y:0,minZ:Je,maxZ:Ue,wrap:Me,fullyVisible:!1}},we=[];let xe=[];const Pe=c,Xe=s.reparseOverscaled?m:c,ke=Me=>Me*Me,Ve=ke((K-this._centerAltitude)*Y),De=Me=>{if(!this._elevation||!Me.tileID||!x)return;const Ue=this._elevation.getMinMaxForTile(Me.tileID),Je=Me.aabb;Ue?(Je.min[2]=Ue.min,Je.max[2]=Ue.max,Je.center[2]=(Je.min[2]+Je.max[2])/2):(Me.shouldSplit=Ze(Me),Me.shouldSplit||(Je.min[2]=Je.max[2]=Je.center[2]=this._centerAltitude))},Ze=Me=>{if(Me.zoom<H)return!0;if(Me.zoom===Pe)return!1;if(Me.shouldSplit!=null)return Me.shouldSplit;const Ue=Me.aabb.distanceX(J),Je=Me.aabb.distanceY(J);let We=Ve,Qe=1;if(R){We=ke(Me.aabb.distanceZ(J));const gt=Math.pow(2,Me.zoom),Et=a.latFromMercatorY((Me.y+1)/gt),Zt=a.latFromMercatorY(Me.y/gt),Ht=Math.min(Math.max(C,Et),Zt),yt=a.circumferenceAtLatitude(Ht)/a.circumferenceAtLatitude(C);if(Qe=Ht===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,yt/this._mercatorScaleRatio),this.zoom<=a.GLOBE_ZOOM_THRESHOLD_MIN&&Me.zoom===Pe-1&&yt>=.9)return!0}else if(y&&(We=ke(Me.aabb.distanceZ(J)*Y)),this.projection.isReprojectedInTileSpace&&m<=5){const gt=Math.pow(2,Me.zoom),Et=ge(new a.MercatorCoordinate((Me.x+.5)/gt,(Me.y+.5)/gt));Qe=Et>.85?1:Et}const vt=Ue*Ue+Je*Je+We,At=ke((1<<Pe-Me.zoom)*F*Qe*((gt,Et)=>{if(Et*ke(.707)<gt)return 1;const Zt=Math.sqrt(Et/gt);return Zt/(1.4144271570014144+(Math.pow(1.1,Zt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(We,Ve),vt));return vt<At};if(this.renderWorldCopies)for(let Me=1;Me<=3;Me++)we.push(me(-Me)),we.push(me(Me));for(we.push(me(0));we.length>0;){const Me=we.pop(),Ue=Me.x,Je=Me.y;let We=Me.fullyVisible;if(!We){const Qe=Me.aabb.intersects(G);if(Qe===0)continue;We=Qe===2}if(Me.zoom!==Pe&&Ze(Me))for(let Qe=0;Qe<4;Qe++){const vt=(Ue<<1)+Qe%2,At=(Je<<1)+(Qe>>1),gt={aabb:x?Me.aabb.quadrant(Qe):a.tileAABB(this,A,Me.zoom+1,vt,At,Me.wrap,Me.minZ,Me.maxZ,this.projection),zoom:Me.zoom+1,x:vt,y:At,wrap:Me.wrap,fullyVisible:We,tileID:void 0,shouldSplit:void 0,minZ:Me.minZ,maxZ:Me.maxZ};y&&!R&&(gt.tileID=new a.OverscaledTileID(Me.zoom+1===Pe?Xe:Me.zoom+1,Me.wrap,Me.zoom+1,vt,At),De(gt)),we.push(gt)}else{const Qe=Me.zoom===Pe?Xe:Me.zoom;if(s.minzoom&&s.minzoom>Qe)continue;const vt=L[0]-(.5+Ue+(Me.wrap<<Me.zoom))*(1<<c-Me.zoom),At=L[1]-.5-Je,gt=Me.tileID?Me.tileID:new a.OverscaledTileID(Qe,Me.wrap,Me.zoom,Ue,Je);xe.push({tileID:gt,distanceSq:vt*vt+At*At})}}if(this.fogCullDistSq){const Me=this.fogCullDistSq,Ue=this.horizonLineFromTop();xe=xe.filter(Je=>{const We=[0,0,0,1],Qe=[a.EXTENT,a.EXTENT,0,1],vt=this.calculateFogTileMatrix(Je.tileID.toUnwrapped());a.transformMat4$1(We,We,vt),a.transformMat4$1(Qe,Qe,vt);const At=a.getAABBPointSquareDist(We,Qe);if(At===0)return!0;let gt=!1;const Et=this._elevation;if(Et&&At>Me&&Ue!==0){const Zt=this.calculateProjMatrix(Je.tileID.toUnwrapped());let Ht;s.isTerrainDEM||(Ht=Et.getMinMaxForTile(Je.tileID)),Ht||(Ht={min:oe,max:ne});const yt=a.furthestTileCorner(this.rotation),lr=[yt[0]*a.EXTENT,yt[1]*a.EXTENT,Ht.max];a.transformMat4(lr,lr,Zt),gt=(1-lr[1])*this.height*.5<Ue}return At<Me||gt})}return xe.sort((Me,Ue)=>Me.distanceSq-Ue.distanceSq).map(Me=>Me.tileID)}resize(s,c){this.width=s,this.height=c,this.pixelsToGLUnits=[2/s,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const c=a.clamp(s.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),m=this.projection.project(s.lng,c);return new a.Point(m.x*this.worldSize,m.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,c){let m,y;const x=this.centerPoint;if(this.projection.name==="globe"){const C=this.worldSize;m=(c.x-x.x)/C,y=(c.y-x.y)/C}else{const C=this.pointCoordinate(c),A=this.pointCoordinate(x);m=C.x-A.x,y=C.y-A.y}const E=this.locationCoordinate(s);this.setLocation(new a.MercatorCoordinate(E.x-m,E.y-y))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s){return this.projection.locationPoint(this,s)}locationPoint3D(s){return this.projection.locationPoint(this,s,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s){return this.coordinateLocation(this.pointCoordinate3D(s))}locationCoordinate(s,c){const m=c?a.mercatorZfromAltitude(c,s.lat):void 0,y=this.projection.project(s.lng,s.lat);return new a.MercatorCoordinate(y.x,y.y,m)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,c){const m=c??this._centerAltitude,y=[s.x,s.y,0,1],x=[s.x,s.y,1,1];a.transformMat4$1(y,y,this.pixelMatrixInverse),a.transformMat4$1(x,x,this.pixelMatrixInverse);const E=x[3];a.scale$1(y,y,1/y[3]),a.scale$1(x,x,1/E);const C=y[2],A=x[2];return{p0:y,p1:x,t:C===A?0:(m-C)/(A-C)}}screenPointToMercatorRay(s){const c=[s.x,s.y,0,1],m=[s.x,s.y,1,1];return a.transformMat4$1(c,c,this.pixelMatrixInverse),a.transformMat4$1(m,m,this.pixelMatrixInverse),a.scale$1(c,c,1/c[3]),a.scale$1(m,m,1/m[3]),c[2]=a.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,m[2]=a.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,a.scale$1(c,c,1/this.worldSize),a.scale$1(m,m,1/this.worldSize),new a.Ray([c[0],c[1],c[2]],a.normalize([],a.sub([],m,c)))}rayIntersectionCoordinate(s){const{p0:c,p1:m,t:y}=s,x=a.mercatorZfromAltitude(c[2],this._center.lat),E=a.mercatorZfromAltitude(m[2],this._center.lat);return new a.MercatorCoordinate(a.number(c[0],m[0],y)/this.worldSize,a.number(c[1],m[1],y)/this.worldSize,a.number(x,E,y))}pointCoordinate(s,c=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,c)}pointCoordinate3D(s){if(!this.elevation)return this.pointCoordinate(s);let c=this.projection.pointCoordinate3D(this,s.x,s.y);if(c)return new a.MercatorCoordinate(c[0],c[1],c[2]);let m=0,y=this.horizonLineFromTop();if(s.y>y)return this.pointCoordinate(s);const x=.02*y,E=s.clone();for(let C=0;C<10&&y-m>x;C++){E.y=a.number(m,y,.66);const A=this.projection.pointCoordinate3D(this,E.x,E.y);A?(y=E.y,c=A):m=E.y}return c?new a.MercatorCoordinate(c[0],c[1],c[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(s);const c=this.pointCoordinate(s);return c.y>=0&&c.y<=1}_coordinatePoint(s,c){const m=c&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,y=[s.x*this.worldSize,s.y*this.worldSize,m+s.toAltitude(),1];return a.transformMat4$1(y,y,this.pixelMatrix),y[3]>0?new a.Point(y[0]/y[3],y[1]/y[3]):new a.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:s,left:c}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,x=this.pointLocation3D(new a.Point(c,s)),E=this.pointLocation3D(new a.Point(y,s)),C=this.pointLocation3D(new a.Point(y,m)),A=this.pointLocation3D(new a.Point(c,m));let L=Math.min(x.lng,E.lng,C.lng,A.lng),R=Math.max(x.lng,E.lng,C.lng,A.lng),B=Math.min(x.lat,E.lat,C.lat,A.lat),G=Math.max(x.lat,E.lat,C.lat,A.lat);const Z=Math.pow(2,-this.zoom)/16*270,Y=this.projection.name==="globe"?1:4,K=(J,F,H,ne,oe)=>{const fe=(J+H)/2,ge=(F+ne)/2,me=new a.Point(fe,ge),{lng:we,lat:xe}=this.pointLocation3D(me),Pe=Math.max(0,L-we,B-xe,we-R,xe-G);L=Math.min(L,we),R=Math.max(R,we),B=Math.min(B,xe),G=Math.max(G,xe),(oe<Y||Pe>Z)&&(K(J,F,fe,ge,oe+1),K(fe,ge,H,ne,oe+1))};if(K(c,s,y,s,1),K(y,s,y,m,1),K(y,m,c,m,1),K(c,m,c,s,1),this.projection.name==="globe"){const[J,F]=a.polesInViewport(this);J?(G=90,R=180,L=-180):F&&(B=-90,R=180,L=-180)}return new a.LngLatBounds(new a.LngLat(L,B),new a.LngLat(R,G))}_getBoundsRectangular(s,c){const{top:m,left:y}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,C=new a.Point(y,m),A=new a.Point(E,m),L=new a.Point(E,x),R=new a.Point(y,x);let B=this.pointCoordinate(C,s),G=this.pointCoordinate(A,s);const Z=this.pointCoordinate(L,c),Y=this.pointCoordinate(R,c),K=(J,F)=>(F.y-J.y)/(F.x-J.x);return B.y>1&&G.y>=0?B=new a.MercatorCoordinate((1-Y.y)/K(Y,B)+Y.x,1):B.y<0&&G.y<=1&&(B=new a.MercatorCoordinate(-Y.y/K(Y,B)+Y.x,0)),G.y>1&&B.y>=0?G=new a.MercatorCoordinate((1-Z.y)/K(Z,G)+Z.x,1):G.y<0&&B.y<=1&&(G=new a.MercatorCoordinate(-Z.y/K(Z,G)+Z.x,0)),new a.LngLatBounds().extend(this.coordinateLocation(B)).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(Z))}_getBoundsRectangularTerrain(){const s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=s.visibleDemTiles.reduce((m,y)=>{if(y.dem){const x=y.dem.tree;m.min=Math.min(m.min,x.minimums[0]),m.max=Math.max(m.max,x.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*s.exaggeration(),c.max*s.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-c*(1-this._horizonShift);return s?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-a.MAX_MERCATOR_LATITUDE,this.maxLat=a.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=a.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=a.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=a.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,c){return this.projection.createTileMatrix(this,c,s)}calculateDistanceTileData(s){const c=s.key,m=this._distanceTileDataCache;if(m[c])return m[c];const y=s.canonical,x=1/this.height,E=this.cameraWorldSize,C=E/this.zoomScale(y.z),A=(y.x+Math.pow(2,y.z)*s.wrap)*C,L=y.y*C,R=this.point;R.x*=E/this.worldSize,R.y*=E/this.worldSize;const B=this.angle,G=Math.sin(-B),Z=-Math.cos(-B);return m[c]={bearing:[G,Z],center:[(R.x-A)*x,(R.y-L)*x],scale:C/a.EXTENT*x},m[c]}calculateFogTileMatrix(s){const c=s.key,m=this._fogTileMatrixCache;if(m[c])return m[c];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return a.multiply(y,this.worldToFogMatrix,y),m[c]=new Float32Array(y),m[c]}calculateProjMatrix(s,c=!1){const m=s.key,y=c?this._alignedProjMatrixCache:this._projMatrixCache;if(y[m])return y[m];const x=this.calculatePosMatrix(s,this.worldSize);return a.multiply(x,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.alignedProjMatrix:this.projMatrix,x),y[m]=new Float32Array(x),y[m]}calculatePixelsToTileUnitsMatrix(s){const c=s.tileID.key,m=this._pixelsToTileUnitsCache;if(m[c])return m[c];const y=function(x,E){const{scale:C}=x.tileTransform,A=C*a.EXTENT/(x.tileSize*Math.pow(2,E.zoom-x.tileID.overscaledZ+x.tileID.canonical.z));return L=new Float32Array(4),G=(R=E.inverseAdjustmentMatrix)[1],Z=R[2],Y=R[3],J=(B=[A,A])[1],L[0]=R[0]*(K=B[0]),L[1]=G*K,L[2]=Z*J,L[3]=Y*J,L;var L,R,B,G,Z,Y,K,J}(s,this);return m[c]=y,m[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const s=1/this.worldSize,c=a.fromScaling([],[s,s,s]);return a.multiply(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const s=this._elevation;this._updateCameraState();const c=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),y=this._camera.forward(),x=a.mercatorZfromAltitude(1,this._center.lat);m[2]/=x,y[2]/=x,a.normalize(y,y);const E=s.raycast(m,y,s.exaggeration());if(E){const C=a.scaleAndAdd([],m,y,E),A=new a.MercatorCoordinate(C[0],C[1],a.mercatorZfromAltitude(C[2],a.latFromMercatorY(C[1]))),L=(A.z+a.length([A.x-m[0],A.y-m[1],A.z-m[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(L),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;const c=this._elevation,m=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(m),x=c.getAtPointOrZero(new a.MercatorCoordinate(...y)),E=this.pixelsPerMeter/this.worldSize*x,C=this._minimumHeightOverTerrain(),A=y[2]-E;if(A<=C)if(A<0||s){const L=this.locationCoordinate(this._center,this._centerAltitude),R=[y[0],y[1],L.z-y[2]],B=a.length(R);R[2]-=(C-A)/this._pixelsPerMercatorPixel;const G=a.length(R);if(G===0)return;a.scale$2(R,R,B/G*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],L.z*this._pixelsPerMercatorPixel-R[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){const G=this.center;return G.lat=a.clamp(G.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&(G.lng=a.clamp(G.lng,this.minLng,this.maxLng)),this.center=G,void(this._constraining=!1)}const c=this._unmodified,{x:m,y}=this.point;let x=0,E=m,C=y;const A=this.width/2,L=this.height/2,R=this.worldMinY*this.scale,B=this.worldMaxY*this.scale;if(y-L<R&&(C=R+L),y+L>B&&(C=B-L),B-R<this.height&&(x=Math.max(x,this.height/(B-R)),C=(B+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const G=this.worldMinX*this.scale,Z=this.worldMaxX*this.scale,Y=this.worldSize/2-(G+Z)/2;E=(m+Y+this.worldSize)%this.worldSize-Y,E-A<G&&(E=G+A),E+A>Z&&(E=Z-A),Z-G<this.width&&(x=Math.max(x,this.width/(Z-G)),E=(Z+G)/2)}E===m&&C===y||(this.center=this.unproject(new a.Point(E,C))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,c=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.mercatorZfromAltitude(1,this.center.lat)/a.mercatorZfromAltitude(1,a.GLOBE_SCALE_MATCH_LATITUDE));const m=wc(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this.projection.zAxisUnit==="meters"?c:1,x=this._camera.getWorldToCamera(this.worldSize,y),E=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);E[8]=2*-s.x/this.width,E[9]=2*s.y/this.height;let C=a.mul([],E,x);if(this.projection.isReprojectedInTileSpace){const ge=this.locationCoordinate(this.center),me=a.identity([]);a.translate(me,me,[ge.x*this.worldSize,ge.y*this.worldSize,0]),a.multiply(me,me,Za(this)),a.translate(me,me,[-ge.x*this.worldSize,-ge.y*this.worldSize,0]),a.multiply(C,C,me),this.inverseAdjustmentMatrix=function(we){const xe=Za(we,!0);return Ae([],[xe[0],xe[1],xe[4],xe[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=a.scale([],C,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=C,this.invProjMatrix=a.invert(new Float64Array(16),this.projMatrix);const A=a.invert([],E);this.frustumCorners=a.FrustumCorners.fromInvProjectionMatrix(A,this.horizonLineFromTop(),this.height);const L=new Float32Array(16);a.identity(L),a.scale(L,L,[1,-1,1]),a.rotateX(L,L,this._pitch),a.rotateZ(L,L,this.angle);const R=a.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),B=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;R[8]=2*-s.x/this.width,R[9]=2*(s.y+B)/this.height,this.skyboxMatrix=a.multiply(L,R,L);const G=this.point,Z=G.x,Y=G.y,K=this.width%2/2,J=this.height%2/2,F=Math.cos(this.angle),H=Math.sin(this.angle),ne=Z-Math.round(Z)+F*K+H*J,oe=Y-Math.round(Y)+F*J+H*K,fe=new Float64Array(C);if(a.translate(fe,fe,[ne>.5?ne-1:ne,oe>.5?oe-1:oe,0]),this.alignedProjMatrix=fe,C=a.create(),a.scale(C,C,[this.width/2,-this.height/2,1]),a.translate(C,C,[1,-1,0]),this.labelPlaneMatrix=C,C=a.create(),a.scale(C,C,[1,-1,1]),a.translate(C,C,[-1,-1,0]),a.scale(C,C,[2/this.width,2/this.height,1]),this.glCoordMatrix=C,this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},C=a.invert(new Float64Array(16),this.pixelMatrix),!C)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=C,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.calculateGlobeMatrix(this);const ge=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.transformMat4(ge,ge,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=C;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const s=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,m=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,x=[s,s,c];a.scale$2(x,x,y),a.scale$2(m,m,-1),a.multiply$2(m,m,x);const E=a.create();a.translate(E,E,m),a.scale(E,E,x),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,c,y)}_computeCameraPosition(s){const c=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),y=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-s/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-m[0]*x,y.y/this.worldSize-m[1]*x,s/this.worldSize*this._centerAltitude-m[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],y=s[2];let x=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(x=Math.min((c-m)/y,1)),this._camera.position=a.scaleAndAdd([],this._camera.position,s,x),this._updateStateFromCamera()}_updateStateFromCamera(){const s=this._camera.position,c=this._camera.forward(),{pitch:m,bearing:y}=this._camera.getPitchBearing(),x=a.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.degToRad(this._maxPitch)),C=Math.max((s[2]-x)/Math.cos(m),E),A=this._zoomFromMercatorZ(C);a.scaleAndAdd(s,s,c,C),this._pitch=a.clamp(m,a.degToRad(this.minPitch),a.degToRad(this.maxPitch)),this.angle=a.wrap(y,-Math.PI,Math.PI),this._setZoom(a.clamp(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.MercatorCoordinate(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){const s=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(s*this.tileSize))}zoomFromMercatorZAdjusted(s){let c=0,m=a.GLOBE_ZOOM_THRESHOLD_MAX,y=0,x=1/0;for(;m-c>1e-6&&m>c;){const E=c+.5*(m-c),C=this.tileSize*Math.pow(2,E),A=this.getCameraToCenterDistance(this.projection,E,C),L=this.scaleZoom(A/(s*this.tileSize)),R=Math.abs(E-L);R<x&&(x=R,y=E),E<L?c=E:m=E}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,c){const m=Math.min(s.x,c.x),y=Math.max(s.x,c.x),x=Math.min(s.y,c.y),E=Math.max(s.y,c.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const C=[new a.Point(m,x),new a.Point(y,E),new a.Point(m,E),new a.Point(y,x)],A=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const R of C){const B=this.pointRayIntersection(R);if(B.t<0)return!0;const G=this.rayIntersectionCoordinate(B);if(G.x<A||G.y<0||G.x>L||G.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.Point(0,0),new a.Point(this.width,this.height))}zoomDeltaToMovement(s,c){const m=a.length(a.sub([],this._camera.position,s)),y=this._zoomFromMercatorZ(m)+c;return m-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const s=function([c,m,y],x){const E=[c,m,y,1];a.transformMat4$1(E,E,x);const C=E[3]=Math.max(E[3],1e-6);return E[0]/=C,E[1]/=C,E[2]/=C,E}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.Point(s[0],s[1])}{const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.Point(0,s))}}getCameraToCenterDistance(s,c=this.zoom,m=this.worldSize){const y=wc(s,c,this.width,this.height,1024),x=s.pixelSpaceConversion(this.center.lat,m,y);return .5/Math.tan(.5*this._fov)*this.height*x}getWorldToCameraMatrix(){const s=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.multiply(s,s,this.globeMatrix),s}}function Ka(d,s){let c=!1,m=null;const y=()=>{m=null,c&&(d(),m=setTimeout(y,s),c=!1)};return()=>(c=!0,m||y(),m)}class fd{constructor(s){this._hashName=s&&encodeURIComponent(s),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ka(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,a.window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),a.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const s=this._map;if(!s)return"";const c=au(s);if(this._hashName){const m=this._hashName;let y=!1;const x=a.window.location.hash.slice(1).split("&").map(E=>{const C=E.split("=")[0];return C===m?(y=!0,`${C}=${c}`):E}).filter(E=>E);return y||x.push(`${m}=${c}`),`#${x.join("&")}`}return`#${c}`}_getCurrentHash(){const s=a.window.location.hash.replace("#","");if(this._hashName){let c;return s.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(c=m)}),(c&&c[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._map;if(!s)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(m=>isNaN(m))){const m=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(c[3]||0):s.getBearing();return s.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:m,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){const s=a.window.location.href.replace(/(#.+)?$/,this.getHashString());a.window.history.replaceState(a.window.history.state,null,s)}}function au(d,s){const c=d.getCenter(),m=Math.round(100*d.getZoom())/100,y=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,y),E=Math.round(c.lng*x)/x,C=Math.round(c.lat*x)/x,A=d.getBearing(),L=d.getPitch();let R=s?`/${E}/${C}/${m}`:`${m}/${C}/${E}`;return(A||L)&&(R+="/"+Math.round(10*A)/10),L&&(R+=`/${Math.round(L)}`),R}const lu={linearity:.3,easing:a.bezier(0,0,.3,1)},Tc=a.extend({deceleration:2500,maxSpeed:1400},lu),Ec=a.extend({deceleration:20,maxSpeed:1400},lu),ft=a.extend({deceleration:1e3,maxSpeed:360},lu),is=a.extend({deceleration:1e3,maxSpeed:90},lu);class Wp{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,c=a.exported.now();for(;s.length>0&&c-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new a.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)c.zoom+=x.zoomDelta||0,c.bearing+=x.bearingDelta||0,c.pitch+=x.pitchDelta||0,x.panDelta&&c.pan._add(x.panDelta),x.around&&(c.around=x.around),x.pinchAround&&(c.pinchAround=x.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(c.pan.mag()){const x=cu(c.pan.mag(),m,a.extend({},Tc,s||{}));y.offset=c.pan.mult(x.amount/c.pan.mag()),y.center=this._map.transform.center,uu(y,x)}if(c.zoom){const x=cu(c.zoom,m,Ec);y.zoom=this._map.transform.zoom+x.amount,uu(y,x)}if(c.bearing){const x=cu(c.bearing,m,ft);y.bearing=this._map.transform.bearing+a.clamp(x.amount,-179,179),uu(y,x)}if(c.pitch){const x=cu(c.pitch,m,is);y.pitch=this._map.transform.pitch+x.amount,uu(y,x)}if(y.zoom||y.bearing){const x=c.pinchAround===void 0?c.around:c.pinchAround;y.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function uu(d,s){(!d.duration||d.duration<s.duration)&&(d.duration=s.duration,d.easing=s.easing)}function cu(d,s,c){const{maxSpeed:m,linearity:y,deceleration:x}=c,E=a.clamp(d*y/(s/1e3),-m,m),C=Math.abs(E)/(x*y);return{easing:c.easing,duration:1e3*C,amount:E*(C/2)}}class En extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,m,y={}){const x=Le(c.getCanvasContainer(),m),E=c.unproject(x);super(s,a.extend({point:x,lngLat:E,originalEvent:m},y)),this._defaultPrevented=!1,this.target=c}}class hu extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,m){const y=s==="touchend"?m.changedTouches:m.touches,x=Ne(c.getCanvasContainer(),y),E=x.map(A=>c.unproject(A)),C=x.reduce((A,L,R,B)=>A.add(L.div(B.length)),new a.Point(0,0));super(s,{points:x,point:C,lngLats:E,lngLat:c.unproject(C),originalEvent:m}),this._defaultPrevented=!1}}class Cc extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,m){super(s,{originalEvent:m}),this._defaultPrevented=!1}}class pd{constructor(s,c){this._map=s,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new Cc(s.type,this._map,s))}mousedown(s,c){return this._mousedownPos=c,this._firePreventable(new En(s.type,this._map,s))}mouseup(s){this._map.fire(new En(s.type,this._map,s))}preclick(s){const c=a.extend({},s);c.type="preclick",this._map.fire(new En(c.type,this._map,c))}click(s,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(s),this._map.fire(new En(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new En(s.type,this._map,s))}mouseover(s){this._map.fire(new En(s.type,this._map,s))}mouseout(s){this._map.fire(new En(s.type,this._map,s))}touchstart(s){return this._firePreventable(new hu(s.type,this._map,s))}touchmove(s){this._map.fire(new hu(s.type,this._map,s))}touchend(s){this._map.fire(new hu(s.type,this._map,s))}touchcancel(s){this._map.fire(new hu(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class kc{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new En(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new En("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new En(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qp{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,c){this.isEnabled()&&s.shiftKey&&s.button===0&&(X(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(s,c){if(!this._active)return;const m=c,y=this._startPos,x=this._lastPos;if(!y||!x||x.equals(m)||!this._box&&m.dist(y)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=q("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const E=Math.min(y.x,m.x),C=Math.max(y.x,m.x),A=Math.min(y.y,m.y),L=Math.max(y.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${A}px)`,this._box.style.width=C-E+"px",this._box.style.height=L-A+"px")})}mouseupWindow(s,c){if(!this._active)return;const m=this._startPos,y=c;if(m&&s.button===0){if(this.reset(),Ce(),m.x!==y.x||m.y!==y.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:s})),{cameraAnimation:x=>x.fitScreenCoordinates(m,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ie(),delete this._startPos,delete this._lastPos}_fireEvent(s,c){return this._map.fire(new a.Event(s,{originalEvent:c}))}}function Ic(d,s){const c={};for(let m=0;m<d.length;m++)c[d[m].identifier]=s[m];return c}class Ya{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,c,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=s.timeStamp),m.length===this.numTouches&&(this.centroid=function(y){const x=new a.Point(0,0);for(const E of y)x._add(E);return x.div(y.length)}(c),this.touches=Ic(m,c)))}touchmove(s,c,m){if(this.aborted||!this.centroid)return;const y=Ic(m,c);for(const x in this.touches){const E=y[x];(!E||E.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(s,c,m){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class md{constructor(s){this.singleTap=new Ya(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,c,m){this.singleTap.touchstart(s,c,m)}touchmove(s,c,m){this.singleTap.touchmove(s,c,m)}touchend(s,c,m){const y=this.singleTap.touchend(s,c,m);if(y){const x=s.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(y)<30;if(x&&E||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class fy{constructor(){this._zoomIn=new md({numTouches:1,numTaps:2}),this._zoomOut=new md({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,c,m){this._zoomIn.touchstart(s,c,m),this._zoomOut.touchstart(s,c,m)}touchmove(s,c,m){this._zoomIn.touchmove(s,c,m),this._zoomOut.touchmove(s,c,m)}touchend(s,c,m){const y=this._zoomIn.touchend(s,c,m),x=this._zoomOut.touchend(s,c,m);return y?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(y)},{originalEvent:s})}):x?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(x)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Hp={0:1,2:2};class Ja{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,c){return!1}_move(s,c){return{}}mousedown(s,c){if(this._lastPoint)return;const m=qe(s);this._correctButton(s,m)&&(this._lastPoint=c,this._eventButton=m)}mousemoveWindow(s,c){const m=this._lastPoint;if(m){if(s.preventDefault(),this._eventButton!=null&&function(y,x){const E=Hp[x];return y.buttons===void 0||(y.buttons&E)!==E}(s,this._eventButton))this.reset();else if(this._moved||!(c.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(m,c)}}mouseupWindow(s){this._lastPoint&&qe(s)===this._eventButton&&(this._moved&&Ce(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gd extends Ja{mousedown(s,c){super.mousedown(s,c),this._lastPoint&&(this._active=!0)}_correctButton(s,c){return c===0&&!s.ctrlKey}_move(s,c){return{around:c,panDelta:c.sub(s)}}}class _d extends Ja{_correctButton(s,c){return c===0&&s.ctrlKey||c===2}_move(s,c){const m=.8*(c.x-s.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(s){s.preventDefault()}}class yd extends Ja{_correctButton(s,c){return c===0&&s.ctrlKey||c===2}_move(s,c){const m=-.5*(c.y-s.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(s){s.preventDefault()}}class Ac{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),a.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.Point(0,0)}touchstart(s,c,m){return this._calculateTransform(s,c,m)}touchmove(s,c,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1&&!a.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,c,m)}}touchend(s,c,m){this._calculateTransform(s,c,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,c,m){m.length>0&&(this._active=!0);const y=Ic(m,c),x=new a.Point(0,0),E=new a.Point(0,0);let C=0;for(const L in y){const R=y[L],B=this._touches[L];B&&(x._add(R),E._add(R.sub(B)),C++,y[L]=R)}if(this._touches=y,C<this._minTouches||!E.mag())return;const A=E.div(C);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(C),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=q("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class du{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,c,m){return{}}touchstart(s,c,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([c[0],c[1]]))}touchmove(s,c,m){const y=this._firstTwoTouches;if(!y)return;s.preventDefault();const[x,E]=y,C=fu(m,c,x),A=fu(m,c,E);if(!C||!A)return;const L=this._aroundCenter?null:C.add(A).div(2);return this._move([C,A],L,s)}touchend(s,c,m){if(!this._firstTwoTouches)return;const[y,x]=this._firstTwoTouches,E=fu(m,c,y),C=fu(m,c,x);E&&C||(this._active&&Ce(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function fu(d,s,c){for(let m=0;m<d.length;m++)if(d[m].identifier===c)return s[m]}function vd(d,s){return Math.log(d/s)/Math.LN2}class Zp extends du{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,c){const m=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(vd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:vd(this._distance,m),pinchAround:c}}}function xd(d,s){return 180*d.angleWith(s)/Math.PI}class Xp extends du{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,c){const m=this._vector;if(this._vector=s[0].sub(s[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:xd(this._vector,m),pinchAround:c}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const c=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const y=xd(s,m);return Math.abs(y)<c}}function Ro(d){return Math.abs(d.y)>Math.abs(d.x)}class Kp extends du{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,Ro(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,c,m){const y=this._lastPoints;if(!y)return;const x=s[0].sub(y[0]),E=s[1].sub(y[1]);return this._map._cooperativeGestures&&!a.isFullscreen()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(x,E,m.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(x.y+E.y)/2*-.5})}gestureBeginsVertically(s,c,m){if(this._valid!==void 0)return this._valid;const y=s.mag()>=2,x=c.mag()>=2;if(!y&&!x)return;if(!y||!x)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;const E=s.y>0==c.y>0;return Ro(s)&&Ro(c)&&E}}const Yp={panStep:100,bearingStep:15,pitchStep:10};class py{constructor(){const s=Yp;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let c=0,m=0,y=0,x=0,E=0;switch(s.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:s.shiftKey?m=-1:(s.preventDefault(),x=-1);break;case 39:s.shiftKey?m=1:(s.preventDefault(),x=1);break;case 38:s.shiftKey?y=1:(s.preventDefault(),E=-1);break;case 40:s.shiftKey?y=-1:(s.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(m=0,y=0),{cameraAnimation:C=>{const A=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:Jp,zoom:c?Math.round(A)+c*(s.shiftKey?2:1):A,bearing:C.getBearing()+m*this._bearingStep,pitch:C.getPitch()+y*this._pitchStep,offset:[-x*this._panStep,-E*this._panStep],center:C.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Jp(d){return d*(2-d)}const bd=4.000244140625;class Qp{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||a.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=s.deltaMode===a.window.WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const m=a.exported.now(),y=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,c!==0&&c%bd==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(y*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),s.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=s,this._delta-=c,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Le(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;this._type==="wheel"&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(this._delta!==0){const A=this._type==="wheel"&&Math.abs(this._delta)>bd?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&L!==0&&(L=1/L);const R=c(),B=Math.pow(2,R),G=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(G*L))),this._type==="wheel"&&(this._startZoom=R,this._easing=this._smoothOutEasing(200)),this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:c(),y=this._startZoom,x=this._easing;let E,C=!1;if(this._type==="wheel"&&y&&x){const A=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),L=x(A);E=a.number(y,m,L),A<1?this._frameId||(this._frameId=!0):C=!0}else E=m,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!C,zoomDelta:E-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let c=a.ease;if(this._prevEase){const m=this._prevEase,y=(a.exported.now()-m.start)/m.duration,x=m.easing(y+.01)-m.easing(y),E=.27/Math.sqrt(x*x+1e-4)*.01,C=Math.sqrt(.0729-E*E);c=a.bezier(E,C,.25,1)}return this._prevEase={start:a.exported.now(),duration:s,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=q("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(a.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class em{constructor(s,c){this._clickZoom=s,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class $n{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,c){return s.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(s.shiftKey?-1:1),around:m.unproject(c)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class my{constructor(){this._tap=new md({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,c,m){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=c[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(s,c,m))}touchmove(s,c,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const y=c[0],x=y.y-this._swipePoint.y;return this._swipePoint=y,s.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(s,c,m)}touchend(s,c,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(s,c,m)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tm{constructor(s,c,m){this._el=s,this._mousePan=c,this._touchPan=m}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class gy{constructor(s,c,m){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=c,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class _y{constructor(s,c,m,y){this._el=s,this._touchZoom=c,this._touchRotate=m,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Fi=d=>d.zoom||d.drag||d.pitch||d.rotate;class rm extends a.Event{}class yy{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,c){const m=a.sub([],c,s);this.radius=a.length(m[2]<0?a.div([],m,this.constants):[m[0],m[1],0])}projectRay(s){a.div(s,s,this.constants),a.normalize(s,s),a.mul$1(s,s,this.constants);const c=a.scale$2([],s,this.radius);if(c[2]>0){const m=a.scale$2([],[0,0,1],a.dot(c,[0,0,1])),y=a.scale$2([],a.normalize([],[c[0],c[1],0]),this.radius),x=a.add([],c,a.scale$2([],a.sub([],a.add([],y,m),c),2));c[0]=x[0],c[1]=x[1]}return c}}function ss(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Es{constructor(s,c){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Wp(s),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new yy,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),a.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[a.window.document,"mousemove",{capture:!0}],[a.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[a.window,"blur",void 0]];for(const[y,x,E]of this._listeners)y.addEventListener(x,y===a.window.document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[s,c,m]of this._listeners)s.removeEventListener(c,s===a.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(s){const c=this._map,m=c.getCanvasContainer();this._add("mapEvent",new pd(c,s));const y=c.boxZoom=new qp(c,s);this._add("boxZoom",y);const x=new fy,E=new $n;c.doubleClickZoom=new em(E,x),this._add("tapZoom",x),this._add("clickZoom",E);const C=new my;this._add("tapDragZoom",C);const A=c.touchPitch=new Kp(c);this._add("touchPitch",A);const L=new _d(s),R=new yd(s);c.dragRotate=new gy(s,L,R),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]);const B=new gd(s),G=new Ac(c,s);c.dragPan=new tm(m,B,G),this._add("mousePan",B),this._add("touchPan",G,["touchZoom","touchRotate"]);const Z=new Xp,Y=new Zp;c.touchZoomRotate=new _y(m,Y,Z,C),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),this._add("blockableMapEvent",new kc(c));const K=c.scrollZoom=new Qp(c,this);this._add("scrollZoom",K,["mousePan"]);const J=c.keyboard=new py;this._add("keyboard",J);for(const F of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[F]&&c[F].enable(s[F])}_add(s,c,m){this._handlers.push({handlerName:s,handler:c,allowed:m}),this._handlersById[s]=c}stop(s){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Fi(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,c,m){for(const y in s)if(y!==m&&(!c||c.indexOf(y)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const c=[];for(const m of s)this._el.contains(m.target)&&c.push(m);return c}handleEvent(s,c){this._updatingCamera=!0;const m=s.type==="renderFrame",y=m?void 0:s,x={needsRenderFrame:!1},E={},C={},A=s.touches?this._getMapTouches(s.touches):void 0,L=A?Ne(this._el,A):m?void 0:Le(this._el,s);for(const{handlerName:G,handler:Z,allowed:Y}of this._handlers){if(!Z.isEnabled())continue;let K;this._blockedByActive(C,Y,G)?Z.reset():Z[c||s.type]&&(K=Z[c||s.type](s,L,A),this.mergeHandlerResult(x,E,K,G,y),K&&K.needsRenderFrame&&this._triggerRenderFrame()),(K||Z.isActive())&&(C[G]=Z)}const R={};for(const G in this._previousActiveHandlers)C[G]||(R[G]=y);this._previousActiveHandlers=C,(Object.keys(R).length||ss(x))&&(this._changes.push([x,E,R]),this._triggerRenderFrame()),(Object.keys(C).length||ss(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=x;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(s,c,m,y,x){if(!m)return;a.extend(s,m);const E={handlerName:y,originalEvent:m.originalEvent||x};m.zoomDelta!==void 0&&(c.zoom=E),m.panDelta!==void 0&&(c.drag=E),m.pitchDelta!==void 0&&(c.pitch=E),m.bearingDelta!==void 0&&(c.rotate=E)}_applyChanges(){const s={},c={},m={};for(const[y,x,E]of this._changes)y.panDelta&&(s.panDelta=(s.panDelta||new a.Point(0,0))._add(y.panDelta)),y.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(s.around=y.around),y.aroundCoord!==void 0&&(s.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(s.pinchAround=y.pinchAround),y.noInertia&&(s.noInertia=y.noInertia),a.extend(c,x),a.extend(m,E);this._updateMapTransform(s,c,m),this._changes=[]}_updateMapTransform(s,c,m){const y=this._map,x=y.transform,E=H=>[H.x,H.y,H.z];if((H=>{const ne=this._eventsInProgress.drag;return ne&&!this._handlersById[ne.handlerName].isActive()})()&&!ss(s)){const H=x.zoom;x.cameraElevationReference="sea",x.recenterOnTerrain(),x.cameraElevationReference="ground",H!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&y._stop(!0),!ss(s))return void this._fireEvents(c,m,!0);let{panDelta:C,zoomDelta:A,bearingDelta:L,pitchDelta:R,around:B,aroundCoord:G,pinchAround:Z}=s;x._isCameraConstrained&&(A>0&&(A=0),x._isCameraConstrained=!1),Z!==void 0&&(B=Z),(A||(H=>c[H]&&!this._eventsInProgress[H])("drag"))&&B&&(this._dragOrigin=E(x.pointCoordinate3D(B)),this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",y._stop(!0),B=B||y.transform.centerPoint,L&&(x.bearing+=L),R&&(x.pitch+=R),x._updateCameraState();const Y=[0,0,0];if(C)if(x.projection.name==="mercator"){const H=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(B).dir),ne=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(B.sub(C)).dir);Y[0]=ne[0]-H[0],Y[1]=ne[1]-H[1]}else{const H=x.pointCoordinate(B);if(x.projection.name==="globe"){C=C.rotate(-x.angle);const ne=x._pixelsPerMercatorPixel/x.worldSize;Y[0]=-C.x*a.mercatorScale(a.latFromMercatorY(H.y))*ne,Y[1]=-C.y*a.mercatorScale(x.center.lat)*ne}else{const ne=x.pointCoordinate(B.sub(C));H&&ne&&(Y[0]=ne.x-H.x,Y[1]=ne.y-H.y)}}const K=x.zoom,J=[0,0,0];if(A){const H=E(G||x.pointCoordinate3D(B)),ne={dir:a.normalize([],a.sub([],H,x._camera.position))};if(ne.dir[2]<0){const oe=x.zoomDeltaToMovement(H,A);a.scale$2(J,ne.dir,oe)}}const F=a.add(Y,Y,J);x._translateCameraConstrained(F),A&&Math.abs(x.zoom-K)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(c,m,!0)}_fireEvents(s,c,m){const y=Fi(this._eventsInProgress),x=Fi(s),E={};for(const R in s){const{originalEvent:B}=s[R];this._eventsInProgress[R]||(E[`${R}start`]=B),this._eventsInProgress[R]=s[R]}!y&&x&&this._fireEvent("movestart",x.originalEvent);for(const R in E)this._fireEvent(R,E[R]);x&&this._fireEvent("move",x.originalEvent);for(const R in s){const{originalEvent:B}=s[R];this._fireEvent(R,B)}const C={};let A;for(const R in this._eventsInProgress){const{handlerName:B,originalEvent:G}=this._eventsInProgress[R];this._handlersById[B].isActive()||(delete this._eventsInProgress[R],A=c[B]||G,C[`${R}end`]=A)}for(const R in C)this._fireEvent(R,C[R]);const L=Fi(this._eventsInProgress);if(m&&(y||x)&&!L){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;R?(B(R.bearing||this._map.getBearing())&&(R.bearing=0),this._map.easeTo(R,{originalEvent:A})):(this._map.fire(new a.Event("moveend",{originalEvent:A})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,c){this._map.fire(new a.Event(s,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new rm("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const oa="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Mc extends a.Evented{constructor(s,c){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(s,c){return this.jumpTo({center:s},c)}panBy(s,c,m){return s=a.Point.convert(s).mult(-1),this.panTo(this.transform.center,a.extend({offset:s},c),m)}panTo(s,c,m){return this.easeTo(a.extend({center:s},c),m)}getZoom(){return this.transform.zoom}setZoom(s,c){return this.jumpTo({zoom:s},c),this}zoomTo(s,c,m){return this.easeTo(a.extend({zoom:s},c),m)}zoomIn(s,c){return this.zoomTo(this.getZoom()+1,s,c),this}zoomOut(s,c){return this.zoomTo(this.getZoom()-1,s,c),this}getBearing(){return this.transform.bearing}setBearing(s,c){return this.jumpTo({bearing:s},c),this}getPadding(){return this.transform.padding}setPadding(s,c){return this.jumpTo({padding:s},c),this}rotateTo(s,c,m){return this.easeTo(a.extend({bearing:s},c),m)}resetNorth(s,c){return this.rotateTo(0,a.extend({duration:1e3},s),c),this}resetNorthPitch(s,c){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},s),c),this}snapToNorth(s,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,c):this}getPitch(){return this.transform.pitch}setPitch(s,c){return this.jumpTo({pitch:s},c),this}cameraForBounds(s,c){s=a.LngLatBounds.convert(s);const m=c&&c.bearing||0,y=c&&c.pitch||0,x=s.getNorthWest(),E=s.getSouthEast();return this._cameraForBounds(this.transform,x,E,m,y,c)}_extendCameraOptions(s){const c={top:0,bottom:0,right:0,left:0};if(typeof(s=a.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=="number"){const m=s.padding;s.padding={top:m,bottom:m,right:m,left:m}}return s.padding=a.extend(c,s.padding),s}_minimumAABBFrustumDistance(s,c){const m=c.max[0]-c.min[0],y=c.max[1]-c.min[1];return m/y>s.aspect?m/(2*Math.tan(.5*s.fovX)*s.aspect):y/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,c,m,y,x,E){const C=s.clone(),A=this._extendCameraOptions(E);C.bearing=y,C.pitch=x;const L=a.LngLat.convert(c),R=a.LngLat.convert(m),B=.5*(L.lat+R.lat),G=.5*(L.lng+R.lng),Z=a.latLngToECEF(B,G),Y=a.normalize([],Z),K=a.normalize([],a.cross([],Y,[0,1,0])),J=a.cross([],K,Y),F=[K[0],K[1],K[2],0,J[0],J[1],J[2],0,Y[0],Y[1],Y[2],0,0,0,0,1],H=[Z,a.latLngToECEF(L.lat,L.lng),a.latLngToECEF(R.lat,L.lng),a.latLngToECEF(R.lat,R.lng),a.latLngToECEF(L.lat,R.lng),a.latLngToECEF(B,L.lng),a.latLngToECEF(B,R.lng),a.latLngToECEF(L.lat,G),a.latLngToECEF(R.lat,G)];let ne=a.Aabb.fromPoints(H.map(We=>[a.dot(K,We),a.dot(J,We),a.dot(Y,We)]));const oe=a.transformMat4([],ne.center,F);a.squaredLength(oe)===0&&a.set(oe,0,0,1),a.normalize(oe,oe),a.scale$2(oe,oe,a.GLOBE_RADIUS),C.center=a.ecefToLatLng(oe);const fe=C.getWorldToCameraMatrix(),ge=a.invert(new Float64Array(16),fe);ne=a.Aabb.applyTransform(ne,a.multiply([],fe,F)),a.transformMat4(oe,oe,fe);const me=.5*(ne.max[2]-ne.min[2]),we=this._minimumAABBFrustumDistance(C,ne),xe=a.scale$2([],[0,0,1],me),Pe=a.add(xe,oe,xe),Xe=we+(C.pitch===0?0:a.distance(oe,Pe)),ke=C.globeCenterInViewSpace,Ve=a.sub([],oe,[ke[0],ke[1],ke[2]]);a.normalize(Ve,Ve),a.scale$2(Ve,Ve,Xe);const De=a.add([],oe,Ve);a.transformMat4(De,De,ge);const Ze=a.earthRadius/a.GLOBE_RADIUS,Me=a.length(De),Ue=a.mercatorZfromAltitude(Math.max(Me*Ze-a.earthRadius,Number.EPSILON),0),Je=Math.min(C.zoomFromMercatorZAdjusted(Ue),A.maxZoom);return Je>.5*(a.GLOBE_ZOOM_THRESHOLD_MIN+a.GLOBE_ZOOM_THRESHOLD_MAX)?(C.setProjection({name:"mercator"}),C.zoom=Je,this._cameraForBounds(C,c,m,y,x,E)):{center:C.center,zoom:Je,bearing:y,pitch:x}}queryTerrainElevation(s,c){const m=this.transform.elevation;return m?(c=a.extend({},{exaggerated:!0},c),m.getAtPoint(a.MercatorCoordinate.fromLngLat(s),null,c.exaggerated)):null}_cameraForBounds(s,c,m,y,x,E){if(s.projection.name==="globe")return this._cameraForBoundsOnGlobe(s,c,m,y,x,E);const C=s.clone(),A=this._extendCameraOptions(E),L=C.padding;C.bearing=y,C.pitch=x;const R=a.LngLat.convert(c),B=a.LngLat.convert(m),G=new a.LngLat(R.lng,B.lat),Z=new a.LngLat(B.lng,R.lat),Y=C.project(R),K=C.project(B),J=this.queryTerrainElevation(R),F=this.queryTerrainElevation(B),H=this.queryTerrainElevation(G),ne=this.queryTerrainElevation(Z),oe=[[Y.x,Y.y,Math.min(J||0,F||0,H||0,ne||0)],[K.x,K.y,Math.max(J||0,F||0,H||0,ne||0)]];let fe=a.Aabb.fromPoints(oe);const ge=C.getWorldToCameraMatrix(),me=a.invert(new Float64Array(16),ge);fe=a.Aabb.applyTransform(fe,ge);const we=a.sub([],fe.max,fe.min),xe=L.left||0,Pe=L.right||0,Xe=L.bottom||0,ke=L.top||0,{left:Ve,right:De,top:Ze,bottom:Me}=A.padding,Ue=.5*(xe+Pe),Je=.5*(ke+Xe),We=Math.min(C.scaleZoom(C.scale*Math.min((C.width-(xe+Pe+Ve+De))/we[0],(C.height-(Xe+ke+Me+Ze))/we[1])),A.maxZoom),Qe=C.scale/C.zoomScale(We);fe=new a.Aabb([fe.min[0]-(Ve+Ue)*Qe,fe.min[1]-(Me+Je)*Qe,fe.min[2]],[fe.max[0]+(De+Ue)*Qe,fe.max[1]+(Ze+Je)*Qe,fe.max[2]]);const vt=.5*we[2],At=this._minimumAABBFrustumDistance(C,fe),gt=[0,0,1,0];a.transformMat4$1(gt,gt,ge),a.normalize$2(gt,gt);const Et=a.scale$2([],gt,At+vt),Zt=a.add([],fe.center,Et),Ht=(typeof A.offset.x=="number"&&typeof A.offset.y=="number"?new a.Point(A.offset.x,A.offset.y):a.Point.convert(A.offset)).rotate(-a.degToRad(y));fe.center[0]-=Ht.x*Qe,fe.center[1]+=Ht.y*Qe,a.transformMat4(fe.center,fe.center,me),a.transformMat4(Zt,Zt,me);const yt=[fe.center[0],fe.center[1],Zt[2]*C.pixelsPerMeter];a.scale$2(yt,yt,1/C.worldSize);const lr=a.lngFromMercatorX(yt[0]),mr=a.latFromMercatorY(yt[1]),gr=Math.min(C._zoomFromMercatorZ(yt[2]),A.maxZoom),_r=new a.LngLat(lr,mr);return C.mercatorFromTransition&&gr<.5*(a.GLOBE_ZOOM_THRESHOLD_MIN+a.GLOBE_ZOOM_THRESHOLD_MAX)?(C.setProjection({name:"globe"}),C.zoom=gr,this._cameraForBounds(C,c,m,y,x,E)):{center:_r,zoom:gr,bearing:y,pitch:x}}fitBounds(s,c,m){const y=this.cameraForBounds(s,c);return this._fitInternal(y,c,m)}fitScreenCoordinates(s,c,m,y,x){const E=a.Point.convert(s),C=a.Point.convert(c),A=new a.Point(Math.min(E.x,C.x),Math.min(E.y,C.y)),L=new a.Point(Math.max(E.x,C.x),Math.max(E.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(E,C))return this;const R=this.transform.pointLocation3D(A),B=this.transform.pointLocation3D(L),G=this.transform.pointLocation3D(new a.Point(A.x,L.y)),Z=this.transform.pointLocation3D(new a.Point(L.x,A.y)),Y=[Math.min(R.lng,B.lng,G.lng,Z.lng),Math.min(R.lat,B.lat,G.lat,Z.lat)],K=[Math.max(R.lng,B.lng,G.lng,Z.lng),Math.max(R.lat,B.lat,G.lat,Z.lat)],J=y&&y.pitch?y.pitch:this.getPitch(),F=this._cameraForBounds(this.transform,Y,K,m,J,y);return this._fitInternal(F,y,x)}_fitInternal(s,c,m){return s?(delete(c=a.extend(s,c)).padding,c.linear?this.easeTo(c,m):this.flyTo(c,m)):this}jumpTo(s,c){this.stop();const m=s.preloadOnly?this.transform.clone():this.transform;let y=!1,x=!1,E=!1;return"zoom"in s&&m.zoom!==+s.zoom&&(y=!0,m.zoom=+s.zoom),s.center!==void 0&&(m.center=a.LngLat.convert(s.center)),"bearing"in s&&m.bearing!==+s.bearing&&(x=!0,m.bearing=+s.bearing),"pitch"in s&&m.pitch!==+s.pitch&&(E=!0,m.pitch=+s.pitch),s.padding==null||m.isPaddingEqual(s.padding)||(m.padding=s.padding),s.preloadOnly?(this._preloadTiles(m),this):(this.fire(new a.Event("movestart",c)).fire(new a.Event("move",c)),y&&this.fire(new a.Event("zoomstart",c)).fire(new a.Event("zoom",c)).fire(new a.Event("zoomend",c)),x&&this.fire(new a.Event("rotatestart",c)).fire(new a.Event("rotate",c)).fire(new a.Event("rotateend",c)),E&&this.fire(new a.Event("pitchstart",c)).fire(new a.Event("pitch",c)).fire(new a.Event("pitchend",c)),this.fire(new a.Event("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.warnOnce(oa),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,c){const m=this.transform;if(!m.projection.supportsFreeCamera)return a.warnOnce(oa),this;this.stop();const y=m.zoom,x=m.pitch,E=m.bearing;m.setFreeCameraOptions(s);const C=y!==m.zoom,A=x!==m.pitch,L=E!==m.bearing;return this.fire(new a.Event("movestart",c)).fire(new a.Event("move",c)),C&&this.fire(new a.Event("zoomstart",c)).fire(new a.Event("zoom",c)).fire(new a.Event("zoomend",c)),L&&this.fire(new a.Event("rotatestart",c)).fire(new a.Event("rotate",c)).fire(new a.Event("rotateend",c)),A&&this.fire(new a.Event("pitchstart",c)).fire(new a.Event("pitch",c)).fire(new a.Event("pitchend",c)),this.fire(new a.Event("moveend",c)),this}easeTo(s,c){this._stop(!1,s.easeId),((s=a.extend({offset:[0,0],duration:500,easing:a.ease},s)).animate===!1||this._prefersReducedMotion(s))&&(s.duration=0);const m=this.transform,y=this.getZoom(),x=this.getBearing(),E=this.getPitch(),C=this.getPadding(),A="zoom"in s?+s.zoom:y,L="bearing"in s?this._normalizeBearing(s.bearing,x):x,R="pitch"in s?+s.pitch:E,B="padding"in s?s.padding:m.padding,G=a.Point.convert(s.offset);let Z,Y,K;if(m.projection.name==="globe"){const xe=a.MercatorCoordinate.fromLngLat(m.center),Pe=G.rotate(-m.angle);xe.x+=Pe.x/m.worldSize,xe.y+=Pe.y/m.worldSize;const Xe=xe.toLngLat(),ke=a.LngLat.convert(s.center||Xe);this._normalizeCenter(ke),Z=m.centerPoint.add(Pe),Y=new a.Point(xe.x,xe.y).mult(m.worldSize),K=new a.Point(a.mercatorXfromLng(ke.lng),a.mercatorYfromLat(ke.lat)).mult(m.worldSize).sub(Y)}else{Z=m.centerPoint.add(G);const xe=m.pointLocation(Z),Pe=a.LngLat.convert(s.center||xe);this._normalizeCenter(Pe),Y=m.project(xe),K=m.project(Pe).sub(Y)}const J=m.zoomScale(A-y);let F,H;s.around&&(F=a.LngLat.convert(s.around),H=m.locationPoint(F));const ne=this._zooming||A!==y,oe=this._rotating||x!==L,fe=this._pitching||R!==E,ge=!m.isPaddingEqual(B),me=xe=>Pe=>{if(ne&&(xe.zoom=a.number(y,A,Pe)),oe&&(xe.bearing=a.number(x,L,Pe)),fe&&(xe.pitch=a.number(E,R,Pe)),ge&&(xe.interpolatePadding(C,B,Pe),Z=xe.centerPoint.add(G)),F)xe.setLocationAtPoint(F,H);else{const Xe=xe.zoomScale(xe.zoom-y),ke=A>y?Math.min(2,J):Math.max(.5,J),Ve=Math.pow(ke,1-Pe),De=xe.unproject(Y.add(K.mult(Pe*Ve)).mult(Xe));xe.setLocationAtPoint(xe.renderWorldCopies?De.wrap():De,Z)}return s.preloadOnly||this._fireMoveEvents(c),xe};if(s.preloadOnly){const xe=this._emulate(me,s.duration,m);return this._preloadTiles(xe),this}const we={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ne,this._rotating=oe,this._pitching=fe,this._padding=ge,this._easeId=s.easeId,this._prepareEase(c,s.noMoveStart,we),this._ease(me(m),xe=>{m.recenterOnTerrain(),this._afterEase(c,xe)},s),this}_prepareEase(s,c,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||m.moving||this.fire(new a.Event("movestart",s)),this._zooming&&!m.zooming&&this.fire(new a.Event("zoomstart",s)),this._rotating&&!m.rotating&&this.fire(new a.Event("rotatestart",s)),this._pitching&&!m.pitching&&this.fire(new a.Event("pitchstart",s))}_fireMoveEvents(s){this.fire(new a.Event("move",s)),this._zooming&&this.fire(new a.Event("zoom",s)),this._rotating&&this.fire(new a.Event("rotate",s)),this._pitching&&this.fire(new a.Event("pitch",s))}_afterEase(s,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,y=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new a.Event("zoomend",s)),y&&this.fire(new a.Event("rotateend",s)),x&&this.fire(new a.Event("pitchend",s)),this.fire(new a.Event("moveend",s))}flyTo(s,c){if(this._prefersReducedMotion(s)){const We=a.pick(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(We,c)}this.stop(),s=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},s);const m=this.transform,y=this.getZoom(),x=this.getBearing(),E=this.getPitch(),C=this.getPadding(),A="zoom"in s?a.clamp(+s.zoom,m.minZoom,m.maxZoom):y,L="bearing"in s?this._normalizeBearing(s.bearing,x):x,R="pitch"in s?+s.pitch:E,B="padding"in s?s.padding:m.padding,G=m.zoomScale(A-y),Z=a.Point.convert(s.offset);let Y=m.centerPoint.add(Z);const K=m.pointLocation(Y),J=a.LngLat.convert(s.center||K);this._normalizeCenter(J);const F=m.project(K),H=m.project(J).sub(F);let ne=s.curve;const oe=Math.max(m.width,m.height),fe=oe/G,ge=H.mag();if("minZoom"in s){const We=a.clamp(Math.min(s.minZoom,y,A),m.minZoom,m.maxZoom),Qe=oe/m.zoomScale(We-y);ne=Math.sqrt(Qe/ge*2)}const me=ne*ne;function we(We){const Qe=(fe*fe-oe*oe+(We?-1:1)*me*me*ge*ge)/(2*(We?fe:oe)*me*ge);return Math.log(Math.sqrt(Qe*Qe+1)-Qe)}function xe(We){return(Math.exp(We)-Math.exp(-We))/2}function Pe(We){return(Math.exp(We)+Math.exp(-We))/2}const Xe=we(0);let ke=function(We){return Pe(Xe)/Pe(Xe+ne*We)},Ve=function(We){return oe*((Pe(Xe)*(xe(Qe=Xe+ne*We)/Pe(Qe))-xe(Xe))/me)/ge;var Qe},De=(we(1)-Xe)/ne;if(Math.abs(ge)<1e-6||!isFinite(De)){if(Math.abs(oe-fe)<1e-6)return this.easeTo(s,c);const We=fe<oe?-1:1;De=Math.abs(Math.log(fe/oe))/ne,Ve=function(){return 0},ke=function(Qe){return Math.exp(We*ne*Qe)}}s.duration="duration"in s?+s.duration:1e3*De/("screenSpeed"in s?+s.screenSpeed/ne:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);const Ze=x!==L,Me=R!==E,Ue=!m.isPaddingEqual(B),Je=We=>Qe=>{const vt=Qe*De,At=1/ke(vt);We.zoom=Qe===1?A:y+We.scaleZoom(At),Ze&&(We.bearing=a.number(x,L,Qe)),Me&&(We.pitch=a.number(E,R,Qe)),Ue&&(We.interpolatePadding(C,B,Qe),Y=We.centerPoint.add(Z));const gt=Qe===1?J:We.unproject(F.add(H.mult(Ve(vt))).mult(At));return We.setLocationAtPoint(We.renderWorldCopies?gt.wrap():gt,Y),We._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(c),We};if(s.preloadOnly){const We=this._emulate(Je,s.duration,m);return this._preloadTiles(We),this}return this._zooming=!0,this._rotating=Ze,this._pitching=Me,this._padding=Ue,this._prepareEase(c,!1),this._ease(Je(m),()=>this._afterEase(c),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,c)}if(!s){const m=this.handlers;m&&m.stop(!1)}return this}_ease(s,c,m){m.animate===!1||m.duration===0?(s(1),c()):(this._easeStart=a.exported.now(),this._easeOptions=m,this._onEaseFrame=s,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,c){s=a.wrap(s,-180,180);const m=Math.abs(s-c);return Math.abs(s-360-c)<m&&(s-=360),Math.abs(s+360-c)<m&&(s+=360),s}_normalizeCenter(s){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const m=s.lng-c.center.lng;s.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&a.exported.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,c,m){const y=Math.ceil(15*c/1e3),x=[],E=s(m.clone());for(let C=0;C<=y;C++){const A=E(C/y);x.push(A.clone())}return x}}class mt{constructor(s={}){this.options=s,a.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){const c=this.options&&this.options.compact;return this._map=s,this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=q("button","mapboxgl-ctrl-attrib-button",this._container),q("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=q("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(s,c){const m=this._map._getUIString(`AttributionControl.${c}`);s.setAttribute("aria-label",m),s.removeAttribute("title"),s.firstElementChild&&s.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.config.ACCESS_TOKEN}];if(s){const m=c.reduce((y,x,E)=>(x.value&&(y+=`${x.key}=${x.value}${E<c.length-1?"&":""}`),y),"?");s.href=`${a.config.FEEDBACK_URL}/${m}#${au(this._map,!0)}`,s.rel="noopener nofollow",this._setElementTitle(s,"MapFeedback")}}_updateData(s){!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const c=this._map.style._sourceCaches;for(const y in c){const x=c[y];if(x.used){const E=x.getSource();E.attribution&&s.indexOf(E.attribution)<0&&s.push(E.attribution)}}s.sort((y,x)=>y.length-x.length),s=s.filter((y,x)=>{for(let E=x+1;E<s.length;E++)if(s[E].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));const m=s.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,s.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class wd{constructor(){a.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=q("div","mapboxgl-ctrl");const c=q("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&s.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const s=this._map.style._sourceCaches;if(Object.entries(s).length===0)return!0;for(const c in s){const m=s[c].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const s=this._container.children;if(s.length){const c=s[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Sd{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const c=++this._id;return this._queue.push({callback:s,id:c,cancelled:!1}),c}remove(s){const c=this._currentlyRunning,m=c?this._queue.concat(c):this._queue;for(const y of m)if(y.id===s)return void(y.cancelled=!0)}run(s=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const m of c)if(!m.cancelled&&(m.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Qa(d,s,c){if(d=new a.LngLat(d.lng,d.lat),s){const m=new a.LngLat(d.lng-360,d.lat),y=new a.LngLat(d.lng+360,d.lat),x=360*Math.ceil(Math.abs(d.lng-c.center.lng)/360),E=c.locationPoint(d).distSqr(s),C=s.x<0||s.y<0||s.x>c.width||s.y>c.height;c.locationPoint(m).distSqr(s)<E&&(C||Math.abs(m.lng-c.center.lng)<x)?d=m:c.locationPoint(y).distSqr(s)<E&&(C||Math.abs(y.lng-c.center.lng)<x)&&(d=y)}for(;Math.abs(d.lng-c.center.lng)>180;){const m=c.locationPoint(d);if(m.x>=0&&m.y>=0&&m.x<=c.width&&m.y<=c.height)break;d.lng>c.center.lng?d.lng-=360:d.lng+=360}return d}const aa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class dt extends a.Evented{constructor(s,c){if(super(),(s instanceof a.window.HTMLElement||c)&&(s=a.extend({element:s},c)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=s&&s.occludedOpacity||.2,s&&s.element)this._element=s.element,this._offset=a.Point.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=q("div");const y=41,x=27,E=se("svg",{display:"block",height:y*this._scale+"px",width:x*this._scale+"px",viewBox:`0 0 ${x} ${y}`},this._element),C=se("radialGradient",{id:"shadowGradient"},se("defs",{},E));se("stop",{offset:"10%","stop-opacity":.4},C),se("stop",{offset:"100%","stop-opacity":.05},C),se("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},E),se("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},E),se("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},E),se("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},E),this._offset=a.Point.convert(s&&s.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});const m=this._element.classList;for(const y in aa)m.remove(`mapboxgl-marker-anchor-${y}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){const s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=a.LngLat.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,s._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){const c=s.code,m=s.charCode||s.keyCode;c!=="Space"&&c!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(s){const c=s.originalEvent.target,m=this._element;this._popup&&(c===m||m.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const s=this._map,c=this._pos;if(!s||!c)return!1;const m=s.unproject(c),y=s.getFreeCameraOptions();if(!y.position)return!1;const x=y.position.toLngLat();return x.distanceTo(m)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const s=this._map;if(!s)return;const c=this._pos;if(!c||c.x<0||c.x>s.transform.width||c.y<0||c.y>s.transform.height)return void this._clearFadeTimer();const m=s.unproject(c);let y;s._showingGlobe()&&a.isLngLatBehindGlobe(s.transform,this._lngLat)?y=0:(y=1-s._queryFogOpacity(m),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const s=this._pos;if(!s||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${s.x}px,${s.y}px)
            ${aa[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const s=this._pos,c=this._map,m=this.getPitchAlignment();if(!c||!s||m!=="map")return"";if(!c._showingGlobe()){const A=c.getPitch();return A?`rotateX(${A}deg)`:""}const y=a.radToDeg(a.globeTiltAtLngLat(c.transform,this._lngLat)),x=s.sub(a.globeCenterToScreenPoint(c.transform)),E=Math.abs(x.x)+Math.abs(x.y);if(E===0)return"";const C=y/E;return`rotateX(${-x.y*C}deg) rotateY(${x.x*C}deg)`}_calculateZTransform(){const s=this._pos,c=this._map;if(!c||!s)return"";let m=0;const y=this.getRotationAlignment();if(y==="map")if(c._showingGlobe()){const x=c.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),E=c.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);m=a.radToDeg(Math.atan2(E.y,E.x))-90}else m=-c.getBearing();else if(y==="horizon"){const x=a.smoothstep(4,6,c.getZoom()),E=a.globeCenterToScreenPoint(c.transform);E.y+=x*c.transform.height;const C=s.sub(E),A=a.radToDeg(Math.atan2(C.y,C.x));m=(A>90?A-270:A+90)*(1-x)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(s){a.window.cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=Qa(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),s===!0?this._updateFrameId=a.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=a.Point.convert(s),this._update(),this}_onMove(s){const c=this._map;if(!c)return;const m=this._pointerdownPos,y=this._positionDelta;if(m&&y){if(!this._isDragging){const x=this._clickTolerance||c._clickTolerance;if(s.point.dist(m)<x)return;this._isDragging=!0}this._pos=s.point.sub(y),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(s){const c=this._map,m=this._pos;c&&m&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(m),this._pointerdownPos=s.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;const c=this._map;return c&&(s?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Td={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},vy=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function nm(d=new a.Point(0,0),s="bottom"){if(typeof d=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(s){case"top":return new a.Point(0,d);case"top-left":return new a.Point(c,c);case"top-right":return new a.Point(-c,c);case"bottom":return new a.Point(0,-d);case"bottom-left":return new a.Point(c,-c);case"bottom-right":return new a.Point(-c,-c);case"left":return new a.Point(d,0);case"right":return new a.Point(-d,0)}return new a.Point(0,0)}return d instanceof a.Point||Array.isArray(d)?a.Point.convert(d):a.Point.convert(d[s]||[0,0])}class Ed{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;const c=a.easeCubicInOut((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,c,m){this._start=this.getValue(c),this._end=s,this._startTime=c,this._endTime=c+m}}const im={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},sm={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},xy={showCompass:!0,showZoom:!0,visualizePitch:!1};class by{constructor(s,c,m=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new _d({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,m&&(this.mousePitch=new yd({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(s,c){this.mouseRotate.mousedown(s,c),this.mousePitch&&this.mousePitch.mousedown(s,c),X()}move(s,c){const m=this.map,y=this.mouseRotate.mousemoveWindow(s,c),x=y&&y.bearingDelta;if(x&&m.setBearing(m.getBearing()+x),this.mousePitch){const E=this.mousePitch.mousemoveWindow(s,c),C=E&&E.pitchDelta;C&&m.setPitch(m.getPitch()+C)}}off(){const s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart,{passive:!1}),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ie(),a.window.removeEventListener("mousemove",this.mousemove),a.window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(a.extend({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),Le(this.element,s)),a.window.addEventListener("mousemove",this.mousemove),a.window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,Le(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ne(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=Ne(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Cd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},kd={maxWidth:100,unit:"metric"},Id={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},el={version:a.version,supported:D,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends Mc{constructor(d){if(a.LivePerformanceUtils.mark(a.PerformanceMarkers.create),(d=a.extend({},sm,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&a.isSafariWithAntialiasingBug(a.window)&&(d.antialias=!1,a.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Xa(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._useWebGL2=d.useWebGL2,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._optimizeForTerrain=d.optimizeForTerrain,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new Sd,this._domRenderTaskQueue=new Sd,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.uniqueId(),this._locale=a.extend({},im,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Ed(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new a.RequestManager(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,typeof d.container=="string"){if(this._container=a.window.document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof a.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&a.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),a.window!==void 0&&(a.window.addEventListener("online",this._onWindowOnline,!1),a.window.addEventListener("resize",this._onWindowResize,!1),a.window.addEventListener("orientationchange",this._onWindowResize,!1),a.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Es(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this._hash=d.hash&&new fd(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,a.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),d.attributionControl&&this.addControl(new mt({customAttribution:d.customAttribution})),this._logoControl=new wd,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new a.Event(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new a.Event(`${s.dataType}dataloading`,s))})}_getMapId(){return this._mapId}addControl(d,s){if(s===void 0&&(s=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=d.onAdd(this);this._controls.push(d);const m=this._controlPositions[s];return s.indexOf("bottom")!==-1?m.insertBefore(c,m.firstChild):m.appendChild(c),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(d);return s>-1&&this._controls.splice(s,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const s=!this._moving;return s&&this.fire(new a.Event("movestart",d)).fire(new a.Event("move",d)),this.fire(new a.Event("resize",d)),s&&this.fire(new a.Event("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(a.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?a.window.navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(s=>s==="auto"?a.window.navigator.language:s):d}setLanguage(d){const s=this._parseLanguage(d);if(!this.style||s===this._language)return this;this._language=s,this.style._reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,s=d.projection.name;let c;s==="globe"&&d.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?(d.setMercatorFromTransition(),c=!0):s==="mercator"&&d.zoom<a.GLOBE_ZOOM_THRESHOLD_MAX&&(d.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,s){return this._updateProjection(d||s||{name:"mercator"})}_updateProjection(d){let s;if(s=d.name==="globe"&&this.transform.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),s){this.painter.clearBackgroundTiles();for(const c in this.style._sourceCaches)this.style._sourceCaches[c].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(d){return this.transform.locationPoint3D(a.LngLat.convert(d))}unproject(d){return this.transform.pointLocation3D(a.Point.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,s,c){if(d==="mouseenter"||d==="mouseover"){let m=!1;const y=E=>{const C=s.filter(L=>this.getLayer(L)),A=C.length?this.queryRenderedFeatures(E.point,{layers:C}):[];A.length?m||(m=!0,c.call(this,new En(d,this,E.originalEvent,{features:A}))):m=!1},x=()=>{m=!1};return{layers:new Set(s),listener:c,delegates:{mousemove:y,mouseout:x}}}if(d==="mouseleave"||d==="mouseout"){let m=!1;const y=E=>{const C=s.filter(A=>this.getLayer(A));(C.length?this.queryRenderedFeatures(E.point,{layers:C}):[]).length?m=!0:m&&(m=!1,c.call(this,new En(d,this,E.originalEvent)))},x=E=>{m&&(m=!1,c.call(this,new En(d,this,E.originalEvent)))};return{layers:new Set(s),listener:c,delegates:{mousemove:y,mouseout:x}}}{const m=y=>{const x=s.filter(C=>this.getLayer(C)),E=x.length?this.queryRenderedFeatures(y.point,{layers:x}):[];E.length&&(y.features=E,c.call(this,y),delete y.features)};return{layers:new Set(s),listener:c,delegates:{[d]:m}}}}on(d,s,c){if(c===void 0)return super.on(d,s);Array.isArray(s)||(s=[s]);const m=this._createDelegatedListener(d,s,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(m);for(const y in m.delegates)this.on(y,m.delegates[y]);return this}once(d,s,c){if(c===void 0)return super.once(d,s);Array.isArray(s)||(s=[s]);const m=this._createDelegatedListener(d,s,c);for(const y in m.delegates)this.once(y,m.delegates[y]);return this}off(d,s,c){if(c===void 0)return super.off(d,s);s=new Set(Array.isArray(s)?s:[s]);const m=(x,E)=>{if(x.size!==E.size)return!1;for(const C of x)if(!E.has(C))return!1;return!0},y=this._delegatedListeners?this._delegatedListeners[d]:void 0;return y&&(x=>{for(let E=0;E<x.length;E++){const C=x[E];if(C.listener===c&&m(C.layers,s)){for(const A in C.delegates)this.off(A,C.delegates[A]);return x.splice(E,1),this}}})(y),this}queryRenderedFeatures(d,s){return this.style?(s!==void 0||d===void 0||d instanceof a.Point||Array.isArray(d)||(s=d,d=void 0),this.style.queryRenderedFeatures(d=d||[[0,0],[this.transform.width,this.transform.height]],s=s||{},this.transform)):[]}querySourceFeatures(d,s){return this.style.querySourceFeatures(d,s)}isPointOnSurface(d){const{name:s}=this.transform.projection;return s!=="globe"&&s!=="mercator"&&a.warnOnce(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.Point.convert(d))}setStyle(d,s){return(s=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&s.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(d,s))}_getUIString(d){const s=this._locale[d];if(s==null)throw new Error(`Missing UI string '${d}'`);return s}_updateStyle(d,s){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d&&(this.style=new Ss(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ss(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,s){if(typeof d=="string"){const c=this._requestManager.normalizeStyleURL(d),m=this._requestManager.transformRequest(c,a.ResourceType.Style);a.getJSON(m,(y,x)=>{y?this.fire(new a.ErrorEvent(y)):x&&this._updateDiff(x,s)})}else typeof d=="object"&&this._updateDiff(d,s)}_updateDiff(d,s){try{this.style.setState(d)&&this._update(!0)}catch(c){a.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(d,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.warnOnce("There is no style added to the map."),!1)}addSource(d,s){return this._lazyInitEmptyStyle(),this.style.addSource(d,s),this._update(!0)}isSourceLoaded(d){return!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){const d=this.style&&this.style._sourceCaches;for(const s in d){const c=d[s]._tiles;for(const m in c){const y=c[m];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}addSourceType(d,s,c){this._lazyInitEmptyStyle(),this.style.addSourceType(d,s,c)}removeSource(d){return this.style.removeSource(d),this._updateTerrain(),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,s,{pixelRatio:c=1,sdf:m=!1,stretchX:y,stretchY:x,content:E}={}){if(this._lazyInitEmptyStyle(),s instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&s instanceof a.window.ImageBitmap){const{width:C,height:A,data:L}=a.exported.getImageData(s);this.style.addImage(d,{data:new a.RGBAImage({width:C,height:A},L),pixelRatio:c,stretchX:y,stretchY:x,content:E,sdf:m,version:0})}else if(s.width===void 0||s.height===void 0)this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:A}=s,L=s;this.style.addImage(d,{data:new a.RGBAImage({width:C,height:A},new Uint8Array(L.data)),pixelRatio:c,stretchX:y,stretchY:x,content:E,sdf:m,version:0,userImage:L}),L.onAdd&&L.onAdd(this,d)}}updateImage(d,s){const c=this.style.getImage(d);if(!c)return void this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=s instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&s instanceof a.window.ImageBitmap?a.exported.getImageData(s):s,{width:y,height:x}=m;y!==void 0&&x!==void 0?y===c.data.width&&x===c.data.height?(c.data.replace(m.data,!(s instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&s instanceof a.window.ImageBitmap)),this.style.updateImage(d,c)):this.fire(new a.ErrorEvent(new Error(`The width and height of the updated image (${y}, ${x})
                must be that same as the previous version of the image
                (${c.data.width}, ${c.data.height})`))):this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,s){a.getImage(this._requestManager.transformRequest(d,a.ResourceType.Image),(c,m)=>{s(c,m instanceof a.window.HTMLImageElement?a.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(d,s){return this._lazyInitEmptyStyle(),this.style.addLayer(d,s),this._update(!0)}moveLayer(d,s){return this.style.moveLayer(d,s),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,s,c){return this.style.setLayerZoomRange(d,s,c),this._update(!0)}setFilter(d,s,c={}){return this.style.setFilter(d,s,c),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,s,c,m={}){return this.style.setPaintProperty(d,s,c,m),this._update(!0)}getPaintProperty(d,s){return this.style.getPaintProperty(d,s)}setLayoutProperty(d,s,c,m={}){return this.style.setLayoutProperty(d,s,c,m),this._update(!0)}getLayoutProperty(d,s){return this.style.getLayoutProperty(d,s)}setLight(d,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,s),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.LngLat.convert(d),this.transform):0}setFeatureState(d,s){return this.style.setFeatureState(d,s),this._update()}removeFeatureState(d,s){return this.style.removeFeatureState(d,s),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300;let c,m,y,x=this._container;for(;x&&(!m||!y);){const E=a.window.getComputedStyle(x).transform;E&&E!=="none"&&(c=E.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(m=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(y=c[3])),x=x.parentElement}this._containerWidth=m?Math.abs(d/m):d,this._containerHeight=y?Math.abs(s/y):s}_detectMissingCSS(){a.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=q("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const s=this._canvasContainer=q("div","mapboxgl-canvas-container",d);this._interactive&&s.classList.add("mapboxgl-interactive"),this._canvas=q("canvas","mapboxgl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=q("div","mapboxgl-control-container",d),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{m[y]=q("div",`mapboxgl-ctrl-${y}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,s){const c=a.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(d),this._canvas.height=c*Math.ceil(s),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${s}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const s=this._markers.indexOf(d);s!==-1&&this._markers.splice(s,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const s=this._popups.indexOf(d);s!==-1&&this._popups.splice(s,1)}_setupPainter(){const d=a.extend({},D.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._useWebGL2&&this._canvas.getContext("webgl2",d),c=s||this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);c?(this._useWebGL2&&!s&&a.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),a.storeAuthState(c,!0),this.painter=new Ha(c,this.transform,!!s),this.on("data",m=>{m.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.exported$1.testSupport(c)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let s;const c=this.painter.context.extTimerQuery,m=a.exported.now();if(this.listens("gpu-timing-frame")&&(s=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],a.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],a.window.performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,A=this.transform.pitch,L=a.exported.now(),R=new a.EvaluationParameters(C,{now:L,fadeDuration:y,pitch:A,transition:this.style.getTransition()});this.style.update(R)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(m),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(m),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new a.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){const C=a.exported.now()-m;c.endQueryEXT(c.TIME_ELAPSED_EXT,s),setTimeout(()=>{const A=c.getQueryObjectEXT(s,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(s),this.fire(new a.Event("gpu-timing-frame",{cpuTime:C,gpuTime:A})),a.window.performance.mark("frame-gpu",{startTime:m,detail:{gpuTime:A}})},50)}if(this.listens("gpu-timing-layer")){const C=this.painter.collectGpuTimers();setTimeout(()=>{const A=this.painter.queryGpuTimers(C);this.fire(new a.Event("gpu-timing-layer",{layerTimes:A}))},50)}if(this.listens("gpu-timing-deferred-render")){const C=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const A=this.painter.queryGpuTimeDeferredRender(C);this.fire(new a.Event("gpu-timing-deferred-render",{gpuTime:A}))},50)}const E=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(E||this._repaint)this.triggerRepaint();else{const C=!this.isMoving()&&this.loaded();if(C&&(x=this._updateAverageElevation(m,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),C&&(this.fire(new a.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const A=this._calculateSpeedIndex();this.fire(new a.Event("speedindexcompleted",{speedIndex:A})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,a.LivePerformanceUtils.mark(a.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&a.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const s of this._markers)d&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(const s of this._popups)!d||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(d,s=!1){const c=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);if((s||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const m=this.transform.averageElevation;let y=this.transform.sampleAverageElevation(),x=!1;this.transform.elevation&&(x=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=d;const E=Math.abs(m-y);if(E>1){if(this._isInitialLoad||x)return this._averageElevation.jumpTo(y),c(y);this._averageElevation.easeTo(y,d,300)}else if(E>1e-4)return this._averageElevation.jumpTo(y),c(y)}return!!this._averageElevation.isEasing(d)&&c(this._averageElevation.getValue(d))}_authenticate(){a.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===a.AUTH_ERR_MSG||d.status===401)){const s=this.painter.context.gl;a.storeAuthState(s,!1),this._logoControl instanceof wd&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());const c=this.painter.context.gl,m=c.createFramebuffer();function y(x){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,x,0);const E=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,E),E}return c.bindFramebuffer(c.FRAMEBUFFER,m),this._canvasPixelComparison(y(d),s.canvasCopies.map(y),s.timeStamps)}_canvasPixelComparison(d,s,c){let m=c[1]-c[0];const y=d.length/4;for(let x=0;x<s.length;x++){const E=s[x];let C=0;for(let A=0;A<E.length;A+=4)E[A]===d[A]&&E[A+1]===d[A+1]&&E[A+2]===d[A+2]&&E[A+3]===d[A+3]&&(C+=1);m+=(c[x+2]-c[x+1])*(1-C/y)}return m}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),a.window!==void 0&&(a.window.removeEventListener("resize",this._onWindowResize,!1),a.window.removeEventListener("orientationchange",this._onWindowResize,!1),a.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.removeEventListener("online",this._onWindowOnline,!1),a.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),a.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=a.exported.frame(s=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(s)}))}_preloadTiles(d){const s=this.style?Object.values(this.style._sourceCaches):[];return a.asyncAll(s,(c,m)=>c._preloadTiles(d,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){a.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,d&&this._update())}_setCacheLimits(d,s){a.setCacheLimits(d,s)}get version(){return a.version}},NavigationControl:class{constructor(d){this.options=a.extend({},xy,d),this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),q("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),q("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:s}):c.resetNorth({},{originalEvent:s}))}),this._compassIcon=q("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const s=d.getZoom(),c=s===d.getMaxZoom(),m=s===d.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new by(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,s){const c=q("button",d,this._container);return c.type="button",c.addEventListener("click",s),c}_setButtonTitle(d,s){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${s}`);d.setAttribute("aria-label",c),d.firstElementChild&&d.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends a.Evented{constructor(d){super(),this.options=a.extend({geolocation:a.window.navigator.geolocation},Cd,d),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ka(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const s=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,d(c)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):a.window.navigator.permissions!==void 0?a.window.navigator.permissions.query({name:"geolocation"}).then(c=>s(c.state!=="denied")).catch(()=>s()):s()}_isOutOfMapMaxBounds(d){const s=this._map.getMaxBounds(),c=d.coords;return!!s&&(c.longitude<s.getWest()||c.longitude>s.getEast()||c.latitude<s.getSouth()||c.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",d)),this._finish()}}_updateCamera(d){const s=new a.LngLat(d.coords.longitude,d.coords.latitude),c=d.coords.accuracy,m=this._map.getBearing(),y=a.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(c),y,{geolocateSource:!0})}_updateMarker(d){if(d){const s=new a.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,s=a.mercatorZfromAltitude(1,d._center.lat)*d.worldSize,c=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=q("button","mapboxgl-ctrl-geolocate",this._container),q("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=q("div","mapboxgl-user-location"),this._dotElement.appendChild(q("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(q("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new dt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=q("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new dt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{a.window.addEventListener("ondeviceorientationabsolute"in a.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};a.window.DeviceMotionEvent!==void 0&&typeof a.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(s=>{s==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),a.window.removeEventListener("deviceorientation",this._onDeviceOrientation),a.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:mt,ScaleControl:class{constructor(d){this.options=a.extend({},kd,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),a.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,s=this._map,c=s._containerHeight/2,m=s._containerWidth/2-d/2,y=s.unproject([m,c]),x=s.unproject([m+d,c]),E=y.distanceTo(x);if(this.options.unit==="imperial"){const C=3.2808*E;C>5280?this._setScale(d,C/5280,"mile"):this._setScale(d,C,"foot")}else this.options.unit==="nautical"?this._setScale(d,E/1852,"nautical-mile"):E>=1e3?this._setScale(d,E/1e3,"kilometer"):this._setScale(d,E,"meter")}_setScale(d,s,c){this._map._requestDomTask(()=>{const m=function(x){const E=Math.pow(10,`${Math.floor(x)}`.length-1);let C=x/E;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(A){const L=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*L)/L}(C),E*C}(s),y=m/s;this._container.innerHTML=this._isNumberFormatSupported&&c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(m):`${m}&nbsp;${Id[c]}`,this._container.style.width=d*y+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof a.window.HTMLElement?this._container=d.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in a.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in a.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,a.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!a.window.document.fullscreenEnabled&&!a.window.document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=q("button","mapboxgl-ctrl-fullscreen",this._controlContainer);q("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),a.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(a.window.document.fullscreenElement||a.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?a.window.document.exitFullscreen?a.window.document.exitFullscreen():a.window.document.webkitCancelFullScreen&&a.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.Evented{constructor(d){super(),this.options=a.extend(Object.create(Td),d),a.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=a.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update();const s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(a.window.document.createTextNode(d))}setHTML(d){const s=a.window.document.createDocumentFragment(),c=a.window.document.createElement("body");let m;for(c.innerHTML=d;m=c.firstChild,m;)s.appendChild(m);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=q("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(d),this.options.closeButton){const c=this._closeButton=q("button","mapboxgl-popup-close-button",s);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let s;return this._classList.delete(d)?s=!1:(this._classList.add(d),s=!0),this._updateClassList(),s}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const s=this._map,c=this._container,m=this._pos;if(!s||!c||!m)return"bottom";const y=c.offsetWidth,x=c.offsetHeight,E=m.x<y/2,C=m.x>s.transform.width-y/2;if(m.y+d<x)return E?"top-left":C?"top-right":"top";if(m.y>s.transform.height-x){if(E)return"bottom-left";if(C)return"bottom-right"}return E?"left":C?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),d.className=s.join(" ")}_update(d){const s=this._map,c=this._content;if(!s||!this._lngLat&&!this._trackPointer||!c)return;let m=this._container;if(m||(m=this._container=q("div","mapboxgl-popup",s.getContainer()),this._tip=q("div","mapboxgl-popup-tip",m),m.appendChild(c)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Qa(this._lngLat,this._pos,s.transform)),!this._trackPointer||d){const y=this._pos=this._trackPointer&&d?d:s.project(this._lngLat),x=nm(this.options.offset),E=this._anchor=this._getAnchor(x.y),C=nm(this.options.offset,E),A=y.add(C).round();s._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${aa[E]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&s._showingGlobe()){const y=a.isLngLatBehindGlobe(s.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(vy);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:dt,Style:Ss,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.Point,MercatorCoordinate:a.MercatorCoordinate,FreeCameraOptions:Vp,Evented:a.Evented,config:a.config,prewarm:function(){Vs().acquire(vi)},clearPrewarmedResources:function(){const d=nn;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(vi),nn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return a.config.ACCESS_TOKEN},set accessToken(d){a.config.ACCESS_TOKEN=d},get baseApiUrl(){return a.config.API_URL},set baseApiUrl(d){a.config.API_URL=d},get workerCount(){return gn.workerCount},set workerCount(d){gn.workerCount=d},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){a.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){a.clearTileCache(d)},workerUrl:"",workerClass:null,setNow:a.exported.setNow,restoreNow:a.exported.restoreNow};return el});var T=_;return T})})(KM);var JN=KM.exports;const vl=Dh(JN);vl.accessToken="pk.eyJ1IjoiZmllbGRjb3JwbWFwYm94IiwiYSI6ImNscjUyODVxMjAwdDYyanB4dGU3OGtraHgifQ.qY3vVHH3oDC8_CIQv-ogVw";function QN(){const t=Ib(),r=xp(),{id:o}=k3(),[u,f]=ve.useState(null),[_,b]=ve.useState(null),T=ve.useRef(null),a=ve.useRef(null),I=ve.useRef([]),[D,j]=ve.useState(!0),[V,q]=ve.useState(!0),[se,pe]=ve.useState(null),{theme:be,toggleTheme:te}=Y_(),X=be==="dark";ve.useEffect(()=>{"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(Le=>{b([Le.coords.longitude,Le.coords.latitude])},Le=>{console.error("Error getting location:",Le)})},[]),ve.useEffect(()=>{(async()=>{if(o)try{const{data:Ne,error:qe}=await Ml.from("route_stretches").select(`
            *,
            waypoints (*)
          `).eq("id",o).single();if(qe){console.warn("Using mock data:",qe);const it=XC.find(Ae=>Ae.id===o);if(!it)throw new Error("Route not found");f(it)}else if(Ne)f(Ne);else{const it=XC.find(Ae=>Ae.id===o);if(!it)throw new Error("Route not found");f(it)}}catch(Ne){console.error("Error fetching route:",Ne),pe("Route not found")}finally{j(!1)}})()},[o]),ve.useEffect(()=>{var Le;if(!(!T.current||!((Le=u==null?void 0:u.waypoints)!=null&&Le.length))){a.current&&(I.current.forEach(Ne=>Ne.remove()),a.current.remove(),a.current=null);try{q(!0),a.current=new vl.Map({container:T.current,style:X?"mapbox://styles/mapbox/navigation-night-v1":"mapbox://styles/mapbox/streets-v12",center:[u.waypoints[0].longitude,u.waypoints[0].latitude],zoom:12,attributionControl:!1}),a.current.addControl(new vl.NavigationControl,"top-right"),a.current.on("load",()=>{if(!a.current)return;if(I.current.forEach(it=>it.remove()),I.current=[],_&&u.status==="not_started"){const it=document.createElement("div");it.className="custom-marker",it.style.width="32px",it.style.height="32px",it.style.backgroundColor="#4CAF50",it.style.border="2px solid white",it.style.borderRadius="4px",it.style.color="white",it.style.textAlign="center",it.style.lineHeight="28px",it.style.fontSize="14px",it.style.fontWeight="bold",it.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)",it.innerHTML="S";const Ae=new vl.Marker({element:it}).setLngLat(_).setPopup(new vl.Popup({offset:25}).setHTML("<div>Starting Point</div>")).addTo(a.current);I.current.push(Ae)}u.waypoints.forEach((it,Ae)=>{const Tt=document.createElement("div");Tt.className="custom-marker",Tt.style.width="32px",Tt.style.height="32px",Tt.style.backgroundColor="#FF4444",Tt.style.border="2px solid white",Tt.style.borderRadius="4px",Tt.style.color="white",Tt.style.textAlign="center",Tt.style.lineHeight="28px",Tt.style.fontSize="14px",Tt.style.fontWeight="bold",Tt.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)",Tt.innerHTML=`${Ae+1}`;const $t=new vl.Marker({element:Tt}).setLngLat([it.longitude,it.latitude]).setPopup(new vl.Popup({offset:25}).setHTML(`
                  <div style="color: ${X?"#fff":"#000"}">
                    <h3>Ponto ${Ae+1}</h3>
                    <p>${it.description}</p>
                  </div>
                `)).addTo(a.current);I.current.push($t)});const Ne=u.waypoints.map(it=>[it.longitude,it.latitude]);a.current.getSource("route")?a.current.getSource("route").setData({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:Ne}}):(a.current.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:Ne}}}),a.current.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#FF4444","line-width":4,"line-opacity":.8}}));const qe=Ne.reduce((it,Ae)=>it.extend(Ae),new vl.LngLatBounds(Ne[0],Ne[0]));_&&qe.extend(_),a.current.fitBounds(qe,{padding:50}),q(!1)})}catch(Ne){console.error("Error initializing map:",Ne),pe("Error loading map"),q(!1)}return()=>{I.current.forEach(Ne=>Ne.remove()),a.current&&(a.current.remove(),a.current=null)}}},[u,X,_]);const ie=async()=>{if(u){if(u.status==="not_started")try{const{error:Le}=await Ml.from("route_stretches").update({status:"in_progress"}).eq("id",u.id);if(Le)throw Le}catch(Le){console.error("Error updating route status:",Le)}navigator.geolocation.getCurrentPosition(Le=>{const{latitude:Ne,longitude:qe}=Le.coords;let it=`${Ne},${qe}`;u.waypoints.forEach(Ae=>{it+=`/${Ae.latitude},${Ae.longitude}`}),t.open(`https://www.google.com/maps/dir/${it}`,"_blank"),r("/routes")},Le=>{console.error("Error getting location:",Le),alert("Could not get your current location. Please enable location services and try again.")},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}},Se=Le=>{switch(Le){case"completed":return"Visualizar";case"in_progress":return"Finalizar";default:return"Iniciar"}},Ce=en.create({container:{flex:1,height:"100vh",backgroundColor:"#f5f5f5"},containerDark:{backgroundColor:"#1a1a1a"},loadingContainer:{flex:1,justifyContent:"center",alignItems:"center"},loadingText:{marginTop:t.width<768?12:16,fontSize:t.width<768?14:16,color:"#333"},loadingTextDark:{color:"#fff"},errorContainer:{flex:1,justifyContent:"center",alignItems:"center",padding:t.width<768?16:20},errorText:{fontSize:t.width<768?14:16,color:"#ff4444",textAlign:"center",marginBottom:t.width<768?16:20},errorTextDark:{color:"#ff6666"},header:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:t.width<768?16:20,backgroundColor:"white",borderBottomWidth:1,borderBottomColor:"#eee"},headerDark:{backgroundColor:"#2d2d2d",borderBottomColor:"#444"},titleContainer:{flexDirection:"row",alignItems:"center",gap:t.width<768?8:12},icon:{marginRight:t.width<768?4:8},title:{fontSize:t.width<768?20:24,fontWeight:"bold",color:"#333",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif'},titleDark:{color:"#fff"},themeToggle:{padding:t.width<768?6:8,borderRadius:50},mapContainer:{flex:1,position:"relative"},mapLoadingOverlay:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:X?"rgba(0, 0, 0, 0.9)":"rgba(255, 255, 255, 0.9)",justifyContent:"center",alignItems:"center",zIndex:1e3},mapDiv:{width:"100%",height:"100%"},buttonContainer:{flexDirection:"row",justifyContent:"space-between",padding:t.width<768?16:20,backgroundColor:"white",borderTopWidth:1,borderTopColor:"#eee"},buttonContainerDark:{backgroundColor:"#2d2d2d",borderTopColor:"#444"},button:{flex:1,padding:t.width<768?12:15,borderRadius:8,marginHorizontal:t.width<768?8:10,alignItems:"center"},cancelButton:{backgroundColor:"#D3D3D3"},startButton:{backgroundColor:"#4CAF50"},buttonText:{color:"white",fontSize:t.width<768?14:16,fontWeight:"bold"}});return D||!u?nt.jsx(Rt,{style:[Ce.container,X&&Ce.containerDark],children:nt.jsxs(Rt,{style:Ce.loadingContainer,children:[nt.jsx(__,{size:"large",color:X?"#66b3ff":"#0066cc"}),nt.jsx(wn,{style:[Ce.loadingText,X&&Ce.loadingTextDark],children:"Carregando..."})]})}):se?nt.jsx(Rt,{style:[Ce.container,X&&Ce.containerDark],children:nt.jsxs(Rt,{style:Ce.errorContainer,children:[nt.jsx(wn,{style:[Ce.errorText,X&&Ce.errorTextDark],children:se}),nt.jsx(Zi,{style:[Ce.button,Ce.cancelButton],onPress:()=>r("/routes"),children:nt.jsx(wn,{style:Ce.buttonText,children:"Voltar"})})]})}):nt.jsxs(Rt,{style:[Ce.container,X&&Ce.containerDark],children:[nt.jsxs(Rt,{style:[Ce.header,X&&Ce.headerDark],children:[nt.jsxs(Rt,{style:Ce.titleContainer,children:[nt.jsx(XM,{size:t.width<768?20:24,color:X?"#66b3ff":"#0066cc",style:Ce.icon}),nt.jsx(wn,{style:[Ce.title,X&&Ce.titleDark],children:u.name})]}),nt.jsx(Zi,{style:Ce.themeToggle,onPress:te,children:X?nt.jsx(Q_,{size:t.width<768?14:16,color:"#fff"}):nt.jsx(J_,{size:t.width<768?14:16,color:"#000"})})]}),nt.jsxs(Rt,{style:Ce.mapContainer,children:[V&&nt.jsxs(Rt,{style:Ce.mapLoadingOverlay,children:[nt.jsx(__,{size:"large",color:X?"#66b3ff":"#0066cc"}),nt.jsx(wn,{style:[Ce.loadingText,X&&Ce.loadingTextDark],children:"Carregando mapa..."})]}),nt.jsx("div",{ref:T,style:Ce.mapDiv})]}),nt.jsxs(Rt,{style:[Ce.buttonContainer,X&&Ce.buttonContainerDark],children:[nt.jsx(Zi,{style:[Ce.button,Ce.cancelButton],onPress:()=>r("/routes"),children:nt.jsx(wn,{style:Ce.buttonText,children:"Voltar"})}),nt.jsx(Zi,{style:[Ce.button,Ce.startButton],onPress:ie,children:nt.jsx(wn,{style:Ce.buttonText,children:Se(u.status)})})]})]})}const KC=({children:t})=>{const{session:r}=WM();return r?t:nt.jsx(wA,{to:"/login"})};function eU(){return nt.jsx(VN,{children:nt.jsx(UN,{children:nt.jsx(q3,{children:nt.jsxs($3,{children:[nt.jsx(ih,{path:"/login",element:nt.jsx(HN,{})}),nt.jsx(ih,{path:"/register",element:nt.jsx(ZN,{})}),nt.jsx(ih,{path:"/routes",element:nt.jsx(KC,{children:nt.jsx(KN,{})})}),nt.jsx(ih,{path:"/route/:id",element:nt.jsx(KC,{children:nt.jsx(QN,{})})}),nt.jsx(ih,{path:"/",element:nt.jsx(wA,{to:"/login"})})]})})})})}const tU=document.getElementById("root"),rU=uA(tU);rU.render(nt.jsx(Sn.StrictMode,{children:nt.jsx(eU,{})}));export{Dh as g};
